This file is a merged representation of a subset of the codebase, containing files not matching ignore patterns, combined into a single document by Repomix.

<file_summary>
This section contains a summary of this file.

<purpose>
This file contains a packed representation of a subset of the repository's contents that is considered the most important context.
It is designed to be easily consumable by AI systems for analysis, code review,
or other automated processes.
</purpose>

<file_format>
The content is organized as follows:
1. This summary section
2. Repository information
3. Directory structure
4. Repository files (if enabled)
5. Multiple file entries, each consisting of:
  - File path as an attribute
  - Full contents of the file
</file_format>

<usage_guidelines>
- This file should be treated as read-only. Any changes should be made to the
  original repository files, not this packed version.
- When processing this file, use the file path to distinguish
  between different files in the repository.
- Be aware that this file may contain sensitive information. Handle it with
  the same level of security as you would the original repository.
</usage_guidelines>

<notes>
- Some files may have been excluded based on .gitignore rules and Repomix's configuration
- Binary files are not included in this packed representation. Please refer to the Repository Structure section for a complete list of file paths, including binary files
- Files matching these patterns are excluded: ./**/*.md
- Files matching patterns in .gitignore are excluded
- Files matching default ignore patterns are excluded
- Files are sorted by Git change count (files with more changes are at the bottom)
</notes>

</file_summary>

<directory_structure>
.ruler/
  ruler.toml
.vooster/
  project.json
  rules.json
  vooster.json
e2e/
  example.spec.ts
scripts/
  check-env.ts
  test-env-check.sh
src/
  app/
    (protected)/
      account/
        page.tsx
      dashboard/
        page.tsx
      new-article/
        page.tsx
      style-guide/
        page.tsx
      layout.tsx
    (public)/
      layout.tsx
      page.tsx
    api/
      [[...hono]]/
        route.ts
    auth/
      after/
        page.tsx
      onboarding/
        _actions.ts
        page.tsx
      layout.tsx
    example/
      page.tsx
    login/
      page.tsx
    sign-in/
      [[...sign-in]]/
        layout.tsx
        page.tsx
    sign-up/
      [[...sign-up]]/
        layout.tsx
        page.tsx
    signup/
      page.tsx
    globals.css
    layout.tsx
    providers.tsx
  backend/
    config/
      index.ts
    hono/
      app.ts
      context.ts
    http/
      response.ts
    middleware/
      context.ts
      error.ts
      supabase.ts
    supabase/
      client.ts
  components/
    brand/
      logo.tsx
    dashboard/
      activity-chart.tsx
      recent-articles-list.tsx
      stats-cards.tsx
      welcome-banner.tsx
      welcome-header.tsx
    layout/
      header.tsx
      sidebar.tsx
    ui/
      accordion.tsx
      alert.tsx
      avatar.tsx
      badge.tsx
      button.tsx
      card.tsx
      checkbox.tsx
      dropdown-menu.tsx
      file-upload.tsx
      form.tsx
      input.tsx
      label.tsx
      progress.tsx
      select.tsx
      separator.tsx
      sheet.tsx
      skeleton.tsx
      sonner.tsx
      table.tsx
      tabs.tsx
      textarea.tsx
      toast.tsx
      toaster.tsx
  constants/
    auth.ts
    env.ts
  features/
    articles/
      actions/
        article-actions.ts
      backend/
        ai-service.ts
        error.ts
        quota-service.ts
        route.ts
        schema.ts
        service.ts
      components/
        article-form.tsx
        article-preview.tsx
        generation-progress.tsx
        seo-panel.tsx
      hooks/
        useArticle.ts
        useCreateArticle.ts
        useGenerateArticle.ts
        useStyleGuide.ts
        useUpdateArticle.ts
      lib/
        article-form-schema.ts
        article-schema.ts
        dto.ts
    auth/
      context/
        current-user-context.tsx
      hooks/
        useCurrentUser.ts
      server/
        load-current-user.ts
      types.ts
    example/
      backend/
        error.ts
        route.ts
        schema.ts
        service.ts
      components/
        example-status.test.tsx
        example-status.tsx
      hooks/
        useExampleQuery.ts
      lib/
        dto.test.ts
        dto.ts
    onboarding/
      actions/
        complete-onboarding.ts
      backend/
        error.ts
        route.ts
        schema.ts
        service.ts
      components/
        onboarding-wizard.tsx
        preview-panel.tsx
        step-audience.tsx
        step-brand-voice.tsx
        step-indicator.tsx
        step-language.tsx
        step-review.tsx
        step-style.tsx
      lib/
        constants.ts
        onboarding-schema.ts
  hooks/
    use-toast.ts
  lib/
    remote/
      api-client.ts
    supabase/
      browser-client.ts
      client.ts
      server-client.ts
      server.ts
      types.ts
    clerk-theme.ts
    slug.ts
    utils.ts
  types/
    globals.d.ts
  middleware.ts
supabase/
  migrations/
    0001_create_example_table.sql
    0002_create_style_guides_table.sql
    0003_create_articles_table.sql
    0004_create_generation_quota_table.sql
.cursorignore
.env.example
.env.test
.gitignore
components.json
eslint.config.mjs
next.config.ts
package.json
playwright.config.ts
postcss.config.mjs
tailwind.config.ts
tsconfig.json
vitest.config.ts
vitest.d.ts
vitest.setup.ts
</directory_structure>

<files>
This section contains the contents of the repository's files.

<file path="src/app/(public)/layout.tsx">
import { ClerkProvider } from "@clerk/nextjs";
import { loadCurrentUser } from "@/features/auth/server/load-current-user";
import { CurrentUserProvider } from "@/features/auth/context/current-user-context";

/**
 * Public Layout
 *
 * This layout wraps public pages (like homepage) with optional authentication.
 * Unlike protected routes, these pages can be accessed without authentication,
 * but still provide user context if the user is logged in.
 */
export default async function PublicLayout({
  children,
}: {
  children: React.ReactNode;
}) {
  // Load current user (will return unauthenticated if not logged in)
  const currentUser = await loadCurrentUser();

  return (
    <ClerkProvider>
      <CurrentUserProvider initialState={currentUser}>
        {children}
      </CurrentUserProvider>
    </ClerkProvider>
  );
}
</file>

<file path="src/app/(public)/page.tsx">
"use client";

import { useCallback, useMemo, useState } from "react";
import Link from "next/link";
import { useRouter } from "next/navigation";
import { Copy, CheckCircle2, Boxes, Database, LogOut, Server } from "lucide-react";
import { getSupabaseBrowserClient } from "@/lib/supabase/browser-client";
import { useCurrentUser } from "@/features/auth/hooks/useCurrentUser";

type SetupCommand = {
  id: string;
  label: string;
  command: string;
};

const setupCommands: SetupCommand[] = [
  { id: "install", label: "ì˜ì¡´ì„± ì„¤ì¹˜", command: "npm install" },
  { id: "lint", label: "ì •ì  ì ê²€", command: "npm run lint" },
  { id: "dev", label: "ë¡œì»¬ ê°œë°œ ì„œë²„", command: "npm run dev" },
];

const envVariables = [
  {
    key: "SUPABASE_URL",
    description: "Supabase í”„ë¡œì íŠ¸ URL (https://...supabase.co)",
  },
  {
    key: "SUPABASE_SERVICE_ROLE_KEY",
    description:
      "ì„œë²„ ì „ìš© service-role í‚¤. ì ˆëŒ€ í´ë¼ì´ì–¸íŠ¸ë¡œ ë…¸ì¶œí•˜ì§€ ë§ˆì„¸ìš”.",
  },
];

const directorySummary = [
  {
    title: "ì•± ë¼ìš°í„°",
    description: "Next.js App Router ì—”íŠ¸ë¦¬í¬ì¸íŠ¸ì™€ ë ˆì´ì•„ì›ƒ ì •ì˜",
    path: "src/app",
  },
  {
    title: "Hono ì—”íŠ¸ë¦¬í¬ì¸íŠ¸",
    description: "Next.js Route Handlerì—ì„œ Hono ì•±ì„ ìœ„ì„",
    path: "src/app/api/[[...hono]]",
  },
  {
    title: "ë°±ì—”ë“œ êµ¬ì„±ìš”ì†Œ",
    description: "Hono ì•±, ë¯¸ë“¤ì›¨ì–´, Supabase ì„œë¹„ìŠ¤",
    path: "src/backend",
  },
  {
    title: "ê¸°ëŠ¥ ëª¨ë“ˆ",
    description: "ê° ê¸°ëŠ¥ë³„ DTO, ë¼ìš°í„°, React Query í›…",
    path: "src/features/[feature]",
  },
];

const backendBuildingBlocks = [
  {
    icon: <Server className="w-4 h-4" />,
    title: "Hono ì•± êµ¬ì„±",
    description:
      "errorBoundary â†’ withAppContext â†’ withSupabase â†’ registerExampleRoutes ìˆœì„œë¡œ ë¯¸ë“¤ì›¨ì–´ì™€ ë¼ìš°í„°ë¥¼ ì¡°ë¦½í•©ë‹ˆë‹¤.",
  },
  {
    icon: <Database className="w-4 h-4" />,
    title: "Supabase ì„œë¹„ìŠ¤",
    description:
      "service-role í‚¤ë¡œ ìƒì„±í•œ ì„œë²„ í´ë¼ì´ì–¸íŠ¸ë¥¼ ì‚¬ìš©í•˜ê³ , ì¿¼ë¦¬ ê²°ê³¼ëŠ” ts-patternìœ¼ë¡œ ë¶„ê¸° ê°€ëŠ¥í•œ ê²°ê³¼ ê°ì²´ë¡œ ë°˜í™˜í•©ë‹ˆë‹¤.",
  },
  {
    icon: <Boxes className="w-4 h-4" />,
    title: "React Query ì—°ë™",
    description:
      "ëª¨ë“  í´ë¼ì´ì–¸íŠ¸ ë°ì´í„° íŒ¨ì¹­ì€ useExampleQueryì™€ ê°™ì€ React Query í›…ì„ í†µí•´ ìˆ˜í–‰í•˜ë©°, DTO ìŠ¤í‚¤ë§ˆë¡œ ì‘ë‹µì„ ê²€ì¦í•©ë‹ˆë‹¤.",
  },
];

export default function Home() {
  const [copiedCommand, setCopiedCommand] = useState<string | null>(null);
  const { user, isAuthenticated, isLoading, refresh } = useCurrentUser();
  const router = useRouter();

  const handleSignOut = useCallback(async () => {
    const supabase = getSupabaseBrowserClient();
    await supabase.auth.signOut();
    await refresh();
    router.replace("/");
  }, [refresh, router]);

  const authActions = useMemo(() => {
    if (isLoading) {
      return (
        <span className="text-sm text-slate-300">ì„¸ì…˜ í™•ì¸ ì¤‘...</span>
      );
    }

    if (isAuthenticated && user) {
      return (
        <div className="flex items-center gap-3 text-sm text-slate-200">
          <span className="truncate">{user.email ?? "ì•Œ ìˆ˜ ì—†ëŠ” ì‚¬ìš©ì"}</span>
          <div className="flex items-center gap-2">
            <Link
              href="/dashboard"
              className="rounded-md border border-slate-600 px-3 py-1 transition hover:border-slate-400 hover:bg-slate-800"
            >
              ëŒ€ì‹œë³´ë“œ
            </Link>
            <button
              type="button"
              onClick={handleSignOut}
              className="flex items-center gap-1 rounded-md bg-slate-100 px-3 py-1 text-slate-900 transition hover:bg-white"
            >
              <LogOut className="h-4 w-4" />
              ë¡œê·¸ì•„ì›ƒ
            </button>
          </div>
        </div>
      );
    }

    return (
      <div className="flex items-center gap-3 text-sm">
        <Link
          href="/login"
          className="rounded-md border border-slate-600 px-3 py-1 text-slate-200 transition hover:border-slate-400 hover:bg-slate-800"
        >
          ë¡œê·¸ì¸
        </Link>
        <Link
          href="/signup"
          className="rounded-md bg-slate-100 px-3 py-1 text-slate-900 transition hover:bg-white"
        >
          íšŒì›ê°€ì…
        </Link>
      </div>
    );
  }, [handleSignOut, isAuthenticated, isLoading, user]);

  const handleCopy = (command: string) => {
    navigator.clipboard.writeText(command);
    setCopiedCommand(command);
    window.setTimeout(() => setCopiedCommand(null), 2000);
  };

  return (
    <main className="min-h-screen bg-gradient-to-br from-slate-950 via-slate-900 to-slate-800 text-white">
      <div className="mx-auto flex w-full max-w-6xl flex-col gap-10 px-6 py-16">
        <div className="flex items-center justify-between rounded-xl border border-slate-700 bg-slate-900/80 px-6 py-4">
          <div className="text-sm font-medium text-slate-300">
            SuperNext â€” êµ¬ì¡°ì ì¸ Next.js + Supabase í…œí”Œë¦¿
          </div>
          {authActions}
        </div>
        <header className="space-y-4">
          <h1 className="text-4xl font-semibold tracking-tight md:text-5xl">
            SuperNext í”„ë¡œì íŠ¸ ì„¤ì • & êµ¬ì¡° ì•ˆë‚´ì„œ
          </h1>
          <p className="max-w-3xl text-base text-slate-300 md:text-lg">
            React Query / Hono.js / Supabaseë¥¼ ì‚¬ìš©í•©ë‹ˆë‹¤.
            <br /> ëª¨ë“  ì»´í¬ë„ŒíŠ¸ëŠ” Client Componentë¡œ ì‘ì„±í•©ë‹ˆë‹¤.
          </p>
        </header>

        <section className="grid gap-8 md:grid-cols-2">
          <SetupChecklist copiedCommand={copiedCommand} onCopy={handleCopy} />
          <EnvironmentGuide />
        </section>

        <section className="grid gap-8 md:grid-cols-2">
          <DirectoryOverview />
          <BackendOverview />
        </section>

        <footer className="rounded-xl border border-slate-700 bg-slate-900/60 p-6">
          <h2 className="text-lg font-semibold text-slate-100">
            Supabase Migration
          </h2>
          <p className="mt-2 text-sm text-slate-300">
            `supabase/migrations/20250227000100_create_example_table.sql` íŒŒì¼ì„
            Supabase ëŒ€ì‹œë³´ë“œ SQL Editorì— ì—…ë¡œë“œí•˜ì—¬ `public.example` í…Œì´ë¸”ê³¼
            ìƒ˜í”Œ ë°ì´í„°ë¥¼ ìƒì„±í•˜ì„¸ìš”. ì„œë¹„ìŠ¤ ì—­í•  í‚¤ëŠ” ì„œë²„ í™˜ê²½ ë³€ìˆ˜ì—ë§Œ
            ì €ì¥í•˜ê³ , React Query í›…ì—ì„œëŠ” ê³µê°œ APIë§Œ í˜¸ì¶œí•©ë‹ˆë‹¤.
          </p>
        </footer>
      </div>
    </main>
  );
}

function SetupChecklist({
  copiedCommand,
  onCopy,
}: {
  copiedCommand: string | null;
  onCopy: (command: string) => void;
}) {
  return (
    <div className="space-y-4 rounded-xl border border-slate-700 bg-slate-900/60 p-6">
      <h2 className="text-lg font-semibold text-slate-100">
        SuperNext ì„¤ì¹˜ ì²´í¬ë¦¬ìŠ¤íŠ¸
      </h2>
      <ul className="space-y-3">
        {setupCommands.map((item) => (
          <li key={item.id} className="flex items-start justify-between gap-3">
            <div className="flex items-start gap-3">
              <CheckCircle2 className="mt-1 h-5 w-5 text-emerald-400" />
              <div>
                <p className="font-medium text-slate-100">{item.label}</p>
                <code className="text-sm text-slate-300">{item.command}</code>
              </div>
            </div>
            <button
              type="button"
              onClick={() => onCopy(item.command)}
              className="flex items-center gap-1 rounded-md border border-slate-700 px-2 py-1 text-xs text-slate-200 transition hover:border-slate-500 hover:bg-slate-800"
            >
              <Copy className="h-3.5 w-3.5" />
              {copiedCommand === item.command ? "ë³µì‚¬ë¨" : "ë³µì‚¬"}
            </button>
          </li>
        ))}
      </ul>
      <p className="text-xs text-slate-400">
        ê°œë°œ ì„œë²„ëŠ” React Query Providerê°€ ì„¤ì •ëœ `src/app/providers.tsx`ë¥¼
        í†µê³¼í•˜ì—¬ ì‹¤í–‰ë©ë‹ˆë‹¤.
      </p>
    </div>
  );
}

function EnvironmentGuide() {
  return (
    <div className="space-y-4 rounded-xl border border-slate-700 bg-slate-900/60 p-6">
      <h2 className="text-lg font-semibold text-slate-100">í™˜ê²½ ë³€ìˆ˜</h2>
      <p className="text-sm text-slate-300">
        `.env.local` íŒŒì¼ì— ì•„ë˜ ê°’ì„ ì¶”ê°€í•˜ê³ , service-role í‚¤ëŠ” ì„œë²„ ë¹Œë“œ
        í™˜ê²½ì—ì„œë§Œ ì£¼ì…í•˜ì„¸ìš”.
      </p>
      <ul className="space-y-3">
        {envVariables.map((item) => (
          <li
            key={item.key}
            className="rounded-lg border border-slate-800 bg-slate-950/50 p-3"
          >
            <p className="font-medium text-slate-100">{item.key}</p>
            <p className="text-xs text-slate-300">{item.description}</p>
          </li>
        ))}
      </ul>
      <p className="text-xs text-slate-400">
        í™˜ê²½ ìŠ¤í‚¤ë§ˆëŠ” `src/backend/config/index.ts`ì—ì„œ zodë¡œ ê²€ì¦ë˜ë©°, ëˆ„ë½ ì‹œ
        ëª…í™•í•œ ì˜¤ë¥˜ë¥¼ ë°œìƒì‹œí‚µë‹ˆë‹¤.
      </p>
    </div>
  );
}

function DirectoryOverview() {
  return (
    <div className="space-y-4 rounded-xl border border-slate-700 bg-slate-900/60 p-6">
      <h2 className="text-lg font-semibold text-slate-100">
        SuperNext ì£¼ìš” ë””ë ‰í„°ë¦¬
      </h2>
      <ul className="space-y-3">
        {directorySummary.map((item) => (
          <li
            key={item.path}
            className="rounded-lg border border-slate-800 bg-slate-950/50 p-3"
          >
            <p className="text-sm font-semibold text-slate-100">{item.path}</p>
            <p className="text-xs text-slate-300">{item.description}</p>
            <p className="text-xs text-slate-400">{item.title}</p>
          </li>
        ))}
      </ul>
    </div>
  );
}

function BackendOverview() {
  return (
    <div className="space-y-4 rounded-xl border border-slate-700 bg-slate-900/60 p-6">
      <h2 className="text-lg font-semibold text-slate-100">
        SuperNext ë°±ì—”ë“œ ë¹Œë”© ë¸”ë¡
      </h2>
      <ul className="space-y-3">
        {backendBuildingBlocks.map((item, index) => (
          <li
            key={item.title + index}
            className="flex items-start gap-3 rounded-lg border border-slate-800 bg-slate-950/50 p-3"
          >
            <div className="mt-0.5 text-indigo-300">{item.icon}</div>
            <div>
              <p className="font-medium text-slate-100">{item.title}</p>
              <p className="text-xs text-slate-300">{item.description}</p>
            </div>
          </li>
        ))}
      </ul>
      <p className="text-xs text-slate-400">
        ì˜ˆì‹œ ë¼ìš°í„°ëŠ” `src/features/example/backend/route.ts`, ì„œë¹„ìŠ¤ ë¡œì§ì€
        `src/features/example/backend/service.ts`, ê³µí†µ ìŠ¤í‚¤ë§ˆëŠ”
        `src/features/example/backend/schema.ts`ì—ì„œ ê´€ë¦¬í•˜ë©° Supabase
        `public.example` í…Œì´ë¸”ê³¼ í†µì‹ í•©ë‹ˆë‹¤.
      </p>
    </div>
  );
}
</file>

<file path="src/app/auth/layout.tsx">
import { ClerkProvider } from "@clerk/nextjs";

/**
 * Auth Layout
 *
 * Wraps all auth-related pages with ClerkProvider.
 * Includes: /auth/onboarding, /auth/after, etc.
 */
export default function AuthLayout({
  children,
}: {
  children: React.ReactNode;
}) {
  return <ClerkProvider>{children}</ClerkProvider>;
}
</file>

<file path="src/app/sign-in/[[...sign-in]]/layout.tsx">
import { ClerkProvider } from "@clerk/nextjs";

/**
 * Sign In Layout
 *
 * Wraps the sign-in page with ClerkProvider.
 */
export default function SignInLayout({
  children,
}: {
  children: React.ReactNode;
}) {
  return <ClerkProvider>{children}</ClerkProvider>;
}
</file>

<file path="src/app/sign-up/[[...sign-up]]/layout.tsx">
import { ClerkProvider } from "@clerk/nextjs";

/**
 * Sign Up Layout
 *
 * Wraps the sign-up page with ClerkProvider.
 */
export default function SignUpLayout({
  children,
}: {
  children: React.ReactNode;
}) {
  return <ClerkProvider>{children}</ClerkProvider>;
}
</file>

<file path="src/components/ui/skeleton.tsx">
import { cn } from "@/lib/utils"

function Skeleton({
  className,
  ...props
}: React.HTMLAttributes<HTMLDivElement>) {
  return (
    <div
      className={cn("animate-pulse rounded-md bg-muted", className)}
      {...props}
    />
  )
}

export { Skeleton }
</file>

<file path="src/features/articles/components/generation-progress.tsx">
"use client";

import { useEffect, useState } from "react";
import { Card } from "@/components/ui/card";
import { Button } from "@/components/ui/button";
import { Progress } from "@/components/ui/progress";
import { Skeleton } from "@/components/ui/skeleton";
import { Alert, AlertDescription } from "@/components/ui/alert";
import { X, AlertCircle, RefreshCw, Sparkles, Clock } from "lucide-react";

interface GenerationProgressProps {
  isGenerating: boolean;
  error: Error | null;
  onCancel: () => void;
  onRetry: () => void;
}

export function GenerationProgress({
  isGenerating,
  error,
  onCancel,
  onRetry,
}: GenerationProgressProps) {
  const [progress, setProgress] = useState(0);
  const [timeElapsed, setTimeElapsed] = useState(0);
  const maxTime = 300; // 5ë¶„ (300ì´ˆ)

  useEffect(() => {
    if (!isGenerating) {
      setProgress(0);
      setTimeElapsed(0);
      return;
    }

    const interval = setInterval(() => {
      setTimeElapsed((prev) => {
        const next = prev + 1;

        // Calculate progress: 0% â†’ 95% over 5 minutes, then 100% when done
        if (next >= maxTime) {
          setProgress(95);
          return maxTime;
        }

        // Logarithmic curve for smooth progress
        const progressPercent = Math.min(95, (next / maxTime) * 100);
        setProgress(progressPercent);

        return next;
      });
    }, 1000);

    return () => clearInterval(interval);
  }, [isGenerating, maxTime]);

  // Complete progress when done
  useEffect(() => {
    if (!isGenerating && progress > 0) {
      setProgress(100);
    }
  }, [isGenerating, progress]);

  const formatTime = (seconds: number) => {
    const mins = Math.floor(seconds / 60);
    const secs = seconds % 60;
    return `${mins}:${secs.toString().padStart(2, "0")}`;
  };

  const timeRemaining = Math.max(0, maxTime - timeElapsed);

  const handleCancel = () => {
    const confirmed = window.confirm(
      "AI ê¸€ ìƒì„±ì„ ì·¨ì†Œí•˜ì‹œê² ìŠµë‹ˆê¹Œ? ì§„í–‰ ì¤‘ì¸ ì‘ì—…ì´ ì¤‘ë‹¨ë©ë‹ˆë‹¤."
    );
    if (confirmed) {
      onCancel();
    }
  };

  // Error state
  if (error) {
    const isQuotaError = error.message.includes("ìƒì„± íšŸìˆ˜ ì œí•œ");
    const isAIError = error.message.includes("AI ê¸€ ìƒì„±ì— ì‹¤íŒ¨");

    return (
      <Card
        className="p-6"
        style={{
          borderColor: "#E1E5EA",
          borderRadius: "12px",
        }}
      >
        <Alert
          variant="destructive"
          className="mb-4"
          style={{ borderColor: "#EF4444" }}
        >
          <AlertCircle className="h-4 w-4" />
          <AlertDescription>
            {isQuotaError ? (
              <div>
                <p className="font-semibold mb-2">ìƒì„± íšŸìˆ˜ ì œí•œì— ë„ë‹¬í–ˆìŠµë‹ˆë‹¤</p>
                <p className="text-sm">{error.message}</p>
                <p className="text-sm mt-2">
                  ë” ë§ì€ ê¸€ì„ ìƒì„±í•˜ë ¤ë©´ í”Œëœì„ ì—…ê·¸ë ˆì´ë“œí•´ì£¼ì„¸ìš”.
                </p>
              </div>
            ) : isAIError ? (
              <div>
                <p className="font-semibold mb-2">AI ê¸€ ìƒì„±ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤</p>
                <p className="text-sm">{error.message}</p>
                <p className="text-sm mt-2">
                  ì ì‹œ í›„ ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”. ë¬¸ì œê°€ ê³„ì†ë˜ë©´ ê³ ê° ì§€ì›íŒ€ì— ë¬¸ì˜í•´ì£¼ì„¸ìš”.
                </p>
              </div>
            ) : (
              <div>
                <p className="font-semibold mb-2">ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤</p>
                <p className="text-sm">{error.message}</p>
              </div>
            )}
          </AlertDescription>
        </Alert>

        <div className="flex gap-2">
          {!isQuotaError && (
            <Button
              onClick={onRetry}
              className="flex-1"
              style={{
                backgroundColor: "#3BA2F8",
                borderRadius: "8px",
              }}
            >
              <RefreshCw className="mr-2 h-4 w-4" />
              ë‹¤ì‹œ ì‹œë„
            </Button>
          )}
          <Button
            onClick={onCancel}
            variant="outline"
            className="flex-1"
            style={{ borderRadius: "8px" }}
          >
            ì·¨ì†Œ
          </Button>
        </div>
      </Card>
    );
  }

  // Loading state
  if (!isGenerating) {
    return null;
  }

  return (
    <Card
      className="p-6"
      style={{
        borderColor: "#E1E5EA",
        borderRadius: "12px",
      }}
      role="status"
      aria-live="polite"
      aria-label="AI ê¸€ ìƒì„± ì§„í–‰ ì¤‘"
    >
      {/* Header */}
      <div className="mb-6">
        <div className="flex items-start justify-between mb-4">
          <div className="flex items-center gap-2">
            <div
              className="p-2 rounded-lg"
              style={{ backgroundColor: "#EFF6FF" }}
            >
              <Sparkles className="h-5 w-5" style={{ color: "#3BA2F8" }} />
            </div>
            <div>
              <h3
                className="font-semibold text-lg"
                style={{ color: "#1F2937" }}
              >
                AIê°€ ê¸€ì„ ì‘ì„±í•˜ê³  ìˆìŠµë‹ˆë‹¤
              </h3>
              <p className="text-sm" style={{ color: "#6B7280" }}>
                ì ì‹œë§Œ ê¸°ë‹¤ë ¤ì£¼ì„¸ìš”
              </p>
            </div>
          </div>
          <Button
            variant="ghost"
            size="icon"
            onClick={handleCancel}
            aria-label="ì·¨ì†Œ"
            style={{ color: "#6B7280" }}
          >
            <X className="h-4 w-4" />
          </Button>
        </div>

        {/* Progress Bar */}
        <div className="space-y-2">
          <div className="flex items-center justify-between text-sm">
            <span style={{ color: "#6B7280" }}>ì§„í–‰ë¥ </span>
            <span
              className="font-semibold"
              style={{ color: "#3BA2F8" }}
              aria-label={`ì§„í–‰ë¥  ${Math.round(progress)}%`}
            >
              {Math.round(progress)}%
            </span>
          </div>
          <Progress
            value={progress}
            className="h-2"
            aria-valuenow={progress}
            aria-valuemin={0}
            aria-valuemax={100}
          />
        </div>

        {/* Timer */}
        <div
          className="mt-4 flex items-center gap-2 text-sm"
          style={{ color: "#6B7280" }}
        >
          <Clock className="h-4 w-4" />
          <span>
            ë‚¨ì€ ì‹œê°„: <span className="font-mono">{formatTime(timeRemaining)}</span>
          </span>
        </div>
      </div>

      {/* Skeleton Preview */}
      <div className="space-y-4 mb-6">
        <div>
          <Skeleton className="h-8 w-3/4 mb-2" />
          <Skeleton className="h-4 w-1/2" />
        </div>
        <div className="space-y-2">
          <Skeleton className="h-4 w-full" />
          <Skeleton className="h-4 w-full" />
          <Skeleton className="h-4 w-5/6" />
        </div>
        <div className="space-y-2">
          <Skeleton className="h-4 w-full" />
          <Skeleton className="h-4 w-full" />
          <Skeleton className="h-4 w-4/5" />
        </div>
      </div>

      {/* Motivational Message */}
      <div
        className="p-4 rounded-lg"
        style={{ backgroundColor: "#F0FDF4" }}
      >
        <p className="text-sm font-medium" style={{ color: "#16A34A" }}>
          ğŸ’¡ ì´ ê¸€ì„ ì§ì ‘ ì‘ì„±í•˜ë©´ ì•½ 50ë¶„ì´ ê±¸ë¦½ë‹ˆë‹¤. AIê°€ ë‹¹ì‹ ì˜ ì‹œê°„ì„ ì ˆì•½í•´ë“œë¦½ë‹ˆë‹¤!
        </p>
      </div>

      {/* Cancel Button */}
      <div className="mt-4">
        <Button
          onClick={handleCancel}
          variant="outline"
          className="w-full"
          style={{ borderRadius: "8px" }}
        >
          ì·¨ì†Œ
        </Button>
      </div>
    </Card>
  );
}
</file>

<file path="src/features/articles/hooks/useGenerateArticle.ts">
"use client";

import { useMutation, useQueryClient } from "@tanstack/react-query";
import { generateArticleAction } from "../actions/article-actions";
import type {
  GenerateArticleRequest,
  GenerateArticleResponse,
} from "../lib/dto";

export const useGenerateArticle = () => {
  const queryClient = useQueryClient();

  return useMutation<GenerateArticleResponse, Error, GenerateArticleRequest>({
    mutationFn: generateArticleAction,
    onSuccess: (data) => {
      // Invalidate articles list
      queryClient.invalidateQueries({ queryKey: ["articles"] });
      // Cache the new article
      queryClient.setQueryData(["article", data.article.id], data.article);
    },
  });
};
</file>

<file path=".vooster/rules.json">
{
  "rules": [
    {
      "type": "prd",
      "content": "# ì œí’ˆ ìš”êµ¬ì‚¬í•­ ë¬¸ì„œ(PRD)\n\n## 1. ì œí’ˆ í•œì¤„ ìš”ì•½\nì¸ë””í•´ì»¤ê°€ í‚¤ì›Œë“œë§Œ ì…ë ¥í•˜ë©´ ì˜ì–´Â·í•œêµ­ì–´ ë¸”ë¡œê·¸ ê¸€, SEO ë©”íƒ€ë°ì´í„°, ë¸Œëœë“œ í†¤ê¹Œì§€ 5ë¶„ ë‚´ ì™„ì„±ë˜ëŠ” AI ì½˜í…ì¸  ìƒì„± SaaS.\n\n## 2. ë¹„ì „ & ëª©í‘œ\n- ì‘ì€ íŒ€Â·ì†”ë¡œ ì°½ì—…ìê°€ ì½˜í…ì¸  ë§ˆì¼€íŒ…ë³´ë‹¤ ì œí’ˆ ê°œë°œì— ì§‘ì¤‘í•  ìˆ˜ ìˆë„ë¡ ê¸€ ì‘ì„± ì‹œê°„ì„ 90% ì´ìƒ ë‹¨ì¶•í•œë‹¤.\n- ì‚¬ìš©ìê°€ â€˜ì›”ê°„ ì™„ì„± ê¸€ ìˆ˜â€™ë¥¼ ê¾¸ì¤€íˆ ëŠ˜ë ¤ ì‚¬ì—… ì„±ì¥ì„ ì²´ê°í•˜ë„ë¡ í•œë‹¤.\n\n## 3. í•µì‹¬ ì‚¬ìš©ì(Persona)\n| êµ¬ë¶„ | íŠ¹ì§• |\n|------|------|\n| Indie Hacker Sam | 1ì¸ SaaS ì°½ì—…ì, ì—° ë§¤ì¶œ $1~50K, ë¸”ë¡œê·¸ëŠ” WordPress ë˜ëŠ” Notionìœ¼ë¡œ ìš´ì˜, ê¸€ì“°ê¸°Â·SEO ê²½í—˜ ë¶€ì¡±, ì›” $50 ì´í•˜ íˆ´ ì‚¬ìš© ì˜ˆì‚° |\n\n## 4. ì£¼ìš” Use Case\n1. Samì´ ì œí’ˆ í‚¤ì›Œë“œì™€ ê°„ë‹¨í•œ ì„¤ëª…ì„ ì…ë ¥í•œë‹¤.\n2. ì„œë¹„ìŠ¤ê°€ ë¸Œëœë“œ ë³´ì´ìŠ¤ ìœ„ì €ë“œë¥¼ í†µí•´ í†¤Â·ê¸¸ì´Â·ë…ì ìˆ˜ì¤€ì„ ì„¤ì •í•œë‹¤.\n3. 5ë¶„ ë‚´ ì´ˆì•ˆ, ì œëª©, H íƒœê·¸ êµ¬ì¡°, ë©”íƒ€ë””ìŠ¤í¬ë¦½ì…˜ì„ ìƒì„±í•œë‹¤.\n4. Samì€ ì›ìŠ¤í¬ë¦° í¸ì§‘ê¸°ì—ì„œ ë¬¸ë‹¨ë³„ ì¬ìƒì„±ì„ í•˜ê³  ì‹¤ì‹œê°„ SEO ì²´í¬ë¥¼ í™•ì¸í•œë‹¤.\n5. ë§ˆí¬ë‹¤ìš´ìœ¼ë¡œ ë‚´ë³´ë‚´ì–´ ë…¸ì…˜ ë¸”ë¡œê·¸ì— ë¶™ì—¬ë„£ê³  ë°œí–‰í•œë‹¤.\n6. ëŒ€ì‹œë³´ë“œì—ì„œ ì›”ê°„ ì™„ì„± ê¸€ ìˆ˜ì™€ ëˆ„ì  ì‹œê°„ ì ˆì•½ì„ í™•ì¸í•œë‹¤.\n\n## 5. í•µì‹¬ ê¸°ëŠ¥ (MVP)\n1. AI ì£¼ì œ ê¸°ë°˜ ê¸€ ìë™ ìƒì„± (1,500~2,500ë‹¨ì–´)\n2. SEO í‚¤ì›Œë“œ & ë©”íƒ€ë°ì´í„° ìë™ ì‚½ì…\n3. ìŠ¤íƒ€ì¼ ê°€ì´ë“œ(ë¸Œëœë“œ ë³´ì´ìŠ¤) ì €ì¥Â·ê´€ë¦¬\n4. ì˜¨ë³´ë”© ìœ„ì €ë“œ(5ë¬¸í•­)\n5. ì›ìŠ¤í¬ë¦° ê¸€ ìƒì„±Â·ìˆ˜ì • í¸ì§‘ê¸° + ì‹¤ì‹œê°„ SEO ì ê²€\n6. ì‹œê°„ ì ˆì•½ í˜„í™©íŒ & ì›”ê°„ ì™„ì„± ê¸€ ìˆ˜ ê·¸ë˜í”„\n7. Markdown ë‚´ë³´ë‚´ê¸° (ì™¸ë¶€ API ì—°ë™ ì—†ìŒ)\n\n## 6. ë¹„MVP / í–¥í›„ ê¸°ëŠ¥\n- ìë™ ì´ë¯¸ì§€ ì‚½ì…, WordPress 1-click ë°œí–‰, í‚¤ì›Œë“œ ì„±ê³¼ ëŒ€ì‹œë³´ë“œ, ì½˜í…ì¸  ìº˜ë¦°ë”, íŒ€ í˜‘ì—…, ë‹¤êµ­ì–´ 5ê°œ ì´ìƒ ì§€ì›\n\n## 7. ì„±ê³µ ì§€í‘œ(KPI)\n- í™œì„± ì‚¬ìš©ìë‹¹ ì›”ê°„ ì™„ì„± ê¸€ ìˆ˜ â‰¥ 4í¸\n- ê¸€ 3í¸ ë¬´ë£Œ ì²´í—˜ í›„ ìœ ë£Œ ì „í™˜ìœ¨ â‰¥ 25%\n- NPS â‰¥ 40\n- ê¸€ ì‘ì„± ì†Œìš” ì‹œê°„ í‰ê·  5ë¶„ ì´í•˜\n\n## 8. ê°€ê²© ì •ì±…\n- ë¬´ë£Œ: ê¸€ 3í¸ ìƒì„±ê¹Œì§€, ê¸°ëŠ¥ ì „ì²´ ì‚¬ìš© ê°€ëŠ¥\n- í”„ë¡œ í”Œëœ: ì›” $19, ê¸€ ë¬´ì œí•œ, ìŠ¤íƒ€ì¼ ê°€ì´ë“œ 3ê°œ, í–¥í›„ ê¸°ëŠ¥ ìš°ì„  ì ‘ê·¼\n\n## 9. ê¸°ìˆ  ìŠ¤íƒ(ê¸°ë³¸)\nNext.js 15, Hono.js, Supabase(PostgreSQL), TypeScript, TailwindCSS, shadcn, lucide-react, @tanstack/react-query, OpenAI GPT-4o API\n\n## 10. ê°œë°œ ì „ëµ\n- ë°©ì‹: MVP â†’ ì‚¬ìš©ì í”¼ë“œë°± ê¸°ë°˜ ì• ìì¼ ê°œì„ \n- ì¼ì •: 8ì£¼ ë‚´ ë² íƒ€, Product Hunt ëŸ°ì¹­\n- íŒ€: 2ì¸(í’€ìŠ¤íƒ 1, SEO/PM 1)\n\n## 11. ì œì•½ ì‚¬í•­\n- ë°˜ì‘í˜• ì›¹ í•„ìˆ˜(ëª¨ë°”ì¼ â‰¥ 320px)\n- ì˜ì–´Â·í•œêµ­ì–´ ê³ í’ˆì§ˆ ì¶œë ¥ í™•ë³´\n- ì¼ 10ë§Œ ë‹¨ì–´ê¹Œì§€ AI API ë¹„ìš© $200/ì›” ì´ë‚´ ìœ ì§€\n\n## 12. ìœ„í—˜ & ëŒ€ì‘\n| ë¦¬ìŠ¤í¬ | ëŒ€ì‘ |\n|---------|------|\n| AI ëª¨ë¸ í‰ì¤€í™” | ìŠ¤íƒ€ì¼ ê°€ì´ë“œ USP ê³ ë„í™”, í¸ì§‘ UX ìµœì í™” |\n| ì‚¬ìš©ì ì´íƒˆ | ì‹œê°„ ì ˆì•½ í˜„í™©íŒÂ·ì„±ê³¼ ì•Œë¦¼ìœ¼ë¡œ ì§€ì† ê°€ì¹˜ ì œê³µ |\n| ë¹„ìš© ì´ˆê³¼ | ë‹¨ì–´ ìˆ˜ í•˜ë“œì¿¼í„°, Prompt ìµœì í™” |\n\n## 13. í–¥í›„ ë¡œë“œë§µ(12ê°œì›”)\n- M0-2: MVP ê°œë°œ, íì‡„ ë² íƒ€ 100ëª…\n- M3: Product Hunt ê³µê°œ, ìœ ë£Œ ì „í™˜ ì‹œì‘\n- M4-6: ì½˜í…ì¸  ìº˜ë¦°ë”, ì›Œë“œí”„ë ˆìŠ¤ ë°œí–‰\n- M7-12: ì„±ê³¼ ëŒ€ì‹œë³´ë“œ, ì´ë¯¸ì§€ AI, íŒ€ í˜‘ì—…, ë‹¤êµ­ì–´ í™•ëŒ€\n\n## 14. ìš´ì˜ & ì§€ì›\n- Discord ì»¤ë®¤ë‹ˆí‹°ë¡œ ì‚¬ìš©ì ì§€ì›\n- ì£¼ 1íšŒ ì œí’ˆ ì—…ë°ì´íŠ¸ ë¡œê·¸ ê²Œì‹œ\n\n---\nì´ ë¬¸ì„œëŠ” ì œí’ˆ ì •ì˜ ì™„ë£Œ ë²„ì „ì…ë‹ˆë‹¤.",
      "writedAt": "2025-11-08T10:13:52.019Z"
    },
    {
      "type": "architecture",
      "content": "Of course. As a senior technical architect, my goal is to distill the technical requirements into a pragmatic blueprint that accelerates development and eliminates unnecessary complexity.\n\nThis refined TRD is focused on what the two-person team needs to build the MVP in 8 weeks, prioritizing clarity, speed, and direct alignment with the PRD.\n\n---\n\n# **Technical Requirements Document (TRD) - AI Content SaaS MVP**\n\n## 1. Guiding Principles\n\n*   **Simplicity First:** The architecture must be the simplest possible to meet the MVP requirements. We will avoid premature optimization and complex patterns.\n*   **Leverage the Stack:** Fully utilize the features of Next.js, Supabase, and Vercel to minimize boilerplate and infrastructure management.\n*   **Developer Velocity:** The structure should enable a single full-stack developer to move quickly without significant context switching.\n\n## 2. Core Technology Stack\n\n| Component           | Technology                | Role & Rationale                                                                        |\n| ------------------- | ------------------------- | --------------------------------------------------------------------------------------- |\n| **Web Framework**   | Next.js 15 (App Router)   | Handles frontend rendering, server components, and API routes. Ideal for rapid development. |\n| **API Layer**       | Hono.js                   | Integrated within Next.js API Routes for fast, lightweight backend logic.                 |\n| **Database & Auth** | Supabase (PostgreSQL)     | Provides database, user authentication, and object storage. The integrated solution simplifies the stack. |\n| **AI Model**        | OpenAI GPT-4o API         | Core engine for all text generation tasks.                                              |\n| **UI Components**   | TailwindCSS + shadcn/ui   | For rapid, consistent, and accessible UI development.                                   |\n| **State Management**| @tanstack/react-query     | Manages all server state, caching, and data fetching. Client state will use React hooks (`useState`, `useContext`). |\n| **Payments**        | TossPayments SDK          | To be integrated post-beta for the Pro Plan upgrade flow. Not a blocker for MVP launch. |\n\n## 3. System Architecture & Directory Structure\n\nWe will adopt a feature-centric, co-located structure. This is lean and scales well for a small team. The overly-nested structure from the initial draft is flattened to improve velocity.\n\n```\n/\nâ”œâ”€â”€ public/                     # Static assets (images, fonts)\nâ”œâ”€â”€ supabase/migrations/        # Database schema migrations\nâ””â”€â”€ src/\n    â”œâ”€â”€ app/                    # Next.js App Router\n    â”‚   â”œâ”€â”€ (auth)/             # Routes for auth pages (login, signup)\n    â”‚   â”‚   â””â”€â”€ page.tsx\n    â”‚   â”œâ”€â”€ (main)/             # Main application routes (protected)\n    â”‚   â”‚   â”œâ”€â”€ dashboard/      # Dashboard page\n    â”‚   â”‚   â””â”€â”€ editor/[id]/    # Article editor page\n    â”‚   â”œâ”€â”€ api/[[...route]]/   # Hono.js entrypoint for all API calls\n    â”‚   â””â”€â”€ layout.tsx\n    â”œâ”€â”€ components/\n    â”‚   â””â”€â”€ ui/                 # Auto-generated shadcn/ui components\n    â”œâ”€â”€ features/               # Core application logic modules\n    â”‚   â”œâ”€â”€ article-editor/     # All logic for the editor feature\n    â”‚   â”‚   â”œâ”€â”€ components/     # React components specific to the editor\n    â”‚   â”‚   â”œâ”€â”€ editor-actions.ts # Server Actions for saving, regenerating\n    â”‚   â”‚   â””â”€â”€ seo-checker.ts  # Client-side SEO scoring logic\n    â”‚   â”œâ”€â”€ dashboard/          # Dashboard feature\n    â”‚   â””â”€â”€ style-guide/        # Style guide (brand voice) feature\n    â””â”€â”€ lib/\n        â”œâ”€â”€ supabase/           # Supabase client setup (client & server)\n        â”œâ”€â”€ openai.ts           # OpenAI API client wrapper\n        â””â”€â”€ utils.ts            # Shared utility functions (e.g., cn)\n```\n\n## 4. Data Model (Supabase PostgreSQL Schema)\n\nThis schema is the minimum required for the MVP. We will use Supabase's built-in `auth.users` table for user management.\n\n```sql\n-- Users are handled by Supabase Auth. We reference them via UUID.\n\n-- Table to store user-defined style guides (brand voice)\nCREATE TABLE style_guides (\n    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),\n    user_id UUID REFERENCES auth.users(id) ON DELETE CASCADE NOT NULL,\n    guide_name TEXT NOT NULL,\n    brand_voice TEXT NOT NULL, -- e.g., \"Witty and Casual\", \"Formal and Authoritative\"\n    target_audience TEXT NOT NULL, -- e.g., \"Beginner developers\", \"Marketing managers\"\n    language VARCHAR(2) NOT NULL, -- 'en' or 'ko'\n    created_at TIMESTAMPTZ DEFAULT now()\n);\n\n-- Table to store generated articles\nCREATE TABLE articles (\n    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),\n    user_id UUID REFERENCES auth.users(id) ON DELETE CASCADE NOT NULL,\n    style_guide_id UUID REFERENCES style_guides(id) ON DELETE SET NULL,\n    status VARCHAR(20) NOT NULL DEFAULT 'draft', -- 'draft', 'completed'\n    keyword TEXT NOT NULL,\n    title TEXT,\n    content_markdown TEXT,\n    meta_description TEXT,\n    seo_score INT DEFAULT 0,\n    time_saved_minutes INT DEFAULT 0, -- Estimated time saved\n    created_at TIMESTAMPTZ DEFAULT now(),\n    updated_at TIMESTAMPTZ DEFAULT now()\n);\n\n-- Enable Row Level Security (RLS) for all tables\nALTER TABLE style_guides ENABLE ROW LEVEL SECURITY;\nALTER TABLE articles ENABLE ROW LEVEL SECURITY;\n\n-- Policies to ensure users can only access their own data\nCREATE POLICY \"user_can_access_own_guides\" ON style_guides FOR ALL USING (auth.uid() = user_id);\nCREATE POLICY \"user_can_access_own_articles\" ON articles FOR ALL USING (auth.uid() = user_id);\n```\n\n## 5. Core Logic & API Endpoints\n\nAuthentication is managed by Supabase Auth middleware on protected routes. API logic will be centralized through Hono.\n\n**API Endpoint:** `POST /api/articles/generate`\n\n**Request Body:**\n```json\n{\n  \"keyword\": \"How to start a SaaS business\",\n  \"styleGuideId\": \"uuid-of-the-style-guide\"\n}\n```\n\n**Generation Flow:**\n\n1.  **Client Request:** The user clicks \"Generate\" in the UI, triggering the API call.\n2.  **API Route (Hono):**\n    *   Authenticates the user via Supabase session.\n    *   Retrieves the specified `style_guide` from the database.\n    *   Checks the user's article count against the free tier limit (3 articles).\n3.  **Prompt Engineering:**\n    *   Constructs a single, comprehensive prompt for GPT-4o. The prompt will request a JSON object containing: `title`, `meta_description`, and `article_body` (as a Markdown string with H2/H3 tags).\n    *   The prompt will incorporate the user's keyword and all parameters from their `style_guide` (voice, audience, language).\n4.  **OpenAI API Call:**\n    *   Calls the GPT-4o API with the engineered prompt. Using streaming is **not** required for the MVP to keep the initial implementation simple. The process should complete within the 5-minute target.\n5.  **Database Insert:**\n    *   Parses the JSON response from OpenAI.\n    *   Creates a new record in the `articles` table with the generated content and `status = 'draft'`.\n    *   Calculates an estimated `time_saved_minutes` (e.g., constant value of 120 minutes).\n6.  **API Response:** Returns the `id` of the newly created article. The client then redirects to the editor page (`/editor/{id}`).\n\n## 6. Key Implementation Details\n\n*   **Onboarding Wizard:** A simple multi-step client-side component that collects data for the user's first `style_guide` and saves it to the database upon completion.\n*   **One-Screen Editor:**\n    *   The editor will be a single React component that fetches the article data using `@tanstack/react-query`.\n    *   It will use a standard textarea for Markdown editing. No complex rich-text editor is needed for the MVP.\n    *   \"Regenerate Paragraph\" will be a Server Action that takes the paragraph's context and re-runs a targeted, smaller prompt through the OpenAI API, updating the content in-place.\n*   **Real-time SEO Check:** A client-side utility function (`/features/article-editor/seo-checker.ts`). It will perform simple, non-blocking checks on the `content_markdown` state for:\n    *   Keyword presence in title and H-tags.\n    *   Word count.\n    *   Meta description length.\n*   **Cost Management:**\n    *   The generation prompt will explicitly request an article length between 1,500-2,500 words to control token usage.\n    *   The backend will enforce a hard limit: free users can only call the `POST /api/articles/generate` endpoint 3 times. This is tracked by counting rows in the `articles` table for the user.",
      "writedAt": "2025-11-08T10:13:52.019Z"
    },
    {
      "type": "guideline",
      "content": "\n    # Senior Developer Guidelines\n    \n    ## Must\n    \n    - always use client component for all components. (use `use client` directive)\n    - always use promise for page.tsx params props.\n    - use valid picsum.photos stock image for placeholder image\n    \n    ## Library\n    \n    use following libraries for specific functionalities:\n    \n    1. `date-fns`: For efficient date and time handling.\n    2. `ts-pattern`: For clean and type-safe branching logic.\n    3. `@tanstack/react-query`: For server state management.\n    4. `zustand`: For lightweight global state management.\n    5. `react-use`: For commonly needed React hooks.\n    6. `es-toolkit`: For robust utility functions.\n    7. `lucide-react`: For customizable icons.\n    8. `zod`: For schema validation and data integrity.\n    9. `shadcn-ui`: For pre-built accessible UI components.\n    10. `tailwindcss`: For utility-first CSS styling.\n    11. `supabase`: For a backend-as-a-service solution.\n    12. `react-hook-form`: For form validation and state management.\n    \n    ## Directory Structure\n    \n    - src\n    - src/app: Next.js App Routers\n    - src/components/ui: shadcn-ui components\n    - src/constants: Common constants\n    - src/hooks: Common hooks\n    - src/lib: utility functions\n    - src/remote: http client\n    - src/features/[featureName]/components/*: Components for specific feature\n    - src/features/[featureName]/constants/*\n    - src/features/[featureName]/hooks/*\n    - src/features/[featureName]/lib/*\n    - src/features/[featureName]/api.ts: api fetch functions\n    \n    ## Solution Process:\n    \n    1. Rephrase Input: Transform to clear, professional prompt.\n    2. Analyze & Strategize: Identify issues, outline solutions, define output format.\n    3. Develop Solution:\n       - \"As a senior-level developer, I need to [rephrased prompt]. To accomplish this, I need to:\"\n       - List steps numerically.\n       - \"To resolve these steps, I need the following solutions:\"\n       - List solutions with bullet points.\n    4. Validate Solution: Review, refine, test against edge cases.\n    5. Evaluate Progress:\n       - If incomplete: Pause, inform user, await input.\n       - If satisfactory: Proceed to final output.\n    6. Prepare Final Output:\n       - ASCII title\n       - Problem summary and approach\n       - Step-by-step solution with relevant code snippets\n       - Format code changes:\n        ```language:path/to/file\n         // ... existing code ...\n         function exampleFunction() {\n             // Modified or new code here\n         }\n         // ... existing code ...\n         ```\n       - Use appropriate formatting\n       - Describe modifications\n       - Conclude with potential improvements\n    \n    ## Key Mindsets:\n    \n    1. Simplicity\n    2. Readability\n    3. Maintainability\n    4. Testability\n    5. Reusability\n    6. Functional Paradigm\n    7. Pragmatism\n    \n    ## Code Guidelines:\n    \n    1. Early Returns\n    2. Conditional Classes over ternary\n    3. Descriptive Names\n    4. Constants > Functions\n    5. DRY\n    6. Functional & Immutable\n    7. Minimal Changes\n    8. Pure Functions\n    9. Composition over inheritance\n    \n    ## Functional Programming:\n    \n    - Avoid Mutation\n    - Use Map, Filter, Reduce\n    - Currying and Partial Application\n    - Immutability\n    \n    ## Code-Style Guidelines\n    \n    - Use TypeScript for type safety.\n    - Follow the coding standards defined in the ESLint configuration.\n    - Ensure all components are responsive and accessible.\n    - Use Tailwind CSS for styling, adhering to the defined color palette.\n    - When generating code, prioritize TypeScript and React best practices.\n    - Ensure that any new components are reusable and follow the existing design patterns.\n    - Minimize the use of AI generated comments, instead use clearly named variables and functions.\n    - Always validate user inputs and handle errors gracefully.\n    - Use the existing components and pages as a reference for the new components and pages.\n    \n    ## Performance:\n    \n    - Avoid Premature Optimization\n    - Profile Before Optimizing\n    - Optimize Judiciously\n    - Document Optimizations\n    \n    ## Comments & Documentation:\n    \n    - Comment function purpose\n    - Use JSDoc for JS\n    - Document \"why\" not \"what\"\n    \n    ## Function Ordering:\n    \n    - Higher-order functionality first\n    - Group related functions\n    \n    ## Handling Bugs:\n    \n    - Use TODO: and FIXME: comments\n    \n    ## Error Handling:\n    \n    - Use appropriate techniques\n    - Prefer returning errors over exceptions\n    \n    ## Testing:\n    \n    - Unit tests for core functionality\n    - Consider integration and end-to-end tests\n    \n    ## Next.js\n    \n    - you must use promise for page.tsx params props.\n    \n    ## Shadcn-ui\n    \n    - if you need to add new component, please show me the installation instructions. I'll paste it into terminal.\n    - example\n      ```\n      $ npx shadcn@latest add card\n      $ npx shadcn@latest add textarea\n      $ npx shadcn@latest add dialog\n      ```\n    \n    ## Supabase\n    \n    - if you need to add new table, please create migration. I'll paste it into supabase.\n    - do not run supabase locally\n    - store migration query for `.sql` file. in /supabase/migrations/\n    \n    ## Package Manager\n    \n    - use npm as package manager.\n    \n    ## Korean Text\n    \n    - ì½”ë“œë¥¼ ìƒì„±í•œ í›„ì— utf-8 ê¸°ì¤€ìœ¼ë¡œ ê¹¨ì§€ëŠ” í•œê¸€ì´ ìˆëŠ”ì§€ í™•ì¸í•´ì£¼ì„¸ìš”. ë§Œì•½ ìˆë‹¤ë©´ ìˆ˜ì •í•´ì£¼ì„¸ìš”.\n    \n    You are a senior full-stack developer, one of those rare 10x devs. Your focus: clean, maintainable, high-quality code.\n    Apply these principles judiciously, considering project and team needs.\n      ",
      "writedAt": "2025-11-08T10:13:52.019Z"
    },
    {
      "type": "design-guide",
      "content": "# ContentCraft AI Design Guide\n\n## 1. Overall Mood (ì „ì²´ì ì¸ ë¬´ë“œ)\n\nContentCraft AIëŠ” **ì‹ ë¢°í•  ìˆ˜ ìˆê³  ì „ë¬¸ì ì¸(Trustworthy & Professional)** ë¬´ë“œë¥¼ ì§€í–¥í•©ë‹ˆë‹¤. ì¸ë””í•´ì»¤ì™€ ì†”ë¡œ ì°½ì—…ìë“¤ì´ ì½˜í…ì¸  ìƒì„±ì— ì§‘ì¤‘í•  ìˆ˜ ìˆë„ë¡ ê¹”ë”í•˜ê³  ì§ê´€ì ì¸ ì¸í„°í˜ì´ìŠ¤ë¥¼ ì œê³µí•©ë‹ˆë‹¤. \n\ní•µì‹¬ ë””ìì¸ ì² í•™:\n- **ë¯¸ë‹ˆë©€ë¦¬ì¦˜**: ë¶ˆí•„ìš”í•œ ìš”ì†Œë¥¼ ì œê±°í•˜ê³  ì½˜í…ì¸ ì— ì§‘ì¤‘\n- **ì‹ ë¢°ì„±**: ì¿¨í†¤ê³¼ ì €ì±„ë„ë¡œ ì•ˆì •ê°ê³¼ ì „ë¬¸ì„± í‘œí˜„\n- **íš¨ìœ¨ì„±**: ì‚¬ìš©ìì˜ ì‘ì—… íë¦„ì„ ë°©í•´í•˜ì§€ ì•ŠëŠ” ì§ê´€ì  ë ˆì´ì•„ì›ƒ\n- **ì ‘ê·¼ì„±**: ì´ˆë³´ìì™€ ì „ë¬¸ê°€ ëª¨ë‘ ì‚¬ìš©í•  ìˆ˜ ìˆëŠ” ìœ ì—°í•œ ì¸í„°í˜ì´ìŠ¤\n\n## 2. Reference Service (ì°¸ì¡° ì„œë¹„ìŠ¤)\n\n- **Name**: Notion\n- **Description**: ì˜¬ì¸ì› ì›Œí¬ìŠ¤í˜ì´ìŠ¤ ë° ë…¸íŠ¸ í…Œì´í‚¹ ë„êµ¬\n- **Design Mood**: ê¹”ë”í•˜ê³  ëª¨ë…¸í†¤ì ì´ë©° ì½˜í…ì¸  ì¤‘ì‹¬ì˜ ë¯¸ë‹ˆë©€ ë””ìì¸\n- **Primary Color**: #2F3437 (ë‹¤í¬ ê·¸ë ˆì´)\n- **Secondary Color**: #F7F6F3 (ì˜¤í”„ í™”ì´íŠ¸)\n\nNotionì˜ ì½˜í…ì¸  ì¤‘ì‹¬ì  ì ‘ê·¼ë²•ê³¼ ê¹”ë”í•œ íƒ€ì´í¬ê·¸ë˜í”¼, ì§ê´€ì ì¸ ë¸”ë¡ í¸ì§‘ ì‹œìŠ¤í…œì„ ë²¤ì¹˜ë§ˆí‚¹í•˜ì—¬ ê¸€ì“°ê¸°ì— ìµœì í™”ëœ í™˜ê²½ì„ êµ¬í˜„í•©ë‹ˆë‹¤.\n\n## 3. Color & Gradient (ìƒ‰ìƒ & ê·¸ë¼ë°ì´ì…˜)\n\n### ë©”ì¸ ì»¬ëŸ¬ íŒ”ë ˆíŠ¸\n- **Primary Color**: #1E2A38 (Navy) - ë©”ì¸ ë¸Œëœë“œ ì»¬ëŸ¬, ì‹ ë¢°ì„±ê³¼ ì „ë¬¸ì„± í‘œí˜„\n- **Secondary Color**: #F5F7FA (Soft Gray) - ë°°ê²½ ë° ì¹´ë“œ ì»¬ëŸ¬\n- **Accent Color**: #3BA2F8 (Sky Blue) - CTA ë²„íŠ¼, ë§í¬, ê°•ì¡° ìš”ì†Œ\n- **Background**: #FCFCFD (Off-White) - ë©”ì¸ ë°°ê²½\n- **Border**: #E1E5EA (Light Gray) - êµ¬ë¶„ì„  ë° í…Œë‘ë¦¬\n\n### ë³´ì¡° ì»¬ëŸ¬\n- **Success**: #10B981 (Emerald)\n- **Warning**: #F59E0B (Amber)\n- **Error**: #EF4444 (Red)\n- **Info**: #3B82F6 (Blue)\n\n### ê·¸ë ˆì´ìŠ¤ì¼€ì¼\n- **Gray 900**: #111827\n- **Gray 700**: #374151\n- **Gray 500**: #6B7280\n- **Gray 300**: #D1D5DB\n- **Gray 100**: #F3F4F6\n\n### Mood\n- **í†¤**: ì¿¨í†¤ (Cool Tone)\n- **ì±„ë„**: ì €ì±„ë„ (Low Saturation)\n\n### Color Usage\n1. **ìµœìš°ì„ **: Primary Navy (#1E2A38) - ë„¤ë¹„ê²Œì´ì…˜, ë©”ì¸ í—¤ë”\n2. **ê°•ì¡°**: Accent Sky Blue (#3BA2F8) - CTA ë²„íŠ¼, í™œì„± ìƒíƒœ\n3. **ë°°ê²½**: Soft Gray (#F5F7FA) - ì¹´ë“œ, ì‚¬ì´ë“œë°”\n4. **í…ìŠ¤íŠ¸**: Gray 900 (#111827) - ë³¸ë¬¸, Gray 700 (#374151) - ë³´ì¡° í…ìŠ¤íŠ¸\n\n## 4. Typography & Font (íƒ€ì´í¬ê·¸ë˜í”¼ & í°íŠ¸)\n\n### í°íŠ¸ íŒ¨ë°€ë¦¬\n- **ì˜ë¬¸**: Inter (Google Fonts)\n- **í•œê¸€**: Pretendard (ì‹œìŠ¤í…œ í°íŠ¸ ëŒ€ì²´)\n- **ëª¨ë…¸ìŠ¤í˜ì´ìŠ¤**: JetBrains Mono (ì½”ë“œ ë¸”ë¡ìš©)\n\n### íƒ€ì´í¬ê·¸ë˜í”¼ ìŠ¤ì¼€ì¼\n- **Heading 1**: 32px, Bold (700), Letter-spacing: -0.025em\n- **Heading 2**: 24px, Semibold (600), Letter-spacing: -0.025em\n- **Heading 3**: 20px, Semibold (600)\n- **Body Large**: 18px, Regular (400), Line-height: 1.7\n- **Body**: 16px, Regular (400), Line-height: 1.6\n- **Body Small**: 14px, Regular (400), Line-height: 1.5\n- **Caption**: 12px, Medium (500), Line-height: 1.4\n\n### í…ìŠ¤íŠ¸ ì»¬ëŸ¬\n- **Primary**: Gray 900 (#111827)\n- **Secondary**: Gray 700 (#374151)\n- **Muted**: Gray 500 (#6B7280)\n- **Placeholder**: Gray 300 (#D1D5DB)\n\n## 5. Layout & Structure (ë ˆì´ì•„ì›ƒ & êµ¬ì¡°)\n\n### ê·¸ë¦¬ë“œ ì‹œìŠ¤í…œ\n- **Container Max Width**: 1440px\n- **Breakpoints**: \n  - Mobile: <640px\n  - Tablet: 640px-1024px  \n  - Desktop: >1024px\n- **Spacing Scale**: 4px ê¸°ë³¸ ë‹¨ìœ„ (4, 8, 12, 16, 20, 24, 32, 40, 48, 64px)\n\n### ë©”ì¸ ë ˆì´ì•„ì›ƒ êµ¬ì¡°\n```\nâ”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”\nâ”‚ Topbar (64px height)                    â”‚\nâ”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤\nâ”‚ Sidebar   â”‚ Main Content Area           â”‚\nâ”‚ (280px)   â”‚                             â”‚\nâ”‚           â”‚ â”Œâ”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚\nâ”‚           â”‚ â”‚Inputâ”‚Preview  â”‚SEO Panelâ”‚ â”‚\nâ”‚           â”‚ â”‚     â”‚         â”‚         â”‚ â”‚\nâ”‚           â”‚ â””â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚\nâ””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜\n```\n\n### 3-Column ì½˜í…ì¸  ë ˆì´ì•„ì›ƒ\n- **ì…ë ¥ ì˜ì—­**: 360px (ìµœì†Œ 320px)\n- **ë¯¸ë¦¬ë³´ê¸°**: ê°€ë³€ (ìµœì†Œ 480px)\n- **SEO íŒ¨ë„**: 320px (ì½œë©ì„œë¸”)\n\n### ë°˜ì‘í˜• ê·œì¹™\n- **Mobile (<640px)**: ì‚¬ì´ë“œë°” ìˆ¨ê¹€, 1-Column ìŠ¤íƒ, í”Œë¡œíŒ… FAB\n- **Tablet (640-1024px)**: 2-Column (ì…ë ¥+ë¯¸ë¦¬ë³´ê¸°), SEO íŒ¨ë„ í•˜ë‹¨\n- **Desktop (>1024px)**: 3-Column ì „ì²´ í‘œì‹œ\n\n## 6. Visual Style (ë¹„ì£¼ì–¼ ìŠ¤íƒ€ì¼)\n\n### ì•„ì´ì½˜ ì‹œìŠ¤í…œ\n- **ë¼ì´ë¸ŒëŸ¬ë¦¬**: Lucide React\n- **ìŠ¤íƒ€ì¼**: ì„ í˜• ì•„ì´ì½˜ (Line Icons)\n- **Stroke Width**: 1.5px\n- **í¬ê¸°**: 16px (Small), 20px (Medium), 24px (Large)\n\n### ì´ë¯¸ì§€ ê°€ì´ë“œë¼ì¸\n- **ì¢…íš¡ë¹„**: 16:9 (íˆì–´ë¡œ), 1:1 (í”„ë¡œí•„), 4:3 (ì¹´ë“œ)\n- **ì½”ë„ˆ ë°˜ê²½**: 8px (ì¹´ë“œ), 12px (ëŒ€í˜• ì´ë¯¸ì§€)\n- **ì˜¤ë²„ë ˆì´**: rgba(30, 42, 56, 0.6) í…ìŠ¤íŠ¸ ê°€ë…ì„± í™•ë³´\n\n### ì¼ëŸ¬ìŠ¤íŠ¸ë ˆì´ì…˜\n- **ìŠ¤íƒ€ì¼**: ë¯¸ë‹ˆë©€ ì„ í˜• ì¼ëŸ¬ìŠ¤íŠ¸\n- **ì»¬ëŸ¬**: ë¸Œëœë“œ ì»¬ëŸ¬ íŒ”ë ˆíŠ¸ ë‚´ì—ì„œ 2-3ìƒ‰ ì‚¬ìš©\n- **ìš©ë„**: ì˜¨ë³´ë”©, ë¹ˆ ìƒíƒœ(Empty State), ì—ëŸ¬ í˜ì´ì§€\n\n### ê·¸ë¦¼ì ì‹œìŠ¤í…œ\n- **Small**: 0 1px 3px rgba(0, 0, 0, 0.1)\n- **Medium**: 0 4px 6px rgba(0, 0, 0, 0.07)\n- **Large**: 0 10px 15px rgba(0, 0, 0, 0.1)\n- **XL**: 0 20px 25px rgba(0, 0, 0, 0.1)\n\n## 7. UX Guide (UX ê°€ì´ë“œ)\n\n### íƒ€ê²Ÿ ì‚¬ìš©ì ì ‘ê·¼ë²•\n**Both (ì „ë¬¸ê°€ + ì´ˆë³´ì)** ì§€ì›ì„ ìœ„í•œ ì ì‘í˜• ì¸í„°í˜ì´ìŠ¤\n\n### ì´ˆë³´ìë¥¼ ìœ„í•œ UX\n- **ì˜¨ë³´ë”©**: ì²« ë°©ë¬¸ ì‹œ 3-Step ì½”ì¹˜ë§ˆí¬ íŠœí† ë¦¬ì–¼\n- **ê¸°ë³¸ê°’ ìµœì í™”**: ê°€ì¥ ì¼ë°˜ì ì¸ ì„¤ì •ì„ ê¸°ë³¸ê°’ìœ¼ë¡œ ì œê³µ\n- **ë„ì›€ë§ ì‹œìŠ¤í…œ**: ì»¨í…ìŠ¤íŠ¸ íˆ´íŒ, ì¸ë¼ì¸ ê°€ì´ë“œ\n- **í”„ë¡œê·¸ë ˆìŠ¤ í‘œì‹œ**: ë‹¨ê³„ë³„ ì§„í–‰ë¥ , ì™„ë£Œ ìƒíƒœ ëª…í™•íˆ í‘œì‹œ\n\n### ì „ë¬¸ê°€ë¥¼ ìœ„í•œ UX\n- **ê³ ê¸‰ ì˜µì…˜**: í† ê¸€ë¡œ ìˆ¨ê¹€/í‘œì‹œ ê°€ëŠ¥í•œ ì„¸ë¶€ ì„¤ì •\n- **ë‹¨ì¶•í‚¤ ì§€ì›**: Cmd/Ctrl + í‚¤ ì¡°í•©ìœ¼ë¡œ ë¹ ë¥¸ ì‘ì—…\n- **ë°°ì¹˜ ì‘ì—…**: ì—¬ëŸ¬ ê¸€ ë™ì‹œ ì²˜ë¦¬ ê¸°ëŠ¥\n- **ì»¤ìŠ¤í„°ë§ˆì´ì œì´ì…˜**: ì‘ì—… ê³µê°„ ë ˆì´ì•„ì›ƒ ì¡°ì •\n\n### í•µì‹¬ UX ì›ì¹™\n1. **ì¦‰ì‹œì„±**: 5ë¶„ ë‚´ ê¸€ ìƒì„± ì™„ë£Œ, ì‹¤ì‹œê°„ í”¼ë“œë°±\n2. **íˆ¬ëª…ì„±**: ì§„í–‰ ìƒí™©, ë¹„ìš©, ì œí•œì‚¬í•­ ëª…í™•íˆ í‘œì‹œ  \n3. **ì œì–´ê°**: ë¬¸ë‹¨ë³„ ì¬ìƒì„±, ì‹¤ì‹œê°„ í¸ì§‘ ê°€ëŠ¥\n4. **ì„±ì·¨ê°**: ì‹œê°„ ì ˆì•½, ì™„ì„± ê¸€ ìˆ˜ ë“± ê°€ì‹œì  ì„±ê³¼ í‘œì‹œ\n\n### ë§ˆì´í¬ë¡œì¹´í”¼ ê°€ì´ë“œë¼ì¸\n- **í†¤**: ê²©ì‹ ìˆìœ¼ë‚˜ ì¹œê·¼í•¨\n- **ê¸¸ì´**: 6ë‹¨ì–´ ì´í•˜ ê°„ê²°í•¨\n- **ìœ ë¨¸**: ì§€ë‚˜ì¹œ ìœ ë¨¸ ì§€ì–‘, ì „ë¬¸ì„± ìœ ì§€\n- **ì˜ˆì‹œ**: \"ê¸€ ìƒì„± ì¤‘...\" â†’ \"AIê°€ ì‘ì„± ì¤‘ì…ë‹ˆë‹¤\" (X) â†’ \"ìƒì„± ì¤‘\" (O)\n\n## 8. UI Component Guide (UI ì»´í¬ë„ŒíŠ¸ ê°€ì´ë“œ)\n\n### ë²„íŠ¼ ì‹œìŠ¤í…œ\n\n#### Primary Button\n- **ë°°ê²½**: Accent Blue (#3BA2F8)\n- **í…ìŠ¤íŠ¸**: White\n- **ë†’ì´**: 40px (Medium), 48px (Large)\n- **íŒ¨ë”©**: 16px 24px\n- **ì½”ë„ˆ**: 8px ë°˜ê²½\n- **í˜¸ë²„**: ë°°ê²½ 20% ì–´ë‘¡ê²Œ\n- **ì˜ˆì‹œ**: \"ê¸€ ìƒì„±í•˜ê¸°\", \"ì €ì¥í•˜ê¸°\"\n\n#### Secondary Button  \n- **ë°°ê²½**: Transparent\n- **í…Œë‘ë¦¬**: 1px solid Gray 300\n- **í…ìŠ¤íŠ¸**: Gray 700\n- **í˜¸ë²„**: ë°°ê²½ Gray 50\n- **ì˜ˆì‹œ**: \"ì·¨ì†Œ\", \"ë‹¤ì‹œ ìƒì„±\"\n\n#### Ghost Button\n- **ë°°ê²½**: Transparent  \n- **í…ìŠ¤íŠ¸**: Accent Blue\n- **í˜¸ë²„**: ë°°ê²½ Blue 50\n- **ì˜ˆì‹œ**: \"ë” ë³´ê¸°\", \"í¸ì§‘\"\n\n### ì…ë ¥ í•„ë“œ (Input Fields)\n\n#### Text Input\n- **ë†’ì´**: 40px\n- **íŒ¨ë”©**: 12px 16px\n- **í…Œë‘ë¦¬**: 1px solid Gray 300\n- **ì½”ë„ˆ**: 6px ë°˜ê²½\n- **í¬ì»¤ìŠ¤**: í…Œë‘ë¦¬ Accent Blue, ê·¸ë¦¼ì ì¶”ê°€\n- **í”Œë ˆì´ìŠ¤í™€ë”**: Gray 400\n\n#### Textarea\n- **ìµœì†Œ ë†’ì´**: 120px\n- **ë¦¬ì‚¬ì´ì¦ˆ**: ì„¸ë¡œë§Œ ê°€ëŠ¥\n- **ë¼ì¸ ë†’ì´**: 1.5\n\n#### Select Dropdown\n- **ë†’ì´**: 40px\n- **ì•„ì´ì½˜**: Chevron Down (Lucide)\n- **ì˜µì…˜**: ìµœëŒ€ ë†’ì´ 200px, ìŠ¤í¬ë¡¤\n\n### ì¹´ë“œ ì‹œìŠ¤í…œ\n\n#### Content Card\n- **ë°°ê²½**: White\n- **í…Œë‘ë¦¬**: 1px solid Gray 200\n- **ì½”ë„ˆ**: 12px ë°˜ê²½\n- **íŒ¨ë”©**: 24px\n- **ê·¸ë¦¼ì**: Medium Shadow\n- **í˜¸ë²„**: ê·¸ë¦¼ì ì¦ê°€\n\n#### Stats Card\n- **ë°°ê²½**: Gradient (White â†’ Gray 50)\n- **ì•„ì´ì½˜**: 20px, Accent Blue\n- **ì œëª©**: 14px Medium\n- **ìˆ˜ì¹˜**: 24px Bold\n\n### ë„¤ë¹„ê²Œì´ì…˜\n\n#### Top Navigation\n- **ë†’ì´**: 64px\n- **ë°°ê²½**: White\n- **í…Œë‘ë¦¬**: í•˜ë‹¨ 1px solid Gray 200\n- **ë¡œê³ **: ì¢Œì¸¡, 32px ë†’ì´\n- **ë©”ë‰´**: ìš°ì¸¡, ì‚¬ìš©ì ì•„ë°”íƒ€ í¬í•¨\n\n#### Sidebar\n- **ë„ˆë¹„**: 280px (ì½œë©ì„œë¸”)\n- **ë°°ê²½**: Gray 50\n- **ë©”ë‰´ ì•„ì´í…œ**: 40px ë†’ì´, 12px íŒ¨ë”©\n- **í™œì„± ìƒíƒœ**: Accent Blue ë°°ê²½, White í…ìŠ¤íŠ¸\n\n### í”¼ë“œë°± ì»´í¬ë„ŒíŠ¸\n\n#### Progress Bar (SEO ì ìˆ˜ìš©)\n- **ë†’ì´**: 8px\n- **ë°°ê²½**: Gray 200\n- **ì§„í–‰**: Accent Blue â†’ Success Green\n- **ì½”ë„ˆ**: 4px ë°˜ê²½\n- **ë ˆì´ë¸”**: ìƒë‹¨ ìš°ì¸¡ í‘œì‹œ\n\n#### Toast Notification\n- **ìœ„ì¹˜**: ìš°ì¸¡ ìƒë‹¨\n- **ë„ˆë¹„**: 360px\n- **ìë™ ë‹«í˜**: 4ì´ˆ\n- **íƒ€ì…ë³„ ì»¬ëŸ¬**: Success, Warning, Error\n\n#### Loading States\n- **ìŠ¤ì¼ˆë ˆí†¤**: Gray 200 ë°°ê²½, ì• ë‹ˆë©”ì´ì…˜\n- **ìŠ¤í”¼ë„ˆ**: Accent Blue, 24px\n- **ì§„í–‰ë¥ **: ì¹´ìš´íŠ¸ë‹¤ìš´ íƒ€ì´ë¨¸ í¬í•¨\n\n### ë°ì´í„° ì‹œê°í™”\n\n#### Dashboard Cards\n- **ì‹œê°„ ì ˆì•½**: í° ìˆ«ì + ë‹¨ìœ„, Success Green\n- **ì™„ì„± ê¸€ ìˆ˜**: ì›”ê°„ ê·¸ë˜í”„, Accent Blue\n- **SEO ì ìˆ˜**: ì›í˜• í”„ë¡œê·¸ë ˆìŠ¤, ê·¸ë¼ë°ì´ì…˜\n\n#### Charts\n- **ë¼ì´ë¸ŒëŸ¬ë¦¬**: Recharts\n- **ì»¬ëŸ¬**: ë¸Œëœë“œ íŒ”ë ˆíŠ¸ ìˆœì„œëŒ€ë¡œ\n- **ê·¸ë¦¬ë“œ**: Gray 100, ë¯¸ì„¸í•œ ì„ \n\n### ì• ë‹ˆë©”ì´ì…˜ ê°€ì´ë“œ\n\n#### ì „í™˜ íš¨ê³¼\n- **ì§€ì†ì‹œê°„**: 150-250ms\n- **ì´ì§•**: ease-out\n- **íƒ€ì…**: fade, slide, scale\n\n#### ë¡œë”© ì• ë‹ˆë©”ì´ì…˜  \n- **ìŠ¤ì¼ˆë ˆí†¤**: ì¢Œìš° ì´ë™ ê·¸ë¼ë°ì´ì…˜\n- **í„ìŠ¤**: íˆ¬ëª…ë„ ë³€í™”\n- **ìŠ¤í”¼ë„ˆ**: íšŒì „\n\n### ì ‘ê·¼ì„± (Accessibility)\n\n#### ì»¬ëŸ¬ ëŒ€ë¹„\n- **ìµœì†Œ ê¸°ì¤€**: WCAG AA (4.5:1)\n- **í…ìŠ¤íŠ¸**: Gray 900 on White (15.6:1)\n- **ë§í¬**: Accent Blue on White (8.2:1)\n\n#### í‚¤ë³´ë“œ ë„¤ë¹„ê²Œì´ì…˜\n- **Tab ìˆœì„œ**: ë…¼ë¦¬ì  íë¦„\n- **í¬ì»¤ìŠ¤ í‘œì‹œ**: 2px Accent Blue ì•„ì›ƒë¼ì¸\n- **ë‹¨ì¶•í‚¤**: Cmd/Ctrl ì¡°í•©\n\n#### ìŠ¤í¬ë¦° ë¦¬ë”\n- **aria-label**: ëª¨ë“  ì¸í„°ë™í‹°ë¸Œ ìš”ì†Œ\n- **role ì†ì„±**: ì ì ˆí•œ ì‹œë§¨í‹± ì—­í• \n- **alt í…ìŠ¤íŠ¸**: ì˜ë¯¸ìˆëŠ” ì´ë¯¸ì§€ ì„¤ëª…\n\n### ë°˜ì‘í˜• ì»´í¬ë„ŒíŠ¸ ê·œì¹™\n\n#### ëª¨ë°”ì¼ (<640px)\n- **ë²„íŠ¼**: ì „ì²´ ë„ˆë¹„, 48px ë†’ì´\n- **ì…ë ¥ í•„ë“œ**: ì „ì²´ ë„ˆë¹„\n- **ì¹´ë“œ**: 16px íŒ¨ë”©\n- **ë„¤ë¹„ê²Œì´ì…˜**: í–„ë²„ê±° ë©”ë‰´\n\n#### íƒœë¸”ë¦¿ (640-1024px)  \n- **ê·¸ë¦¬ë“œ**: 2-Column ë ˆì´ì•„ì›ƒ\n- **ì‚¬ì´ë“œë°”**: ì˜¤ë²„ë ˆì´ ëª¨ë“œ\n- **ì¹´ë“œ**: 20px íŒ¨ë”©\n\n#### ë°ìŠ¤í¬í†± (>1024px)\n- **ê·¸ë¦¬ë“œ**: 3-Column ì „ì²´ í‘œì‹œ\n- **í˜¸ë²„ ìƒíƒœ**: ëª¨ë“  ì¸í„°ë™í‹°ë¸Œ ìš”ì†Œ\n- **íˆ´íŒ**: ë§ˆìš°ìŠ¤ ì˜¤ë²„ ì‹œ í‘œì‹œ",
      "writedAt": "2025-11-08T10:13:52.019Z"
    },
    {
      "type": "ia",
      "content": "# ContentCraft AI ì •ë³´ ì•„í‚¤í…ì²˜ (IA)\n\n## 1. ì‚¬ì´íŠ¸ë§µ (ì‚¬ì´íŠ¸ë§µ)\n\n```\nContentCraft AI\nâ”œâ”€â”€ / (í™ˆí˜ì´ì§€)\nâ”œâ”€â”€ /auth\nâ”‚   â”œâ”€â”€ /auth/login (ë¡œê·¸ì¸)\nâ”‚   â”œâ”€â”€ /auth/signup (íšŒì›ê°€ì…)\nâ”‚   â””â”€â”€ /auth/onboarding (ì˜¨ë³´ë”© ìœ„ì €ë“œ)\nâ”œâ”€â”€ /dashboard (ëŒ€ì‹œë³´ë“œ) [ì¸ì¦ í•„ìš”]\nâ”‚   â”œâ”€â”€ /dashboard/stats (í†µê³„ í˜„í™©)\nâ”‚   â””â”€â”€ /dashboard/history (ì‘ì„± ì´ë ¥)\nâ”œâ”€â”€ /new (ìƒˆ ê¸€ ì‘ì„±) [ì¸ì¦ í•„ìš”]\nâ”‚   â”œâ”€â”€ /new/setup (ì£¼ì œ ì„¤ì •)\nâ”‚   â”œâ”€â”€ /new/generate (AI ìƒì„±)\nâ”‚   â””â”€â”€ /new/edit (í¸ì§‘ ë° ì™„ì„±)\nâ”œâ”€â”€ /style-guides (ìŠ¤íƒ€ì¼ ê°€ì´ë“œ ê´€ë¦¬) [ì¸ì¦ í•„ìš”]\nâ”‚   â”œâ”€â”€ /style-guides/list (ê°€ì´ë“œ ëª©ë¡)\nâ”‚   â”œâ”€â”€ /style-guides/new (ìƒˆ ê°€ì´ë“œ ìƒì„±)\nâ”‚   â””â”€â”€ /style-guides/:id/edit (ê°€ì´ë“œ í¸ì§‘)\nâ”œâ”€â”€ /account (ê³„ì • ê´€ë¦¬) [ì¸ì¦ í•„ìš”]\nâ”‚   â”œâ”€â”€ /account/profile (í”„ë¡œí•„ ì„¤ì •)\nâ”‚   â”œâ”€â”€ /account/billing (ê²°ì œ ë° êµ¬ë…)\nâ”‚   â””â”€â”€ /account/usage (ì‚¬ìš©ëŸ‰ í˜„í™©)\nâ”œâ”€â”€ /docs (ë„ì›€ë§)\nâ”‚   â”œâ”€â”€ /docs/getting-started (ì‹œì‘ ê°€ì´ë“œ)\nâ”‚   â”œâ”€â”€ /docs/features (ê¸°ëŠ¥ ì„¤ëª…)\nâ”‚   â””â”€â”€ /docs/faq (ìì£¼ ë¬»ëŠ” ì§ˆë¬¸)\nâ””â”€â”€ /pricing (ê°€ê²© ì •ì±…)\n```\n\n## 2. ì‚¬ìš©ì íë¦„ (ì‚¬ìš©ì íë¦„)\n\n### **í•µì‹¬ ì‘ì—… 1: ì‹ ê·œ ì‚¬ìš©ì ì˜¨ë³´ë”©**\n1. ì‚¬ìš©ìê°€ í™ˆí˜ì´ì§€(/)ì—ì„œ \"ë¬´ë£Œë¡œ ì‹œì‘í•˜ê¸°\" ë²„íŠ¼ í´ë¦­\n2. íšŒì›ê°€ì… í˜ì´ì§€(/auth/signup)ë¡œ ì´ë™\n3. ì´ë©”ì¼, íŒ¨ìŠ¤ì›Œë“œ ì…ë ¥ í›„ ê³„ì • ìƒì„±\n4. ì˜¨ë³´ë”© ìœ„ì €ë“œ(/auth/onboarding)ë¡œ ìë™ ì´ë™\n5. 5ë¬¸í•­ ë¸Œëœë“œ ë³´ì´ìŠ¤ ì„¤ì • ì™„ë£Œ\n6. ëŒ€ì‹œë³´ë“œ(/dashboard)ë¡œ ì´ë™í•˜ì—¬ ì²« ê¸€ ì‘ì„± ìœ ë„\n\n### **í•µì‹¬ ì‘ì—… 2: AI ê¸€ ìƒì„± ë° í¸ì§‘**\n1. ëŒ€ì‹œë³´ë“œì—ì„œ \"ìƒˆ ê¸€ ì‘ì„±\" ë²„íŠ¼ í´ë¦­\n2. ìƒˆ ê¸€ ì‘ì„± í˜ì´ì§€(/new)ë¡œ ì´ë™\n3. ì£¼ì œ í‚¤ì›Œë“œì™€ ê°„ë‹¨í•œ ì„¤ëª… ì…ë ¥\n4. ìŠ¤íƒ€ì¼ ê°€ì´ë“œ ì„ íƒ (ê¸°ë³¸ê°’ ì ìš©)\n5. \"ìƒì„±í•˜ê¸°\" ë²„íŠ¼ í´ë¦­í•˜ì—¬ AI ìƒì„± ì‹œì‘\n6. 5ë¶„ ë‚´ ì´ˆì•ˆ, ì œëª©, SEO ë©”íƒ€ë°ì´í„° ìë™ ìƒì„±\n7. ì›ìŠ¤í¬ë¦° í¸ì§‘ê¸°ì—ì„œ ë¬¸ë‹¨ë³„ ì¬ìƒì„± ë° ìˆ˜ì •\n8. ì‹¤ì‹œê°„ SEO ì ìˆ˜ í™•ì¸ ë° ìµœì í™”\n9. ë§ˆí¬ë‹¤ìš´ìœ¼ë¡œ ë‹¤ìš´ë¡œë“œ ë˜ëŠ” í´ë¦½ë³´ë“œ ë³µì‚¬\n10. ëŒ€ì‹œë³´ë“œì—ì„œ ì™„ì„± ê¸€ ìˆ˜ ë° ì‹œê°„ ì ˆì•½ í˜„í™© í™•ì¸\n\n### **í•µì‹¬ ì‘ì—… 3: ìœ ë£Œ ì „í™˜**\n1. ë¬´ë£Œ 3í¸ ì™„ì„± í›„ ìƒˆ ê¸€ ì‘ì„± ì‹œë„\n2. ì œí•œ ë„ë‹¬ ëª¨ë‹¬ íŒì—… í‘œì‹œ\n3. í”„ë¡œ í”Œëœ($19/ì›”) í˜œíƒ ë° ë¹„êµí‘œ í™•ì¸\n4. \"êµ¬ë…í•˜ê¸°\" ë²„íŠ¼ í´ë¦­\n5. ê²°ì œ ì •ë³´ ì…ë ¥(/account/billing)\n6. ê²°ì œ ì™„ë£Œ í›„ ë¬´ì œí•œ ê¸€ ìƒì„± ê°€ëŠ¥\n\n## 3. ë„¤ë¹„ê²Œì´ì…˜ êµ¬ì¡° (ë„¤ë¹„ê²Œì´ì…˜ êµ¬ì¡°)\n\n### **ê¸€ë¡œë²Œ ë„¤ë¹„ê²Œì´ì…˜ ë°” (GNB)**\n- **ìœ„ì¹˜**: ìƒë‹¨ ê³ ì • (64px ë†’ì´)\n- **ì¢Œì¸¡**: ContentCraft AI ë¡œê³  (í™ˆí˜ì´ì§€ ë§í¬)\n- **ìš°ì¸¡**: ì‚¬ìš©ì ì•„ë°”íƒ€ ë“œë¡­ë‹¤ìš´ ë©”ë‰´\n  - ë‚´ ê³„ì •(/account/profile)\n  - ê²°ì œ ê´€ë¦¬(/account/billing)\n  - ë„ì›€ë§(/docs)\n  - ë¡œê·¸ì•„ì›ƒ\n\n### **ì‚¬ì´ë“œ ë„¤ë¹„ê²Œì´ì…˜ (Sidebar)**\n- **ìœ„ì¹˜**: ì¢Œì¸¡ ê³ ì • (280px ë„ˆë¹„, ëª¨ë°”ì¼ì—ì„œ ì½œë©ì„œë¸”)\n- **ë©”ë‰´ êµ¬ì¡°**:\n  - ëŒ€ì‹œë³´ë“œ (/dashboard) - í™ˆ ì•„ì´ì½˜\n  - ìƒˆ ê¸€ ì‘ì„± (/new) - íœ ì•„ì´ì½˜\n  - ìŠ¤íƒ€ì¼ ê°€ì´ë“œ (/style-guides) - íŒ”ë ˆíŠ¸ ì•„ì´ì½˜\n  - ê³„ì • ê´€ë¦¬ (/account) - ì„¤ì • ì•„ì´ì½˜\n  - ë„ì›€ë§ (/docs) - ë¬¼ìŒí‘œ ì•„ì´ì½˜\n\n### **ë¸Œë ˆë“œí¬ëŸ¼ ë„¤ë¹„ê²Œì´ì…˜**\n- **í‘œì‹œ ìœ„ì¹˜**: /new í˜ì´ì§€ ë‚´ ìƒë‹¨\n- **êµ¬ì¡°**: ëŒ€ì‹œë³´ë“œ > ìƒˆ ê¸€ ì‘ì„± > [í˜„ì¬ ë‹¨ê³„]\n- **ë‹¨ê³„ë³„**: ì£¼ì œ ì„¤ì • â†’ AI ìƒì„± â†’ í¸ì§‘ ì™„ì„±\n\n### **í‘¸í„° ë„¤ë¹„ê²Œì´ì…˜**\n- **ìœ„ì¹˜**: í˜ì´ì§€ í•˜ë‹¨ (ì¸ì¦ ë¶ˆí•„ìš” í˜ì´ì§€ë§Œ)\n- **ë©”ë‰´**: ê°œì¸ì •ë³´ì²˜ë¦¬ë°©ì¹¨, ì´ìš©ì•½ê´€, ê³ ê°ì§€ì›, íšŒì‚¬ ì†Œê°œ\n\n## 4. í˜ì´ì§€ ê³„ì¸µ êµ¬ì¡° (í˜ì´ì§€ ê³„ì¸µ êµ¬ì¡°)\n\n```\n/ (Depth 1 - ë£¨íŠ¸)\nâ”œâ”€â”€ /auth (Depth 1 - ì¸ì¦)\nâ”‚   â”œâ”€â”€ /auth/login (Depth 2)\nâ”‚   â”œâ”€â”€ /auth/signup (Depth 2)\nâ”‚   â””â”€â”€ /auth/onboarding (Depth 2)\nâ”œâ”€â”€ /dashboard (Depth 1 - ë©”ì¸ ì•±)\nâ”‚   â”œâ”€â”€ /dashboard/stats (Depth 2)\nâ”‚   â””â”€â”€ /dashboard/history (Depth 2)\nâ”œâ”€â”€ /new (Depth 1 - ê¸€ ì‘ì„±)\nâ”‚   â”œâ”€â”€ /new/setup (Depth 2)\nâ”‚   â”œâ”€â”€ /new/generate (Depth 2)\nâ”‚   â””â”€â”€ /new/edit (Depth 2)\nâ”œâ”€â”€ /style-guides (Depth 1 - ìŠ¤íƒ€ì¼ ê´€ë¦¬)\nâ”‚   â”œâ”€â”€ /style-guides/list (Depth 2)\nâ”‚   â”œâ”€â”€ /style-guides/new (Depth 2)\nâ”‚   â””â”€â”€ /style-guides/:id/edit (Depth 3)\nâ”œâ”€â”€ /account (Depth 1 - ê³„ì •)\nâ”‚   â”œâ”€â”€ /account/profile (Depth 2)\nâ”‚   â”œâ”€â”€ /account/billing (Depth 2)\nâ”‚   â””â”€â”€ /account/usage (Depth 2)\nâ”œâ”€â”€ /docs (Depth 1 - ë„ì›€ë§)\nâ”‚   â”œâ”€â”€ /docs/getting-started (Depth 2)\nâ”‚   â”œâ”€â”€ /docs/features (Depth 2)\nâ”‚   â””â”€â”€ /docs/faq (Depth 2)\nâ””â”€â”€ /pricing (Depth 1 - ê°€ê²©)\n```\n\n## 5. ì½˜í…ì¸  êµ¬ì„± (ì½˜í…ì¸  êµ¬ì„±)\n\n| í˜ì´ì§€ | í•µì‹¬ ì½˜í…ì¸  ìš”ì†Œ |\n|--------|------------------|\n| í™ˆí˜ì´ì§€(/) | íˆì–´ë¡œ ì„¹ì…˜, í•µì‹¬ ê°€ì¹˜ ì œì•ˆ, ë°ëª¨ ì˜ìƒ, ê¸°ëŠ¥ ì†Œê°œ, ê°€ê²© ì •ë³´, ì‚¬ìš©ì í›„ê¸°, CTA ë²„íŠ¼ |\n| ëŒ€ì‹œë³´ë“œ(/dashboard) | í™˜ì˜ ë©”ì‹œì§€, í†µê³„ ì¹´ë“œ(ì™„ì„± ê¸€ ìˆ˜, ì‹œê°„ ì ˆì•½), ì›”ê°„ ê·¸ë˜í”„, ìµœê·¼ ì‘ì„± ì´ë ¥, ìƒˆ ê¸€ ì‘ì„± CTA |\n| ìƒˆ ê¸€ ì‘ì„±(/new) | 3ì»¬ëŸ¼ ë ˆì´ì•„ì›ƒ: ì…ë ¥ í¼(í‚¤ì›Œë“œ, ì„¤ëª…, ìŠ¤íƒ€ì¼ ê°€ì´ë“œ), ì‹¤ì‹œê°„ ë¯¸ë¦¬ë³´ê¸°, SEO ì ê²€ íŒ¨ë„ |\n| ìŠ¤íƒ€ì¼ ê°€ì´ë“œ(/style-guides) | ê°€ì´ë“œ ì¹´ë“œ ëª©ë¡, ìƒˆ ê°€ì´ë“œ ìƒì„± ë²„íŠ¼, í¸ì§‘/ì‚­ì œ ì•¡ì…˜, ë¯¸ë¦¬ë³´ê¸° ê¸°ëŠ¥ |\n| ê³„ì • ê´€ë¦¬(/account) | íƒ­ ë„¤ë¹„ê²Œì´ì…˜(í”„ë¡œí•„/ê²°ì œ/ì‚¬ìš©ëŸ‰), í¼ í•„ë“œ, êµ¬ë… ìƒíƒœ, ì‚¬ìš©ëŸ‰ ì°¨íŠ¸ |\n| ì˜¨ë³´ë”©(/auth/onboarding) | ì§„í–‰ë¥  í‘œì‹œ, 5ë‹¨ê³„ ìœ„ì €ë“œ, ë¸Œëœë“œ ë³´ì´ìŠ¤ ì„¤ì • í¼, ì‹¤ì‹œê°„ ë¯¸ë¦¬ë³´ê¸° |\n\n## 6. ì¸í„°ë™ì…˜ íŒ¨í„´ (ì¸í„°ë™ì…˜ íŒ¨í„´)\n\n### **ëª¨ë‹¬ ì‚¬ìš© íŒ¨í„´**\n- **í™•ì¸ ëª¨ë‹¬**: ì‚­ì œ, êµ¬ë… ì·¨ì†Œ ë“± ì¤‘ìš”í•œ ì•¡ì…˜\n- **ì—…ê·¸ë ˆì´ë“œ ëª¨ë‹¬**: ë¬´ë£Œ í•œë„ ì´ˆê³¼ ì‹œ í”„ë¡œ í”Œëœ ì•ˆë‚´\n- **ì„¤ì • ëª¨ë‹¬**: ê³„ì • ì„¤ì •, ìŠ¤íƒ€ì¼ ê°€ì´ë“œ ë¹ ë¥¸ í¸ì§‘\n\n### **íˆ´íŒ íŒ¨í„´**\n- **ë„ì›€ë§ íˆ´íŒ**: ë³µì¡í•œ ê¸°ëŠ¥ ì„¤ëª… (SEO ì ìˆ˜, ë¸Œëœë“œ ë³´ì´ìŠ¤)\n- **ìƒíƒœ íˆ´íŒ**: ì§„í–‰ ìƒí™©, ì˜¤ë¥˜ ë©”ì‹œì§€\n- **ë‹¨ì¶•í‚¤ íˆ´íŒ**: í‚¤ë³´ë“œ ë‹¨ì¶•í‚¤ ì•ˆë‚´\n\n### **ì¸ë¼ì¸ í¸ì§‘ íŒ¨í„´**\n- **ë¬¸ë‹¨ë³„ ì¬ìƒì„±**: ê° ë¬¸ë‹¨ì— ì¬ìƒì„± ë²„íŠ¼\n- **ì œëª© í¸ì§‘**: í´ë¦­í•˜ì—¬ ì¦‰ì‹œ í¸ì§‘ ëª¨ë“œ\n- **ì‹¤ì‹œê°„ ì €ì¥**: ë³€ê²½ì‚¬í•­ ìë™ ì €ì¥\n\n### **í”¼ë“œë°± íŒ¨í„´**\n- **í† ìŠ¤íŠ¸ ì•Œë¦¼**: ì„±ê³µ/ì˜¤ë¥˜ ë©”ì‹œì§€, 4ì´ˆ ìë™ ë‹«í˜\n- **í”„ë¡œê·¸ë ˆìŠ¤ ë°”**: AI ìƒì„± ì§„í–‰ë¥ , SEO ì ìˆ˜\n- **ìŠ¤ì¼ˆë ˆí†¤ ë¡œë”©**: ì½˜í…ì¸  ë¡œë”© ì¤‘ ë ˆì´ì•„ì›ƒ ìœ ì§€\n\n### **ë¦¬ìŠ¤íŠ¸ ì¸í„°ë™ì…˜**\n- **ë¬´í•œ ìŠ¤í¬ë¡¤**: ì‘ì„± ì´ë ¥, ìŠ¤íƒ€ì¼ ê°€ì´ë“œ ëª©ë¡\n- **í•„í„°ë§**: ë‚ ì§œë³„, ìƒíƒœë³„ í•„í„°\n- **ê²€ìƒ‰**: ì‹¤ì‹œê°„ ê²€ìƒ‰ ê²°ê³¼\n\n## 7. URL êµ¬ì¡° (URL êµ¬ì¡°)\n\n### **URL ëª…ëª… ê·œì¹™**\n- **ì¼ë°˜ ë¦¬ì†ŒìŠ¤**: `/resource-name` (ì†Œë¬¸ì, í•˜ì´í”ˆ êµ¬ë¶„)\n- **ìƒì„¸ í˜ì´ì§€**: `/resource-name/:id`\n- **í¸ì§‘ í˜ì´ì§€**: `/resource-name/:id/edit`\n- **ì¤‘ì²© ë¦¬ì†ŒìŠ¤**: `/parent/child`\n\n### **êµ¬ì²´ì  URL êµ¬ì¡°**\n```\n/ - í™ˆí˜ì´ì§€\n/auth/login - ë¡œê·¸ì¸\n/auth/signup - íšŒì›ê°€ì…\n/auth/onboarding - ì˜¨ë³´ë”©\n\n/dashboard - ëŒ€ì‹œë³´ë“œ ë©”ì¸\n/dashboard/stats - í†µê³„ ìƒì„¸\n/dashboard/history - ì‘ì„± ì´ë ¥\n\n/new - ìƒˆ ê¸€ ì‘ì„± (ë‹¨ì¼ í˜ì´ì§€, ë‹¨ê³„ë³„ UI)\n/new?step=setup - ì£¼ì œ ì„¤ì • ë‹¨ê³„\n/new?step=generate - ìƒì„± ë‹¨ê³„  \n/new?step=edit - í¸ì§‘ ë‹¨ê³„\n\n/style-guides - ìŠ¤íƒ€ì¼ ê°€ì´ë“œ ëª©ë¡\n/style-guides/new - ìƒˆ ê°€ì´ë“œ ìƒì„±\n/style-guides/[id] - ê°€ì´ë“œ ìƒì„¸ë³´ê¸°\n/style-guides/[id]/edit - ê°€ì´ë“œ í¸ì§‘\n\n/account - ê³„ì • ê´€ë¦¬ ë©”ì¸\n/account/profile - í”„ë¡œí•„ ì„¤ì •\n/account/billing - ê²°ì œ ê´€ë¦¬\n/account/usage - ì‚¬ìš©ëŸ‰ í˜„í™©\n\n/docs - ë„ì›€ë§ ë©”ì¸\n/docs/getting-started - ì‹œì‘ ê°€ì´ë“œ\n/docs/features - ê¸°ëŠ¥ ì„¤ëª…\n/docs/faq - ìì£¼ ë¬»ëŠ” ì§ˆë¬¸\n\n/pricing - ê°€ê²© ì •ì±…\n```\n\n### **SEO ìµœì í™”**\n- **ì˜ë¯¸ìˆëŠ” URL**: ê¸°ëŠ¥ê³¼ ë‚´ìš©ì„ ëª…í™•íˆ í‘œí˜„\n- **ì¼ê´€ì„±**: ë™ì¼í•œ íŒ¨í„´ ìœ ì§€\n- **ê³„ì¸µ êµ¬ì¡°**: ë…¼ë¦¬ì  ê¹Šì´ ê´€ê³„\n\n## 8. ì»´í¬ë„ŒíŠ¸ ê³„ì¸µ êµ¬ì¡° (ì»´í¬ë„ŒíŠ¸ ê³„ì¸µ êµ¬ì¡°)\n\n### **ê¸€ë¡œë²Œ ì»´í¬ë„ŒíŠ¸**\n- **Layout**\n  - `TopNavigation` - ìƒë‹¨ ë„¤ë¹„ê²Œì´ì…˜ ë°”\n  - `Sidebar` - ì¢Œì¸¡ ì‚¬ì´ë“œë°” ë©”ë‰´\n  - `Footer` - í•˜ë‹¨ í‘¸í„° (í¼ë¸”ë¦­ í˜ì´ì§€ë§Œ)\n- **UI ê¸°ë³¸ ì»´í¬ë„ŒíŠ¸**\n  - `Button` - Primary, Secondary, Ghost ë²„íŠ¼\n  - `Input` - í…ìŠ¤íŠ¸ ì…ë ¥, í…ìŠ¤íŠ¸ì—ë¦¬ì–´, ì…€ë ‰íŠ¸\n  - `Card` - ì½˜í…ì¸  ì¹´ë“œ, í†µê³„ ì¹´ë“œ\n  - `Modal` - í™•ì¸, ì—…ê·¸ë ˆì´ë“œ, ì„¤ì • ëª¨ë‹¬\n  - `Toast` - ì•Œë¦¼ ë©”ì‹œì§€\n  - `Tooltip` - ë„ì›€ë§ íˆ´íŒ\n\n### **í˜ì´ì§€ë³„ íŠ¹í™” ì»´í¬ë„ŒíŠ¸**\n\n#### **ëŒ€ì‹œë³´ë“œ ì»´í¬ë„ŒíŠ¸**\n- `StatsCard` - ì™„ì„± ê¸€ ìˆ˜, ì‹œê°„ ì ˆì•½ í†µê³„\n- `ActivityChart` - ì›”ê°„ í™œë™ ê·¸ë˜í”„\n- `RecentPosts` - ìµœê·¼ ì‘ì„± ê¸€ ëª©ë¡\n- `QuickActions` - ë¹ ë¥¸ ì‘ì—… ë²„íŠ¼ë“¤\n\n#### **ê¸€ ì‘ì„± ì»´í¬ë„ŒíŠ¸**\n- `ContentEditor` - 3ì»¬ëŸ¼ í¸ì§‘ê¸° ë ˆì´ì•„ì›ƒ\n  - `InputPanel` - í‚¤ì›Œë“œ, ì„¤ëª… ì…ë ¥ ì˜ì—­\n  - `PreviewPanel` - ì‹¤ì‹œê°„ ë¯¸ë¦¬ë³´ê¸°\n  - `SEOPanel` - SEO ì ê²€ ë° ìµœì í™” ë„êµ¬\n- `ParagraphRegenerate` - ë¬¸ë‹¨ë³„ ì¬ìƒì„± ë²„íŠ¼\n- `ProgressTracker` - ìƒì„± ì§„í–‰ë¥  í‘œì‹œ\n- `ExportOptions` - ë§ˆí¬ë‹¤ìš´ ë‹¤ìš´ë¡œë“œ/ë³µì‚¬\n\n#### **ìŠ¤íƒ€ì¼ ê°€ì´ë“œ ì»´í¬ë„ŒíŠ¸**\n- `StyleGuideCard` - ê°€ì´ë“œ ì¹´ë“œ ì•„ì´í…œ\n- `StyleGuideForm` - ê°€ì´ë“œ ìƒì„±/í¸ì§‘ í¼\n- `BrandVoicePreview` - ë¸Œëœë“œ ë³´ì´ìŠ¤ ë¯¸ë¦¬ë³´ê¸°\n- `GuideTemplates` - í…œí”Œë¦¿ ì„ íƒê¸°\n\n#### **ì˜¨ë³´ë”© ì»´í¬ë„ŒíŠ¸**\n- `OnboardingWizard` - 5ë‹¨ê³„ ìœ„ì €ë“œ ì»¨í…Œì´ë„ˆ\n- `StepIndicator` - ì§„í–‰ë¥  í‘œì‹œ\n- `BrandVoiceForm` - ë¸Œëœë“œ ë³´ì´ìŠ¤ ì„¤ì • í¼\n- `PreviewGenerator` - ì‹¤ì‹œê°„ ìƒ˜í”Œ ìƒì„±\n\n#### **ê³„ì • ê´€ë¦¬ ì»´í¬ë„ŒíŠ¸**\n- `ProfileForm` - í”„ë¡œí•„ ì •ë³´ í¸ì§‘\n- `BillingCard` - êµ¬ë… ì •ë³´ ë° ê²°ì œ ê´€ë¦¬\n- `UsageChart` - ì‚¬ìš©ëŸ‰ í˜„í™© ì°¨íŠ¸\n- `PlanComparison` - í”Œëœ ë¹„êµ í…Œì´ë¸”\n\n### **ìƒíƒœ ê´€ë¦¬ ì»´í¬ë„ŒíŠ¸**\n- `LoadingSpinner` - ë¡œë”© ìŠ¤í”¼ë„ˆ\n- `SkeletonLoader` - ìŠ¤ì¼ˆë ˆí†¤ ë¡œë”© UI\n- `EmptyState` - ë¹ˆ ìƒíƒœ ì¼ëŸ¬ìŠ¤íŠ¸ë ˆì´ì…˜\n- `ErrorBoundary` - ì˜¤ë¥˜ ì²˜ë¦¬ ê²½ê³„\n\n### **ë°˜ì‘í˜• ì»´í¬ë„ŒíŠ¸**\n- `MobileNavigation` - ëª¨ë°”ì¼ í–„ë²„ê±° ë©”ë‰´\n- `ResponsiveLayout` - í™”ë©´ í¬ê¸°ë³„ ë ˆì´ì•„ì›ƒ ì „í™˜\n- `CollapsibleSidebar` - ì ‘ì„ ìˆ˜ ìˆëŠ” ì‚¬ì´ë“œë°”\n- `TabletOptimized` - íƒœë¸”ë¦¿ ìµœì í™” ì»´í¬ë„ŒíŠ¸\n\n### **ì ‘ê·¼ì„± ì»´í¬ë„ŒíŠ¸**\n- `SkipLink` - í‚¤ë³´ë“œ ë„¤ë¹„ê²Œì´ì…˜ìš© ìŠ¤í‚µ ë§í¬\n- `FocusTrap` - ëª¨ë‹¬ ë‚´ í¬ì»¤ìŠ¤ íŠ¸ë©\n- `ScreenReaderOnly` - ìŠ¤í¬ë¦° ë¦¬ë” ì „ìš© í…ìŠ¤íŠ¸\n- `KeyboardShortcuts` - ë‹¨ì¶•í‚¤ ì²˜ë¦¬\n\nì´ ì •ë³´ ì•„í‚¤í…ì²˜ëŠ” MVP ì¶œì‹œë¥¼ ìœ„í•œ í•µì‹¬ êµ¬ì¡°ë¥¼ ì •ì˜í•˜ë©°, ì‚¬ìš©ì ê²½í—˜ì„ ìµœì í™”í•˜ê³  ê°œë°œ íš¨ìœ¨ì„±ì„ ë†’ì´ëŠ” ê²ƒì„ ëª©í‘œë¡œ í•©ë‹ˆë‹¤.",
      "writedAt": "2025-11-08T10:13:52.019Z"
    },
    {
      "type": "step-by-step",
      "content": "\n## Core Directive\nYou are a senior software engineer AI assistant. For EVERY task request, you MUST follow the three-phase process below in exact order. Each phase must be completed with expert-level precision and detail.\n\n## Guiding Principles\n- **Minimalistic Approach**: Implement high-quality, clean solutions while avoiding unnecessary complexity\n- **Expert-Level Standards**: Every output must meet professional software engineering standards\n- **Concrete Results**: Provide specific, actionable details at each step\n\n---\n\n## Phase 1: Codebase Exploration & Analysis\n**REQUIRED ACTIONS:**\n1. **Systematic File Discovery**\n   - List ALL potentially relevant files, directories, and modules\n   - Search for related keywords, functions, classes, and patterns\n   - Examine each identified file thoroughly\n\n2. **Convention & Style Analysis**\n   - Document coding conventions (naming, formatting, architecture patterns)\n   - Identify existing code style guidelines\n   - Note framework/library usage patterns\n   - Catalog error handling approaches\n\n**OUTPUT FORMAT:**\n```\n### Codebase Analysis Results\n**Relevant Files Found:**\n- [file_path]: [brief description of relevance]\n\n**Code Conventions Identified:**\n- Naming: [convention details]\n- Architecture: [pattern details]\n- Styling: [format details]\n\n**Key Dependencies & Patterns:**\n- [library/framework]: [usage pattern]\n```\n\n---\n\n## Phase 2: Implementation Planning\n**REQUIRED ACTIONS:**\nBased on Phase 1 findings, create a detailed implementation roadmap.\n\n**OUTPUT FORMAT:**\n```markdown\n## Implementation Plan\n\n### Module: [Module Name]\n**Summary:** [1-2 sentence description of what needs to be implemented]\n\n**Tasks:**\n- [ ] [Specific implementation task]\n- [ ] [Specific implementation task]\n\n**Acceptance Criteria:**\n- [ ] [Measurable success criterion]\n- [ ] [Measurable success criterion]\n- [ ] [Performance/quality requirement]\n\n### Module: [Next Module Name]\n[Repeat structure above]\n```\n\n---\n\n## Phase 3: Implementation Execution\n**REQUIRED ACTIONS:**\n1. Implement each module following the plan from Phase 2\n2. Verify ALL acceptance criteria are met before proceeding\n3. Ensure code adheres to conventions identified in Phase 1\n\n**QUALITY GATES:**\n- [ ] All acceptance criteria validated\n- [ ] Code follows established conventions\n- [ ] Minimalistic approach maintained\n- [ ] Expert-level implementation standards met\n\n---\n\n## Success Validation\nBefore completing any task, confirm:\n- âœ… All three phases completed sequentially\n- âœ… Each phase output meets specified format requirements\n- âœ… Implementation satisfies all acceptance criteria\n- âœ… Code quality meets professional standards\n\n## Response Structure\nAlways structure your response as:\n1. **Phase 1 Results**: [Codebase analysis findings]\n2. **Phase 2 Plan**: [Implementation roadmap]  \n3. **Phase 3 Implementation**: [Actual code with validation]\n",
      "writedAt": "2025-11-08T10:13:52.019Z"
    },
    {
      "type": "clean-code",
      "content": "\n# Clean Code Guidelines\n\nYou are an expert software engineer focused on writing clean, maintainable code. Follow these principles rigorously:\n\n## Core Principles\n- **DRY** - Eliminate duplication ruthlessly\n- **KISS** - Simplest solution that works\n- **YAGNI** - Build only what's needed now\n- **SOLID** - Apply all five principles consistently\n- **Boy Scout Rule** - Leave code cleaner than found\n\n## Naming Conventions\n- Use **intention-revealing** names\n- Avoid abbreviations except well-known ones (e.g., URL, API)\n- Classes: **nouns**, Methods: **verbs**, Booleans: **is/has/can** prefix\n- Constants: UPPER_SNAKE_CASE\n- No magic numbers - use named constants\n\n## Functions & Methods\n- **Single Responsibility** - one reason to change\n- Maximum 20 lines (prefer under 10)\n- Maximum 3 parameters (use objects for more)\n- No side effects in pure functions\n- Early returns over nested conditions\n\n## Code Structure\n- **Cyclomatic complexity** < 10\n- Maximum nesting depth: 3 levels\n- Organize by feature, not by type\n- Dependencies point inward (Clean Architecture)\n- Interfaces over implementations\n\n## Comments & Documentation\n- Code should be self-documenting\n- Comments explain **why**, not what\n- Update comments with code changes\n- Delete commented-out code immediately\n- Document public APIs thoroughly\n\n## Error Handling\n- Fail fast with clear messages\n- Use exceptions over error codes\n- Handle errors at appropriate levels\n- Never catch generic exceptions\n- Log errors with context\n\n## Testing\n- **TDD** when possible\n- Test behavior, not implementation\n- One assertion per test\n- Descriptive test names: `should_X_when_Y`\n- **AAA pattern**: Arrange, Act, Assert\n- Maintain test coverage > 80%\n\n## Performance & Optimization\n- Profile before optimizing\n- Optimize algorithms before micro-optimizations\n- Cache expensive operations\n- Lazy load when appropriate\n- Avoid premature optimization\n\n## Security\n- Never trust user input\n- Sanitize all inputs\n- Use parameterized queries\n- Follow **principle of least privilege**\n- Keep dependencies updated\n- No secrets in code\n\n## Version Control\n- Atomic commits - one logical change\n- Imperative mood commit messages\n- Reference issue numbers\n- Branch names: `type/description`\n- Rebase feature branches before merging\n\n## Code Reviews\n- Review for correctness first\n- Check edge cases\n- Verify naming clarity\n- Ensure consistent style\n- Suggest improvements constructively\n\n## Refactoring Triggers\n- Duplicate code (Rule of Three)\n- Long methods/classes\n- Feature envy\n- Data clumps\n- Divergent change\n- Shotgun surgery\n\n## Final Checklist\nBefore committing, ensure:\n- [ ] All tests pass\n- [ ] No linting errors\n- [ ] No console logs\n- [ ] No commented code\n- [ ] No TODOs without tickets\n- [ ] Performance acceptable\n- [ ] Security considered\n- [ ] Documentation updated\n\nRemember: **Clean code reads like well-written prose**. Optimize for readability and maintainability over cleverness.\n",
      "writedAt": "2025-11-08T10:13:52.019Z"
    }
  ]
}
</file>

<file path=".vooster/vooster.json">
{
  "apiKey": "ak_brgywk8cnw7tdfpmh9ui45yl",
  "email": "lead@awesome.dev",
  "savedAt": "2025-11-08T10:13:51.791Z"
}
</file>

<file path="e2e/example.spec.ts">
import { test, expect } from '@playwright/test';

test.describe('Example Feature', () => {
  test.beforeEach(async ({ page }) => {
    await page.goto('/example');
  });

  test('should render the example page correctly', async ({ page }) => {
    // í˜ì´ì§€ ì œëª© í™•ì¸
    await expect(page.getByRole('heading', { name: /Backend Health Check/i })).toBeVisible();

    // ì„¤ëª… í…ìŠ¤íŠ¸ í™•ì¸
    await expect(page.getByText(/ì˜ˆì‹œ API/i)).toBeVisible();

    // ì…ë ¥ í•„ë“œ í™•ì¸
    const input = page.getByPlaceholder(/00000000-0000-0000-0000-000000000000/i);
    await expect(input).toBeVisible();

    // ì¡°íšŒ ë²„íŠ¼ í™•ì¸
    const button = page.getByRole('button', { name: /ì¡°íšŒí•˜ê¸°/i });
    await expect(button).toBeVisible();

    // ì´ˆê¸° ìƒíƒœëŠ” Idle
    await expect(page.getByText(/Idle/i)).toBeVisible();
  });

  test('should show idle message when no ID is provided', async ({ page }) => {
    // ì´ˆê¸° ìƒíƒœ ë©”ì‹œì§€ í™•ì¸
    await expect(page.getByText(/UUIDë¥¼ ì…ë ¥í•˜ê³  ì¡°íšŒí•˜ê¸° ë²„íŠ¼ì„ ëˆ„ë¥´ë©´/i)).toBeVisible();

    // Idle ìƒíƒœ ë±ƒì§€ í™•ì¸
    await expect(page.getByText(/Idle/i)).toBeVisible();
  });

  test('should clear results when empty input is submitted', async ({ page }) => {
    const input = page.getByPlaceholder(/00000000-0000-0000-0000-000000000000/i);
    const button = page.getByRole('button', { name: /ì¡°íšŒí•˜ê¸°/i });

    // ë¹ˆ ë¬¸ìì—´ ì…ë ¥
    await input.fill('   ');
    await button.click();

    // Idle ìƒíƒœë¡œ ëŒì•„ê°€ëŠ”ì§€ í™•ì¸
    await expect(page.getByText(/Idle/i)).toBeVisible();
    await expect(page.getByText(/UUIDë¥¼ ì…ë ¥í•˜ê³  ì¡°íšŒí•˜ê¸° ë²„íŠ¼ì„ ëˆ„ë¥´ë©´/i)).toBeVisible();
  });

  test('should show error for invalid UUID', async ({ page }) => {
    const input = page.getByPlaceholder(/00000000-0000-0000-0000-000000000000/i);
    const button = page.getByRole('button', { name: /ì¡°íšŒí•˜ê¸°/i });

    // ì˜ëª»ëœ UUID ì…ë ¥
    await input.fill('invalid-uuid-format');
    await button.click();

    // Error ìƒíƒœ ë±ƒì§€ í™•ì¸
    await expect(page.getByText(/Error/i).first()).toBeVisible({ timeout: 10000 });

    // ì—ëŸ¬ ë©”ì‹œì§€ í™•ì¸
    await expect(page.getByText(/ìš”ì²­ ì‹¤íŒ¨/i)).toBeVisible();
  });

  test('should handle loading state', async ({ page }) => {
    const input = page.getByPlaceholder(/00000000-0000-0000-0000-000000000000/i);
    const button = page.getByRole('button', { name: /ì¡°íšŒí•˜ê¸°/i });

    // ì„ì˜ì˜ UUID ì…ë ¥ (ëŠë¦° ì‘ë‹µì„ ì‹œë®¬ë ˆì´ì…˜í•˜ê¸° ìœ„í•´)
    await input.fill('00000000-0000-0000-0000-000000000001');
    await button.click();

    // Fetching ìƒíƒœê°€ ë‚˜íƒ€ë‚˜ëŠ”ì§€ í™•ì¸ (ë¹ ë¥´ê²Œ ì§€ë‚˜ê°ˆ ìˆ˜ ìˆìŒ)
    const fetchingOrError = page.getByText(/Fetching|Error/i).first();
    await expect(fetchingOrError).toBeVisible({ timeout: 10000 });
  });

  test('should allow refetch with same ID', async ({ page }) => {
    const input = page.getByPlaceholder(/00000000-0000-0000-0000-000000000000/i);
    const button = page.getByRole('button', { name: /ì¡°íšŒí•˜ê¸°/i });

    const testId = 'test-id-12345';

    // ì²« ë²ˆì§¸ ì¡°íšŒ
    await input.fill(testId);
    await button.click();

    // ê²°ê³¼ ëŒ€ê¸°
    await expect(page.getByText(/Error|Success/i).first()).toBeVisible({ timeout: 10000 });

    // ê°™ì€ IDë¡œ ë‹¤ì‹œ ì¡°íšŒ
    await button.click();

    // ë‹¤ì‹œ Fetching ìƒíƒœê°€ ë˜ëŠ”ì§€ í™•ì¸
    await expect(page.getByText(/Fetching|Error|Success/i).first()).toBeVisible({ timeout: 10000 });
  });

  test('should display result sections correctly', async ({ page }) => {
    // í˜„ì¬ ìƒíƒœ ì„¹ì…˜ í™•ì¸
    await expect(page.getByRole('heading', { name: /í˜„ì¬ ìƒíƒœ/i })).toBeVisible();

    // ê²°ê³¼ í‘œì‹œ ì˜ì—­ì´ ì¡´ì¬í•˜ëŠ”ì§€ í™•ì¸
    const resultSection = page.locator('article').filter({ hasText: /í˜„ì¬ ìƒíƒœ/ });
    await expect(resultSection).toBeVisible();
  });
});
</file>

<file path="scripts/check-env.ts">
import 'dotenv/config';

async function checkEnv() {
  try {
    // Import env.ts to trigger validation
    await import('../src/constants/env.js');
    console.log('âœ… Environment variables are valid!');
    process.exit(0);
  } catch (error) {
    console.error('âŒ Environment validation failed:');
    if (error instanceof Error) {
      console.error(error.message);
    } else {
      console.error(error);
    }
    process.exit(1);
  }
}

checkEnv();
</file>

<file path="scripts/test-env-check.sh">
#!/bin/bash

echo "ğŸ§ª Running Acceptance Tests for env:check"
echo ""

# Setup
BACKUP_FILE=".env.local.backup"
[ -f .env.local ] && cp .env.local $BACKUP_FILE

PASS_COUNT=0
FAIL_COUNT=0

# Test 1: Valid env
echo "Test 1: Valid environment variables"
cat > .env.local << EOF
NEXT_PUBLIC_SUPABASE_URL=https://test.supabase.co
NEXT_PUBLIC_SUPABASE_ANON_KEY=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.test
SUPABASE_URL=https://test.supabase.co
SUPABASE_SERVICE_ROLE_KEY=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.service
EOF

if npm run env:check > /dev/null 2>&1; then
  echo "âœ… PASS: Valid env detected"
  ((PASS_COUNT++))
else
  echo "âŒ FAIL: Valid env should pass"
  ((FAIL_COUNT++))
fi
echo ""

# Test 2: Missing vars
echo "Test 2: Missing environment variables"
cat > .env.local << EOF
NEXT_PUBLIC_SUPABASE_URL=https://test.supabase.co
EOF

if npm run env:check > /dev/null 2>&1; then
  echo "âŒ FAIL: Missing vars should fail"
  ((FAIL_COUNT++))
else
  echo "âœ… PASS: Missing vars detected"
  ((PASS_COUNT++))
fi
echo ""

# Test 3: No file
echo "Test 3: No .env.local file"
rm -f .env.local

if npm run env:check > /dev/null 2>&1; then
  echo "âŒ FAIL: No file should fail"
  ((FAIL_COUNT++))
else
  echo "âœ… PASS: No file detected"
  ((PASS_COUNT++))
fi
echo ""

# Test 4: Invalid URL format
echo "Test 4: Invalid URL format"
cat > .env.local << EOF
NEXT_PUBLIC_SUPABASE_URL=not-a-valid-url
NEXT_PUBLIC_SUPABASE_ANON_KEY=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.test
SUPABASE_URL=not-a-valid-url
SUPABASE_SERVICE_ROLE_KEY=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.service
EOF

if npm run env:check > /dev/null 2>&1; then
  echo "âŒ FAIL: Invalid URL should fail"
  ((FAIL_COUNT++))
else
  echo "âœ… PASS: Invalid URL detected"
  ((PASS_COUNT++))
fi
echo ""

# Cleanup
[ -f $BACKUP_FILE ] && mv $BACKUP_FILE .env.local || rm -f .env.local

echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
echo "ğŸ‰ Acceptance tests complete!"
echo "   Passed: $PASS_COUNT"
echo "   Failed: $FAIL_COUNT"
echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"

if [ $FAIL_COUNT -eq 0 ]; then
  exit 0
else
  exit 1
fi
</file>

<file path="src/app/(protected)/account/page.tsx">
"use client";

type AccountPageProps = {
  params: Promise<Record<string, never>>;
};

export default function AccountPage({ params }: AccountPageProps) {
  void params;

  return (
    <div className="flex flex-col gap-4">
      <h1 className="text-3xl font-bold">ê³„ì • ê´€ë¦¬</h1>
      <p className="text-muted-foreground">
        ì´ í˜ì´ì§€ëŠ” ì¶”í›„ êµ¬í˜„ë  ì˜ˆì •ì…ë‹ˆë‹¤.
      </p>
    </div>
  );
}
</file>

<file path="src/app/(protected)/style-guide/page.tsx">
"use client";

type StyleGuidePageProps = {
  params: Promise<Record<string, never>>;
};

export default function StyleGuidePage({ params }: StyleGuidePageProps) {
  void params;

  return (
    <div className="flex flex-col gap-4">
      <h1 className="text-3xl font-bold">ìŠ¤íƒ€ì¼ ê°€ì´ë“œ</h1>
      <p className="text-muted-foreground">
        ì´ í˜ì´ì§€ëŠ” ì¶”í›„ êµ¬í˜„ë  ì˜ˆì •ì…ë‹ˆë‹¤.
      </p>
    </div>
  );
}
</file>

<file path="src/app/api/[[...hono]]/route.ts">
import { handle } from 'hono/vercel';
import { createHonoApp } from '@/backend/hono/app';

const app = createHonoApp();

export const GET = handle(app);
export const POST = handle(app);
export const PUT = handle(app);
export const PATCH = handle(app);
export const DELETE = handle(app);
export const OPTIONS = handle(app);

export const runtime = 'nodejs';
</file>

<file path="src/app/auth/onboarding/_actions.ts">
"use server";

import { auth, clerkClient } from "@clerk/nextjs/server";

/**
 * ì˜¨ë³´ë”© ì™„ë£Œ ì²˜ë¦¬ ì„œë²„ ì•¡ì…˜
 * ì‚¬ìš©ìì˜ publicMetadataì— onboardingCompletedë¥¼ trueë¡œ ì„¤ì •
 */
export async function completeOnboarding() {
  try {
    const { userId } = await auth();

    if (!userId) {
      return {
        success: false,
        error: "ì¸ì¦ë˜ì§€ ì•Šì€ ì‚¬ìš©ìì…ë‹ˆë‹¤.",
      };
    }

    // Clerk í´ë¼ì´ì–¸íŠ¸ë¥¼ ì‚¬ìš©í•˜ì—¬ ì‚¬ìš©ì ë©”íƒ€ë°ì´í„° ì—…ë°ì´íŠ¸
    const client = await clerkClient();
    await client.users.updateUser(userId, {
      publicMetadata: {
        onboardingCompleted: true,
      },
    });

    return {
      success: true,
      message: "ì˜¨ë³´ë”©ì´ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤.",
    };
  } catch (error) {
    console.error("ì˜¨ë³´ë”© ì™„ë£Œ ì²˜ë¦¬ ì¤‘ ì˜¤ë¥˜:", error);
    return {
      success: false,
      error: "ì˜¨ë³´ë”© ì™„ë£Œ ì²˜ë¦¬ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.",
    };
  }
}
</file>

<file path="src/app/auth/onboarding/page.tsx">
"use client";

import { toast } from "sonner";
import { OnboardingWizard } from "@/features/onboarding/components/onboarding-wizard";
import { completeOnboarding } from "@/features/onboarding/actions/complete-onboarding";
import { OnboardingFormData } from "@/features/onboarding/lib/onboarding-schema";

export default function OnboardingPage() {

  const handleComplete = async (data: OnboardingFormData) => {
    try {
      // Call server action
      const result = await completeOnboarding(data);

      if (result.success) {
        // Navigate to dashboard with special query param to bypass middleware onboarding check
        // The middleware will allow access and then clean up the param on redirect
        // This works around Clerk's session caching delay
        window.location.href = "/dashboard?onboarding_completed=true&welcome=true";
      }
    } catch (error) {
      // Show error message
      toast.error("ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤", {
        description:
          error instanceof Error
            ? error.message
            : "ì˜¨ë³´ë”© ì™„ë£Œ ì¤‘ ë¬¸ì œê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤",
      });
      throw error;
    }
  };

  return <OnboardingWizard onComplete={handleComplete} />;
}
</file>

<file path="src/app/example/page.tsx">
'use client';

import { ExampleStatus } from '@/features/example/components/example-status';

export default function ExamplePage() {
  return (
    <div className="min-h-screen bg-gradient-to-b from-slate-950 via-slate-900 to-slate-950 px-6 py-16 text-slate-100">
      <ExampleStatus />
    </div>
  );
}
</file>

<file path="src/backend/http/response.ts">
import type { ContentfulStatusCode } from 'hono/utils/http-status';
import type { AppContext } from '@/backend/hono/context';

export type SuccessResult<TData> = {
  ok: true;
  status: ContentfulStatusCode;
  data: TData;
};

export type ErrorResult<TCode extends string, TDetails = unknown> = {
  ok: false;
  status: ContentfulStatusCode;
  error: {
    code: TCode;
    message: string;
    details?: TDetails;
  };
};

export type HandlerResult<TData, TCode extends string, TDetails = unknown> =
  | SuccessResult<TData>
  | ErrorResult<TCode, TDetails>;

export const success = <TData>(
  data: TData,
  status: ContentfulStatusCode = 200,
): SuccessResult<TData> => ({
  ok: true,
  status,
  data,
});

export const failure = <TCode extends string, TDetails = unknown>(
  status: ContentfulStatusCode,
  code: TCode,
  message: string,
  details?: TDetails,
): ErrorResult<TCode, TDetails> => ({
  ok: false,
  status,
  error: {
    code,
    message,
    ...(details === undefined ? {} : { details }),
  },
});

export const respond = <TData, TCode extends string, TDetails = unknown>(
  c: AppContext,
  result: HandlerResult<TData, TCode, TDetails>,
) => {
  if (result.ok) {
    return c.json(result.data, result.status);
  }

  const errorResult = result as ErrorResult<TCode, TDetails>;

  return c.json(
    {
      error: errorResult.error,
    },
    errorResult.status,
  );
};
</file>

<file path="src/backend/middleware/context.ts">
import { createMiddleware } from 'hono/factory';
import { getAppConfig } from '@/backend/config';
import {
  contextKeys,
  type AppEnv,
  type AppLogger,
} from '@/backend/hono/context';

const logger: AppLogger = {
  info: (...args) => console.info(...args),
  error: (...args) => console.error(...args),
  warn: (...args) => console.warn(...args),
  debug: (...args) => console.debug(...args),
};

export const withAppContext = () => {
  const config = getAppConfig();

  return createMiddleware<AppEnv>(async (c, next) => {
    c.set(contextKeys.logger, logger);
    c.set(contextKeys.config, config);

    await next();
  });
};
</file>

<file path="src/backend/middleware/error.ts">
import { createMiddleware } from 'hono/factory';
import { match, P } from 'ts-pattern';
import {
  contextKeys,
  type AppEnv,
  type AppLogger,
} from '@/backend/hono/context';

export const errorBoundary = () =>
  createMiddleware<AppEnv>(async (c, next) => {
    try {
      await next();
    } catch (error) {
      const logger = c.get(contextKeys.logger) as AppLogger | undefined;
      const message = match(error)
        .with(P.instanceOf(Error), (err) => err.message)
        .otherwise(() => 'Unexpected error');

      logger?.error?.(error);

      return c.json(
        {
          error: {
            code: 'INTERNAL_SERVER_ERROR',
            message,
          },
        },
        500,
      );
    }
  });
</file>

<file path="src/backend/middleware/supabase.ts">
import { createMiddleware } from 'hono/factory';
import {
  contextKeys,
  type AppEnv,
} from '@/backend/hono/context';
import { createServiceClient } from '@/backend/supabase/client';

export const withSupabase = () =>
  createMiddleware<AppEnv>(async (c, next) => {
    const config = c.get(
      contextKeys.config,
    ) as AppEnv['Variables']['config'] | undefined;

    if (!config) {
      throw new Error('Application configuration is not available.');
    }

    const client = createServiceClient(config.supabase);

    c.set(contextKeys.supabase, client);

    await next();
  });
</file>

<file path="src/backend/supabase/client.ts">
import { createClient } from '@supabase/supabase-js';
import type { SupabaseClient } from '@supabase/supabase-js';

export type ServiceClientConfig = {
  url: string;
  serviceRoleKey: string;
};

export const createServiceClient = ({
  url,
  serviceRoleKey,
}: ServiceClientConfig): SupabaseClient =>
  createClient(url, serviceRoleKey, {
    auth: {
      persistSession: false,
    },
  });
</file>

<file path="src/components/brand/logo.tsx">
import Link from "next/link";

type LogoProps = {
  className?: string;
  showText?: boolean;
};

export function Logo({ className = "", showText = true }: LogoProps) {
  return (
    <Link href="/" className={`flex items-center gap-2 ${className}`}>
      <div className="flex h-8 w-8 items-center justify-center rounded-lg bg-gradient-to-br from-[#3BA2F8] to-[#2680D0]">
        <span className="text-lg font-bold text-white">C</span>
      </div>
      {showText && (
        <span className="text-xl font-bold text-gray-900">ContentCraft AI</span>
      )}
    </Link>
  );
}
</file>

<file path="src/components/dashboard/activity-chart.tsx">
"use client";

import { Card, CardContent, CardHeader, CardTitle } from "@/components/ui/card";

export function ActivityChart() {
  return (
    <Card>
      <CardHeader>
        <CardTitle>ì›”ê°„ í™œë™ ê·¸ë˜í”„</CardTitle>
      </CardHeader>
      <CardContent>
        <div className="flex h-64 items-center justify-center rounded-lg border-2 border-dashed border-muted-foreground/25">
          <p className="text-sm text-muted-foreground">
            ì°¨íŠ¸ ë¼ì´ë¸ŒëŸ¬ë¦¬(ì˜ˆ: Recharts)ê°€ ì—¬ê¸°ì— í‘œì‹œë©ë‹ˆë‹¤
          </p>
        </div>
      </CardContent>
    </Card>
  );
}
</file>

<file path="src/components/dashboard/recent-articles-list.tsx">
"use client";

import { Card, CardContent, CardHeader, CardTitle } from "@/components/ui/card";
import {
  Table,
  TableBody,
  TableCell,
  TableHead,
  TableHeader,
  TableRow,
} from "@/components/ui/table";
import { Badge } from "@/components/ui/badge";
import { Button } from "@/components/ui/button";
import { Eye, Pencil } from "lucide-react";

type Article = {
  id: string;
  title: string;
  status: "ì™„ë£Œ" | "ì‘ì„±ì¤‘";
  createdAt: string;
};

const dummyArticles: Article[] = [
  {
    id: "1",
    title: "Next.js 15ì˜ ìƒˆë¡œìš´ ê¸°ëŠ¥ ì‚´í´ë³´ê¸°",
    status: "ì™„ë£Œ",
    createdAt: "2025-11-05",
  },
  {
    id: "2",
    title: "AIë¥¼ í™œìš©í•œ ì½˜í…ì¸  ë§ˆì¼€íŒ… ì „ëµ",
    status: "ì™„ë£Œ",
    createdAt: "2025-11-03",
  },
  {
    id: "3",
    title: "ì¸ë””í•´ì»¤ë¥¼ ìœ„í•œ SEO ìµœì í™” ê°€ì´ë“œ",
    status: "ì™„ë£Œ",
    createdAt: "2025-11-01",
  },
  {
    id: "4",
    title: "SaaS ì œí’ˆì˜ ì„±ì¥ í•´í‚¹ ì „ëµ",
    status: "ì‘ì„±ì¤‘",
    createdAt: "2025-10-28",
  },
];

export function RecentArticlesList() {
  return (
    <Card>
      <CardHeader>
        <CardTitle>ìµœê·¼ ì‘ì„±í•œ ê¸€</CardTitle>
      </CardHeader>
      <CardContent>
        <Table>
          <TableHeader>
            <TableRow>
              <TableHead>ìƒíƒœ</TableHead>
              <TableHead>ì œëª©</TableHead>
              <TableHead>ìƒì„±ì¼</TableHead>
              <TableHead className="text-right">ì•¡ì…˜</TableHead>
            </TableRow>
          </TableHeader>
          <TableBody>
            {dummyArticles.map((article) => (
              <TableRow key={article.id}>
                <TableCell>
                  <Badge
                    variant={
                      article.status === "ì™„ë£Œ" ? "default" : "secondary"
                    }
                  >
                    {article.status}
                  </Badge>
                </TableCell>
                <TableCell className="font-medium">{article.title}</TableCell>
                <TableCell>{article.createdAt}</TableCell>
                <TableCell className="text-right">
                  <div className="flex justify-end gap-2">
                    <Button variant="ghost" size="icon">
                      <Eye className="h-4 w-4" />
                    </Button>
                    <Button variant="ghost" size="icon">
                      <Pencil className="h-4 w-4" />
                    </Button>
                  </div>
                </TableCell>
              </TableRow>
            ))}
          </TableBody>
        </Table>
      </CardContent>
    </Card>
  );
}
</file>

<file path="src/components/dashboard/stats-cards.tsx">
"use client";

import {
  Card,
  CardContent,
  CardDescription,
  CardHeader,
  CardTitle,
} from "@/components/ui/card";
import { FileText, Clock } from "lucide-react";

type StatsCardsProps = {
  monthlyArticles?: number;
  monthlyGoal?: number;
  savedHours?: number;
};

export function StatsCards({
  monthlyArticles = 4,
  monthlyGoal = 10,
  savedHours = 8,
}: StatsCardsProps) {
  const achievementRate = Math.round((monthlyArticles / monthlyGoal) * 100);

  return (
    <div className="grid grid-cols-1 gap-4 md:grid-cols-2">
      <Card>
        <CardHeader className="flex flex-row items-center justify-between space-y-0 pb-2">
          <CardTitle className="text-sm font-medium">ì›”ê°„ ì™„ì„± ê¸€ ìˆ˜</CardTitle>
          <FileText className="h-4 w-4 text-muted-foreground" />
        </CardHeader>
        <CardContent>
          <div className="text-2xl font-bold">
            {monthlyArticles} / {monthlyGoal}í¸
          </div>
          <CardDescription className="mt-1">
            ëª©í‘œì˜ {achievementRate}%ë¥¼ ë‹¬ì„±í–ˆì–´ìš”!
          </CardDescription>
        </CardContent>
      </Card>

      <Card>
        <CardHeader className="flex flex-row items-center justify-between space-y-0 pb-2">
          <CardTitle className="text-sm font-medium">ëˆ„ì  ì ˆì•½ ì‹œê°„</CardTitle>
          <Clock className="h-4 w-4 text-muted-foreground" />
        </CardHeader>
        <CardContent>
          <div className="text-2xl font-bold">{savedHours} ì‹œê°„</div>
          <CardDescription className="mt-1">
            ì´ë²ˆ ë‹¬ì— ì ˆì•½í•œ ì‹œê°„
          </CardDescription>
        </CardContent>
      </Card>
    </div>
  );
}
</file>

<file path="src/components/dashboard/welcome-banner.tsx">
"use client";

import { useState, useEffect } from "react";
import { X, Sparkles } from "lucide-react";
import { useRouter } from "next/navigation";

interface WelcomeBannerProps {
  onDismiss?: () => void;
}

export function WelcomeBanner({ onDismiss }: WelcomeBannerProps) {
  const [isVisible, setIsVisible] = useState(false);
  const router = useRouter();

  // Mount animation
  useEffect(() => {
    setIsVisible(true);

    // Auto-dismiss after 10 seconds
    const timer = setTimeout(() => {
      handleDismiss();
    }, 10000);

    return () => clearTimeout(timer);
  }, []);

  // Handle ESC key for accessibility
  useEffect(() => {
    const handleKeyDown = (e: KeyboardEvent) => {
      if (e.key === "Escape") {
        handleDismiss();
      }
    };

    window.addEventListener("keydown", handleKeyDown);
    return () => window.removeEventListener("keydown", handleKeyDown);
  }, []);

  const handleDismiss = () => {
    setIsVisible(false);
    setTimeout(() => {
      onDismiss?.();
    }, 250); // Wait for animation to complete
  };

  const handleCTAClick = () => {
    router.push("/new-article");
  };

  return (
    <div
      role="status"
      aria-live="polite"
      className={`
        transition-all duration-250 ease-out
        ${isVisible ? "opacity-100 translate-y-0" : "opacity-0 -translate-y-4"}
      `}
    >
      <div
        className="
          bg-[#F0F9FF]
          border-l-4 border-[#3BA2F8]
          rounded-[12px]
          p-4 md:p-6
          shadow-sm
        "
      >
        <div className="flex flex-col md:flex-row md:items-center md:justify-between gap-4">
          {/* Content */}
          <div className="flex items-start gap-3 flex-1">
            <div className="flex-shrink-0 mt-0.5">
              <Sparkles className="w-5 h-5 text-[#3BA2F8]" aria-hidden="true" />
            </div>
            <div className="flex-1">
              <h3 className="text-[16px] font-semibold text-[#1E2A38] mb-1">
                í™˜ì˜í•©ë‹ˆë‹¤! ğŸ‰
              </h3>
              <p className="text-[14px] text-[#374151] leading-[1.5]">
                ëª¨ë“  ì„¤ì •ì´ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤. ì´ì œ AIë¡œ ì²« ì½˜í…ì¸ ë¥¼ ìƒì„±í•´ë³´ì„¸ìš”!
              </p>
            </div>
          </div>

          {/* Actions */}
          <div className="flex items-center gap-3 md:flex-shrink-0">
            <button
              onClick={handleCTAClick}
              className="
                bg-[#3BA2F8]
                text-white
                px-6
                py-2.5
                rounded-lg
                text-[14px]
                font-medium
                hover:bg-[#2d8fd9]
                transition-colors
                focus:outline-none
                focus:ring-2
                focus:ring-[#3BA2F8]
                focus:ring-offset-2
                h-[40px]
              "
              aria-label="ì²« ê¸€ ì‘ì„±í•˜ëŸ¬ ê°€ê¸°"
            >
              ì²« ê¸€ ì‘ì„±
            </button>
            <button
              onClick={handleDismiss}
              className="
                p-2
                text-[#6B7280]
                hover:text-[#374151]
                hover:bg-white/50
                rounded-lg
                transition-colors
                focus:outline-none
                focus:ring-2
                focus:ring-[#3BA2F8]
                focus:ring-offset-2
              "
              aria-label="í™˜ì˜ ë©”ì‹œì§€ ë‹«ê¸°"
            >
              <X className="w-5 h-5" aria-hidden="true" />
            </button>
          </div>
        </div>
      </div>
    </div>
  );
}
</file>

<file path="src/components/dashboard/welcome-header.tsx">
"use client";

import { Button } from "@/components/ui/button";
import { Plus } from "lucide-react";

type WelcomeHeaderProps = {
  userName?: string;
};

export function WelcomeHeader({ userName = "Sam" }: WelcomeHeaderProps) {
  return (
    <div className="flex flex-col gap-4 sm:flex-row sm:items-center sm:justify-between">
      <div>
        <h1 className="text-3xl font-bold text-foreground">
          ì•ˆë…•í•˜ì„¸ìš”, {userName}ë‹˜!
        </h1>
        <p className="mt-1 text-muted-foreground">
          ì˜¤ëŠ˜ë„ ë©‹ì§„ ì½˜í…ì¸ ë¥¼ ë§Œë“¤ì–´ ë³´ì„¸ìš”.
        </p>
      </div>
      <Button size="lg" className="sm:ml-auto">
        ìƒˆ ê¸€ ì‘ì„±
        <Plus className="ml-2 h-4 w-4" />
      </Button>
    </div>
  );
}
</file>

<file path="src/components/layout/sidebar.tsx">
"use client";

import Link from "next/link";
import { usePathname } from "next/navigation";
import { LayoutDashboard, PenTool, FileText, User, Menu } from "lucide-react";
import { cn } from "@/lib/utils";
import { Button } from "@/components/ui/button";
import { Sheet, SheetContent, SheetTrigger } from "@/components/ui/sheet";

const menuItems = [
  {
    icon: LayoutDashboard,
    label: "ëŒ€ì‹œë³´ë“œ",
    href: "/dashboard",
  },
  {
    icon: PenTool,
    label: "ìƒˆ ê¸€ ì‘ì„±",
    href: "/new-article",
  },
  {
    icon: FileText,
    label: "ìŠ¤íƒ€ì¼ ê°€ì´ë“œ",
    href: "/style-guide",
  },
  {
    icon: User,
    label: "ê³„ì • ê´€ë¦¬",
    href: "/account",
  },
];

function SidebarContent() {
  const pathname = usePathname();

  return (
    <div className="flex h-full flex-col gap-4 p-4">
      <div className="mb-4">
        <h1 className="text-2xl font-bold text-primary">ì½˜í…ì¸ ë©”ì´ì»¤</h1>
      </div>
      <nav className="flex flex-col gap-2">
        {menuItems.map((item) => {
          const Icon = item.icon;
          const isActive = pathname === item.href;
          return (
            <Link key={item.href} href={item.href}>
              <Button
                variant={isActive ? "secondary" : "ghost"}
                className={cn(
                  "w-full justify-start gap-3",
                  isActive && "bg-secondary",
                )}
              >
                <Icon className="h-5 w-5" />
                <span>{item.label}</span>
              </Button>
            </Link>
          );
        })}
      </nav>
    </div>
  );
}

export function Sidebar() {
  return (
    <>
      {/* Mobile Sidebar */}
      <div className="md:hidden">
        <Sheet>
          <SheetTrigger asChild>
            <Button variant="ghost" size="icon" className="md:hidden">
              <Menu className="h-6 w-6" />
            </Button>
          </SheetTrigger>
          <SheetContent side="left" className="w-64 p-0">
            <SidebarContent />
          </SheetContent>
        </Sheet>
      </div>

      {/* Desktop Sidebar */}
      <aside className="hidden w-64 border-r bg-background md:block">
        <SidebarContent />
      </aside>
    </>
  );
}
</file>

<file path="src/components/ui/accordion.tsx">
"use client"

import * as React from "react"
import * as AccordionPrimitive from "@radix-ui/react-accordion"
import { ChevronDown } from "lucide-react"

import { cn } from "@/lib/utils"

const Accordion = AccordionPrimitive.Root

const AccordionItem = React.forwardRef<
  React.ElementRef<typeof AccordionPrimitive.Item>,
  React.ComponentPropsWithoutRef<typeof AccordionPrimitive.Item>
>(({ className, ...props }, ref) => (
  <AccordionPrimitive.Item
    ref={ref}
    className={cn("border-b", className)}
    {...props}
  />
))
AccordionItem.displayName = "AccordionItem"

const AccordionTrigger = React.forwardRef<
  React.ElementRef<typeof AccordionPrimitive.Trigger>,
  React.ComponentPropsWithoutRef<typeof AccordionPrimitive.Trigger>
>(({ className, children, ...props }, ref) => (
  <AccordionPrimitive.Header className="flex">
    <AccordionPrimitive.Trigger
      ref={ref}
      className={cn(
        "flex flex-1 items-center justify-between py-4 font-medium transition-all hover:underline [&[data-state=open]>svg]:rotate-180",
        className
      )}
      {...props}
    >
      {children}
      <ChevronDown className="h-4 w-4 shrink-0 transition-transform duration-200" />
    </AccordionPrimitive.Trigger>
  </AccordionPrimitive.Header>
))
AccordionTrigger.displayName = AccordionPrimitive.Trigger.displayName

const AccordionContent = React.forwardRef<
  React.ElementRef<typeof AccordionPrimitive.Content>,
  React.ComponentPropsWithoutRef<typeof AccordionPrimitive.Content>
>(({ className, children, ...props }, ref) => (
  <AccordionPrimitive.Content
    ref={ref}
    className="overflow-hidden text-sm transition-all data-[state=closed]:animate-accordion-up data-[state=open]:animate-accordion-down"
    {...props}
  >
    <div className={cn("pb-4 pt-0", className)}>{children}</div>
  </AccordionPrimitive.Content>
))

AccordionContent.displayName = AccordionPrimitive.Content.displayName

export { Accordion, AccordionItem, AccordionTrigger, AccordionContent }
</file>

<file path="src/components/ui/alert.tsx">
"use client"

import * as React from "react"
import { cva, type VariantProps } from "class-variance-authority"

import { cn } from "@/lib/utils"

const alertVariants = cva(
  "relative w-full rounded-lg border p-4 [&>svg~*]:pl-7 [&>svg+div]:translate-y-[-3px] [&>svg]:absolute [&>svg]:left-4 [&>svg]:top-4 [&>svg]:text-foreground",
  {
    variants: {
      variant: {
        default: "bg-background text-foreground",
        destructive:
          "border-destructive/50 text-destructive dark:border-destructive [&>svg]:text-destructive",
      },
    },
    defaultVariants: {
      variant: "default",
    },
  }
)

const Alert = React.forwardRef<
  HTMLDivElement,
  React.HTMLAttributes<HTMLDivElement> & VariantProps<typeof alertVariants>
>(({ className, variant, ...props }, ref) => (
  <div
    ref={ref}
    role="alert"
    className={cn(alertVariants({ variant }), className)}
    {...props}
  />
))
Alert.displayName = "Alert"

const AlertTitle = React.forwardRef<
  HTMLParagraphElement,
  React.HTMLAttributes<HTMLHeadingElement>
>(({ className, ...props }, ref) => (
  <h5
    ref={ref}
    className={cn("mb-1 font-medium leading-none tracking-tight", className)}
    {...props}
  />
))
AlertTitle.displayName = "AlertTitle"

const AlertDescription = React.forwardRef<
  HTMLParagraphElement,
  React.HTMLAttributes<HTMLParagraphElement>
>(({ className, ...props }, ref) => (
  <div
    ref={ref}
    className={cn("text-sm [&_p]:leading-relaxed", className)}
    {...props}
  />
))
AlertDescription.displayName = "AlertDescription"

export { Alert, AlertTitle, AlertDescription }
</file>

<file path="src/components/ui/avatar.tsx">
"use client"

import * as React from "react"
import * as AvatarPrimitive from "@radix-ui/react-avatar"

import { cn } from "@/lib/utils"

const Avatar = React.forwardRef<
  React.ElementRef<typeof AvatarPrimitive.Root>,
  React.ComponentPropsWithoutRef<typeof AvatarPrimitive.Root>
>(({ className, ...props }, ref) => (
  <AvatarPrimitive.Root
    ref={ref}
    className={cn(
      "relative flex h-10 w-10 shrink-0 overflow-hidden rounded-full",
      className
    )}
    {...props}
  />
))
Avatar.displayName = AvatarPrimitive.Root.displayName

const AvatarImage = React.forwardRef<
  React.ElementRef<typeof AvatarPrimitive.Image>,
  React.ComponentPropsWithoutRef<typeof AvatarPrimitive.Image>
>(({ className, ...props }, ref) => (
  <AvatarPrimitive.Image
    ref={ref}
    className={cn("aspect-square h-full w-full", className)}
    {...props}
  />
))
AvatarImage.displayName = AvatarPrimitive.Image.displayName

const AvatarFallback = React.forwardRef<
  React.ElementRef<typeof AvatarPrimitive.Fallback>,
  React.ComponentPropsWithoutRef<typeof AvatarPrimitive.Fallback>
>(({ className, ...props }, ref) => (
  <AvatarPrimitive.Fallback
    ref={ref}
    className={cn(
      "flex h-full w-full items-center justify-center rounded-full bg-muted",
      className
    )}
    {...props}
  />
))
AvatarFallback.displayName = AvatarPrimitive.Fallback.displayName

export { Avatar, AvatarImage, AvatarFallback }
</file>

<file path="src/components/ui/badge.tsx">
import * as React from "react";
import { cva, type VariantProps } from "class-variance-authority";

import { cn } from "@/lib/utils";

const badgeVariants = cva(
  "inline-flex items-center rounded-full border px-2.5 py-0.5 text-xs font-semibold transition-colors focus:outline-hidden focus:ring-2 focus:ring-ring focus:ring-offset-2",
  {
    variants: {
      variant: {
        default:
          "border-transparent bg-primary text-primary-foreground hover:bg-primary/80",
        secondary:
          "border-transparent bg-secondary text-secondary-foreground hover:bg-secondary/80",
        destructive:
          "border-transparent bg-destructive text-destructive-foreground hover:bg-destructive/80",
        outline: "text-foreground",
      },
    },
    defaultVariants: {
      variant: "default",
    },
  },
);

export interface BadgeProps
  extends React.HTMLAttributes<HTMLDivElement>,
    VariantProps<typeof badgeVariants> {}

function Badge({ className, variant, ...props }: BadgeProps) {
  return (
    <div className={cn(badgeVariants({ variant }), className)} {...props} />
  );
}

export { Badge, badgeVariants };
</file>

<file path="src/components/ui/button.tsx">
import * as React from "react";
import { Slot } from "@radix-ui/react-slot";
import { cva, type VariantProps } from "class-variance-authority";

import { cn } from "@/lib/utils";

const buttonVariants = cva(
  "inline-flex items-center justify-center whitespace-nowrap rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-hidden focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50",
  {
    variants: {
      variant: {
        default: "bg-primary text-primary-foreground hover:bg-primary/90",
        destructive:
          "bg-destructive text-destructive-foreground hover:bg-destructive/90",
        outline:
          "border border-input bg-background hover:bg-accent hover:text-accent-foreground",
        secondary:
          "bg-secondary text-secondary-foreground hover:bg-secondary/80",
        ghost: "hover:bg-accent hover:text-accent-foreground",
        link: "text-primary underline-offset-4 hover:underline",
      },
      size: {
        default: "h-10 px-4 py-2",
        sm: "h-9 rounded-md px-3",
        lg: "h-11 rounded-md px-8",
        icon: "h-10 w-10",
      },
    },
    defaultVariants: {
      variant: "default",
      size: "default",
    },
  },
);

export interface ButtonProps
  extends React.ButtonHTMLAttributes<HTMLButtonElement>,
    VariantProps<typeof buttonVariants> {
  asChild?: boolean;
}

const Button = React.forwardRef<HTMLButtonElement, ButtonProps>(
  ({ className, variant, size, asChild = false, ...props }, ref) => {
    const Comp = asChild ? Slot : "button";
    return (
      <Comp
        className={cn(buttonVariants({ variant, size, className }))}
        ref={ref}
        {...props}
      />
    );
  },
);
Button.displayName = "Button";

export { Button, buttonVariants };
</file>

<file path="src/components/ui/card.tsx">
import * as React from "react"

import { cn } from "@/lib/utils"

const Card = React.forwardRef<
  HTMLDivElement,
  React.HTMLAttributes<HTMLDivElement>
>(({ className, ...props }, ref) => (
  <div
    ref={ref}
    className={cn(
      "rounded-lg border bg-card text-card-foreground shadow-xs",
      className
    )}
    {...props}
  />
))
Card.displayName = "Card"

const CardHeader = React.forwardRef<
  HTMLDivElement,
  React.HTMLAttributes<HTMLDivElement>
>(({ className, ...props }, ref) => (
  <div
    ref={ref}
    className={cn("flex flex-col space-y-1.5 p-6", className)}
    {...props}
  />
))
CardHeader.displayName = "CardHeader"

const CardTitle = React.forwardRef<
  HTMLDivElement,
  React.HTMLAttributes<HTMLDivElement>
>(({ className, ...props }, ref) => (
  <div
    ref={ref}
    className={cn(
      "text-2xl font-semibold leading-none tracking-tight",
      className
    )}
    {...props}
  />
))
CardTitle.displayName = "CardTitle"

const CardDescription = React.forwardRef<
  HTMLDivElement,
  React.HTMLAttributes<HTMLDivElement>
>(({ className, ...props }, ref) => (
  <div
    ref={ref}
    className={cn("text-sm text-muted-foreground", className)}
    {...props}
  />
))
CardDescription.displayName = "CardDescription"

const CardContent = React.forwardRef<
  HTMLDivElement,
  React.HTMLAttributes<HTMLDivElement>
>(({ className, ...props }, ref) => (
  <div ref={ref} className={cn("p-6 pt-0", className)} {...props} />
))
CardContent.displayName = "CardContent"

const CardFooter = React.forwardRef<
  HTMLDivElement,
  React.HTMLAttributes<HTMLDivElement>
>(({ className, ...props }, ref) => (
  <div
    ref={ref}
    className={cn("flex items-center p-6 pt-0", className)}
    {...props}
  />
))
CardFooter.displayName = "CardFooter"

export { Card, CardHeader, CardFooter, CardTitle, CardDescription, CardContent }
</file>

<file path="src/components/ui/checkbox.tsx">
"use client";

import * as React from "react";
import * as CheckboxPrimitive from "@radix-ui/react-checkbox";
import { Check } from "lucide-react";

import { cn } from "@/lib/utils";

const Checkbox = React.forwardRef<
  React.ElementRef<typeof CheckboxPrimitive.Root>,
  React.ComponentPropsWithoutRef<typeof CheckboxPrimitive.Root>
>(({ className, ...props }, ref) => (
  <CheckboxPrimitive.Root
    ref={ref}
    className={cn(
      "peer h-4 w-4 shrink-0 rounded-sm border border-primary ring-offset-background focus-visible:outline-hidden focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 data-[state=checked]:bg-primary data-[state=checked]:text-primary-foreground",
      className,
    )}
    {...props}
  >
    <CheckboxPrimitive.Indicator
      className={cn("flex items-center justify-center text-current")}
    >
      <Check className="h-4 w-4" />
    </CheckboxPrimitive.Indicator>
  </CheckboxPrimitive.Root>
));
Checkbox.displayName = CheckboxPrimitive.Root.displayName;

export { Checkbox };
</file>

<file path="src/components/ui/dropdown-menu.tsx">
"use client";

import * as React from "react";
import * as DropdownMenuPrimitive from "@radix-ui/react-dropdown-menu";
import { Check, ChevronRight, Circle } from "lucide-react";

import { cn } from "@/lib/utils";

const DropdownMenu = DropdownMenuPrimitive.Root;

const DropdownMenuTrigger = DropdownMenuPrimitive.Trigger;

const DropdownMenuGroup = DropdownMenuPrimitive.Group;

const DropdownMenuPortal = DropdownMenuPrimitive.Portal;

const DropdownMenuSub = DropdownMenuPrimitive.Sub;

const DropdownMenuRadioGroup = DropdownMenuPrimitive.RadioGroup;

const DropdownMenuSubTrigger = React.forwardRef<
  React.ElementRef<typeof DropdownMenuPrimitive.SubTrigger>,
  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.SubTrigger> & {
    inset?: boolean;
  }
>(({ className, inset, children, ...props }, ref) => (
  <DropdownMenuPrimitive.SubTrigger
    ref={ref}
    className={cn(
      "flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-hidden focus:bg-accent data-[state=open]:bg-accent",
      inset && "pl-8",
      className,
    )}
    {...props}
  >
    {children}
    <ChevronRight className="ml-auto h-4 w-4" />
  </DropdownMenuPrimitive.SubTrigger>
));
DropdownMenuSubTrigger.displayName =
  DropdownMenuPrimitive.SubTrigger.displayName;

const DropdownMenuSubContent = React.forwardRef<
  React.ElementRef<typeof DropdownMenuPrimitive.SubContent>,
  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.SubContent>
>(({ className, ...props }, ref) => (
  <DropdownMenuPrimitive.SubContent
    ref={ref}
    className={cn(
      "z-50 min-w-32 overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-lg data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",
      className,
    )}
    {...props}
  />
));
DropdownMenuSubContent.displayName =
  DropdownMenuPrimitive.SubContent.displayName;

const DropdownMenuContent = React.forwardRef<
  React.ElementRef<typeof DropdownMenuPrimitive.Content>,
  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.Content>
>(({ className, sideOffset = 4, ...props }, ref) => (
  <DropdownMenuPrimitive.Portal>
    <DropdownMenuPrimitive.Content
      ref={ref}
      sideOffset={sideOffset}
      className={cn(
        "z-50 min-w-32 overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",
        className,
      )}
      {...props}
    />
  </DropdownMenuPrimitive.Portal>
));
DropdownMenuContent.displayName = DropdownMenuPrimitive.Content.displayName;

const DropdownMenuItem = React.forwardRef<
  React.ElementRef<typeof DropdownMenuPrimitive.Item>,
  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.Item> & {
    inset?: boolean;
  }
>(({ className, inset, ...props }, ref) => (
  <DropdownMenuPrimitive.Item
    ref={ref}
    className={cn(
      "relative flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-hidden transition-colors focus:bg-accent focus:text-accent-foreground data-disabled:pointer-events-none data-disabled:opacity-50",
      inset && "pl-8",
      className,
    )}
    {...props}
  />
));
DropdownMenuItem.displayName = DropdownMenuPrimitive.Item.displayName;

const DropdownMenuCheckboxItem = React.forwardRef<
  React.ElementRef<typeof DropdownMenuPrimitive.CheckboxItem>,
  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.CheckboxItem>
>(({ className, children, checked, ...props }, ref) => (
  <DropdownMenuPrimitive.CheckboxItem
    ref={ref}
    className={cn(
      "relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-hidden transition-colors focus:bg-accent focus:text-accent-foreground data-disabled:pointer-events-none data-disabled:opacity-50",
      className,
    )}
    checked={checked}
    {...props}
  >
    <span className="absolute left-2 flex h-3.5 w-3.5 items-center justify-center">
      <DropdownMenuPrimitive.ItemIndicator>
        <Check className="h-4 w-4" />
      </DropdownMenuPrimitive.ItemIndicator>
    </span>
    {children}
  </DropdownMenuPrimitive.CheckboxItem>
));
DropdownMenuCheckboxItem.displayName =
  DropdownMenuPrimitive.CheckboxItem.displayName;

const DropdownMenuRadioItem = React.forwardRef<
  React.ElementRef<typeof DropdownMenuPrimitive.RadioItem>,
  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.RadioItem>
>(({ className, children, ...props }, ref) => (
  <DropdownMenuPrimitive.RadioItem
    ref={ref}
    className={cn(
      "relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-hidden transition-colors focus:bg-accent focus:text-accent-foreground data-disabled:pointer-events-none data-disabled:opacity-50",
      className,
    )}
    {...props}
  >
    <span className="absolute left-2 flex h-3.5 w-3.5 items-center justify-center">
      <DropdownMenuPrimitive.ItemIndicator>
        <Circle className="h-2 w-2 fill-current" />
      </DropdownMenuPrimitive.ItemIndicator>
    </span>
    {children}
  </DropdownMenuPrimitive.RadioItem>
));
DropdownMenuRadioItem.displayName = DropdownMenuPrimitive.RadioItem.displayName;

const DropdownMenuLabel = React.forwardRef<
  React.ElementRef<typeof DropdownMenuPrimitive.Label>,
  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.Label> & {
    inset?: boolean;
  }
>(({ className, inset, ...props }, ref) => (
  <DropdownMenuPrimitive.Label
    ref={ref}
    className={cn(
      "px-2 py-1.5 text-sm font-semibold",
      inset && "pl-8",
      className,
    )}
    {...props}
  />
));
DropdownMenuLabel.displayName = DropdownMenuPrimitive.Label.displayName;

const DropdownMenuSeparator = React.forwardRef<
  React.ElementRef<typeof DropdownMenuPrimitive.Separator>,
  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.Separator>
>(({ className, ...props }, ref) => (
  <DropdownMenuPrimitive.Separator
    ref={ref}
    className={cn("-mx-1 my-1 h-px bg-muted", className)}
    {...props}
  />
));
DropdownMenuSeparator.displayName = DropdownMenuPrimitive.Separator.displayName;

const DropdownMenuShortcut = ({
  className,
  ...props
}: React.HTMLAttributes<HTMLSpanElement>) => {
  return (
    <span
      className={cn("ml-auto text-xs tracking-widest opacity-60", className)}
      {...props}
    />
  );
};
DropdownMenuShortcut.displayName = "DropdownMenuShortcut";

export {
  DropdownMenu,
  DropdownMenuTrigger,
  DropdownMenuContent,
  DropdownMenuItem,
  DropdownMenuCheckboxItem,
  DropdownMenuRadioItem,
  DropdownMenuLabel,
  DropdownMenuSeparator,
  DropdownMenuShortcut,
  DropdownMenuGroup,
  DropdownMenuPortal,
  DropdownMenuSub,
  DropdownMenuSubContent,
  DropdownMenuSubTrigger,
  DropdownMenuRadioGroup,
};
</file>

<file path="src/components/ui/file-upload.tsx">
"use client";

import { cn } from "@/lib/utils";
import { ChangeEvent, useRef } from "react";

interface FileUploadProps extends React.HTMLAttributes<HTMLDivElement> {
  onFileChange: (file: File) => void;
  accept?: string;
}

export function FileUpload({
  className,
  onFileChange,
  accept = "image/*",
  children,
  ...props
}: FileUploadProps) {
  const inputRef = useRef<HTMLInputElement>(null);

  const handleClick = () => {
    inputRef.current?.click();
  };

  const handleChange = (e: ChangeEvent<HTMLInputElement>) => {
    const file = e.target.files?.[0];
    if (file) {
      onFileChange(file);
    }
  };

  return (
    <div
      onClick={handleClick}
      className={cn(
        "cursor-pointer rounded-md border-2 border-dashed border-gray-300 p-4 hover:border-gray-400",
        className
      )}
      {...props}
    >
      <input
        type="file"
        ref={inputRef}
        onChange={handleChange}
        accept={accept}
        className="hidden"
      />
      {children}
    </div>
  );
}
</file>

<file path="src/components/ui/form.tsx">
'use client';

import * as React from 'react';
import * as LabelPrimitive from '@radix-ui/react-label';
import { Slot } from '@radix-ui/react-slot';
import {
  Controller,
  ControllerProps,
  FieldPath,
  FieldValues,
  FormProvider,
  useFormContext,
} from 'react-hook-form';

import { cn } from '@/lib/utils';
import { Label } from '@/components/ui/label';

const Form = FormProvider;

type FormFieldContextValue<
  TFieldValues extends FieldValues = FieldValues,
  TName extends FieldPath<TFieldValues> = FieldPath<TFieldValues>,
> = {
  name: TName;
};

const FormFieldContext = React.createContext<FormFieldContextValue>(
  {} as FormFieldContextValue,
);

const FormField = <
  TFieldValues extends FieldValues = FieldValues,
  TName extends FieldPath<TFieldValues> = FieldPath<TFieldValues>,
>({
  ...props
}: ControllerProps<TFieldValues, TName>) => {
  return (
    <FormFieldContext.Provider value={{ name: props.name }}>
      <Controller {...props} />
    </FormFieldContext.Provider>
  );
};

const useFormField = () => {
  const fieldContext = React.useContext(FormFieldContext);
  const itemContext = React.useContext(FormItemContext);
  const { getFieldState, formState } = useFormContext();

  const fieldState = getFieldState(fieldContext.name, formState);

  if (!fieldContext) {
    throw new Error('useFormField should be used within <FormField>');
  }

  const { id } = itemContext;

  return {
    id,
    name: fieldContext.name,
    formItemId: `${id}-form-item`,
    formDescriptionId: `${id}-form-item-description`,
    formMessageId: `${id}-form-item-message`,
    ...fieldState,
  };
};

type FormItemContextValue = {
  id: string;
};

const FormItemContext = React.createContext<FormItemContextValue>(
  {} as FormItemContextValue,
);

const FormItem = React.forwardRef<
  HTMLDivElement,
  React.HTMLAttributes<HTMLDivElement>
>(({ className, ...props }, ref) => {
  const id = React.useId();

  return (
    <FormItemContext.Provider value={{ id }}>
      <div ref={ref} className={cn('space-y-2', className)} {...props} />
    </FormItemContext.Provider>
  );
});
FormItem.displayName = 'FormItem';

const FormLabel = React.forwardRef<
  React.ElementRef<typeof LabelPrimitive.Root>,
  React.ComponentPropsWithoutRef<typeof LabelPrimitive.Root>
>(({ className, ...props }, ref) => {
  const { error, formItemId } = useFormField();

  return (
    <Label
      ref={ref}
      className={cn(error && 'text-destructive', className)}
      htmlFor={formItemId}
      {...props}
    />
  );
});
FormLabel.displayName = 'FormLabel';

const FormControl = React.forwardRef<
  React.ElementRef<typeof Slot>,
  React.ComponentPropsWithoutRef<typeof Slot>
>(({ ...props }, ref) => {
  const { error, formItemId, formDescriptionId, formMessageId } =
    useFormField();

  return (
    <Slot
      ref={ref}
      id={formItemId}
      aria-describedby={
        !error
          ? `${formDescriptionId}`
          : `${formDescriptionId} ${formMessageId}`
      }
      aria-invalid={!!error}
      {...props}
    />
  );
});
FormControl.displayName = 'FormControl';

const FormDescription = React.forwardRef<
  HTMLParagraphElement,
  React.HTMLAttributes<HTMLParagraphElement>
>(({ className, ...props }, ref) => {
  const { formDescriptionId } = useFormField();

  return (
    <p
      ref={ref}
      id={formDescriptionId}
      className={cn('text-sm text-muted-foreground', className)}
      {...props}
    />
  );
});
FormDescription.displayName = 'FormDescription';

const FormMessage = React.forwardRef<
  HTMLParagraphElement,
  React.HTMLAttributes<HTMLParagraphElement>
>(({ className, children, ...props }, ref) => {
  const { error, formMessageId } = useFormField();
  const body = error ? String(error?.message) : children;

  if (!body) {
    return null;
  }

  return (
    <p
      ref={ref}
      id={formMessageId}
      className={cn('text-sm font-medium text-destructive', className)}
      {...props}
    >
      {body}
    </p>
  );
});
FormMessage.displayName = 'FormMessage';

export {
  useFormField,
  Form,
  FormItem,
  FormLabel,
  FormControl,
  FormDescription,
  FormMessage,
  FormField,
};
</file>

<file path="src/components/ui/input.tsx">
import * as React from "react";

import { cn } from "@/lib/utils";

export interface InputProps
  extends React.InputHTMLAttributes<HTMLInputElement> {}

const Input = React.forwardRef<HTMLInputElement, InputProps>(
  ({ className, type, ...props }, ref) => {
    return (
      <input
        type={type}
        className={cn(
          "flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background file:border-0 file:bg-transparent file:text-sm file:font-medium placeholder:text-muted-foreground focus-visible:outline-hidden focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50",
          className,
        )}
        ref={ref}
        {...props}
      />
    );
  },
);
Input.displayName = "Input";

export { Input };
</file>

<file path="src/components/ui/label.tsx">
"use client";

import * as React from "react";
import * as LabelPrimitive from "@radix-ui/react-label";
import { cva, type VariantProps } from "class-variance-authority";

import { cn } from "@/lib/utils";

const labelVariants = cva(
  "text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70",
);

const Label = React.forwardRef<
  React.ElementRef<typeof LabelPrimitive.Root>,
  React.ComponentPropsWithoutRef<typeof LabelPrimitive.Root> &
    VariantProps<typeof labelVariants>
>(({ className, ...props }, ref) => (
  <LabelPrimitive.Root
    ref={ref}
    className={cn(labelVariants(), className)}
    {...props}
  />
));
Label.displayName = LabelPrimitive.Root.displayName;

export { Label };
</file>

<file path="src/components/ui/progress.tsx">
"use client"

import * as React from "react"
import * as ProgressPrimitive from "@radix-ui/react-progress"

import { cn } from "@/lib/utils"

const Progress = React.forwardRef<
  React.ElementRef<typeof ProgressPrimitive.Root>,
  React.ComponentPropsWithoutRef<typeof ProgressPrimitive.Root>
>(({ className, value, ...props }, ref) => (
  <ProgressPrimitive.Root
    ref={ref}
    className={cn(
      "relative h-2 w-full overflow-hidden rounded-full bg-secondary",
      className
    )}
    {...props}
  >
    <ProgressPrimitive.Indicator
      className="h-full w-full flex-1 bg-primary transition-all"
      style={{ transform: `translateX(-${100 - (value || 0)}%)` }}
    />
  </ProgressPrimitive.Root>
))
Progress.displayName = ProgressPrimitive.Root.displayName

export { Progress }
</file>

<file path="src/components/ui/select.tsx">
'use client';

import * as React from 'react';
import * as SelectPrimitive from '@radix-ui/react-select';
import { Check, ChevronDown, ChevronUp } from 'lucide-react';

import { cn } from '@/lib/utils';

const Select = SelectPrimitive.Root;

const SelectGroup = SelectPrimitive.Group;

const SelectValue = SelectPrimitive.Value;

const SelectTrigger = React.forwardRef<
  React.ElementRef<typeof SelectPrimitive.Trigger>,
  React.ComponentPropsWithoutRef<typeof SelectPrimitive.Trigger>
>(({ className, children, ...props }, ref) => (
  <SelectPrimitive.Trigger
    ref={ref}
    className={cn(
      'flex h-10 w-full items-center justify-between rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus:outline-hidden focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 [&>span]:line-clamp-1',
      className,
    )}
    {...props}
  >
    {children}
    <SelectPrimitive.Icon asChild>
      <ChevronDown className="h-4 w-4 opacity-50" />
    </SelectPrimitive.Icon>
  </SelectPrimitive.Trigger>
));
SelectTrigger.displayName = SelectPrimitive.Trigger.displayName;

const SelectScrollUpButton = React.forwardRef<
  React.ElementRef<typeof SelectPrimitive.ScrollUpButton>,
  React.ComponentPropsWithoutRef<typeof SelectPrimitive.ScrollUpButton>
>(({ className, ...props }, ref) => (
  <SelectPrimitive.ScrollUpButton
    ref={ref}
    className={cn(
      'flex cursor-default items-center justify-center py-1',
      className,
    )}
    {...props}
  >
    <ChevronUp className="h-4 w-4" />
  </SelectPrimitive.ScrollUpButton>
));
SelectScrollUpButton.displayName = SelectPrimitive.ScrollUpButton.displayName;

const SelectScrollDownButton = React.forwardRef<
  React.ElementRef<typeof SelectPrimitive.ScrollDownButton>,
  React.ComponentPropsWithoutRef<typeof SelectPrimitive.ScrollDownButton>
>(({ className, ...props }, ref) => (
  <SelectPrimitive.ScrollDownButton
    ref={ref}
    className={cn(
      'flex cursor-default items-center justify-center py-1',
      className,
    )}
    {...props}
  >
    <ChevronDown className="h-4 w-4" />
  </SelectPrimitive.ScrollDownButton>
));
SelectScrollDownButton.displayName =
  SelectPrimitive.ScrollDownButton.displayName;

const SelectContent = React.forwardRef<
  React.ElementRef<typeof SelectPrimitive.Content>,
  React.ComponentPropsWithoutRef<typeof SelectPrimitive.Content>
>(({ className, children, position = 'popper', ...props }, ref) => (
  <SelectPrimitive.Portal>
    <SelectPrimitive.Content
      ref={ref}
      className={cn(
        'relative z-50 max-h-96 min-w-32 overflow-hidden rounded-md border bg-popover text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2',
        position === 'popper' &&
          'data-[side=bottom]:translate-y-1 data-[side=left]:-translate-x-1 data-[side=right]:translate-x-1 data-[side=top]:-translate-y-1',
        className,
      )}
      position={position}
      {...props}
    >
      <SelectScrollUpButton />
      <SelectPrimitive.Viewport
        className={cn(
          'p-1',
          position === 'popper' &&
            'h-(--radix-select-trigger-height) w-full min-w-(--radix-select-trigger-width)',
        )}
      >
        {children}
      </SelectPrimitive.Viewport>
      <SelectScrollDownButton />
    </SelectPrimitive.Content>
  </SelectPrimitive.Portal>
));
SelectContent.displayName = SelectPrimitive.Content.displayName;

const SelectLabel = React.forwardRef<
  React.ElementRef<typeof SelectPrimitive.Label>,
  React.ComponentPropsWithoutRef<typeof SelectPrimitive.Label>
>(({ className, ...props }, ref) => (
  <SelectPrimitive.Label
    ref={ref}
    className={cn('py-1.5 pl-8 pr-2 text-sm font-semibold', className)}
    {...props}
  />
));
SelectLabel.displayName = SelectPrimitive.Label.displayName;

const SelectItem = React.forwardRef<
  React.ElementRef<typeof SelectPrimitive.Item>,
  React.ComponentPropsWithoutRef<typeof SelectPrimitive.Item>
>(({ className, children, ...props }, ref) => (
  <SelectPrimitive.Item
    ref={ref}
    className={cn(
      'relative flex w-full cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-hidden focus:bg-accent focus:text-accent-foreground data-disabled:pointer-events-none data-disabled:opacity-50',
      className,
    )}
    {...props}
  >
    <span className="absolute left-2 flex h-3.5 w-3.5 items-center justify-center">
      <SelectPrimitive.ItemIndicator>
        <Check className="h-4 w-4" />
      </SelectPrimitive.ItemIndicator>
    </span>

    <SelectPrimitive.ItemText>{children}</SelectPrimitive.ItemText>
  </SelectPrimitive.Item>
));
SelectItem.displayName = SelectPrimitive.Item.displayName;

const SelectSeparator = React.forwardRef<
  React.ElementRef<typeof SelectPrimitive.Separator>,
  React.ComponentPropsWithoutRef<typeof SelectPrimitive.Separator>
>(({ className, ...props }, ref) => (
  <SelectPrimitive.Separator
    ref={ref}
    className={cn('-mx-1 my-1 h-px bg-muted', className)}
    {...props}
  />
));
SelectSeparator.displayName = SelectPrimitive.Separator.displayName;

export {
  Select,
  SelectGroup,
  SelectValue,
  SelectTrigger,
  SelectContent,
  SelectLabel,
  SelectItem,
  SelectSeparator,
  SelectScrollUpButton,
  SelectScrollDownButton,
};
</file>

<file path="src/components/ui/separator.tsx">
"use client"

import * as React from "react"
import * as SeparatorPrimitive from "@radix-ui/react-separator"

import { cn } from "@/lib/utils"

const Separator = React.forwardRef<
  React.ElementRef<typeof SeparatorPrimitive.Root>,
  React.ComponentPropsWithoutRef<typeof SeparatorPrimitive.Root>
>(
  (
    { className, orientation = "horizontal", decorative = true, ...props },
    ref
  ) => (
    <SeparatorPrimitive.Root
      ref={ref}
      decorative={decorative}
      orientation={orientation}
      className={cn(
        "shrink-0 bg-border",
        orientation === "horizontal" ? "h-px w-full" : "h-full w-px",
        className
      )}
      {...props}
    />
  )
)
Separator.displayName = SeparatorPrimitive.Root.displayName

export { Separator }
</file>

<file path="src/components/ui/sheet.tsx">
'use client';

import * as React from 'react';
import * as SheetPrimitive from '@radix-ui/react-dialog';
import { cva, type VariantProps } from 'class-variance-authority';
import { X } from 'lucide-react';

import { cn } from '@/lib/utils';

const Sheet = SheetPrimitive.Root;

const SheetTrigger = SheetPrimitive.Trigger;

const SheetClose = SheetPrimitive.Close;

const SheetPortal = SheetPrimitive.Portal;

const SheetOverlay = React.forwardRef<
  React.ElementRef<typeof SheetPrimitive.Overlay>,
  React.ComponentPropsWithoutRef<typeof SheetPrimitive.Overlay>
>(({ className, ...props }, ref) => (
  <SheetPrimitive.Overlay
    className={cn(
      'fixed inset-0 z-50 bg-black/80  data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0',
      className,
    )}
    {...props}
    ref={ref}
  />
));
SheetOverlay.displayName = SheetPrimitive.Overlay.displayName;

const sheetVariants = cva(
  'fixed z-50 gap-4 bg-background p-6 shadow-lg transition ease-in-out data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:duration-300 data-[state=open]:duration-500',
  {
    variants: {
      side: {
        top: 'inset-x-0 top-0 border-b data-[state=closed]:slide-out-to-top data-[state=open]:slide-in-from-top',
        bottom:
          'inset-x-0 bottom-0 border-t data-[state=closed]:slide-out-to-bottom data-[state=open]:slide-in-from-bottom',
        left: 'inset-y-0 left-0 h-full w-3/4 border-r data-[state=closed]:slide-out-to-left data-[state=open]:slide-in-from-left sm:max-w-sm',
        right:
          'inset-y-0 right-0 h-full w-3/4  border-l data-[state=closed]:slide-out-to-right data-[state=open]:slide-in-from-right sm:max-w-sm',
      },
    },
    defaultVariants: {
      side: 'right',
    },
  },
);

interface SheetContentProps
  extends React.ComponentPropsWithoutRef<typeof SheetPrimitive.Content>,
    VariantProps<typeof sheetVariants> {}

const SheetContent = React.forwardRef<
  React.ElementRef<typeof SheetPrimitive.Content>,
  SheetContentProps
>(({ side = 'right', className, children, ...props }, ref) => (
  <SheetPortal>
    <SheetOverlay />
    <SheetPrimitive.Content
      ref={ref}
      className={cn(sheetVariants({ side }), className)}
      {...props}
    >
      {children}
      <SheetPrimitive.Close className="absolute right-4 top-4 rounded-sm opacity-70 ring-offset-background transition-opacity hover:opacity-100 focus:outline-hidden focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none data-[state=open]:bg-secondary">
        <X className="h-4 w-4" />
        <span className="sr-only">Close</span>
      </SheetPrimitive.Close>
    </SheetPrimitive.Content>
  </SheetPortal>
));
SheetContent.displayName = SheetPrimitive.Content.displayName;

const SheetHeader = ({
  className,
  ...props
}: React.HTMLAttributes<HTMLDivElement>) => (
  <div
    className={cn(
      'flex flex-col space-y-2 text-center sm:text-left',
      className,
    )}
    {...props}
  />
);
SheetHeader.displayName = 'SheetHeader';

const SheetFooter = ({
  className,
  ...props
}: React.HTMLAttributes<HTMLDivElement>) => (
  <div
    className={cn(
      'flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2',
      className,
    )}
    {...props}
  />
);
SheetFooter.displayName = 'SheetFooter';

const SheetTitle = React.forwardRef<
  React.ElementRef<typeof SheetPrimitive.Title>,
  React.ComponentPropsWithoutRef<typeof SheetPrimitive.Title>
>(({ className, ...props }, ref) => (
  <SheetPrimitive.Title
    ref={ref}
    className={cn('text-lg font-semibold text-foreground', className)}
    {...props}
  />
));
SheetTitle.displayName = SheetPrimitive.Title.displayName;

const SheetDescription = React.forwardRef<
  React.ElementRef<typeof SheetPrimitive.Description>,
  React.ComponentPropsWithoutRef<typeof SheetPrimitive.Description>
>(({ className, ...props }, ref) => (
  <SheetPrimitive.Description
    ref={ref}
    className={cn('text-sm text-muted-foreground', className)}
    {...props}
  />
));
SheetDescription.displayName = SheetPrimitive.Description.displayName;

export {
  Sheet,
  SheetPortal,
  SheetOverlay,
  SheetTrigger,
  SheetClose,
  SheetContent,
  SheetHeader,
  SheetFooter,
  SheetTitle,
  SheetDescription,
};
</file>

<file path="src/components/ui/sonner.tsx">
"use client"

import { Toaster as Sonner } from "sonner"

type ToasterProps = React.ComponentProps<typeof Sonner>

const Toaster = ({ ...props }: ToasterProps) => {
  return (
    <Sonner
      className="toaster group"
      toastOptions={{
        classNames: {
          toast:
            "group toast group-[.toaster]:bg-background group-[.toaster]:text-foreground group-[.toaster]:border-border group-[.toaster]:shadow-lg",
          description: "group-[.toast]:text-muted-foreground",
          actionButton:
            "group-[.toast]:bg-primary group-[.toast]:text-primary-foreground",
          cancelButton:
            "group-[.toast]:bg-muted group-[.toast]:text-muted-foreground",
        },
      }}
      {...props}
    />
  )
}

export { Toaster }
</file>

<file path="src/components/ui/table.tsx">
import * as React from "react";

import { cn } from "@/lib/utils";

const Table = React.forwardRef<
  HTMLTableElement,
  React.HTMLAttributes<HTMLTableElement>
>(({ className, ...props }, ref) => (
  <div className="relative w-full overflow-auto">
    <table
      ref={ref}
      className={cn("w-full caption-bottom text-sm", className)}
      {...props}
    />
  </div>
));
Table.displayName = "Table";

const TableHeader = React.forwardRef<
  HTMLTableSectionElement,
  React.HTMLAttributes<HTMLTableSectionElement>
>(({ className, ...props }, ref) => (
  <thead ref={ref} className={cn("[&_tr]:border-b", className)} {...props} />
));
TableHeader.displayName = "TableHeader";

const TableBody = React.forwardRef<
  HTMLTableSectionElement,
  React.HTMLAttributes<HTMLTableSectionElement>
>(({ className, ...props }, ref) => (
  <tbody
    ref={ref}
    className={cn("[&_tr:last-child]:border-0", className)}
    {...props}
  />
));
TableBody.displayName = "TableBody";

const TableFooter = React.forwardRef<
  HTMLTableSectionElement,
  React.HTMLAttributes<HTMLTableSectionElement>
>(({ className, ...props }, ref) => (
  <tfoot
    ref={ref}
    className={cn(
      "border-t bg-muted/50 font-medium [&>tr]:last:border-b-0",
      className,
    )}
    {...props}
  />
));
TableFooter.displayName = "TableFooter";

const TableRow = React.forwardRef<
  HTMLTableRowElement,
  React.HTMLAttributes<HTMLTableRowElement>
>(({ className, ...props }, ref) => (
  <tr
    ref={ref}
    className={cn(
      "border-b transition-colors hover:bg-muted/50 data-[state=selected]:bg-muted",
      className,
    )}
    {...props}
  />
));
TableRow.displayName = "TableRow";

const TableHead = React.forwardRef<
  HTMLTableCellElement,
  React.ThHTMLAttributes<HTMLTableCellElement>
>(({ className, ...props }, ref) => (
  <th
    ref={ref}
    className={cn(
      "h-12 px-4 text-left align-middle font-medium text-muted-foreground [&:has([role=checkbox])]:pr-0",
      className,
    )}
    {...props}
  />
));
TableHead.displayName = "TableHead";

const TableCell = React.forwardRef<
  HTMLTableCellElement,
  React.TdHTMLAttributes<HTMLTableCellElement>
>(({ className, ...props }, ref) => (
  <td
    ref={ref}
    className={cn("p-4 align-middle [&:has([role=checkbox])]:pr-0", className)}
    {...props}
  />
));
TableCell.displayName = "TableCell";

const TableCaption = React.forwardRef<
  HTMLTableCaptionElement,
  React.HTMLAttributes<HTMLTableCaptionElement>
>(({ className, ...props }, ref) => (
  <caption
    ref={ref}
    className={cn("mt-4 text-sm text-muted-foreground", className)}
    {...props}
  />
));
TableCaption.displayName = "TableCaption";

export {
  Table,
  TableHeader,
  TableBody,
  TableFooter,
  TableHead,
  TableRow,
  TableCell,
  TableCaption,
};
</file>

<file path="src/components/ui/tabs.tsx">
"use client"

import * as React from "react"
import * as TabsPrimitive from "@radix-ui/react-tabs"

import { cn } from "@/lib/utils"

const Tabs = TabsPrimitive.Root

const TabsList = React.forwardRef<
  React.ElementRef<typeof TabsPrimitive.List>,
  React.ComponentPropsWithoutRef<typeof TabsPrimitive.List>
>(({ className, ...props }, ref) => (
  <TabsPrimitive.List
    ref={ref}
    className={cn(
      "inline-flex h-10 items-center justify-center rounded-md bg-muted p-1 text-muted-foreground",
      className
    )}
    {...props}
  />
))
TabsList.displayName = TabsPrimitive.List.displayName

const TabsTrigger = React.forwardRef<
  React.ElementRef<typeof TabsPrimitive.Trigger>,
  React.ComponentPropsWithoutRef<typeof TabsPrimitive.Trigger>
>(({ className, ...props }, ref) => (
  <TabsPrimitive.Trigger
    ref={ref}
    className={cn(
      "inline-flex items-center justify-center whitespace-nowrap rounded-sm px-3 py-1.5 text-sm font-medium ring-offset-background transition-all focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 data-[state=active]:bg-background data-[state=active]:text-foreground data-[state=active]:shadow-sm",
      className
    )}
    {...props}
  />
))
TabsTrigger.displayName = TabsPrimitive.Trigger.displayName

const TabsContent = React.forwardRef<
  React.ElementRef<typeof TabsPrimitive.Content>,
  React.ComponentPropsWithoutRef<typeof TabsPrimitive.Content>
>(({ className, ...props }, ref) => (
  <TabsPrimitive.Content
    ref={ref}
    className={cn(
      "mt-2 ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2",
      className
    )}
    {...props}
  />
))
TabsContent.displayName = TabsPrimitive.Content.displayName

export { Tabs, TabsList, TabsTrigger, TabsContent }
</file>

<file path="src/components/ui/textarea.tsx">
import * as React from 'react';

import { cn } from '@/lib/utils';

const Textarea = React.forwardRef<
  HTMLTextAreaElement,
  React.ComponentProps<'textarea'>
>(({ className, ...props }, ref) => {
  return (
    <textarea
      className={cn(
        'flex min-h-[80px] w-full rounded-md border border-input bg-background px-3 py-2 text-base ring-offset-background placeholder:text-muted-foreground focus-visible:outline-hidden focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 md:text-sm',
        className,
      )}
      ref={ref}
      {...props}
    />
  );
});
Textarea.displayName = 'Textarea';

export { Textarea };
</file>

<file path="src/components/ui/toast.tsx">
'use client';

import * as React from 'react';
import * as ToastPrimitives from '@radix-ui/react-toast';
import { cva, type VariantProps } from 'class-variance-authority';
import { X } from 'lucide-react';

import { cn } from '@/lib/utils';

const ToastProvider = ToastPrimitives.Provider;

const ToastViewport = React.forwardRef<
  React.ElementRef<typeof ToastPrimitives.Viewport>,
  React.ComponentPropsWithoutRef<typeof ToastPrimitives.Viewport>
>(({ className, ...props }, ref) => (
  <ToastPrimitives.Viewport
    ref={ref}
    className={cn(
      'fixed top-0 z-100 flex max-h-screen w-full flex-col-reverse p-4 sm:bottom-0 sm:right-0 sm:top-auto sm:flex-col md:max-w-[420px]',
      className,
    )}
    {...props}
  />
));
ToastViewport.displayName = ToastPrimitives.Viewport.displayName;

const toastVariants = cva(
  'group pointer-events-auto relative flex w-full items-center justify-between space-x-4 overflow-hidden rounded-md border p-6 pr-8 shadow-lg transition-all data-[swipe=cancel]:translate-x-0 data-[swipe=end]:translate-x-(--radix-toast-swipe-end-x) data-[swipe=move]:translate-x-(--radix-toast-swipe-move-x) data-[swipe=move]:transition-none data-[state=open]:animate-in data-[state=closed]:animate-out data-[swipe=end]:animate-out data-[state=closed]:fade-out-80 data-[state=closed]:slide-out-to-right-full data-[state=open]:slide-in-from-top-full data-[state=open]:sm:slide-in-from-bottom-full',
  {
    variants: {
      variant: {
        default: 'border bg-background text-foreground',
        destructive:
          'destructive group border-destructive bg-destructive text-destructive-foreground',
      },
    },
    defaultVariants: {
      variant: 'default',
    },
  },
);

const Toast = React.forwardRef<
  React.ElementRef<typeof ToastPrimitives.Root>,
  React.ComponentPropsWithoutRef<typeof ToastPrimitives.Root> &
    VariantProps<typeof toastVariants>
>(({ className, variant, ...props }, ref) => {
  return (
    <ToastPrimitives.Root
      ref={ref}
      className={cn(toastVariants({ variant }), className)}
      {...props}
    />
  );
});
Toast.displayName = ToastPrimitives.Root.displayName;

const ToastAction = React.forwardRef<
  React.ElementRef<typeof ToastPrimitives.Action>,
  React.ComponentPropsWithoutRef<typeof ToastPrimitives.Action>
>(({ className, ...props }, ref) => (
  <ToastPrimitives.Action
    ref={ref}
    className={cn(
      'inline-flex h-8 shrink-0 items-center justify-center rounded-md border bg-transparent px-3 text-sm font-medium ring-offset-background transition-colors hover:bg-secondary focus:outline-hidden focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 group-[.destructive]:border-muted/40 hover:group-[.destructive]:border-destructive/30 hover:group-[.destructive]:bg-destructive hover:group-[.destructive]:text-destructive-foreground focus:group-[.destructive]:ring-destructive',
      className,
    )}
    {...props}
  />
));
ToastAction.displayName = ToastPrimitives.Action.displayName;

const ToastClose = React.forwardRef<
  React.ElementRef<typeof ToastPrimitives.Close>,
  React.ComponentPropsWithoutRef<typeof ToastPrimitives.Close>
>(({ className, ...props }, ref) => (
  <ToastPrimitives.Close
    ref={ref}
    className={cn(
      'absolute right-2 top-2 rounded-md p-1 text-foreground/50 opacity-0 transition-opacity hover:text-foreground focus:opacity-100 focus:outline-hidden focus:ring-2 group-hover:opacity-100 group-[.destructive]:text-red-300 hover:group-[.destructive]:text-red-50 focus:group-[.destructive]:ring-red-400 focus:group-[.destructive]:ring-offset-red-600',
      className,
    )}
    toast-close=""
    {...props}
  >
    <X className="h-4 w-4" />
  </ToastPrimitives.Close>
));
ToastClose.displayName = ToastPrimitives.Close.displayName;

const ToastTitle = React.forwardRef<
  React.ElementRef<typeof ToastPrimitives.Title>,
  React.ComponentPropsWithoutRef<typeof ToastPrimitives.Title>
>(({ className, ...props }, ref) => (
  <ToastPrimitives.Title
    ref={ref}
    className={cn('text-sm font-semibold', className)}
    {...props}
  />
));
ToastTitle.displayName = ToastPrimitives.Title.displayName;

const ToastDescription = React.forwardRef<
  React.ElementRef<typeof ToastPrimitives.Description>,
  React.ComponentPropsWithoutRef<typeof ToastPrimitives.Description>
>(({ className, ...props }, ref) => (
  <ToastPrimitives.Description
    ref={ref}
    className={cn('text-sm opacity-90', className)}
    {...props}
  />
));
ToastDescription.displayName = ToastPrimitives.Description.displayName;

type ToastProps = React.ComponentPropsWithoutRef<typeof Toast>;

type ToastActionElement = React.ReactElement<typeof ToastAction>;

export {
  type ToastProps,
  type ToastActionElement,
  ToastProvider,
  ToastViewport,
  Toast,
  ToastTitle,
  ToastDescription,
  ToastClose,
  ToastAction,
};
</file>

<file path="src/components/ui/toaster.tsx">
'use client';

import { useToast } from '@/hooks/use-toast';
import {
  Toast,
  ToastClose,
  ToastDescription,
  ToastProvider,
  ToastTitle,
  ToastViewport,
} from '@/components/ui/toast';

export function Toaster() {
  const { toasts } = useToast();

  return (
    <ToastProvider>
      {toasts.map(function ({ id, title, description, action, ...props }) {
        return (
          <Toast key={id} {...props}>
            <div className="grid gap-1">
              {title && <ToastTitle>{title}</ToastTitle>}
              {description && (
                <ToastDescription>{description}</ToastDescription>
              )}
            </div>
            {action}
            <ToastClose />
          </Toast>
        );
      })}
      <ToastViewport />
    </ToastProvider>
  );
}
</file>

<file path="src/constants/env.ts">
import { z } from 'zod';

const clientEnvSchema = z.object({
  NEXT_PUBLIC_SUPABASE_URL: z.string().url(),
  NEXT_PUBLIC_SUPABASE_ANON_KEY: z.string().min(1),
});

const _clientEnv = clientEnvSchema.safeParse({
  NEXT_PUBLIC_SUPABASE_URL: process.env.NEXT_PUBLIC_SUPABASE_URL,
  NEXT_PUBLIC_SUPABASE_ANON_KEY: process.env.NEXT_PUBLIC_SUPABASE_ANON_KEY,
});

export type ClientEnv = z.infer<typeof clientEnvSchema>;

if (!_clientEnv.success) {
  console.error('í™˜ê²½ ë³€ìˆ˜ ê²€ì¦ ì‹¤íŒ¨:', _clientEnv.error.flatten().fieldErrors);
  throw new Error('í™˜ê²½ ë³€ìˆ˜ë¥¼ í™•ì¸í•˜ì„¸ìš”.');
}

export const env: ClientEnv = _clientEnv.data;
</file>

<file path="src/features/articles/backend/ai-service.ts">
import { generateObject } from 'ai';
import { createGoogleGenerativeAI } from '@ai-sdk/google';
import type { SupabaseClient } from '@supabase/supabase-js';
import {
  failure,
  success,
  type HandlerResult,
} from '@/backend/http/response';
import {
  AIGeneratedContentSchema,
  type AIGeneratedContent,
  type GenerateArticleRequest,
} from '@/features/articles/backend/schema';
import {
  articleErrorCodes,
  type ArticleServiceError,
} from '@/features/articles/backend/error';
import type { StyleGuideResponse } from '@/features/onboarding/backend/schema';

const STYLE_GUIDES_TABLE = 'style_guides';

/**
 * Gets style guide by ID or default style guide for user
 */
const getStyleGuide = async (
  client: SupabaseClient,
  clerkUserId: string,
  styleGuideId?: string,
): Promise<StyleGuideResponse | null> => {
  let query = client.from(STYLE_GUIDES_TABLE).select('*').eq('clerk_user_id', clerkUserId);

  if (styleGuideId) {
    query = query.eq('id', styleGuideId);
  } else {
    query = query.eq('is_default', true);
  }

  const { data, error } = await query.single();

  if (error || !data) {
    return null;
  }

  // Map snake_case to camelCase
  return {
    id: data.id,
    clerkUserId: data.clerk_user_id,
    brandName: data.brand_name,
    brandDescription: data.brand_description,
    personality: data.personality,
    formality: data.formality,
    targetAudience: data.target_audience,
    painPoints: data.pain_points,
    language: data.language,
    tone: data.tone,
    contentLength: data.content_length,
    readingLevel: data.reading_level,
    notes: data.notes,
    isDefault: data.is_default,
    createdAt: data.created_at,
    updatedAt: data.updated_at,
  };
};

/**
 * Builds AI prompt based on topic, style guide, and keywords
 */
const buildPrompt = (
  topic: string,
  styleGuide: StyleGuideResponse | null,
  keywords: string[],
  additionalInstructions?: string,
): string => {
  const language = styleGuide?.language || 'ko';
  const isKorean = language === 'ko';

  const contentLengthGuide = {
    short: isKorean ? '1000-1500ì' : '500-800 words',
    medium: isKorean ? '2000-3000ì' : '1000-1500 words',
    long: isKorean ? '4000-6000ì' : '2000-3000 words',
  };

  const readingLevelGuide = {
    beginner: isKorean ? 'ì´ˆë³´ìë„ ì‰½ê²Œ ì´í•´í•  ìˆ˜ ìˆëŠ”' : 'beginner-friendly',
    intermediate: isKorean ? 'ì¤‘ê¸‰ ìˆ˜ì¤€ì˜' : 'intermediate-level',
    advanced: isKorean ? 'ì „ë¬¸ì ì´ê³  ì‹¬í™”ëœ' : 'advanced and in-depth',
  };

  const toneGuide = {
    professional: isKorean ? 'ì „ë¬¸ì ì´ê³  ì‹ ë¢°ê° ìˆëŠ”' : 'professional and trustworthy',
    friendly: isKorean ? 'ì¹œê·¼í•˜ê³  ëŒ€í™”í•˜ëŠ” ë“¯í•œ' : 'friendly and conversational',
    inspirational: isKorean ? 'ì˜ê°ì„ ì£¼ê³  ë™ê¸°ë¶€ì—¬í•˜ëŠ”' : 'inspirational and motivating',
    educational: isKorean ? 'êµìœ¡ì ì´ê³  ì •ë³´ ì „ë‹¬ì— ì¶©ì‹¤í•œ' : 'educational and informative',
  };

  const promptTemplate = isKorean
    ? `
ë‹¹ì‹ ì€ ì „ë¬¸ ë¸”ë¡œê·¸ ì½˜í…ì¸  ì‘ê°€ì…ë‹ˆë‹¤. ë‹¤ìŒ ì¡°ê±´ì— ë§ì¶° ê³ í’ˆì§ˆ ë¸”ë¡œê·¸ ê¸€ì„ ì‘ì„±í•´ì£¼ì„¸ìš”.

**ì£¼ì œ**: ${topic}

**ë¸Œëœë“œ ì •ë³´**:
${styleGuide ? `- ë¸Œëœë“œëª…: ${styleGuide.brandName}
- ë¸Œëœë“œ ì„¤ëª…: ${styleGuide.brandDescription}
- ë¸Œëœë“œ ì„±ê²©: ${styleGuide.personality.join(', ')}
- ê²©ì‹ ìˆ˜ì¤€: ${styleGuide.formality}
- íƒ€ê²Ÿ ë…ì: ${styleGuide.targetAudience}
- ë…ìì˜ ê³ ë¯¼: ${styleGuide.painPoints}` : 'ì¼ë°˜ì ì¸ ë¸”ë¡œê·¸ ìŠ¤íƒ€ì¼ë¡œ ì‘ì„±'}

**ì‘ì„± ìŠ¤íƒ€ì¼**:
- ì–´ì¡°: ${styleGuide ? toneGuide[styleGuide.tone] : 'ì¹œê·¼í•˜ê³  ì „ë¬¸ì ì¸'}
- ê¸€ ê¸¸ì´: ${styleGuide ? contentLengthGuide[styleGuide.contentLength] : '2000-3000ì'}
- ë‚œì´ë„: ${styleGuide ? readingLevelGuide[styleGuide.readingLevel] : 'ì¤‘ê¸‰ ìˆ˜ì¤€ì˜'}

**í‚¤ì›Œë“œ**: ${keywords.length > 0 ? keywords.join(', ') : 'ì£¼ì œì™€ ê´€ë ¨ëœ í‚¤ì›Œë“œë¥¼ ìì—°ìŠ¤ëŸ½ê²Œ í¬í•¨'}

${additionalInstructions ? `**ì¶”ê°€ ì§€ì‹œì‚¬í•­**: ${additionalInstructions}` : ''}

**ì‘ì„± ìš”êµ¬ì‚¬í•­**:
1. ì œëª©ì€ SEOì— ìµœì í™”ë˜ê³  í´ë¦­ì„ ìœ ë„í•  ìˆ˜ ìˆë„ë¡ ì‘ì„±
2. ë³¸ë¬¸ì€ Markdown í˜•ì‹ìœ¼ë¡œ ì‘ì„± (ì œëª©, ì†Œì œëª©, ëª©ë¡, ê°•ì¡° ë“± í™œìš©)
3. ì„œë¡ , ë³¸ë¡ , ê²°ë¡  êµ¬ì¡°ë¥¼ ê°–ì¶”ë˜ ìì—°ìŠ¤ëŸ½ê²Œ ì „ê°œ
4. ì‹¤ìš©ì ì´ê³  ì‹¤í–‰ ê°€ëŠ¥í•œ ì •ë³´ ì œê³µ
5. ë…ìì˜ ê³ ë¯¼ì„ í•´ê²°í•˜ëŠ” ë° ì§‘ì¤‘
6. Meta Descriptionì€ 160ì ì´ë‚´ë¡œ ìš”ì•½
7. ì£¼ìš” í‚¤ì›Œë“œë¥¼ ìì—°ìŠ¤ëŸ½ê²Œ ë³¸ë¬¸ì— í¬í•¨
8. ì†Œì œëª©(headings)ì€ ëª…í™•í•˜ê³  êµ¬ì¡°ì ìœ¼ë¡œ êµ¬ì„±

**ì¶œë ¥ í˜•ì‹**:
- title: ë¸”ë¡œê·¸ ê¸€ ì œëª©
- content: Markdown í˜•ì‹ì˜ ë³¸ë¬¸ (ì œëª© ì œì™¸)
- metaDescription: SEOë¥¼ ìœ„í•œ ë©”íƒ€ ì„¤ëª… (160ì ì´ë‚´)
- keywords: ê´€ë ¨ í‚¤ì›Œë“œ ë°°ì—´ (5-10ê°œ)
- headings: ë³¸ë¬¸ì˜ ì£¼ìš” ì†Œì œëª© ë°°ì—´
`
    : `
You are a professional blog content writer. Create a high-quality blog post according to the following requirements.

**Topic**: ${topic}

**Brand Information**:
${styleGuide ? `- Brand Name: ${styleGuide.brandName}
- Brand Description: ${styleGuide.brandDescription}
- Brand Personality: ${styleGuide.personality.join(', ')}
- Formality Level: ${styleGuide.formality}
- Target Audience: ${styleGuide.targetAudience}
- Audience Pain Points: ${styleGuide.painPoints}` : 'Write in a general blog style'}

**Writing Style**:
- Tone: ${styleGuide ? toneGuide[styleGuide.tone] : 'friendly and professional'}
- Content Length: ${styleGuide ? contentLengthGuide[styleGuide.contentLength] : '1000-1500 words'}
- Reading Level: ${styleGuide ? readingLevelGuide[styleGuide.readingLevel] : 'intermediate-level'}

**Keywords**: ${keywords.length > 0 ? keywords.join(', ') : 'Naturally include relevant keywords'}

${additionalInstructions ? `**Additional Instructions**: ${additionalInstructions}` : ''}

**Writing Requirements**:
1. Create an SEO-optimized title that encourages clicks
2. Write the body in Markdown format (use headings, subheadings, lists, emphasis, etc.)
3. Structure with introduction, body, and conclusion in a natural flow
4. Provide practical and actionable information
5. Focus on solving the reader's pain points
6. Summarize in Meta Description (max 160 characters)
7. Naturally incorporate main keywords throughout the content
8. Organize headings clearly and structurally

**Output Format**:
- title: Blog post title
- content: Markdown-formatted body (excluding title)
- metaDescription: SEO meta description (max 160 chars)
- keywords: Array of relevant keywords (5-10)
- headings: Array of main subheadings from the content
`;

  return promptTemplate;
};

/**
 * Generates article content using Google Gemini
 */
export const generateArticleContent = async (
  client: SupabaseClient,
  clerkUserId: string,
  apiKey: string,
  request: GenerateArticleRequest,
): Promise<HandlerResult<AIGeneratedContent, ArticleServiceError, unknown>> => {
  try {
    // Get style guide if provided
    const styleGuide = await getStyleGuide(
      client,
      clerkUserId,
      request.styleGuideId,
    );

    if (request.styleGuideId && !styleGuide) {
      return failure(
        404,
        articleErrorCodes.styleGuideNotFound,
        'Style guide not found',
      );
    }

    // Build prompt
    const prompt = buildPrompt(
      request.topic,
      styleGuide,
      request.keywords || [],
      request.additionalInstructions,
    );

    // Call Gemini API using generateObject for structured output
    const google = createGoogleGenerativeAI({
      apiKey,
    });

    const { object } = await generateObject({
      model: google('gemini-2.0-flash-exp'),
      schema: AIGeneratedContentSchema,
      prompt,
    });

    return success(object);
  } catch (error) {
    return failure(
      500,
      articleErrorCodes.aiGenerationFailed,
      `AI generation failed: ${error instanceof Error ? error.message : 'Unknown error'}`,
      error,
    );
  }
};
</file>

<file path="src/features/articles/backend/quota-service.ts">
import type { SupabaseClient } from '@supabase/supabase-js';
import {
  failure,
  success,
  type HandlerResult,
} from '@/backend/http/response';
import {
  articleErrorCodes,
  type ArticleServiceError,
} from '@/features/articles/backend/error';

const GENERATION_QUOTA_TABLE = 'generation_quota';

// Quota limits per tier
const QUOTA_LIMITS = {
  free: 10,
  pro: 100,
} as const;

type TierType = 'free' | 'pro';

interface QuotaRow {
  id: string;
  clerk_user_id: string;
  tier: TierType;
  generation_count: number;
  last_reset_at: string;
  created_at: string;
  updated_at: string;
}

interface QuotaCheckResult {
  allowed: boolean;
  tier: TierType;
  currentCount: number;
  limit: number;
  remaining: number;
}

/**
 * Gets or creates quota record for user
 */
const getOrCreateQuotaRecord = async (
  client: SupabaseClient,
  clerkUserId: string,
): Promise<QuotaRow | null> => {
  // Try to get existing record
  const { data: existing } = await client
    .from(GENERATION_QUOTA_TABLE)
    .select('*')
    .eq('clerk_user_id', clerkUserId)
    .single();

  if (existing) {
    return existing as QuotaRow;
  }

  // Create new record if doesn't exist
  const { data: newRecord, error } = await client
    .from(GENERATION_QUOTA_TABLE)
    .insert({
      clerk_user_id: clerkUserId,
      tier: 'free',
      generation_count: 0,
    })
    .select('*')
    .single();

  if (error || !newRecord) {
    return null;
  }

  return newRecord as QuotaRow;
};

/**
 * Checks if user has available quota
 * Returns quota information including remaining count
 */
export const checkQuota = async (
  client: SupabaseClient,
  clerkUserId: string,
): Promise<HandlerResult<QuotaCheckResult, ArticleServiceError, unknown>> => {
  try {
    const quota = await getOrCreateQuotaRecord(client, clerkUserId);

    if (!quota) {
      return failure(
        500,
        articleErrorCodes.quotaCheckFailed,
        'Failed to retrieve or create quota record',
      );
    }

    const tier = quota.tier as TierType;
    const limit = QUOTA_LIMITS[tier];
    const currentCount = quota.generation_count;
    const remaining = Math.max(0, limit - currentCount);
    const allowed = currentCount < limit;

    return success(
      {
        allowed,
        tier,
        currentCount,
        limit,
        remaining,
      },
      200,
    );
  } catch (error) {
    return failure(
      500,
      articleErrorCodes.quotaCheckFailed,
      `Quota check failed: ${error instanceof Error ? error.message : 'Unknown error'}`,
      error,
    );
  }
};

/**
 * Increments generation count for user
 * Uses atomic update to prevent race conditions
 */
export const incrementQuota = async (
  client: SupabaseClient,
  clerkUserId: string,
): Promise<HandlerResult<{ newCount: number; remaining: number }, ArticleServiceError, unknown>> => {
  try {
    // Get current quota to determine tier
    const quota = await getOrCreateQuotaRecord(client, clerkUserId);

    if (!quota) {
      return failure(
        500,
        articleErrorCodes.quotaIncrementFailed,
        'Failed to retrieve quota record',
      );
    }

    const tier = quota.tier as TierType;
    const limit = QUOTA_LIMITS[tier];

    // Atomic increment using PostgreSQL
    const { data, error } = await client
      .from(GENERATION_QUOTA_TABLE)
      .update({
        generation_count: quota.generation_count + 1,
      })
      .eq('clerk_user_id', clerkUserId)
      .eq('generation_count', quota.generation_count) // Ensure no race condition
      .select('generation_count')
      .single();

    if (error || !data) {
      return failure(
        500,
        articleErrorCodes.quotaIncrementFailed,
        `Failed to increment quota: ${error?.message || 'Unknown error'}`,
      );
    }

    const newCount = data.generation_count;
    const remaining = Math.max(0, limit - newCount);

    return success({ newCount, remaining }, 200);
  } catch (error) {
    return failure(
      500,
      articleErrorCodes.quotaIncrementFailed,
      `Quota increment failed: ${error instanceof Error ? error.message : 'Unknown error'}`,
      error,
    );
  }
};

/**
 * Gets quota status for user (without creating record)
 */
export const getQuotaStatus = async (
  client: SupabaseClient,
  clerkUserId: string,
): Promise<HandlerResult<QuotaCheckResult, ArticleServiceError, unknown>> => {
  try {
    const { data: quota } = await client
      .from(GENERATION_QUOTA_TABLE)
      .select('*')
      .eq('clerk_user_id', clerkUserId)
      .single();

    if (!quota) {
      // Return default free tier status
      return success(
        {
          allowed: true,
          tier: 'free',
          currentCount: 0,
          limit: QUOTA_LIMITS.free,
          remaining: QUOTA_LIMITS.free,
        },
        200,
      );
    }

    const tier = quota.tier as TierType;
    const limit = QUOTA_LIMITS[tier];
    const currentCount = quota.generation_count;
    const remaining = Math.max(0, limit - currentCount);
    const allowed = currentCount < limit;

    return success(
      {
        allowed,
        tier,
        currentCount,
        limit,
        remaining,
      },
      200,
    );
  } catch (error) {
    return failure(
      500,
      articleErrorCodes.quotaCheckFailed,
      `Failed to get quota status: ${error instanceof Error ? error.message : 'Unknown error'}`,
      error,
    );
  }
};
</file>

<file path="src/features/articles/backend/service.ts">
import type { SupabaseClient } from '@supabase/supabase-js';
import {
  failure,
  success,
  type HandlerResult,
} from '@/backend/http/response';
import {
  ArticleTableRowSchema,
  ArticleResponseSchema,
  type ArticleResponse,
  type CreateArticleRequest,
  type UpdateArticleRequest,
} from '@/features/articles/backend/schema';
import {
  articleErrorCodes,
  type ArticleServiceError,
} from '@/features/articles/backend/error';

const ARTICLES_TABLE = 'articles';

/**
 * Maps database row (snake_case) to API response (camelCase)
 */
const mapArticleRowToResponse = (row: unknown): ArticleResponse => {
  // Validate the database row
  const rowParse = ArticleTableRowSchema.safeParse(row);

  if (!rowParse.success) {
    throw new Error('Article row failed validation');
  }

  // Map snake_case to camelCase
  const mapped = {
    id: rowParse.data.id,
    clerkUserId: rowParse.data.clerk_user_id,
    title: rowParse.data.title,
    slug: rowParse.data.slug,
    keywords: rowParse.data.keywords,
    description: rowParse.data.description,
    content: rowParse.data.content,
    styleGuideId: rowParse.data.style_guide_id,
    tone: rowParse.data.tone,
    contentLength: rowParse.data.content_length,
    readingLevel: rowParse.data.reading_level,
    metaTitle: rowParse.data.meta_title,
    metaDescription: rowParse.data.meta_description,
    status: rowParse.data.status,
    publishedAt: rowParse.data.published_at,
    createdAt: rowParse.data.created_at,
    updatedAt: rowParse.data.updated_at,
  } satisfies ArticleResponse;

  // Validate the response
  const parsed = ArticleResponseSchema.safeParse(mapped);

  if (!parsed.success) {
    throw new Error('Article response failed validation');
  }

  return parsed.data;
};

/**
 * Creates a new article draft
 */
export const createArticle = async (
  client: SupabaseClient,
  clerkUserId: string,
  data: CreateArticleRequest,
): Promise<HandlerResult<ArticleResponse, ArticleServiceError, unknown>> => {
  // Map camelCase TypeScript to snake_case database columns
  const dbRecord = {
    clerk_user_id: clerkUserId,
    title: data.title,
    slug: data.slug,
    keywords: data.keywords,
    description: data.description || null,
    content: data.content,
    style_guide_id: data.styleGuideId || null,
    tone: data.tone || null,
    content_length: data.contentLength || null,
    reading_level: data.readingLevel || null,
    meta_title: data.metaTitle || null,
    meta_description: data.metaDescription || null,
    status: 'draft' as const,
  };

  const { data: savedData, error } = await client
    .from(ARTICLES_TABLE)
    .insert(dbRecord)
    .select('*')
    .single();

  if (error) {
    return failure(
      500,
      articleErrorCodes.createError,
      `Failed to create article: ${error.message}`,
    );
  }

  if (!savedData) {
    return failure(
      500,
      articleErrorCodes.createError,
      'Article was created but no data was returned',
    );
  }

  try {
    const mapped = mapArticleRowToResponse(savedData);
    return success(mapped, 201);
  } catch (err) {
    return failure(
      500,
      articleErrorCodes.validationError,
      'Article row failed validation.',
      err,
    );
  }
};

/**
 * Gets an article by ID
 * Only returns articles belonging to the specified user
 */
export const getArticleById = async (
  client: SupabaseClient,
  clerkUserId: string,
  articleId: string,
): Promise<HandlerResult<ArticleResponse, ArticleServiceError, unknown>> => {
  const { data, error } = await client
    .from(ARTICLES_TABLE)
    .select('*')
    .eq('id', articleId)
    .eq('clerk_user_id', clerkUserId)
    .single();

  if (error) {
    if (error.code === 'PGRST116') {
      return failure(404, articleErrorCodes.notFound, 'Article not found');
    }
    return failure(
      500,
      articleErrorCodes.fetchError,
      `Failed to fetch article: ${error.message}`,
    );
  }

  if (!data) {
    return failure(404, articleErrorCodes.notFound, 'Article not found');
  }

  try {
    const mapped = mapArticleRowToResponse(data);
    return success(mapped, 200);
  } catch (err) {
    return failure(
      500,
      articleErrorCodes.validationError,
      'Article row failed validation.',
      err,
    );
  }
};

/**
 * Updates an existing article
 * Only updates articles belonging to the specified user
 */
export const updateArticle = async (
  client: SupabaseClient,
  clerkUserId: string,
  articleId: string,
  data: UpdateArticleRequest,
): Promise<HandlerResult<ArticleResponse, ArticleServiceError, unknown>> => {
  // Map camelCase TypeScript to snake_case database columns
  const updateData: Record<string, unknown> = {};

  if (data.title !== undefined) updateData.title = data.title;
  if (data.slug !== undefined) updateData.slug = data.slug;
  if (data.keywords !== undefined) updateData.keywords = data.keywords;
  if (data.description !== undefined)
    updateData.description = data.description || null;
  if (data.content !== undefined) updateData.content = data.content;
  if (data.styleGuideId !== undefined)
    updateData.style_guide_id = data.styleGuideId || null;
  if (data.tone !== undefined) updateData.tone = data.tone || null;
  if (data.contentLength !== undefined)
    updateData.content_length = data.contentLength || null;
  if (data.readingLevel !== undefined)
    updateData.reading_level = data.readingLevel || null;
  if (data.metaTitle !== undefined)
    updateData.meta_title = data.metaTitle || null;
  if (data.metaDescription !== undefined)
    updateData.meta_description = data.metaDescription || null;
  if (data.status !== undefined) {
    updateData.status = data.status;
    // If publishing for the first time, set published_at
    if (data.status === 'published') {
      updateData.published_at = new Date().toISOString();
    }
  }

  const { data: updatedData, error } = await client
    .from(ARTICLES_TABLE)
    .update(updateData)
    .eq('id', articleId)
    .eq('clerk_user_id', clerkUserId)
    .select('*')
    .single();

  if (error) {
    if (error.code === 'PGRST116') {
      return failure(404, articleErrorCodes.notFound, 'Article not found');
    }
    return failure(
      500,
      articleErrorCodes.updateError,
      `Failed to update article: ${error.message}`,
    );
  }

  if (!updatedData) {
    return failure(
      500,
      articleErrorCodes.updateError,
      'Article was updated but no data was returned',
    );
  }

  try {
    const mapped = mapArticleRowToResponse(updatedData);
    return success(mapped, 200);
  } catch (err) {
    return failure(
      500,
      articleErrorCodes.validationError,
      'Article row failed validation.',
      err,
    );
  }
};

/**
 * Deletes an article by ID
 * Only deletes articles belonging to the specified user
 */
export const deleteArticle = async (
  client: SupabaseClient,
  clerkUserId: string,
  articleId: string,
): Promise<HandlerResult<{ id: string }, ArticleServiceError, unknown>> => {
  const { error } = await client
    .from(ARTICLES_TABLE)
    .delete()
    .eq('id', articleId)
    .eq('clerk_user_id', clerkUserId);

  if (error) {
    return failure(
      500,
      articleErrorCodes.deleteError,
      `Failed to delete article: ${error.message}`,
    );
  }

  return success({ id: articleId }, 200);
};
</file>

<file path="src/features/articles/components/article-form.tsx">
"use client";

import { UseFormReturn } from "react-hook-form";
import {
  FormField,
  FormItem,
  FormLabel,
  FormControl,
  FormDescription,
  FormMessage,
} from "@/components/ui/form";
import { Input } from "@/components/ui/input";
import { Textarea } from "@/components/ui/textarea";
import {
  Select,
  SelectContent,
  SelectItem,
  SelectTrigger,
  SelectValue,
} from "@/components/ui/select";
import { Button } from "@/components/ui/button";
import { Badge } from "@/components/ui/badge";
import { X, Plus } from "lucide-react";
import { useState } from "react";
import type { ArticleFormData } from "../lib/article-form-schema";
import { generateSlug } from "../lib/article-form-schema";

interface ArticleFormProps {
  form: UseFormReturn<ArticleFormData>;
  styleGuides?: Array<{ id: string; name: string }>;
  isLoading?: boolean;
}

export function ArticleForm({ form, styleGuides, isLoading }: ArticleFormProps) {
  const [keywordInput, setKeywordInput] = useState("");

  const handleAddKeyword = () => {
    const trimmed = keywordInput.trim();
    if (!trimmed) return;

    const currentKeywords = form.getValues("keywords") || [];
    if (!currentKeywords.includes(trimmed)) {
      form.setValue("keywords", [...currentKeywords, trimmed]);
    }
    setKeywordInput("");
  };

  const handleRemoveKeyword = (keyword: string) => {
    const currentKeywords = form.getValues("keywords") || [];
    form.setValue(
      "keywords",
      currentKeywords.filter((k) => k !== keyword)
    );
  };

  const handleTitleChange = (value: string) => {
    form.setValue("title", value);

    // Auto-generate slug if it's empty or was auto-generated
    const currentSlug = form.getValues("slug");
    if (!currentSlug || currentSlug === generateSlug(form.getValues("title"))) {
      const newSlug = generateSlug(value);
      form.setValue("slug", newSlug);
    }
  };

  const keywords = form.watch("keywords") || [];

  return (
    <div className="space-y-6">
      <div>
        <h2 className="text-2xl font-bold" style={{ color: "#1F2937" }}>
          ê¸€ ì‘ì„±
        </h2>
        <p className="mt-1 text-sm" style={{ color: "#6B7280" }}>
          ìƒˆë¡œìš´ ë¸”ë¡œê·¸ ê¸€ì„ ì‘ì„±í•´ì£¼ì„¸ìš”
        </p>
      </div>

      {/* Title */}
      <FormField
        control={form.control}
        name="title"
        render={({ field }) => (
          <FormItem>
            <FormLabel className="text-base font-semibold">
              ì œëª© <span style={{ color: "#DC2626" }}>*</span>
            </FormLabel>
            <FormControl>
              <Input
                {...field}
                onChange={(e) => handleTitleChange(e.target.value)}
                placeholder="ê¸€ì˜ ì œëª©ì„ ì…ë ¥í•˜ì„¸ìš”"
                disabled={isLoading}
                className="h-12 text-base"
                style={{
                  borderColor: "#E1E5EA",
                  borderRadius: "8px",
                }}
              />
            </FormControl>
            <FormDescription>
              ëª…í™•í•˜ê³  ê°„ê²°í•œ ì œëª©ì„ ì…ë ¥í•´ì£¼ì„¸ìš”
            </FormDescription>
            <FormMessage />
          </FormItem>
        )}
      />

      {/* Slug */}
      <FormField
        control={form.control}
        name="slug"
        render={({ field }) => (
          <FormItem>
            <FormLabel className="text-base font-semibold">
              URL ìŠ¬ëŸ¬ê·¸ <span style={{ color: "#DC2626" }}>*</span>
            </FormLabel>
            <FormControl>
              <Input
                {...field}
                placeholder="url-slug-example"
                disabled={isLoading}
                className="h-12 font-mono text-sm"
                style={{
                  borderColor: "#E1E5EA",
                  borderRadius: "8px",
                }}
              />
            </FormControl>
            <FormDescription>
              ì†Œë¬¸ì, ìˆ«ì, í•˜ì´í”ˆ(-)ë§Œ ì‚¬ìš© ê°€ëŠ¥í•©ë‹ˆë‹¤
            </FormDescription>
            <FormMessage />
          </FormItem>
        )}
      />

      {/* Keywords */}
      <FormField
        control={form.control}
        name="keywords"
        render={() => (
          <FormItem>
            <FormLabel className="text-base font-semibold">í‚¤ì›Œë“œ</FormLabel>
            <div className="space-y-3">
              <div className="flex gap-2">
                <Input
                  value={keywordInput}
                  onChange={(e) => setKeywordInput(e.target.value)}
                  onKeyDown={(e) => {
                    if (e.key === "Enter") {
                      e.preventDefault();
                      handleAddKeyword();
                    }
                  }}
                  placeholder="í‚¤ì›Œë“œ ì…ë ¥ í›„ Enter"
                  disabled={isLoading}
                  className="h-10"
                  style={{
                    borderColor: "#E1E5EA",
                    borderRadius: "8px",
                  }}
                />
                <Button
                  type="button"
                  variant="outline"
                  size="icon"
                  onClick={handleAddKeyword}
                  disabled={isLoading}
                  className="h-10 w-10"
                  style={{
                    borderColor: "#E1E5EA",
                    borderRadius: "8px",
                  }}
                >
                  <Plus className="h-4 w-4" />
                </Button>
              </div>
              {keywords.length > 0 && (
                <div className="flex flex-wrap gap-2">
                  {keywords.map((keyword) => (
                    <Badge
                      key={keyword}
                      variant="secondary"
                      className="px-3 py-1.5 text-sm"
                      style={{
                        backgroundColor: "#F3F4F6",
                        color: "#374151",
                      }}
                    >
                      {keyword}
                      <button
                        type="button"
                        onClick={() => handleRemoveKeyword(keyword)}
                        className="ml-2 hover:opacity-70"
                        disabled={isLoading}
                      >
                        <X className="h-3 w-3" />
                      </button>
                    </Badge>
                  ))}
                </div>
              )}
            </div>
            <FormDescription>
              ê¸€ì˜ ì£¼ìš” í‚¤ì›Œë“œë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”
            </FormDescription>
            <FormMessage />
          </FormItem>
        )}
      />

      {/* Description */}
      <FormField
        control={form.control}
        name="description"
        render={({ field }) => (
          <FormItem>
            <FormLabel className="text-base font-semibold">
              ìš”ì•½ ì„¤ëª…
            </FormLabel>
            <FormControl>
              <Textarea
                {...field}
                placeholder="ê¸€ì˜ ìš”ì•½ ì„¤ëª…ì„ ì…ë ¥í•˜ì„¸ìš”"
                disabled={isLoading}
                rows={3}
                className="resize-none"
                style={{
                  borderColor: "#E1E5EA",
                  borderRadius: "8px",
                }}
              />
            </FormControl>
            <FormDescription>
              ìµœëŒ€ 500ìê¹Œì§€ ì…ë ¥ ê°€ëŠ¥í•©ë‹ˆë‹¤
            </FormDescription>
            <FormMessage />
          </FormItem>
        )}
      />

      {/* Content */}
      <FormField
        control={form.control}
        name="content"
        render={({ field }) => (
          <FormItem>
            <FormLabel className="text-base font-semibold">
              ë³¸ë¬¸ <span style={{ color: "#DC2626" }}>*</span>
            </FormLabel>
            <FormControl>
              <Textarea
                {...field}
                placeholder="ê¸€ì˜ ë³¸ë¬¸ì„ ì…ë ¥í•˜ì„¸ìš” (Markdown ì§€ì›)"
                disabled={isLoading}
                rows={12}
                className="resize-none font-mono text-sm"
                style={{
                  borderColor: "#E1E5EA",
                  borderRadius: "8px",
                }}
              />
            </FormControl>
            <FormDescription>
              Markdown ë¬¸ë²•ì„ ì‚¬ìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤
            </FormDescription>
            <FormMessage />
          </FormItem>
        )}
      />

      {/* Style Guide */}
      {styleGuides && styleGuides.length > 0 && (
        <FormField
          control={form.control}
          name="styleGuideId"
          render={({ field }) => (
            <FormItem>
              <FormLabel className="text-base font-semibold">
                ìŠ¤íƒ€ì¼ ê°€ì´ë“œ
              </FormLabel>
              <Select
                onValueChange={field.onChange}
                value={field.value}
                disabled={isLoading}
              >
                <FormControl>
                  <SelectTrigger
                    className="h-12"
                    style={{
                      borderColor: "#E1E5EA",
                      borderRadius: "8px",
                    }}
                  >
                    <SelectValue placeholder="ìŠ¤íƒ€ì¼ ê°€ì´ë“œ ì„ íƒ (ì„ íƒì‚¬í•­)" />
                  </SelectTrigger>
                </FormControl>
                <SelectContent>
                  {styleGuides.map((guide) => (
                    <SelectItem key={guide.id} value={guide.id}>
                      {guide.name}
                    </SelectItem>
                  ))}
                </SelectContent>
              </Select>
              <FormDescription>
                ê¸€ ì‘ì„± ì‹œ ì°¸ê³ í•  ìŠ¤íƒ€ì¼ ê°€ì´ë“œë¥¼ ì„ íƒí•˜ì„¸ìš”
              </FormDescription>
              <FormMessage />
            </FormItem>
          )}
        />
      )}

      {/* Tone */}
      <FormField
        control={form.control}
        name="tone"
        render={({ field }) => (
          <FormItem>
            <FormLabel className="text-base font-semibold">í†¤</FormLabel>
            <Select
              onValueChange={field.onChange}
              value={field.value}
              disabled={isLoading}
            >
              <FormControl>
                <SelectTrigger
                  className="h-12"
                  style={{
                    borderColor: "#E1E5EA",
                    borderRadius: "8px",
                  }}
                >
                  <SelectValue placeholder="ê¸€ì˜ í†¤ì„ ì„ íƒí•˜ì„¸ìš”" />
                </SelectTrigger>
              </FormControl>
              <SelectContent>
                <SelectItem value="professional">Professional (ì „ë¬¸ì )</SelectItem>
                <SelectItem value="friendly">Friendly (ì¹œê·¼í•¨)</SelectItem>
                <SelectItem value="inspirational">Inspirational (ì˜ê°ì )</SelectItem>
                <SelectItem value="educational">Educational (êµìœ¡ì )</SelectItem>
              </SelectContent>
            </Select>
            <FormDescription>
              ê¸€ì˜ ë¶„ìœ„ê¸°ì™€ ìŠ¤íƒ€ì¼ì„ ì„ íƒí•˜ì„¸ìš”
            </FormDescription>
            <FormMessage />
          </FormItem>
        )}
      />

      <div className="grid gap-6 sm:grid-cols-2">
        {/* Content Length */}
        <FormField
          control={form.control}
          name="contentLength"
          render={({ field }) => (
            <FormItem>
              <FormLabel className="text-base font-semibold">
                ê¸€ ê¸¸ì´
              </FormLabel>
              <Select
                onValueChange={field.onChange}
                value={field.value}
                disabled={isLoading}
              >
                <FormControl>
                  <SelectTrigger
                    className="h-12"
                    style={{
                      borderColor: "#E1E5EA",
                      borderRadius: "8px",
                    }}
                  >
                    <SelectValue placeholder="ì„ íƒ" />
                  </SelectTrigger>
                </FormControl>
                <SelectContent>
                  <SelectItem value="short">ì§§ìŒ (Short)</SelectItem>
                  <SelectItem value="medium">ì¤‘ê°„ (Medium)</SelectItem>
                  <SelectItem value="long">ê¹€ (Long)</SelectItem>
                </SelectContent>
              </Select>
              <FormMessage />
            </FormItem>
          )}
        />

        {/* Reading Level */}
        <FormField
          control={form.control}
          name="readingLevel"
          render={({ field }) => (
            <FormItem>
              <FormLabel className="text-base font-semibold">
                ë‚œì´ë„
              </FormLabel>
              <Select
                onValueChange={field.onChange}
                value={field.value}
                disabled={isLoading}
              >
                <FormControl>
                  <SelectTrigger
                    className="h-12"
                    style={{
                      borderColor: "#E1E5EA",
                      borderRadius: "8px",
                    }}
                  >
                    <SelectValue placeholder="ì„ íƒ" />
                  </SelectTrigger>
                </FormControl>
                <SelectContent>
                  <SelectItem value="beginner">ì´ˆê¸‰ (Beginner)</SelectItem>
                  <SelectItem value="intermediate">ì¤‘ê¸‰ (Intermediate)</SelectItem>
                  <SelectItem value="advanced">ê³ ê¸‰ (Advanced)</SelectItem>
                </SelectContent>
              </Select>
              <FormMessage />
            </FormItem>
          )}
        />
      </div>
    </div>
  );
}
</file>

<file path="src/features/articles/components/article-preview.tsx">
"use client";

import { Card } from "@/components/ui/card";
import { FileText } from "lucide-react";
import type { ArticleFormData } from "../lib/article-form-schema";

interface ArticlePreviewProps {
  formData: ArticleFormData;
}

export function ArticlePreview({ formData }: ArticlePreviewProps) {
  const hasContent = formData.title || formData.content;

  return (
    <Card
      className="sticky top-4 h-fit overflow-hidden"
      style={{
        borderColor: "#E1E5EA",
        borderRadius: "12px",
      }}
    >
      <div
        className="border-b px-6 py-4"
        style={{ borderColor: "#E1E5EA", backgroundColor: "#F9FAFB" }}
      >
        <h3 className="flex items-center gap-2 text-lg font-semibold">
          <FileText className="h-5 w-5" style={{ color: "#3BA2F8" }} />
          ë¯¸ë¦¬ë³´ê¸°
        </h3>
      </div>

      <div className="p-6">
        {!hasContent ? (
          <div
            className="flex min-h-[400px] items-center justify-center text-center"
            style={{ color: "#9CA3AF" }}
          >
            <div>
              <FileText className="mx-auto mb-3 h-12 w-12" />
              <p className="text-sm">
                ê¸€ì„ ì‘ì„±í•˜ë©´
                <br />
                ë¯¸ë¦¬ë³´ê¸°ê°€ í‘œì‹œë©ë‹ˆë‹¤
              </p>
            </div>
          </div>
        ) : (
          <div className="space-y-6">
            {/* Title */}
            {formData.title && (
              <div>
                <h1
                  className="text-3xl font-bold leading-tight"
                  style={{ color: "#1F2937" }}
                >
                  {formData.title}
                </h1>
              </div>
            )}

            {/* Meta Info */}
            <div className="flex flex-wrap gap-2">
              {formData.tone && (
                <span
                  className="rounded-full px-3 py-1 text-xs font-medium"
                  style={{
                    backgroundColor: "#EFF6FF",
                    color: "#3B82F6",
                  }}
                >
                  {formData.tone}
                </span>
              )}
              {formData.contentLength && (
                <span
                  className="rounded-full px-3 py-1 text-xs font-medium"
                  style={{
                    backgroundColor: "#F0FDF4",
                    color: "#10B981",
                  }}
                >
                  {formData.contentLength}
                </span>
              )}
              {formData.readingLevel && (
                <span
                  className="rounded-full px-3 py-1 text-xs font-medium"
                  style={{
                    backgroundColor: "#FEF3C7",
                    color: "#F59E0B",
                  }}
                >
                  {formData.readingLevel}
                </span>
              )}
            </div>

            {/* Keywords */}
            {formData.keywords && formData.keywords.length > 0 && (
              <div>
                <h4
                  className="mb-2 text-xs font-semibold uppercase"
                  style={{ color: "#6B7280" }}
                >
                  í‚¤ì›Œë“œ
                </h4>
                <div className="flex flex-wrap gap-1.5">
                  {formData.keywords.map((keyword) => (
                    <span
                      key={keyword}
                      className="rounded px-2 py-0.5 text-xs"
                      style={{
                        backgroundColor: "#F3F4F6",
                        color: "#4B5563",
                      }}
                    >
                      #{keyword}
                    </span>
                  ))}
                </div>
              </div>
            )}

            {/* Description */}
            {formData.description && (
              <div>
                <p
                  className="text-base leading-relaxed"
                  style={{ color: "#6B7280" }}
                >
                  {formData.description}
                </p>
              </div>
            )}

            {/* Content Preview */}
            {formData.content && (
              <div
                className="border-t pt-6"
                style={{ borderColor: "#E1E5EA" }}
              >
                <h4
                  className="mb-3 text-xs font-semibold uppercase"
                  style={{ color: "#6B7280" }}
                >
                  ë³¸ë¬¸
                </h4>
                <div
                  className="prose prose-sm max-w-none"
                  style={{ color: "#374151" }}
                >
                  <pre className="whitespace-pre-wrap font-sans text-sm leading-relaxed">
                    {formData.content}
                  </pre>
                </div>
              </div>
            )}
          </div>
        )}
      </div>
    </Card>
  );
}
</file>

<file path="src/features/articles/components/seo-panel.tsx">
"use client";

import { Card } from "@/components/ui/card";
import { Badge } from "@/components/ui/badge";
import {
  Search,
  CheckCircle2,
  AlertCircle,
  XCircle,
  Info,
} from "lucide-react";
import type { ArticleFormData } from "../lib/article-form-schema";

interface SeoCheckItem {
  label: string;
  status: "pass" | "warning" | "fail" | "info";
  message: string;
}

interface SeoPanelProps {
  formData: ArticleFormData;
}

export function SeoPanel({ formData }: SeoPanelProps) {
  const checks: SeoCheckItem[] = [
    // Title checks
    {
      label: "ì œëª© ê¸¸ì´",
      status: formData.title
        ? formData.title.length >= 30 && formData.title.length <= 60
          ? "pass"
          : formData.title.length > 60
            ? "warning"
            : "info"
        : "info",
      message: formData.title
        ? `${formData.title.length}ì (ê¶Œì¥: 30-60ì)`
        : "ì œëª©ì„ ì…ë ¥í•˜ì„¸ìš”",
    },
    // Meta title
    {
      label: "Meta ì œëª©",
      status: formData.metaTitle
        ? formData.metaTitle.length <= 60
          ? "pass"
          : "warning"
        : "info",
      message: formData.metaTitle
        ? `${formData.metaTitle.length}ì (ìµœëŒ€: 60ì)`
        : "Meta ì œëª©ì„ ì…ë ¥í•˜ë©´ ê²€ìƒ‰ ê²°ê³¼ì— í‘œì‹œë©ë‹ˆë‹¤",
    },
    // Meta description
    {
      label: "Meta ì„¤ëª…",
      status: formData.metaDescription
        ? formData.metaDescription.length >= 120 &&
          formData.metaDescription.length <= 160
          ? "pass"
          : formData.metaDescription.length > 160
            ? "warning"
            : "info"
        : "info",
      message: formData.metaDescription
        ? `${formData.metaDescription.length}ì (ê¶Œì¥: 120-160ì)`
        : "Meta ì„¤ëª…ì„ ì…ë ¥í•˜ë©´ ê²€ìƒ‰ ê²°ê³¼ì— í‘œì‹œë©ë‹ˆë‹¤",
    },
    // Slug
    {
      label: "URL ìŠ¬ëŸ¬ê·¸",
      status: formData.slug
        ? /^[a-z0-9]+(?:-[a-z0-9]+)*$/.test(formData.slug)
          ? "pass"
          : "fail"
        : "info",
      message: formData.slug
        ? /^[a-z0-9]+(?:-[a-z0-9]+)*$/.test(formData.slug)
          ? "ì˜¬ë°”ë¥¸ í˜•ì‹ì…ë‹ˆë‹¤"
          : "ì†Œë¬¸ì, ìˆ«ì, í•˜ì´í”ˆë§Œ ì‚¬ìš© ê°€ëŠ¥í•©ë‹ˆë‹¤"
        : "URL ìŠ¬ëŸ¬ê·¸ë¥¼ ì…ë ¥í•˜ì„¸ìš”",
    },
    // Keywords
    {
      label: "í‚¤ì›Œë“œ",
      status:
        formData.keywords && formData.keywords.length > 0
          ? formData.keywords.length >= 3 && formData.keywords.length <= 10
            ? "pass"
            : "warning"
          : "info",
      message:
        formData.keywords && formData.keywords.length > 0
          ? `${formData.keywords.length}ê°œ í‚¤ì›Œë“œ (ê¶Œì¥: 3-10ê°œ)`
          : "í‚¤ì›Œë“œë¥¼ 3-10ê°œ ì¶”ê°€í•˜ì„¸ìš”",
    },
    // Content length
    {
      label: "ë³¸ë¬¸ ê¸¸ì´",
      status: formData.content
        ? formData.content.length >= 300
          ? "pass"
          : "info"
        : "info",
      message: formData.content
        ? `${formData.content.length}ì (ìµœì†Œ ê¶Œì¥: 300ì)`
        : "ë³¸ë¬¸ì„ ì…ë ¥í•˜ì„¸ìš”",
    },
  ];

  const passCount = checks.filter((c) => c.status === "pass").length;
  const totalCount = checks.length;
  const score = Math.round((passCount / totalCount) * 100);

  const getStatusIcon = (status: SeoCheckItem["status"]) => {
    switch (status) {
      case "pass":
        return <CheckCircle2 className="h-4 w-4" style={{ color: "#10B981" }} />;
      case "warning":
        return <AlertCircle className="h-4 w-4" style={{ color: "#F59E0B" }} />;
      case "fail":
        return <XCircle className="h-4 w-4" style={{ color: "#DC2626" }} />;
      case "info":
        return <Info className="h-4 w-4" style={{ color: "#6B7280" }} />;
    }
  };

  const getStatusColor = (status: SeoCheckItem["status"]) => {
    switch (status) {
      case "pass":
        return "#10B981";
      case "warning":
        return "#F59E0B";
      case "fail":
        return "#DC2626";
      case "info":
        return "#6B7280";
    }
  };

  const getScoreColor = (score: number) => {
    if (score >= 80) return "#10B981";
    if (score >= 50) return "#F59E0B";
    return "#DC2626";
  };

  return (
    <Card
      className="sticky top-4 h-fit overflow-hidden"
      style={{
        borderColor: "#E1E5EA",
        borderRadius: "12px",
      }}
    >
      <div
        className="border-b px-6 py-4"
        style={{ borderColor: "#E1E5EA", backgroundColor: "#F9FAFB" }}
      >
        <div className="flex items-center justify-between">
          <h3 className="flex items-center gap-2 text-lg font-semibold">
            <Search className="h-5 w-5" style={{ color: "#3BA2F8" }} />
            SEO ì ê²€
          </h3>
          <Badge
            variant="secondary"
            className="text-base font-bold"
            style={{
              backgroundColor: getScoreColor(score) + "20",
              color: getScoreColor(score),
            }}
          >
            {score}ì 
          </Badge>
        </div>
        <p className="mt-1 text-xs" style={{ color: "#6B7280" }}>
          {passCount}/{totalCount} í•­ëª© í†µê³¼
        </p>
      </div>

      <div className="divide-y" style={{ borderColor: "#E1E5EA" }}>
        {checks.map((check, index) => (
          <div key={index} className="px-6 py-4">
            <div className="flex items-start gap-3">
              <div className="mt-0.5">{getStatusIcon(check.status)}</div>
              <div className="flex-1 space-y-1">
                <div className="flex items-center justify-between">
                  <h4
                    className="text-sm font-medium"
                    style={{ color: "#374151" }}
                  >
                    {check.label}
                  </h4>
                </div>
                <p
                  className="text-xs leading-relaxed"
                  style={{ color: getStatusColor(check.status) }}
                >
                  {check.message}
                </p>
              </div>
            </div>
          </div>
        ))}
      </div>

      <div
        className="border-t px-6 py-4"
        style={{ borderColor: "#E1E5EA", backgroundColor: "#F9FAFB" }}
      >
        <div className="space-y-2">
          <h4
            className="text-xs font-semibold uppercase"
            style={{ color: "#6B7280" }}
          >
            SEO ê°œì„  íŒ
          </h4>
          <ul
            className="space-y-1.5 text-xs leading-relaxed"
            style={{ color: "#6B7280" }}
          >
            <li>â€¢ ì œëª©ì€ ì£¼ìš” í‚¤ì›Œë“œë¥¼ í¬í•¨í•˜ê³  30-60ìë¡œ ì‘ì„±</li>
            <li>â€¢ Meta ì„¤ëª…ì€ í´ë¦­ì„ ìœ ë„í•˜ëŠ” ë‚´ìš©ìœ¼ë¡œ 120-160ì</li>
            <li>â€¢ URLì€ ì§§ê³  ì˜ë¯¸ìˆëŠ” í‚¤ì›Œë“œë¡œ êµ¬ì„±</li>
            <li>â€¢ í‚¤ì›Œë“œëŠ” ìì—°ìŠ¤ëŸ½ê²Œ ë³¸ë¬¸ì— í¬í•¨</li>
          </ul>
        </div>
      </div>
    </Card>
  );
}
</file>

<file path="src/features/articles/hooks/useArticle.ts">
"use client";

import { useQuery } from "@tanstack/react-query";
import { getArticle } from "../actions/article-actions";
import type { ArticleResponse } from "../lib/dto";

export const useArticle = (articleId: string | null) => {
  return useQuery<ArticleResponse, Error>({
    queryKey: ["article", articleId],
    queryFn: () => {
      if (!articleId) {
        throw new Error("Article ID is required");
      }
      return getArticle(articleId);
    },
    enabled: !!articleId,
  });
};
</file>

<file path="src/features/articles/hooks/useCreateArticle.ts">
"use client";

import { useMutation, useQueryClient } from "@tanstack/react-query";
import { createArticleDraft } from "../actions/article-actions";
import type { CreateArticleRequest, ArticleResponse } from "../lib/dto";

export const useCreateArticle = () => {
  const queryClient = useQueryClient();

  return useMutation<ArticleResponse, Error, CreateArticleRequest>({
    mutationFn: createArticleDraft,
    onSuccess: (data) => {
      queryClient.invalidateQueries({ queryKey: ["articles"] });
      queryClient.setQueryData(["article", data.id], data);
    },
  });
};
</file>

<file path="src/features/articles/hooks/useStyleGuide.ts">
"use client";

import { useQuery } from "@tanstack/react-query";
import { getUserStyleGuide } from "../actions/article-actions";

export interface StyleGuideData {
  id: string;
  clerkUserId: string;
  brandName: string;
  brandDescription: string;
  personality: string[];
  formality: "casual" | "neutral" | "formal";
  targetAudience: string;
  painPoints: string;
  language: "ko" | "en";
  tone: "professional" | "friendly" | "inspirational" | "educational";
  contentLength: "short" | "medium" | "long";
  readingLevel: "beginner" | "intermediate" | "advanced";
  notes: string | null;
  isDefault: boolean;
  createdAt: string;
  updatedAt: string;
}

export const useStyleGuide = () => {
  return useQuery<StyleGuideData, Error>({
    queryKey: ["styleGuide"],
    queryFn: getUserStyleGuide,
  });
};
</file>

<file path="src/features/articles/hooks/useUpdateArticle.ts">
"use client";

import { useMutation, useQueryClient } from "@tanstack/react-query";
import { updateArticleDraft } from "../actions/article-actions";
import type { UpdateArticleRequest, ArticleResponse } from "../lib/dto";

interface UpdateArticleVariables {
  articleId: string;
  data: UpdateArticleRequest;
}

export const useUpdateArticle = () => {
  const queryClient = useQueryClient();

  return useMutation<ArticleResponse, Error, UpdateArticleVariables>({
    mutationFn: ({ articleId, data }) => updateArticleDraft(articleId, data),
    onSuccess: (data) => {
      queryClient.invalidateQueries({ queryKey: ["articles"] });
      queryClient.setQueryData(["article", data.id], data);
    },
  });
};
</file>

<file path="src/features/articles/lib/article-form-schema.ts">
import { z } from "zod";
import {
  CreateArticleRequestSchema,
  ContentToneSchema,
  ContentLengthSchema,
  ReadingLevelSchema,
} from "./dto";

export const ArticleFormSchema = CreateArticleRequestSchema;

export type ArticleFormData = z.infer<typeof ArticleFormSchema>;

export const defaultArticleFormValues: ArticleFormData = {
  title: "",
  slug: "",
  keywords: [],
  description: "",
  content: "",
  styleGuideId: undefined,
  tone: undefined,
  contentLength: undefined,
  readingLevel: undefined,
  metaTitle: "",
  metaDescription: "",
};

// Export enums for use in form components
export { ContentToneSchema, ContentLengthSchema, ReadingLevelSchema };

// Helper to generate slug from title
export const generateSlug = (title: string): string => {
  return title
    .toLowerCase()
    .trim()
    .replace(/[^\w\sê°€-í£-]/g, "") // Remove special chars except Korean
    .replace(/\s+/g, "-") // Replace spaces with hyphens
    .replace(/-+/g, "-") // Remove consecutive hyphens
    .replace(/^-|-$/g, ""); // Remove leading/trailing hyphens
};
</file>

<file path="src/features/articles/lib/article-schema.ts">
import { z } from 'zod';

// Reuse style schema from onboarding
import { styleSchema } from '@/features/onboarding/lib/onboarding-schema';

// Article Draft Form Schema
export const articleDraftSchema = z.object({
  title: z
    .string()
    .min(1, 'ì œëª©ì„ ì…ë ¥í•´ì£¼ì„¸ìš”')
    .max(200, 'ì œëª©ì€ 200ì ì´ë‚´ë¡œ ì…ë ¥í•´ì£¼ì„¸ìš”'),
  slug: z
    .string()
    .min(1, 'URL ìŠ¬ëŸ¬ê·¸ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”')
    .max(200, 'ìŠ¬ëŸ¬ê·¸ëŠ” 200ì ì´ë‚´ë¡œ ì…ë ¥í•´ì£¼ì„¸ìš”')
    .regex(
      /^[a-z0-9]+(?:-[a-z0-9]+)*$/,
      'ìŠ¬ëŸ¬ê·¸ëŠ” ì†Œë¬¸ì, ìˆ«ì, í•˜ì´í”ˆ(-)ë§Œ ì‚¬ìš© ê°€ëŠ¥í•©ë‹ˆë‹¤',
    ),
  keywords: z.array(z.string()).default([]),
  description: z.string().max(500, 'ì„¤ëª…ì€ 500ì ì´ë‚´ë¡œ ì…ë ¥í•´ì£¼ì„¸ìš”').optional(),
  content: z.string().min(1, 'ë‚´ìš©ì„ ì…ë ¥í•´ì£¼ì„¸ìš”'),
  // Style overrides (optional - uses style guide defaults if not provided)
  tone: styleSchema.shape.tone.optional(),
  contentLength: styleSchema.shape.contentLength.optional(),
  readingLevel: styleSchema.shape.readingLevel.optional(),
  // SEO metadata
  metaTitle: z.string().max(60, 'Meta ì œëª©ì€ 60ì ì´ë‚´ë¡œ ì…ë ¥í•´ì£¼ì„¸ìš”').optional(),
  metaDescription: z
    .string()
    .max(160, 'Meta ì„¤ëª…ì€ 160ì ì´ë‚´ë¡œ ì…ë ¥í•´ì£¼ì„¸ìš”')
    .optional(),
});

export type ArticleDraftFormData = z.infer<typeof articleDraftSchema>;

// Default values for the article draft form
export const defaultArticleDraftValues: ArticleDraftFormData = {
  title: '',
  slug: '',
  keywords: [],
  description: '',
  content: '',
  metaTitle: '',
  metaDescription: '',
};
</file>

<file path="src/features/auth/hooks/useCurrentUser.ts">
"use client";

import { useMemo } from "react";
import { useCurrentUserContext } from "../context/current-user-context";

export const useCurrentUser = () => {
  const context = useCurrentUserContext();

  return useMemo(
    () => ({
      user: context.user,
      status: context.status,
      isAuthenticated: context.isAuthenticated,
      isLoading: context.isLoading,
      refresh: context.refresh,
    }),
    [context]
  );
};
</file>

<file path="src/features/auth/types.ts">
export type CurrentUser = {
  id: string;
  email: string | null;
  appMetadata: Record<string, unknown>;
  userMetadata: Record<string, unknown>;
};

export type CurrentUserSnapshot =
  | { status: "authenticated"; user: CurrentUser }
  | { status: "unauthenticated"; user: null }
  | { status: "loading"; user: CurrentUser | null };

export type CurrentUserContextValue = CurrentUserSnapshot & {
  refresh: () => Promise<void>;
  isAuthenticated: boolean;
  isLoading: boolean;
};
</file>

<file path="src/features/example/backend/error.ts">
export const exampleErrorCodes = {
  notFound: 'EXAMPLE_NOT_FOUND',
  fetchError: 'EXAMPLE_FETCH_ERROR',
  validationError: 'EXAMPLE_VALIDATION_ERROR',
} as const;

type ExampleErrorValue = (typeof exampleErrorCodes)[keyof typeof exampleErrorCodes];

export type ExampleServiceError = ExampleErrorValue;
</file>

<file path="src/features/example/backend/route.ts">
import type { Hono } from 'hono';
import {
  failure,
  respond,
  type ErrorResult,
} from '@/backend/http/response';
import {
  getLogger,
  getSupabase,
  type AppEnv,
} from '@/backend/hono/context';
import { ExampleParamsSchema } from '@/features/example/backend/schema';
import { getExampleById } from './service';
import {
  exampleErrorCodes,
  type ExampleServiceError,
} from './error';

export const registerExampleRoutes = (app: Hono<AppEnv>) => {
  app.get('/example/:id', async (c) => {
    const parsedParams = ExampleParamsSchema.safeParse({ id: c.req.param('id') });

    if (!parsedParams.success) {
      return respond(
        c,
        failure(
          400,
          'INVALID_EXAMPLE_PARAMS',
          'The provided example id is invalid.',
          parsedParams.error.format(),
        ),
      );
    }

    const supabase = getSupabase(c);
    const logger = getLogger(c);

    const result = await getExampleById(supabase, parsedParams.data.id);

    if (!result.ok) {
      const errorResult = result as ErrorResult<ExampleServiceError, unknown>;

      if (errorResult.error.code === exampleErrorCodes.fetchError) {
        logger.error('Failed to fetch example', errorResult.error.message);
      }

      return respond(c, result);
    }

    return respond(c, result);
  });
};
</file>

<file path="src/features/example/backend/schema.ts">
import { z } from 'zod';

export const ExampleParamsSchema = z.object({
  id: z.string().uuid({ message: 'Example id must be a valid UUID.' }),
});

export const ExampleResponseSchema = z.object({
  id: z.string().uuid(),
  fullName: z.string(),
  avatarUrl: z.string().url(),
  bio: z.string().nullable(),
  updatedAt: z.string(),
});

export type ExampleResponse = z.infer<typeof ExampleResponseSchema>;

export const ExampleTableRowSchema = z.object({
  id: z.string().uuid(),
  full_name: z.string().nullable(),
  avatar_url: z.string().nullable(),
  bio: z.string().nullable(),
  updated_at: z.string(),
});

export type ExampleRow = z.infer<typeof ExampleTableRowSchema>;
</file>

<file path="src/features/example/backend/service.ts">
import type { SupabaseClient } from '@supabase/supabase-js';
import {
  failure,
  success,
  type HandlerResult,
} from '@/backend/http/response';
import {
  ExampleResponseSchema,
  ExampleTableRowSchema,
  type ExampleResponse,
  type ExampleRow,
} from '@/features/example/backend/schema';
import {
  exampleErrorCodes,
  type ExampleServiceError,
} from '@/features/example/backend/error';

const EXAMPLE_TABLE = 'example';

const fallbackAvatar = (id: string) =>
  `https://picsum.photos/seed/${encodeURIComponent(id)}/200/200`;

export const getExampleById = async (
  client: SupabaseClient,
  id: string,
): Promise<HandlerResult<ExampleResponse, ExampleServiceError, unknown>> => {
  const { data, error } = await client
    .from(EXAMPLE_TABLE)
    .select('id, full_name, avatar_url, bio, updated_at')
    .eq('id', id)
    .maybeSingle<ExampleRow>();

  if (error) {
    return failure(500, exampleErrorCodes.fetchError, error.message);
  }

  if (!data) {
    return failure(404, exampleErrorCodes.notFound, 'Example not found');
  }

  const rowParse = ExampleTableRowSchema.safeParse(data);

  if (!rowParse.success) {
    return failure(
      500,
      exampleErrorCodes.validationError,
      'Example row failed validation.',
      rowParse.error.format(),
    );
  }

  const mapped = {
    id: rowParse.data.id,
    fullName: rowParse.data.full_name ?? 'Anonymous User',
    avatarUrl:
      rowParse.data.avatar_url ?? fallbackAvatar(rowParse.data.id),
    bio: rowParse.data.bio,
    updatedAt: rowParse.data.updated_at,
  } satisfies ExampleResponse;

  const parsed = ExampleResponseSchema.safeParse(mapped);

  if (!parsed.success) {
    return failure(
      500,
      exampleErrorCodes.validationError,
      'Example payload failed validation.',
      parsed.error.format(),
    );
  }

  return success(parsed.data);
};
</file>

<file path="src/features/example/components/example-status.test.tsx">
import { describe, it, expect, vi } from 'vitest';
import { render, screen } from '@testing-library/react';
import userEvent from '@testing-library/user-event';
import { QueryClient, QueryClientProvider } from '@tanstack/react-query';
import { ExampleStatus } from './example-status';

// Mock the API client
vi.mock('@/lib/remote/api-client', () => ({
  apiClient: {
    get: vi.fn(),
  },
  extractApiErrorMessage: vi.fn((error, defaultMsg) => defaultMsg),
}));

const createWrapper = () => {
  const queryClient = new QueryClient({
    defaultOptions: {
      queries: {
        retry: false,
        gcTime: 0,
      },
    },
  });

  function Wrapper({ children }: { children: React.ReactNode }) {
    return (
      <QueryClientProvider client={queryClient}>{children}</QueryClientProvider>
    );
  }

  return Wrapper;
};

describe('ExampleStatus', () => {
  it('should render the component correctly', () => {
    render(<ExampleStatus />, { wrapper: createWrapper() });

    expect(screen.getByText(/Backend Health Check/i)).toBeInTheDocument();
    expect(screen.getByPlaceholderText(/00000000-0000-0000-0000-000000000000/i)).toBeInTheDocument();
    expect(screen.getByRole('button', { name: /ì¡°íšŒí•˜ê¸°/i })).toBeInTheDocument();
  });

  it('should display idle status initially', () => {
    render(<ExampleStatus />, { wrapper: createWrapper() });

    expect(screen.getByText(/Idle/i)).toBeInTheDocument();
    expect(screen.getByText(/UUIDë¥¼ ì…ë ¥í•˜ê³  ì¡°íšŒí•˜ê¸° ë²„íŠ¼ì„ ëˆ„ë¥´ë©´/i)).toBeInTheDocument();
  });

  it('should update input value when user types', async () => {
    const user = userEvent.setup();
    render(<ExampleStatus />, { wrapper: createWrapper() });

    const input = screen.getByPlaceholderText(/00000000-0000-0000-0000-000000000000/i);

    await user.type(input, 'test-id');

    expect(input).toHaveValue('test-id');
  });

  it('should clear results when empty input is submitted', async () => {
    const user = userEvent.setup();
    render(<ExampleStatus />, { wrapper: createWrapper() });

    const input = screen.getByPlaceholderText(/00000000-0000-0000-0000-000000000000/i);
    const button = screen.getByRole('button', { name: /ì¡°íšŒí•˜ê¸°/i });

    // Submit empty input
    await user.type(input, '   ');
    await user.click(button);

    expect(screen.getByText(/Idle/i)).toBeInTheDocument();
  });

  it('should show current status header', () => {
    render(<ExampleStatus />, { wrapper: createWrapper() });

    expect(screen.getByText(/í˜„ì¬ ìƒíƒœ/i)).toBeInTheDocument();
  });

  it('should have accessible form elements', () => {
    render(<ExampleStatus />, { wrapper: createWrapper() });

    const input = screen.getByPlaceholderText(/00000000-0000-0000-0000-000000000000/i);
    const button = screen.getByRole('button', { name: /ì¡°íšŒí•˜ê¸°/i });

    expect(input).toBeInTheDocument();
    expect(button).toBeInTheDocument();
  });

  it('should display description text', () => {
    render(<ExampleStatus />, { wrapper: createWrapper() });

    expect(screen.getByText(/ì˜ˆì‹œ API/i)).toBeInTheDocument();
    expect(screen.getByText(/Supabase ì˜ˆì‹œ ë ˆì½”ë“œì˜ UUIDë¥¼ ì…ë ¥í•˜ë©´/i)).toBeInTheDocument();
  });
});
</file>

<file path="src/features/example/components/example-status.tsx">
'use client';

import { useState } from 'react';
import type { FormEvent } from 'react';
import { Button } from '@/components/ui/button';
import { Input } from '@/components/ui/input';
import { useExampleQuery } from '@/features/example/hooks/useExampleQuery';

const statusBadge = (
  label: string,
  tone: 'success' | 'error' | 'idle',
) => {
  const toneStyles: Record<typeof tone, string> = {
    success: 'bg-emerald-500/10 text-emerald-300 border-emerald-400/40',
    error: 'bg-rose-500/10 text-rose-300 border-rose-400/40',
    idle: 'bg-slate-500/10 text-slate-200 border-slate-400/30',
  };

  return (
    <span
      className={`inline-flex items-center rounded-full border px-2.5 py-0.5 text-xs font-medium ${toneStyles[tone]}`}
    >
      {label}
    </span>
  );
};

export const ExampleStatus = () => {
  const [inputValue, setInputValue] = useState('');
  const [exampleId, setExampleId] = useState('');
  const query = useExampleQuery(exampleId);

  const handleSubmit = (event: FormEvent<HTMLFormElement>) => {
    event.preventDefault();
    const trimmed = inputValue.trim();

    if (!trimmed) {
      setExampleId('');
      return;
    }

    if (trimmed === exampleId) {
      void query.refetch();
      return;
    }

    setExampleId(trimmed);
  };

  return (
    <section className="mx-auto flex w-full max-w-3xl flex-col gap-6">
      <header className="space-y-2 text-slate-100">
        <h1 className="text-3xl font-semibold tracking-tight">Backend Health Check</h1>
        <p className="text-sm text-slate-300">
          ì˜ˆì‹œ API(`/api/example/:id`)ê°€ ì •ìƒ ë™ì‘í•˜ëŠ”ì§€ í™•ì¸í•©ë‹ˆë‹¤. Supabase ì˜ˆì‹œ
          ë ˆì½”ë“œì˜ UUIDë¥¼ ì…ë ¥í•˜ë©´ React Queryë¥¼ í†µí•´ ë°±ì—”ë“œ ì‘ë‹µì„ í™•ì¸í•  ìˆ˜
          ìˆìŠµë‹ˆë‹¤.
        </p>
      </header>

      <form
        onSubmit={handleSubmit}
        className="flex flex-col gap-3 rounded-xl border border-slate-800 bg-slate-950/60 p-4 md:flex-row md:items-center"
      >
        <div className="flex-1 space-y-1">
          <label className="text-xs uppercase tracking-wide text-slate-400">
            Example UUID
          </label>
          <Input
            value={inputValue}
            onChange={(event) => setInputValue(event.target.value)}
            placeholder="00000000-0000-0000-0000-000000000000"
            className="bg-slate-900/70 text-slate-100 placeholder:text-slate-600"
          />
        </div>
        <Button
          type="submit"
          variant="secondary"
          className="mt-2 h-12 rounded-lg border border-slate-600 bg-slate-800 text-slate-100 hover:bg-slate-700 md:mt-6"
        >
          ì¡°íšŒí•˜ê¸°
        </Button>
      </form>

      <article className="space-y-3 rounded-xl border border-slate-800 bg-slate-950/60 p-6 text-slate-100">
        <div className="flex items-center justify-between">
          <h2 className="text-lg font-semibold">í˜„ì¬ ìƒíƒœ</h2>
          {exampleId
            ? query.status === 'pending'
              ? statusBadge('Fetching', 'idle')
              : query.status === 'error'
                ? statusBadge('Error', 'error')
                : statusBadge('Success', 'success')
            : statusBadge('Idle', 'idle')}
        </div>

        {!exampleId && (
          <p className="text-sm text-slate-300">
            UUIDë¥¼ ì…ë ¥í•˜ê³  ì¡°íšŒí•˜ê¸° ë²„íŠ¼ì„ ëˆ„ë¥´ë©´ ê²°ê³¼ê°€ ì´ê³³ì— í‘œì‹œë©ë‹ˆë‹¤.
          </p>
        )}

        {exampleId && query.status === 'pending' && (
          <p className="text-sm text-slate-300">Supabaseì—ì„œ ë°ì´í„°ë¥¼ ê°€ì ¸ì˜¤ëŠ” ì¤‘...</p>
        )}

        {query.status === 'error' && (
          <div className="space-y-2 rounded-lg border border-rose-400/30 bg-rose-500/5 p-4">
            <p className="text-sm font-medium text-rose-300">ìš”ì²­ ì‹¤íŒ¨</p>
            <p className="text-xs text-rose-200/80">
              {query.error instanceof Error
                ? query.error.message
                : 'ì•Œ ìˆ˜ ì—†ëŠ” ì—ëŸ¬ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.'}
            </p>
          </div>
        )}

        {query.data && (
          <div className="space-y-3 rounded-lg border border-emerald-400/30 bg-emerald-500/5 p-4 text-sm text-emerald-100">
            <div>
              <p className="text-xs uppercase tracking-wide text-emerald-300">ID</p>
              <p className="font-mono text-xs md:text-sm">{query.data.id}</p>
            </div>
            <div>
              <p className="text-xs uppercase tracking-wide text-emerald-300">
                ì´ë¦„
              </p>
              <p>{query.data.fullName}</p>
            </div>
            <div>
              <p className="text-xs uppercase tracking-wide text-emerald-300">
                ì†Œê°œ
              </p>
              <p>{query.data.bio ?? 'â€”'}</p>
            </div>
            <div>
              <p className="text-xs uppercase tracking-wide text-emerald-300">
                ì•„ë°”íƒ€
              </p>
              <a
                href={query.data.avatarUrl}
                target="_blank"
                rel="noreferrer"
                className="underline"
              >
                {query.data.avatarUrl}
              </a>
            </div>
            <div>
              <p className="text-xs uppercase tracking-wide text-emerald-300">
                ì—…ë°ì´íŠ¸ ì‹œê°
              </p>
              <p>{query.data.updatedAt}</p>
            </div>
          </div>
        )}
      </article>
    </section>
  );
};
</file>

<file path="src/features/example/hooks/useExampleQuery.ts">
'use client';

import { useQuery } from '@tanstack/react-query';
import { apiClient, extractApiErrorMessage } from '@/lib/remote/api-client';
import { ExampleResponseSchema } from '@/features/example/lib/dto';

const fetchExample = async (id: string) => {
  try {
    const { data } = await apiClient.get(`/api/example/${id}`);
    return ExampleResponseSchema.parse(data);
  } catch (error) {
    const message = extractApiErrorMessage(error, 'Failed to fetch example.');
    throw new Error(message);
  }
};

export const useExampleQuery = (id: string) =>
  useQuery({
    queryKey: ['example', id],
    queryFn: () => fetchExample(id),
    enabled: Boolean(id),
    staleTime: 60 * 1000,
  });
</file>

<file path="src/features/example/lib/dto.test.ts">
import { describe, it, expect } from 'vitest';
import { ExampleResponseSchema } from './dto';

describe('ExampleResponseSchema', () => {
  it('should validate a correct example response', () => {
    const validData = {
      id: '123e4567-e89b-12d3-a456-426614174000',
      fullName: 'Test User',
      avatarUrl: 'https://example.com/avatar.jpg',
      bio: 'This is a test bio',
      updatedAt: '2024-01-01T00:00:00Z',
    };

    const result = ExampleResponseSchema.safeParse(validData);

    expect(result.success).toBe(true);
    if (result.success) {
      expect(result.data).toEqual(validData);
    }
  });

  it('should allow null bio', () => {
    const validData = {
      id: '123e4567-e89b-12d3-a456-426614174000',
      fullName: 'Test User',
      avatarUrl: 'https://example.com/avatar.jpg',
      bio: null,
      updatedAt: '2024-01-01T00:00:00Z',
    };

    const result = ExampleResponseSchema.safeParse(validData);

    expect(result.success).toBe(true);
  });

  it('should reject invalid data structure', () => {
    const invalidData = {
      id: 123, // should be string
      fullName: 'Test User',
    };

    const result = ExampleResponseSchema.safeParse(invalidData);

    expect(result.success).toBe(false);
  });

  it('should reject missing required fields', () => {
    const invalidData = {
      id: 'test-id',
      // missing fullName, avatarUrl, updatedAt
    };

    const result = ExampleResponseSchema.safeParse(invalidData);

    expect(result.success).toBe(false);
  });
});
</file>

<file path="src/features/example/lib/dto.ts">
export {
  ExampleParamsSchema,
  ExampleResponseSchema,
  type ExampleResponse,
} from '@/features/example/backend/schema';
</file>

<file path="src/features/onboarding/actions/complete-onboarding.ts">
"use server";

import { auth, clerkClient } from "@clerk/nextjs/server";
import { revalidatePath } from "next/cache";
import { OnboardingFormData } from "../lib/onboarding-schema";

/**
 * Complete the onboarding process
 * Saves data to Supabase and updates Clerk metadata
 */
export async function completeOnboarding(data: OnboardingFormData) {
  try {
    // Get authenticated user
    const { userId } = await auth();

    if (!userId) {
      throw new Error("Unauthorized");
    }

    // Save onboarding data to Supabase via Hono API
    const apiUrl = `${process.env.NEXT_PUBLIC_APP_URL}/api/style-guides`;
    const response = await fetch(apiUrl, {
      method: "POST",
      headers: {
        "Content-Type": "application/json",
        "x-clerk-user-id": userId,
      },
      body: JSON.stringify(data),
    });

    if (!response.ok) {
      const errorData = await response.json().catch(() => ({}));
      console.error("Failed to save style guide:", errorData);
      throw new Error(
        errorData.error?.message || "ìŠ¤íƒ€ì¼ ê°€ì´ë“œ ì €ì¥ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤"
      );
    }

    const savedData = await response.json();
    console.log("Style guide saved successfully:", savedData);

    // Update Clerk metadata only after successful Supabase save
    const client = await clerkClient();
    await client.users.updateUser(userId, {
      publicMetadata: {
        onboardingCompleted: true,
      },
    });

    console.log("Onboarding completed successfully for user:", userId);

    // Revalidate the dashboard path to ensure fresh middleware checks
    // This is safe because we're not on /auth/onboarding anymore when this runs
    revalidatePath("/dashboard", "page");
    revalidatePath("/", "layout");

    return { success: true, redirectUrl: "/dashboard?welcome=true" };
  } catch (error) {
    console.error("Error completing onboarding:", error);
    throw new Error(
      error instanceof Error
        ? error.message
        : "ì˜¨ë³´ë”© ì™„ë£Œ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤"
    );
  }
}
</file>

<file path="src/features/onboarding/backend/schema.ts">
import { z } from 'zod';
import { onboardingSchema } from '@/features/onboarding/lib/onboarding-schema';

// Request schema - reuses the onboarding form schema
export const CreateStyleGuideRequestSchema = onboardingSchema;

export type CreateStyleGuideRequest = z.infer<typeof CreateStyleGuideRequestSchema>;

// Database row schema (snake_case to match database columns)
export const StyleGuideTableRowSchema = z.object({
  id: z.string().uuid(),
  clerk_user_id: z.string(),
  brand_name: z.string(),
  brand_description: z.string(),
  personality: z.array(z.string()),
  formality: z.enum(['casual', 'neutral', 'formal']),
  target_audience: z.string(),
  pain_points: z.string(),
  language: z.enum(['ko', 'en']),
  tone: z.enum(['professional', 'friendly', 'inspirational', 'educational']),
  content_length: z.enum(['short', 'medium', 'long']),
  reading_level: z.enum(['beginner', 'intermediate', 'advanced']),
  notes: z.string().nullable(),
  is_default: z.boolean(),
  created_at: z.string(),
  updated_at: z.string(),
});

export type StyleGuideRow = z.infer<typeof StyleGuideTableRowSchema>;

// Response schema (camelCase for API responses)
export const StyleGuideResponseSchema = z.object({
  id: z.string().uuid(),
  clerkUserId: z.string(),
  brandName: z.string(),
  brandDescription: z.string(),
  personality: z.array(z.string()),
  formality: z.enum(['casual', 'neutral', 'formal']),
  targetAudience: z.string(),
  painPoints: z.string(),
  language: z.enum(['ko', 'en']),
  tone: z.enum(['professional', 'friendly', 'inspirational', 'educational']),
  contentLength: z.enum(['short', 'medium', 'long']),
  readingLevel: z.enum(['beginner', 'intermediate', 'advanced']),
  notes: z.string().nullable(),
  isDefault: z.boolean(),
  createdAt: z.string(),
  updatedAt: z.string(),
});

export type StyleGuideResponse = z.infer<typeof StyleGuideResponseSchema>;
</file>

<file path="src/features/onboarding/components/onboarding-wizard.tsx">
"use client";

import { useState, useEffect, useCallback } from "react";
import { useForm } from "react-hook-form";
import { zodResolver } from "@hookform/resolvers/zod";
import { Form } from "@/components/ui/form";
import { Button } from "@/components/ui/button";
import {
  Accordion,
  AccordionContent,
  AccordionItem,
  AccordionTrigger,
} from "@/components/ui/accordion";
import { ChevronLeft, ChevronRight } from "lucide-react";
import { StepIndicator } from "./step-indicator";
import { PreviewPanel } from "./preview-panel";
import { StepBrandVoice } from "./step-brand-voice";
import { StepAudience } from "./step-audience";
import { StepLanguage } from "./step-language";
import { StepStyle } from "./step-style";
import { StepReview } from "./step-review";
import {
  onboardingSchema,
  brandVoiceSchema,
  targetAudienceSchema,
  languageSchema,
  styleSchema,
  reviewSchema,
  defaultOnboardingValues,
  type OnboardingFormData,
} from "../lib/onboarding-schema";
import { TOTAL_STEPS } from "../lib/constants";

interface OnboardingWizardProps {
  onComplete: (data: OnboardingFormData) => Promise<void>;
}

export function OnboardingWizard({ onComplete }: OnboardingWizardProps) {
  const [currentStep, setCurrentStep] = useState(1);
  const [isSubmitting, setIsSubmitting] = useState(false);

  const form = useForm<OnboardingFormData>({
    resolver: zodResolver(onboardingSchema),
    defaultValues: defaultOnboardingValues,
    mode: "onChange",
  });

  // Get step-specific schema for validation
  const getStepSchema = (step: number) => {
    switch (step) {
      case 1:
        return brandVoiceSchema;
      case 2:
        return targetAudienceSchema;
      case 3:
        return languageSchema;
      case 4:
        return styleSchema;
      case 5:
        return reviewSchema;
      default:
        return onboardingSchema;
    }
  };

  // Validate current step before proceeding
  const validateCurrentStep = useCallback(async () => {
    const stepSchema = getStepSchema(currentStep);
    const values = form.getValues();

    try {
      await stepSchema.parseAsync(values);
      return true;
    } catch (error) {
      // Trigger validation to show errors
      await form.trigger();
      return false;
    }
  }, [currentStep, form]);

  const handleNext = useCallback(async () => {
    const isValid = await validateCurrentStep();

    if (isValid && currentStep < TOTAL_STEPS) {
      setCurrentStep((prev) => prev + 1);
      // Focus on the top of the form
      window.scrollTo({ top: 0, behavior: "smooth" });

      // Announce step change for screen readers
      const announcement = `Step ${currentStep + 1} of ${TOTAL_STEPS}`;
      announceToScreenReader(announcement);
    }
  }, [currentStep, validateCurrentStep]);

  const handlePrevious = useCallback(() => {
    if (currentStep > 1) {
      setCurrentStep((prev) => prev - 1);
      window.scrollTo({ top: 0, behavior: "smooth" });

      // Announce step change for screen readers
      const announcement = `Step ${currentStep - 1} of ${TOTAL_STEPS}`;
      announceToScreenReader(announcement);
    }
  }, [currentStep]);

  // Helper function to announce to screen readers
  const announceToScreenReader = (message: string) => {
    const announcement = document.createElement("div");
    announcement.setAttribute("role", "status");
    announcement.setAttribute("aria-live", "polite");
    announcement.className = "sr-only";
    announcement.textContent = message;
    document.body.appendChild(announcement);
    setTimeout(() => document.body.removeChild(announcement), 1000);
  };

  const handleSubmit = async (data: OnboardingFormData) => {
    setIsSubmitting(true);
    try {
      await onComplete(data);
    } catch (error) {
      console.error("Onboarding submission error:", error);
      setIsSubmitting(false);
    }
  };

  // Watch form values for preview
  const formValues = form.watch();

  // Keyboard navigation
  useEffect(() => {
    const handleKeyDown = (e: KeyboardEvent) => {
      // Don't handle if user is typing in an input
      if (
        e.target instanceof HTMLInputElement ||
        e.target instanceof HTMLTextAreaElement
      ) {
        return;
      }

      // Alt + Arrow Right: Next step
      if (e.altKey && e.key === "ArrowRight") {
        e.preventDefault();
        handleNext();
      }

      // Alt + Arrow Left: Previous step
      if (e.altKey && e.key === "ArrowLeft") {
        e.preventDefault();
        handlePrevious();
      }
    };

    window.addEventListener("keydown", handleKeyDown);
    return () => window.removeEventListener("keydown", handleKeyDown);
  }, [currentStep, handleNext, handlePrevious]);

  // Render current step component
  const renderStep = () => {
    switch (currentStep) {
      case 1:
        return <StepBrandVoice form={form} />;
      case 2:
        return <StepAudience form={form} />;
      case 3:
        return <StepLanguage form={form} />;
      case 4:
        return <StepStyle form={form} />;
      case 5:
        return <StepReview form={form} />;
      default:
        return null;
    }
  };

  return (
    <div
      className="min-h-screen py-8"
      style={{ backgroundColor: "#FCFCFD" }}
    >
      <div className="container mx-auto max-w-7xl px-4">
        {/* Step Indicator */}
        <div className="mb-8">
          <StepIndicator currentStep={currentStep} />

          {/* Keyboard shortcut hint */}
          <div className="mt-2 text-center">
            <p className="text-xs" style={{ color: "#9CA3AF" }}>
              <kbd className="rounded px-1.5 py-0.5" style={{ backgroundColor: "#F3F4F6", color: "#6B7280", border: "1px solid #E5E7EB" }}>
                Alt
              </kbd>
              {" + "}
              <kbd className="rounded px-1.5 py-0.5" style={{ backgroundColor: "#F3F4F6", color: "#6B7280", border: "1px solid #E5E7EB" }}>
                â† / â†’
              </kbd>
              {" "}
              í‚¤ë¡œ ì´ë™ ê°€ëŠ¥
            </p>
          </div>
        </div>

        <Form {...form}>
          <form
            onSubmit={(e) => {
              // Prevent default form submission - we handle it manually
              e.preventDefault();
            }}
            onKeyDown={(e) => {
              // Prevent Enter key from submitting the form
              if (e.key === "Enter" && e.target instanceof HTMLElement) {
                // Allow Enter in textarea for new lines
                if (e.target.tagName !== "TEXTAREA") {
                  e.preventDefault();
                }
              }
            }}
          >
            {/* Desktop: 2-column layout */}
            <div className="hidden lg:grid lg:grid-cols-[1fr,400px] lg:gap-8">
              {/* Left: Form */}
              <div
                className="rounded-lg border p-6"
                style={{
                  backgroundColor: "#FFFFFF",
                  borderColor: "#E1E5EA",
                  borderRadius: "12px",
                }}
              >
                {renderStep()}

                {/* Navigation Buttons */}
                <div className="mt-8 flex items-center justify-between border-t pt-6">
                  <Button
                    type="button"
                    variant="outline"
                    onClick={handlePrevious}
                    disabled={currentStep === 1}
                    className="h-10"
                    style={{
                      borderColor: "#E1E5EA",
                      borderRadius: "8px",
                    }}
                  >
                    <ChevronLeft className="mr-2 h-4 w-4" />
                    ì´ì „
                  </Button>

                  {currentStep < TOTAL_STEPS ? (
                    <Button
                      type="button"
                      onClick={handleNext}
                      className="h-10"
                      style={{
                        backgroundColor: "#3BA2F8",
                        borderRadius: "8px",
                      }}
                    >
                      ë‹¤ìŒ
                      <ChevronRight className="ml-2 h-4 w-4" />
                    </Button>
                  ) : (
                    <Button
                      type="button"
                      onClick={async () => {
                        const isValid = await validateCurrentStep();
                        if (isValid) {
                          const formData = form.getValues();
                          await handleSubmit(formData);
                        }
                      }}
                      disabled={isSubmitting}
                      className="h-10"
                      style={{
                        backgroundColor: "#10B981",
                        borderRadius: "8px",
                      }}
                    >
                      {isSubmitting ? "ì²˜ë¦¬ ì¤‘..." : "ì™„ë£Œ"}
                    </Button>
                  )}
                </div>
              </div>

              {/* Right: Preview Panel (sticky) */}
              <div>
                <PreviewPanel formData={formValues} />
              </div>
            </div>

            {/* Mobile/Tablet: Single column with accordion preview */}
            <div className="lg:hidden">
              <div
                className="rounded-lg border p-6"
                style={{
                  backgroundColor: "#FFFFFF",
                  borderColor: "#E1E5EA",
                  borderRadius: "12px",
                }}
              >
                {renderStep()}

                {/* Mobile Preview - Accordion */}
                <div className="mt-6">
                  <Accordion type="single" collapsible>
                    <AccordionItem
                      value="preview"
                      style={{ borderColor: "#E1E5EA" }}
                    >
                      <AccordionTrigger
                        className="text-sm font-medium"
                        style={{ color: "#374151" }}
                      >
                        ë¯¸ë¦¬ë³´ê¸°
                      </AccordionTrigger>
                      <AccordionContent>
                        <div className="pt-2">
                          <PreviewPanel formData={formValues} />
                        </div>
                      </AccordionContent>
                    </AccordionItem>
                  </Accordion>
                </div>

                {/* Navigation Buttons */}
                <div className="mt-8 flex items-center justify-between border-t pt-6">
                  <Button
                    type="button"
                    variant="outline"
                    onClick={handlePrevious}
                    disabled={currentStep === 1}
                    className="h-12 flex-1 sm:h-10 sm:flex-initial"
                    style={{
                      borderColor: "#E1E5EA",
                      borderRadius: "8px",
                    }}
                  >
                    <ChevronLeft className="mr-2 h-4 w-4" />
                    ì´ì „
                  </Button>

                  {currentStep < TOTAL_STEPS ? (
                    <Button
                      type="button"
                      onClick={handleNext}
                      className="ml-4 h-12 flex-1 sm:h-10 sm:flex-initial"
                      style={{
                        backgroundColor: "#3BA2F8",
                        borderRadius: "8px",
                      }}
                    >
                      ë‹¤ìŒ
                      <ChevronRight className="ml-2 h-4 w-4" />
                    </Button>
                  ) : (
                    <Button
                      type="button"
                      onClick={async () => {
                        const isValid = await validateCurrentStep();
                        if (isValid) {
                          const formData = form.getValues();
                          await handleSubmit(formData);
                        }
                      }}
                      disabled={isSubmitting}
                      className="ml-4 h-12 flex-1 sm:h-10 sm:flex-initial"
                      style={{
                        backgroundColor: "#10B981",
                        borderRadius: "8px",
                      }}
                    >
                      {isSubmitting ? "ì²˜ë¦¬ ì¤‘..." : "ì™„ë£Œ"}
                    </Button>
                  )}
                </div>
              </div>
            </div>
          </form>
        </Form>
      </div>
    </div>
  );
}
</file>

<file path="src/features/onboarding/components/preview-panel.tsx">
"use client";

import { Card } from "@/components/ui/card";
import { OnboardingFormData } from "../lib/onboarding-schema";
import {
  PERSONALITY_OPTIONS,
  PREVIEW_TEMPLATES,
  TONE_OPTIONS,
  CONTENT_LENGTH_OPTIONS,
  READING_LEVEL_OPTIONS,
} from "../lib/constants";

interface PreviewPanelProps {
  formData: Partial<OnboardingFormData>;
}

export function PreviewPanel({ formData }: PreviewPanelProps) {
  const {
    brandName,
    personality,
    formality,
    targetAudience,
    language,
    tone,
    contentLength,
    readingLevel,
  } = formData;

  // Generate preview text
  const generatePreviewText = () => {
    if (!brandName || !personality || !formality || !targetAudience) {
      return language === "ko"
        ? "ë¸Œëœë“œ ì •ë³´ë¥¼ ì…ë ¥í•˜ë©´ ì—¬ê¸°ì— ë¯¸ë¦¬ë³´ê¸°ê°€ í‘œì‹œë©ë‹ˆë‹¤."
        : "Fill in your brand information to see a preview here.";
    }

    const template =
      PREVIEW_TEMPLATES[language || "ko"][formality || "neutral"];

    // Get personality label
    const personalityLabel = personality
      .map(
        (p) =>
          PERSONALITY_OPTIONS.find((opt) => opt.value === p)?.label || p
      )
      .join(", ");

    return template
      .replace("{brandName}", brandName)
      .replace("{personality}", personalityLabel)
      .replace("{targetAudience}", targetAudience);
  };

  const toneLabel = TONE_OPTIONS.find((t) => t.value === tone)?.label;
  const lengthLabel = CONTENT_LENGTH_OPTIONS.find(
    (l) => l.value === contentLength
  )?.label;
  const levelLabel = READING_LEVEL_OPTIONS.find(
    (r) => r.value === readingLevel
  )?.label;

  return (
    <Card
      className="sticky top-6 h-fit p-6"
      style={{
        backgroundColor: "#FFFFFF",
        borderColor: "#E1E5EA",
        borderRadius: "12px",
      }}
    >
      <div className="space-y-4">
        <div>
          <h3
            className="text-lg font-semibold"
            style={{ color: "#111827" }}
          >
            ë¯¸ë¦¬ë³´ê¸°
          </h3>
          <p className="text-sm" style={{ color: "#6B7280" }}>
            ì„¤ì •ì— ë”°ë¥¸ ì½˜í…ì¸  ìŠ¤íƒ€ì¼
          </p>
        </div>

        <div
          className="rounded-lg p-4"
          style={{
            backgroundColor: "#F5F7FA",
            borderLeft: "4px solid #3BA2F8",
          }}
        >
          <p
            className="leading-relaxed"
            style={{
              color: "#374151",
              fontSize: "15px",
              lineHeight: "1.7",
            }}
          >
            {generatePreviewText()}
          </p>
        </div>

        {/* Settings summary */}
        <div className="space-y-3 pt-4">
          <h4
            className="text-sm font-medium"
            style={{ color: "#374151" }}
          >
            ì„¤ì • ìš”ì•½
          </h4>

          <div className="space-y-2">
            {brandName && (
              <div className="flex items-center justify-between text-sm">
                <span style={{ color: "#6B7280" }}>ë¸Œëœë“œ</span>
                <span
                  className="font-medium"
                  style={{ color: "#111827" }}
                >
                  {brandName}
                </span>
              </div>
            )}

            {language && (
              <div className="flex items-center justify-between text-sm">
                <span style={{ color: "#6B7280" }}>ì–¸ì–´</span>
                <span
                  className="font-medium"
                  style={{ color: "#111827" }}
                >
                  {language === "ko" ? "í•œêµ­ì–´" : "English"}
                </span>
              </div>
            )}

            {tone && (
              <div className="flex items-center justify-between text-sm">
                <span style={{ color: "#6B7280" }}>í†¤</span>
                <span
                  className="font-medium"
                  style={{ color: "#111827" }}
                >
                  {toneLabel}
                </span>
              </div>
            )}

            {contentLength && (
              <div className="flex items-center justify-between text-sm">
                <span style={{ color: "#6B7280" }}>ê¸¸ì´</span>
                <span
                  className="font-medium"
                  style={{ color: "#111827" }}
                >
                  {lengthLabel}
                </span>
              </div>
            )}

            {readingLevel && (
              <div className="flex items-center justify-between text-sm">
                <span style={{ color: "#6B7280" }}>ìˆ˜ì¤€</span>
                <span
                  className="font-medium"
                  style={{ color: "#111827" }}
                >
                  {levelLabel}
                </span>
              </div>
            )}
          </div>
        </div>
      </div>
    </Card>
  );
}
</file>

<file path="src/features/onboarding/components/step-audience.tsx">
"use client";

import { UseFormReturn } from "react-hook-form";
import {
  FormField,
  FormItem,
  FormLabel,
  FormControl,
  FormMessage,
  FormDescription,
} from "@/components/ui/form";
import { Textarea } from "@/components/ui/textarea";
import { OnboardingFormData } from "../lib/onboarding-schema";

interface StepAudienceProps {
  form: UseFormReturn<OnboardingFormData>;
}

export function StepAudience({ form }: StepAudienceProps) {
  return (
    <div className="space-y-6">
      <div>
        <h2
          className="text-2xl font-semibold"
          style={{ color: "#111827" }}
        >
          íƒ€ê²Ÿ ë…ì ì •ì˜
        </h2>
        <p className="mt-2 text-sm" style={{ color: "#6B7280" }}>
          ì–´ë–¤ ë…ìë¥¼ ìœ„í•œ ì½˜í…ì¸ ì¸ì§€ ì•Œë ¤ì£¼ì„¸ìš”
        </p>
      </div>

      {/* Target Audience */}
      <FormField
        control={form.control}
        name="targetAudience"
        render={({ field }) => (
          <FormItem>
            <FormLabel>íƒ€ê²Ÿ ë…ì</FormLabel>
            <FormControl>
              <Textarea
                placeholder="ì˜ˆ: ìŠ¤íƒ€íŠ¸ì—… ì°½ì—…ì, í”„ë¦¬ëœì„œ ê°œë°œì, ë§ˆì¼€íŒ… ë‹´ë‹¹ì ë“±&#10;&#10;ë…ìì˜ íŠ¹ì„±, ê´€ì‹¬ì‚¬, ì§ì—… ë“±ì„ ìì„¸íˆ ì„¤ëª…í•´ì£¼ì„¸ìš”"
                {...field}
                className="min-h-[150px] resize-y"
                style={{
                  borderColor: "#E1E5EA",
                  borderRadius: "6px",
                }}
              />
            </FormControl>
            <FormDescription>
              íƒ€ê²Ÿ ë…ìì˜ íŠ¹ì„±ì„ êµ¬ì²´ì ìœ¼ë¡œ ì„¤ëª…í• ìˆ˜ë¡ ë” ë§ì¶¤í™”ëœ ì½˜í…ì¸ ë¥¼ ìƒì„±í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤
            </FormDescription>
            <FormMessage />
          </FormItem>
        )}
      />

      {/* Pain Points */}
      <FormField
        control={form.control}
        name="painPoints"
        render={({ field }) => (
          <FormItem>
            <FormLabel>í•´ê²°í•˜ë ¤ëŠ” ë¬¸ì œ</FormLabel>
            <FormControl>
              <Textarea
                placeholder="ì˜ˆ: ì‹œê°„ ë¶€ì¡±, ì½˜í…ì¸  ì‘ì„±ì˜ ì–´ë ¤ì›€, ì¼ê´€ì„± ìœ ì§€ ë“±&#10;&#10;ë…ìë“¤ì´ ê²ªê³  ìˆëŠ” ë¬¸ì œë‚˜ ë‹ˆì¦ˆë¥¼ ì„¤ëª…í•´ì£¼ì„¸ìš”"
                {...field}
                className="min-h-[150px] resize-y"
                style={{
                  borderColor: "#E1E5EA",
                  borderRadius: "6px",
                }}
              />
            </FormControl>
            <FormDescription>
              ë…ìê°€ í•´ê²°í•˜ê³  ì‹¶ì–´í•˜ëŠ” ë¬¸ì œë‚˜ ë‹¬ì„±í•˜ê³  ì‹¶ì€ ëª©í‘œë¥¼ ì„¤ëª…í•´ì£¼ì„¸ìš”
            </FormDescription>
            <FormMessage />
          </FormItem>
        )}
      />

      <div
        className="rounded-lg p-4"
        style={{
          backgroundColor: "#F5F7FA",
          borderLeft: "4px solid #3BA2F8",
        }}
      >
        <p className="text-sm font-medium" style={{ color: "#111827" }}>
          ğŸ’¡ íŒ
        </p>
        <p className="mt-2 text-sm" style={{ color: "#6B7280" }}>
          íƒ€ê²Ÿ ë…ìë¥¼ êµ¬ì²´ì ìœ¼ë¡œ ì •ì˜í• ìˆ˜ë¡ ë” íš¨ê³¼ì ì¸ ì½˜í…ì¸ ë¥¼ ë§Œë“¤ ìˆ˜ ìˆìŠµë‹ˆë‹¤.
          ì¸êµ¬í†µê³„í•™ì  ì •ë³´(ë‚˜ì´, ì§ì—…)ì™€ ì‹¬ë¦¬í•™ì  ì •ë³´(ê´€ì‹¬ì‚¬, ê°€ì¹˜ê´€)ë¥¼ ëª¨ë‘
          ê³ ë ¤í•´ë³´ì„¸ìš”.
        </p>
      </div>
    </div>
  );
}
</file>

<file path="src/features/onboarding/components/step-brand-voice.tsx">
"use client";

import { UseFormReturn } from "react-hook-form";
import {
  FormField,
  FormItem,
  FormLabel,
  FormControl,
  FormMessage,
  FormDescription,
} from "@/components/ui/form";
import { Input } from "@/components/ui/input";
import { Textarea } from "@/components/ui/textarea";
import { Checkbox } from "@/components/ui/checkbox";
import { Label } from "@/components/ui/label";
import { OnboardingFormData } from "../lib/onboarding-schema";
import { PERSONALITY_OPTIONS, FORMALITY_OPTIONS } from "../lib/constants";

interface StepBrandVoiceProps {
  form: UseFormReturn<OnboardingFormData>;
}

export function StepBrandVoice({ form }: StepBrandVoiceProps) {
  return (
    <div className="space-y-6">
      <div>
        <h2
          className="text-2xl font-semibold"
          style={{ color: "#111827" }}
        >
          ë¸Œëœë“œ ë³´ì´ìŠ¤ ì„¤ì •
        </h2>
        <p className="mt-2 text-sm" style={{ color: "#6B7280" }}>
          ë¸Œëœë“œì˜ ê°œì„±ê³¼ ëª©ì†Œë¦¬ë¥¼ ì •ì˜í•´ì£¼ì„¸ìš”
        </p>
      </div>

      {/* Brand Name */}
      <FormField
        control={form.control}
        name="brandName"
        render={({ field }) => (
          <FormItem>
            <FormLabel>ë¸Œëœë“œ ì´ë¦„</FormLabel>
            <FormControl>
              <Input
                placeholder="ì˜ˆ: ContentCraft AI"
                {...field}
                className="h-10"
                style={{
                  borderColor: "#E1E5EA",
                  borderRadius: "6px",
                }}
              />
            </FormControl>
            <FormMessage />
          </FormItem>
        )}
      />

      {/* Brand Description */}
      <FormField
        control={form.control}
        name="brandDescription"
        render={({ field }) => (
          <FormItem>
            <FormLabel>ë¸Œëœë“œ ì„¤ëª…</FormLabel>
            <FormControl>
              <Textarea
                placeholder="ë¸Œëœë“œê°€ ë¬´ì—‡ì„ í•˜ëŠ”ì§€, ì–´ë–¤ ê°€ì¹˜ë¥¼ ì œê³µí•˜ëŠ”ì§€ ì„¤ëª…í•´ì£¼ì„¸ìš”"
                {...field}
                className="min-h-[120px] resize-y"
                style={{
                  borderColor: "#E1E5EA",
                  borderRadius: "6px",
                }}
              />
            </FormControl>
            <FormDescription>
              ìµœì†Œ 10ì ì´ìƒ ì…ë ¥í•´ì£¼ì„¸ìš”
            </FormDescription>
            <FormMessage />
          </FormItem>
        )}
      />

      {/* Personality */}
      <FormField
        control={form.control}
        name="personality"
        render={() => (
          <FormItem>
            <div className="mb-4">
              <FormLabel>ë¸Œëœë“œ ì„±ê²© (ìµœëŒ€ 3ê°œ)</FormLabel>
              <FormDescription>
                ë¸Œëœë“œì˜ ê°œì„±ì„ ê°€ì¥ ì˜ ë‚˜íƒ€ë‚´ëŠ” ë‹¨ì–´ë¥¼ ì„ íƒí•˜ì„¸ìš”
              </FormDescription>
            </div>
            <div className="grid grid-cols-2 gap-3 sm:grid-cols-3">
              {PERSONALITY_OPTIONS.map((option) => (
                <FormField
                  key={option.value}
                  control={form.control}
                  name="personality"
                  render={({ field }) => {
                    return (
                      <FormItem
                        key={option.value}
                        className="flex flex-row items-start space-x-3 space-y-0"
                      >
                        <FormControl>
                          <Checkbox
                            checked={field.value?.includes(option.value)}
                            onCheckedChange={(checked) => {
                              const currentValue = field.value || [];
                              const newValue = checked
                                ? [...currentValue, option.value]
                                : currentValue.filter(
                                    (value) => value !== option.value
                                  );
                              // Limit to 3 selections
                              if (newValue.length <= 3) {
                                field.onChange(newValue);
                              }
                            }}
                          />
                        </FormControl>
                        <Label
                          className="cursor-pointer font-normal"
                          style={{ color: "#374151" }}
                        >
                          {option.label}
                        </Label>
                      </FormItem>
                    );
                  }}
                />
              ))}
            </div>
            <FormMessage />
          </FormItem>
        )}
      />

      {/* Formality */}
      <FormField
        control={form.control}
        name="formality"
        render={({ field }) => (
          <FormItem>
            <FormLabel>ê²©ì‹ ìˆ˜ì¤€</FormLabel>
            <FormDescription>
              ë¸Œëœë“œ ì»¤ë®¤ë‹ˆì¼€ì´ì…˜ì˜ ê²©ì‹ ìˆ˜ì¤€ì„ ì„ íƒí•˜ì„¸ìš”
            </FormDescription>
            <div className="space-y-3">
              {FORMALITY_OPTIONS.map((option) => (
                <div
                  key={option.value}
                  className="flex items-start space-x-3"
                >
                  <FormControl>
                    <input
                      type="radio"
                      value={option.value}
                      checked={field.value === option.value}
                      onChange={() => field.onChange(option.value)}
                      className="mt-1 h-4 w-4 cursor-pointer"
                      style={{
                        accentColor: "#3BA2F8",
                      }}
                    />
                  </FormControl>
                  <div className="flex-1">
                    <Label
                      className="cursor-pointer font-medium"
                      style={{ color: "#111827" }}
                    >
                      {option.label}
                    </Label>
                    <p className="text-sm" style={{ color: "#6B7280" }}>
                      {option.description}
                    </p>
                  </div>
                </div>
              ))}
            </div>
            <FormMessage />
          </FormItem>
        )}
      />
    </div>
  );
}
</file>

<file path="src/features/onboarding/components/step-indicator.tsx">
"use client";

import { Progress } from "@/components/ui/progress";
import { STEP_NAMES, TOTAL_STEPS } from "../lib/constants";

interface StepIndicatorProps {
  currentStep: number;
}

export function StepIndicator({ currentStep }: StepIndicatorProps) {
  const progressPercentage = (currentStep / TOTAL_STEPS) * 100;

  return (
    <div className="w-full space-y-4">
      {/* Progress bar */}
      <div className="space-y-2">
        <div className="flex items-center justify-between text-sm">
          <span className="font-medium" style={{ color: "#374151" }}>
            {STEP_NAMES[currentStep - 1]}
          </span>
          <span className="text-sm" style={{ color: "#6B7280" }}>
            {currentStep} / {TOTAL_STEPS}
          </span>
        </div>
        <Progress
          value={progressPercentage}
          className="h-2"
          style={{
            backgroundColor: "#E1E5EA",
          }}
          aria-label={`ì§„í–‰ë¥ : ${Math.round(progressPercentage)}%`}
        />
      </div>

      {/* Step dots */}
      <div className="flex items-center justify-between">
        {Array.from({ length: TOTAL_STEPS }, (_, index) => {
          const stepNumber = index + 1;
          const isCompleted = stepNumber < currentStep;
          const isCurrent = stepNumber === currentStep;

          return (
            <div
              key={stepNumber}
              className="flex flex-col items-center gap-2"
            >
              <div
                className="flex h-8 w-8 items-center justify-center rounded-full text-xs font-medium transition-colors"
                style={{
                  backgroundColor: isCompleted || isCurrent ? "#3BA2F8" : "#E1E5EA",
                  color: isCompleted || isCurrent ? "#FFFFFF" : "#6B7280",
                }}
                aria-current={isCurrent ? "step" : undefined}
                aria-label={`Step ${stepNumber}: ${STEP_NAMES[index]}`}
              >
                {stepNumber}
              </div>
              <span
                className="hidden text-xs sm:block"
                style={{
                  color: isCurrent ? "#111827" : "#6B7280",
                  fontWeight: isCurrent ? 500 : 400,
                }}
              >
                {STEP_NAMES[index]}
              </span>
            </div>
          );
        })}
      </div>
    </div>
  );
}
</file>

<file path="src/features/onboarding/components/step-language.tsx">
"use client";

import { UseFormReturn } from "react-hook-form";
import {
  FormField,
  FormItem,
  FormLabel,
  FormControl,
  FormMessage,
  FormDescription,
} from "@/components/ui/form";
import { Label } from "@/components/ui/label";
import { OnboardingFormData } from "../lib/onboarding-schema";
import { LANGUAGE_OPTIONS } from "../lib/constants";

interface StepLanguageProps {
  form: UseFormReturn<OnboardingFormData>;
}

export function StepLanguage({ form }: StepLanguageProps) {
  return (
    <div className="space-y-6">
      <div>
        <h2
          className="text-2xl font-semibold"
          style={{ color: "#111827" }}
        >
          ì–¸ì–´ ì„¤ì •
        </h2>
        <p className="mt-2 text-sm" style={{ color: "#6B7280" }}>
          ì£¼ë¡œ ì‚¬ìš©í•  ì–¸ì–´ë¥¼ ì„ íƒí•´ì£¼ì„¸ìš”
        </p>
      </div>

      {/* Language Selection */}
      <FormField
        control={form.control}
        name="language"
        render={({ field }) => (
          <FormItem>
            <FormLabel>ì½˜í…ì¸  ì–¸ì–´</FormLabel>
            <FormDescription>
              ìƒì„±ë  ì½˜í…ì¸ ì˜ ê¸°ë³¸ ì–¸ì–´ë¥¼ ì„ íƒí•˜ì„¸ìš”
            </FormDescription>
            <div className="grid gap-4 sm:grid-cols-2">
              {LANGUAGE_OPTIONS.map((option) => (
                <div
                  key={option.value}
                  onClick={() => field.onChange(option.value)}
                  className="group relative cursor-pointer rounded-lg border-2 p-6 transition-all hover:shadow-md"
                  style={{
                    borderColor:
                      field.value === option.value ? "#3BA2F8" : "#E1E5EA",
                    backgroundColor:
                      field.value === option.value ? "#F0F9FF" : "#FFFFFF",
                  }}
                  role="radio"
                  aria-checked={field.value === option.value}
                  tabIndex={0}
                  onKeyDown={(e) => {
                    if (e.key === "Enter" || e.key === " ") {
                      e.preventDefault();
                      field.onChange(option.value);
                    }
                  }}
                >
                  <FormControl>
                    <input
                      type="radio"
                      value={option.value}
                      checked={field.value === option.value}
                      onChange={() => field.onChange(option.value)}
                      className="absolute left-4 top-4 h-4 w-4 cursor-pointer"
                      style={{
                        accentColor: "#3BA2F8",
                      }}
                    />
                  </FormControl>
                  <div className="ml-6">
                    <Label
                      className="cursor-pointer text-lg font-semibold"
                      style={{
                        color:
                          field.value === option.value ? "#1E2A38" : "#111827",
                      }}
                    >
                      {option.label}
                    </Label>
                    <p
                      className="mt-1 text-sm"
                      style={{ color: "#6B7280" }}
                    >
                      {option.description}
                    </p>
                  </div>
                </div>
              ))}
            </div>
            <FormMessage />
          </FormItem>
        )}
      />

      <div
        className="rounded-lg p-4"
        style={{
          backgroundColor: "#F5F7FA",
          borderLeft: "4px solid #3BA2F8",
        }}
      >
        <p className="text-sm font-medium" style={{ color: "#111827" }}>
          ğŸ’¡ íŒ
        </p>
        <p className="mt-2 text-sm" style={{ color: "#6B7280" }}>
          ê¸°ë³¸ ì–¸ì–´ë¥¼ ì„¤ì •í•œ í›„ì—ë„ ì½˜í…ì¸  ìƒì„± ì‹œ ë‹¤ë¥¸ ì–¸ì–´ë¥¼ ì„ íƒí•  ìˆ˜
          ìˆìŠµë‹ˆë‹¤. ì´ ì„¤ì •ì€ ê¸°ë³¸ê°’ìœ¼ë¡œë§Œ ì‚¬ìš©ë©ë‹ˆë‹¤.
        </p>
      </div>
    </div>
  );
}
</file>

<file path="src/features/onboarding/components/step-review.tsx">
"use client";

import { UseFormReturn } from "react-hook-form";
import {
  FormField,
  FormItem,
  FormLabel,
  FormControl,
  FormMessage,
  FormDescription,
} from "@/components/ui/form";
import { Textarea } from "@/components/ui/textarea";
import { OnboardingFormData } from "../lib/onboarding-schema";
import {
  PERSONALITY_OPTIONS,
  FORMALITY_OPTIONS,
  TONE_OPTIONS,
  CONTENT_LENGTH_OPTIONS,
  READING_LEVEL_OPTIONS,
} from "../lib/constants";

interface StepReviewProps {
  form: UseFormReturn<OnboardingFormData>;
}

export function StepReview({ form }: StepReviewProps) {
  const formValues = form.getValues();

  const getPersonalityLabels = () => {
    return formValues.personality
      .map(
        (p) =>
          PERSONALITY_OPTIONS.find((opt) => opt.value === p)?.label || p
      )
      .join(", ");
  };

  const getFormalityLabel = () => {
    return (
      FORMALITY_OPTIONS.find((opt) => opt.value === formValues.formality)
        ?.label || formValues.formality
    );
  };

  const getToneLabel = () => {
    return (
      TONE_OPTIONS.find((opt) => opt.value === formValues.tone)?.label ||
      formValues.tone
    );
  };

  const getLengthLabel = () => {
    return (
      CONTENT_LENGTH_OPTIONS.find(
        (opt) => opt.value === formValues.contentLength
      )?.label || formValues.contentLength
    );
  };

  const getLevelLabel = () => {
    return (
      READING_LEVEL_OPTIONS.find(
        (opt) => opt.value === formValues.readingLevel
      )?.label || formValues.readingLevel
    );
  };

  return (
    <div className="space-y-6">
      <div>
        <h2
          className="text-2xl font-semibold"
          style={{ color: "#111827" }}
        >
          ìµœì¢… ê²€í† 
        </h2>
        <p className="mt-2 text-sm" style={{ color: "#6B7280" }}>
          ì„¤ì •ì„ ê²€í† í•˜ê³  ì™„ë£Œí•´ì£¼ì„¸ìš”
        </p>
      </div>

      {/* Summary Cards */}
      <div className="space-y-4">
        {/* Brand Voice Summary */}
        <div
          className="rounded-lg border p-4"
          style={{
            backgroundColor: "#FFFFFF",
            borderColor: "#E1E5EA",
          }}
        >
          <h3
            className="mb-3 font-semibold"
            style={{ color: "#111827" }}
          >
            ë¸Œëœë“œ ë³´ì´ìŠ¤
          </h3>
          <dl className="space-y-2">
            <div className="flex justify-between text-sm">
              <dt style={{ color: "#6B7280" }}>ë¸Œëœë“œ ì´ë¦„</dt>
              <dd
                className="font-medium"
                style={{ color: "#111827" }}
              >
                {formValues.brandName}
              </dd>
            </div>
            <div className="text-sm">
              <dt className="mb-1" style={{ color: "#6B7280" }}>
                ì„¤ëª…
              </dt>
              <dd style={{ color: "#111827" }}>
                {formValues.brandDescription}
              </dd>
            </div>
            <div className="flex justify-between text-sm">
              <dt style={{ color: "#6B7280" }}>ì„±ê²©</dt>
              <dd
                className="font-medium"
                style={{ color: "#111827" }}
              >
                {getPersonalityLabels()}
              </dd>
            </div>
            <div className="flex justify-between text-sm">
              <dt style={{ color: "#6B7280" }}>ê²©ì‹</dt>
              <dd
                className="font-medium"
                style={{ color: "#111827" }}
              >
                {getFormalityLabel()}
              </dd>
            </div>
          </dl>
        </div>

        {/* Audience Summary */}
        <div
          className="rounded-lg border p-4"
          style={{
            backgroundColor: "#FFFFFF",
            borderColor: "#E1E5EA",
          }}
        >
          <h3
            className="mb-3 font-semibold"
            style={{ color: "#111827" }}
          >
            íƒ€ê²Ÿ ë…ì
          </h3>
          <dl className="space-y-2">
            <div className="text-sm">
              <dt className="mb-1" style={{ color: "#6B7280" }}>
                íƒ€ê²Ÿ ë…ì
              </dt>
              <dd style={{ color: "#111827" }}>
                {formValues.targetAudience}
              </dd>
            </div>
            <div className="text-sm">
              <dt className="mb-1" style={{ color: "#6B7280" }}>
                í•´ê²°í•˜ë ¤ëŠ” ë¬¸ì œ
              </dt>
              <dd style={{ color: "#111827" }}>{formValues.painPoints}</dd>
            </div>
          </dl>
        </div>

        {/* Settings Summary */}
        <div
          className="rounded-lg border p-4"
          style={{
            backgroundColor: "#FFFFFF",
            borderColor: "#E1E5EA",
          }}
        >
          <h3
            className="mb-3 font-semibold"
            style={{ color: "#111827" }}
          >
            ì½˜í…ì¸  ì„¤ì •
          </h3>
          <dl className="space-y-2">
            <div className="flex justify-between text-sm">
              <dt style={{ color: "#6B7280" }}>ì–¸ì–´</dt>
              <dd
                className="font-medium"
                style={{ color: "#111827" }}
              >
                {formValues.language === "ko" ? "í•œêµ­ì–´" : "English"}
              </dd>
            </div>
            <div className="flex justify-between text-sm">
              <dt style={{ color: "#6B7280" }}>í†¤</dt>
              <dd
                className="font-medium"
                style={{ color: "#111827" }}
              >
                {getToneLabel()}
              </dd>
            </div>
            <div className="flex justify-between text-sm">
              <dt style={{ color: "#6B7280" }}>ê¸¸ì´</dt>
              <dd
                className="font-medium"
                style={{ color: "#111827" }}
              >
                {getLengthLabel()}
              </dd>
            </div>
            <div className="flex justify-between text-sm">
              <dt style={{ color: "#6B7280" }}>ì½ê¸° ìˆ˜ì¤€</dt>
              <dd
                className="font-medium"
                style={{ color: "#111827" }}
              >
                {getLevelLabel()}
              </dd>
            </div>
          </dl>
        </div>
      </div>

      {/* Optional Notes */}
      <FormField
        control={form.control}
        name="notes"
        render={({ field }) => (
          <FormItem>
            <FormLabel>ì¶”ê°€ ë©”ëª¨ (ì„ íƒì‚¬í•­)</FormLabel>
            <FormControl>
              <Textarea
                placeholder="ì¶”ê°€ë¡œ ê¸°ì–µí•˜ê³  ì‹¶ì€ ë‚´ìš©ì´ë‚˜ íŠ¹ë³„í•œ ìš”êµ¬ì‚¬í•­ì„ ì…ë ¥í•˜ì„¸ìš”"
                {...field}
                className="min-h-[100px] resize-y"
                style={{
                  borderColor: "#E1E5EA",
                  borderRadius: "6px",
                }}
              />
            </FormControl>
            <FormDescription>
              ì´ ë©”ëª¨ëŠ” í–¥í›„ ì°¸ê³ ìš©ìœ¼ë¡œ ì €ì¥ë©ë‹ˆë‹¤
            </FormDescription>
            <FormMessage />
          </FormItem>
        )}
      />

      <div
        className="rounded-lg p-4"
        style={{
          backgroundColor: "#F0F9FF",
          borderLeft: "4px solid #3BA2F8",
        }}
      >
        <p className="text-sm font-medium" style={{ color: "#111827" }}>
          ì¤€ë¹„ ì™„ë£Œ!
        </p>
        <p className="mt-2 text-sm" style={{ color: "#374151" }}>
          ëª¨ë“  ì„¤ì •ì´ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤. "ì™„ë£Œ" ë²„íŠ¼ì„ í´ë¦­í•˜ë©´ ëŒ€ì‹œë³´ë“œë¡œ
          ì´ë™í•˜ì—¬ ì½˜í…ì¸  ìƒì„±ì„ ì‹œì‘í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
        </p>
      </div>
    </div>
  );
}
</file>

<file path="src/features/onboarding/components/step-style.tsx">
"use client";

import { UseFormReturn } from "react-hook-form";
import {
  FormField,
  FormItem,
  FormLabel,
  FormControl,
  FormMessage,
  FormDescription,
} from "@/components/ui/form";
import {
  Select,
  SelectContent,
  SelectItem,
  SelectTrigger,
  SelectValue,
} from "@/components/ui/select";
import { OnboardingFormData } from "../lib/onboarding-schema";
import {
  TONE_OPTIONS,
  CONTENT_LENGTH_OPTIONS,
  READING_LEVEL_OPTIONS,
} from "../lib/constants";

interface StepStyleProps {
  form: UseFormReturn<OnboardingFormData>;
}

export function StepStyle({ form }: StepStyleProps) {
  return (
    <div className="space-y-6">
      <div>
        <h2
          className="text-2xl font-semibold"
          style={{ color: "#111827" }}
        >
          ìŠ¤íƒ€ì¼ ì„¤ì •
        </h2>
        <p className="mt-2 text-sm" style={{ color: "#6B7280" }}>
          ì½˜í…ì¸ ì˜ í†¤ê³¼ ê¸¸ì´ë¥¼ ì„¤ì •í•´ì£¼ì„¸ìš”
        </p>
      </div>

      {/* Tone */}
      <FormField
        control={form.control}
        name="tone"
        render={({ field }) => (
          <FormItem>
            <FormLabel>ì½˜í…ì¸  í†¤</FormLabel>
            <Select onValueChange={field.onChange} defaultValue={field.value}>
              <FormControl>
                <SelectTrigger
                  className="h-10"
                  style={{
                    borderColor: "#E1E5EA",
                    borderRadius: "6px",
                  }}
                >
                  <SelectValue placeholder="í†¤ì„ ì„ íƒí•˜ì„¸ìš”" />
                </SelectTrigger>
              </FormControl>
              <SelectContent>
                {TONE_OPTIONS.map((option) => (
                  <SelectItem key={option.value} value={option.value}>
                    <div className="flex flex-col">
                      <span className="font-medium">{option.label}</span>
                      <span
                        className="text-xs"
                        style={{ color: "#6B7280" }}
                      >
                        {option.description}
                      </span>
                    </div>
                  </SelectItem>
                ))}
              </SelectContent>
            </Select>
            <FormDescription>
              ì½˜í…ì¸ ì˜ ì „ë°˜ì ì¸ ë¶„ìœ„ê¸°ì™€ ì–´ì¡°ë¥¼ ê²°ì •í•©ë‹ˆë‹¤
            </FormDescription>
            <FormMessage />
          </FormItem>
        )}
      />

      {/* Content Length */}
      <FormField
        control={form.control}
        name="contentLength"
        render={({ field }) => (
          <FormItem>
            <FormLabel>ì½˜í…ì¸  ê¸¸ì´</FormLabel>
            <Select onValueChange={field.onChange} defaultValue={field.value}>
              <FormControl>
                <SelectTrigger
                  className="h-10"
                  style={{
                    borderColor: "#E1E5EA",
                    borderRadius: "6px",
                  }}
                >
                  <SelectValue placeholder="ê¸¸ì´ë¥¼ ì„ íƒí•˜ì„¸ìš”" />
                </SelectTrigger>
              </FormControl>
              <SelectContent>
                {CONTENT_LENGTH_OPTIONS.map((option) => (
                  <SelectItem key={option.value} value={option.value}>
                    <div className="flex flex-col">
                      <span className="font-medium">{option.label}</span>
                      <span
                        className="text-xs"
                        style={{ color: "#6B7280" }}
                      >
                        {option.description}
                      </span>
                    </div>
                  </SelectItem>
                ))}
              </SelectContent>
            </Select>
            <FormDescription>
              ìƒì„±ë  ì½˜í…ì¸ ì˜ í‰ê·  ê¸¸ì´ë¥¼ ì„¤ì •í•©ë‹ˆë‹¤
            </FormDescription>
            <FormMessage />
          </FormItem>
        )}
      />

      {/* Reading Level */}
      <FormField
        control={form.control}
        name="readingLevel"
        render={({ field }) => (
          <FormItem>
            <FormLabel>ì½ê¸° ìˆ˜ì¤€</FormLabel>
            <Select onValueChange={field.onChange} defaultValue={field.value}>
              <FormControl>
                <SelectTrigger
                  className="h-10"
                  style={{
                    borderColor: "#E1E5EA",
                    borderRadius: "6px",
                  }}
                >
                  <SelectValue placeholder="ìˆ˜ì¤€ì„ ì„ íƒí•˜ì„¸ìš”" />
                </SelectTrigger>
              </FormControl>
              <SelectContent>
                {READING_LEVEL_OPTIONS.map((option) => (
                  <SelectItem key={option.value} value={option.value}>
                    <div className="flex flex-col">
                      <span className="font-medium">{option.label}</span>
                      <span
                        className="text-xs"
                        style={{ color: "#6B7280" }}
                      >
                        {option.description}
                      </span>
                    </div>
                  </SelectItem>
                ))}
              </SelectContent>
            </Select>
            <FormDescription>
              ë…ìì˜ ì „ë¬¸ì„± ìˆ˜ì¤€ì— ë§ëŠ” ìš©ì–´ì™€ í‘œí˜„ì„ ì‚¬ìš©í•©ë‹ˆë‹¤
            </FormDescription>
            <FormMessage />
          </FormItem>
        )}
      />

      <div
        className="rounded-lg p-4"
        style={{
          backgroundColor: "#F5F7FA",
          borderLeft: "4px solid #3BA2F8",
        }}
      >
        <p className="text-sm font-medium" style={{ color: "#111827" }}>
          ğŸ’¡ íŒ
        </p>
        <p className="mt-2 text-sm" style={{ color: "#6B7280" }}>
          ì´ ì„¤ì •ì€ ê¸°ë³¸ê°’ìœ¼ë¡œ ì‚¬ìš©ë˜ë©°, ê° ì½˜í…ì¸  ìƒì„± ì‹œ ê°œë³„ì ìœ¼ë¡œ ì¡°ì •í•  ìˆ˜
          ìˆìŠµë‹ˆë‹¤.
        </p>
      </div>
    </div>
  );
}
</file>

<file path="src/features/onboarding/lib/constants.ts">
// Step configuration
export const TOTAL_STEPS = 5;

export const STEP_NAMES = [
  "ë¸Œëœë“œ ë³´ì´ìŠ¤",
  "íƒ€ê²Ÿ ë…ì",
  "ì–¸ì–´ ì„¤ì •",
  "ìŠ¤íƒ€ì¼ ì„¤ì •",
  "ìµœì¢… ê²€í† ",
] as const;

export const STEP_DESCRIPTIONS = [
  "ë¸Œëœë“œì˜ ê°œì„±ê³¼ ëª©ì†Œë¦¬ë¥¼ ì •ì˜í•´ì£¼ì„¸ìš”",
  "ì–´ë–¤ ë…ìë¥¼ ìœ„í•œ ì½˜í…ì¸ ì¸ì§€ ì•Œë ¤ì£¼ì„¸ìš”",
  "ì£¼ë¡œ ì‚¬ìš©í•  ì–¸ì–´ë¥¼ ì„ íƒí•´ì£¼ì„¸ìš”",
  "ì½˜í…ì¸ ì˜ í†¤ê³¼ ê¸¸ì´ë¥¼ ì„¤ì •í•´ì£¼ì„¸ìš”",
  "ì„¤ì •ì„ ê²€í† í•˜ê³  ì™„ë£Œí•´ì£¼ì„¸ìš”",
] as const;

// Step 1: Brand Voice Options
export const PERSONALITY_OPTIONS = [
  { value: "innovative", label: "í˜ì‹ ì ì¸" },
  { value: "trustworthy", label: "ì‹ ë¢°í•  ìˆ˜ ìˆëŠ”" },
  { value: "playful", label: "ì¬ë¯¸ìˆëŠ”" },
  { value: "professional", label: "ì „ë¬¸ì ì¸" },
  { value: "approachable", label: "ì¹œê·¼í•œ" },
  { value: "bold", label: "ëŒ€ë‹´í•œ" },
  { value: "authentic", label: "ì§„ì •ì„± ìˆëŠ”" },
  { value: "sophisticated", label: "ì„¸ë ¨ëœ" },
] as const;

export const FORMALITY_OPTIONS = [
  { value: "casual", label: "ìºì£¼ì–¼", description: "í¸ì•ˆí•˜ê³  ì¼ìƒì ì¸ ëŒ€í™”ì²´" },
  {
    value: "neutral",
    label: "ì¤‘ë¦½",
    description: "ê²©ì‹ê³¼ í¸ì•ˆí•¨ì˜ ê· í˜•",
  },
  {
    value: "formal",
    label: "ê²©ì‹ ìˆëŠ”",
    description: "ì „ë¬¸ì ì´ê³  ê³µì‹ì ì¸ ì–´ì¡°",
  },
] as const;

// Step 3: Language Options
export const LANGUAGE_OPTIONS = [
  { value: "ko", label: "í•œêµ­ì–´", description: "Korean" },
  { value: "en", label: "ì˜ì–´", description: "English" },
] as const;

// Step 4: Style Options
export const TONE_OPTIONS = [
  {
    value: "professional",
    label: "ì „ë¬¸ì ",
    description: "ë¹„ì¦ˆë‹ˆìŠ¤ì™€ ì „ë¬¸ì„± ê°•ì¡°",
  },
  {
    value: "friendly",
    label: "ì¹œê·¼í•œ",
    description: "ë”°ëœ»í•˜ê³  ì ‘ê·¼í•˜ê¸° ì‰¬ìš´",
  },
  {
    value: "inspirational",
    label: "ì˜ê°ì„ ì£¼ëŠ”",
    description: "ë™ê¸°ë¶€ì—¬ì™€ ê¸ì •ì  ë©”ì‹œì§€",
  },
  {
    value: "educational",
    label: "êµìœ¡ì ",
    description: "í•™ìŠµê³¼ ì§€ì‹ ì „ë‹¬ ì¤‘ì‹¬",
  },
] as const;

export const CONTENT_LENGTH_OPTIONS = [
  {
    value: "short",
    label: "ì§§ê²Œ",
    description: "300-500ì (ë¹ ë¥¸ ì½ê¸°)",
  },
  {
    value: "medium",
    label: "ë³´í†µ",
    description: "500-1000ì (ê· í˜•ì¡íŒ ê¸¸ì´)",
  },
  {
    value: "long",
    label: "ê¸¸ê²Œ",
    description: "1000ì ì´ìƒ (ì‹¬ì¸µ ë¶„ì„)",
  },
] as const;

export const READING_LEVEL_OPTIONS = [
  {
    value: "beginner",
    label: "ì´ˆê¸‰",
    description: "ì‰¬ìš´ ë‹¨ì–´ì™€ ê°„ë‹¨í•œ ë¬¸ì¥",
  },
  {
    value: "intermediate",
    label: "ì¤‘ê¸‰",
    description: "ì¼ë°˜ì ì¸ ìˆ˜ì¤€ì˜ ì–´íœ˜",
  },
  {
    value: "advanced",
    label: "ê³ ê¸‰",
    description: "ì „ë¬¸ ìš©ì–´ì™€ ë³µì¡í•œ ê°œë…",
  },
] as const;

// Preview templates
export const PREVIEW_TEMPLATES = {
  ko: {
    casual:
      "{brandName}ëŠ” {personality}í•œ ë¸Œëœë“œì˜ˆìš”. ìš°ë¦¬ëŠ” {targetAudience}ë¥¼ ìœ„í•´ ì½˜í…ì¸ ë¥¼ ë§Œë“¤ì–´ìš”.",
    neutral:
      "{brandName}ëŠ” {personality} ë¸Œëœë“œì…ë‹ˆë‹¤. {targetAudience}ë¥¼ ìœ„í•œ ì½˜í…ì¸ ë¥¼ ì œê³µí•©ë‹ˆë‹¤.",
    formal:
      "{brandName}ëŠ” {personality} ë¸Œëœë“œë¡œì„œ, {targetAudience}ë¥¼ ëŒ€ìƒìœ¼ë¡œ ì „ë¬¸ ì½˜í…ì¸ ë¥¼ ì œê³µí•˜ê³  ìˆìŠµë‹ˆë‹¤.",
  },
  en: {
    casual:
      "{brandName} is a {personality} brand. We create content for {targetAudience}.",
    neutral:
      "{brandName} is a {personality} brand. We provide content for {targetAudience}.",
    formal:
      "{brandName} is a {personality} brand that provides professional content for {targetAudience}.",
  },
} as const;
</file>

<file path="src/features/onboarding/lib/onboarding-schema.ts">
import { z } from "zod";

// Step 1: Brand Voice Schema
export const brandVoiceSchema = z.object({
  brandName: z
    .string()
    .min(1, "ë¸Œëœë“œ ì´ë¦„ì„ ì…ë ¥í•´ì£¼ì„¸ìš”")
    .max(50, "ë¸Œëœë“œ ì´ë¦„ì€ 50ì ì´ë‚´ë¡œ ì…ë ¥í•´ì£¼ì„¸ìš”"),
  brandDescription: z
    .string()
    .min(10, "ë¸Œëœë“œ ì„¤ëª…ì€ ìµœì†Œ 10ì ì´ìƒ ì…ë ¥í•´ì£¼ì„¸ìš”")
    .max(500, "ë¸Œëœë“œ ì„¤ëª…ì€ 500ì ì´ë‚´ë¡œ ì…ë ¥í•´ì£¼ì„¸ìš”"),
  personality: z
    .array(z.string())
    .min(1, "ìµœì†Œ 1ê°œì˜ ì„±ê²©ì„ ì„ íƒí•´ì£¼ì„¸ìš”")
    .max(3, "ìµœëŒ€ 3ê°œê¹Œì§€ ì„ íƒ ê°€ëŠ¥í•©ë‹ˆë‹¤"),
  formality: z.enum(["casual", "neutral", "formal"], {
    errorMap: () => ({ message: "ê²©ì‹ ìˆ˜ì¤€ì„ ì„ íƒí•´ì£¼ì„¸ìš”" }),
  }),
});

// Step 2: Target Audience Schema
export const targetAudienceSchema = z.object({
  targetAudience: z
    .string()
    .min(10, "íƒ€ê²Ÿ ë…ìì— ëŒ€í•œ ì„¤ëª…ì„ ìµœì†Œ 10ì ì´ìƒ ì…ë ¥í•´ì£¼ì„¸ìš”")
    .max(300, "íƒ€ê²Ÿ ë…ì ì„¤ëª…ì€ 300ì ì´ë‚´ë¡œ ì…ë ¥í•´ì£¼ì„¸ìš”"),
  painPoints: z
    .string()
    .min(10, "í•´ê²°í•˜ë ¤ëŠ” ë¬¸ì œë¥¼ ìµœì†Œ 10ì ì´ìƒ ì…ë ¥í•´ì£¼ì„¸ìš”")
    .max(300, "ë¬¸ì œ ì„¤ëª…ì€ 300ì ì´ë‚´ë¡œ ì…ë ¥í•´ì£¼ì„¸ìš”"),
});

// Step 3: Language Schema
export const languageSchema = z.object({
  language: z.enum(["ko", "en"], {
    errorMap: () => ({ message: "ì–¸ì–´ë¥¼ ì„ íƒí•´ì£¼ì„¸ìš”" }),
  }),
});

// Step 4: Style Schema
export const styleSchema = z.object({
  tone: z.enum(["professional", "friendly", "inspirational", "educational"], {
    errorMap: () => ({ message: "í†¤ì„ ì„ íƒí•´ì£¼ì„¸ìš”" }),
  }),
  contentLength: z.enum(["short", "medium", "long"], {
    errorMap: () => ({ message: "ì½˜í…ì¸  ê¸¸ì´ë¥¼ ì„ íƒí•´ì£¼ì„¸ìš”" }),
  }),
  readingLevel: z.enum(["beginner", "intermediate", "advanced"], {
    errorMap: () => ({ message: "ì½ê¸° ìˆ˜ì¤€ì„ ì„ íƒí•´ì£¼ì„¸ìš”" }),
  }),
});

// Step 5: Review Schema
export const reviewSchema = z.object({
  notes: z.string().max(500, "ë©”ëª¨ëŠ” 500ì ì´ë‚´ë¡œ ì…ë ¥í•´ì£¼ì„¸ìš”").optional(),
});

// Full Onboarding Schema (all steps combined)
export const onboardingSchema = z.object({
  ...brandVoiceSchema.shape,
  ...targetAudienceSchema.shape,
  ...languageSchema.shape,
  ...styleSchema.shape,
  ...reviewSchema.shape,
});

// Export Types
export type BrandVoiceFormData = z.infer<typeof brandVoiceSchema>;
export type TargetAudienceFormData = z.infer<typeof targetAudienceSchema>;
export type LanguageFormData = z.infer<typeof languageSchema>;
export type StyleFormData = z.infer<typeof styleSchema>;
export type ReviewFormData = z.infer<typeof reviewSchema>;
export type OnboardingFormData = z.infer<typeof onboardingSchema>;

// Default values for the form
export const defaultOnboardingValues: OnboardingFormData = {
  brandName: "",
  brandDescription: "",
  personality: [],
  formality: "neutral",
  targetAudience: "",
  painPoints: "",
  language: "ko",
  tone: "professional",
  contentLength: "medium",
  readingLevel: "intermediate",
  notes: "",
};
</file>

<file path="src/hooks/use-toast.ts">
"use client"

// Inspired by react-hot-toast library
import * as React from "react"

import type {
  ToastActionElement,
  ToastProps,
} from "@/components/ui/toast"

const TOAST_LIMIT = 1
const TOAST_REMOVE_DELAY = 1000000

type ToasterToast = ToastProps & {
  id: string
  title?: React.ReactNode
  description?: React.ReactNode
  action?: ToastActionElement
}

const actionTypes = {
  ADD_TOAST: "ADD_TOAST",
  UPDATE_TOAST: "UPDATE_TOAST",
  DISMISS_TOAST: "DISMISS_TOAST",
  REMOVE_TOAST: "REMOVE_TOAST",
} as const

let count = 0

function genId() {
  count = (count + 1) % Number.MAX_SAFE_INTEGER
  return count.toString()
}

type ActionType = typeof actionTypes

type Action =
  | {
      type: ActionType["ADD_TOAST"]
      toast: ToasterToast
    }
  | {
      type: ActionType["UPDATE_TOAST"]
      toast: Partial<ToasterToast>
    }
  | {
      type: ActionType["DISMISS_TOAST"]
      toastId?: ToasterToast["id"]
    }
  | {
      type: ActionType["REMOVE_TOAST"]
      toastId?: ToasterToast["id"]
    }

interface State {
  toasts: ToasterToast[]
}

const toastTimeouts = new Map<string, ReturnType<typeof setTimeout>>()

const addToRemoveQueue = (toastId: string) => {
  if (toastTimeouts.has(toastId)) {
    return
  }

  const timeout = setTimeout(() => {
    toastTimeouts.delete(toastId)
    dispatch({
      type: "REMOVE_TOAST",
      toastId: toastId,
    })
  }, TOAST_REMOVE_DELAY)

  toastTimeouts.set(toastId, timeout)
}

export const reducer = (state: State, action: Action): State => {
  switch (action.type) {
    case "ADD_TOAST":
      return {
        ...state,
        toasts: [action.toast, ...state.toasts].slice(0, TOAST_LIMIT),
      }

    case "UPDATE_TOAST":
      return {
        ...state,
        toasts: state.toasts.map((t) =>
          t.id === action.toast.id ? { ...t, ...action.toast } : t
        ),
      }

    case "DISMISS_TOAST": {
      const { toastId } = action

      // ! Side effects ! - This could be extracted into a dismissToast() action,
      // but I'll keep it here for simplicity
      if (toastId) {
        addToRemoveQueue(toastId)
      } else {
        state.toasts.forEach((toast) => {
          addToRemoveQueue(toast.id)
        })
      }

      return {
        ...state,
        toasts: state.toasts.map((t) =>
          t.id === toastId || toastId === undefined
            ? {
                ...t,
                open: false,
              }
            : t
        ),
      }
    }
    case "REMOVE_TOAST":
      if (action.toastId === undefined) {
        return {
          ...state,
          toasts: [],
        }
      }
      return {
        ...state,
        toasts: state.toasts.filter((t) => t.id !== action.toastId),
      }
  }
}

const listeners: Array<(state: State) => void> = []

let memoryState: State = { toasts: [] }

function dispatch(action: Action) {
  memoryState = reducer(memoryState, action)
  listeners.forEach((listener) => {
    listener(memoryState)
  })
}

type Toast = Omit<ToasterToast, "id">

function toast({ ...props }: Toast) {
  const id = genId()

  const update = (props: ToasterToast) =>
    dispatch({
      type: "UPDATE_TOAST",
      toast: { ...props, id },
    })
  const dismiss = () => dispatch({ type: "DISMISS_TOAST", toastId: id })

  dispatch({
    type: "ADD_TOAST",
    toast: {
      ...props,
      id,
      open: true,
      onOpenChange: (open) => {
        if (!open) dismiss()
      },
    },
  })

  return {
    id: id,
    dismiss,
    update,
  }
}

function useToast() {
  const [state, setState] = React.useState<State>(memoryState)

  React.useEffect(() => {
    listeners.push(setState)
    return () => {
      const index = listeners.indexOf(setState)
      if (index > -1) {
        listeners.splice(index, 1)
      }
    }
  }, [state])

  return {
    ...state,
    toast,
    dismiss: (toastId?: string) => dispatch({ type: "DISMISS_TOAST", toastId }),
  }
}

export { useToast, toast }
</file>

<file path="src/lib/remote/api-client.ts">
import axios, { isAxiosError } from "axios";

const apiClient = axios.create({
  baseURL: process.env.NEXT_PUBLIC_API_BASE_URL ?? "",
  headers: {
    "Content-Type": "application/json",
  },
});

type ErrorPayload = {
  error?: {
    message?: string;
  };
  message?: string;
};

export const extractApiErrorMessage = (
  error: unknown,
  fallbackMessage = "API request failed."
) => {
  if (isAxiosError(error)) {
    const payload = error.response?.data as ErrorPayload | undefined;

    if (typeof payload?.error?.message === "string") {
      return payload.error.message;
    }

    if (typeof payload?.message === "string") {
      return payload.message;
    }
  }

  if (error instanceof Error && error.message) {
    return error.message;
  }

  return fallbackMessage;
};

export { apiClient, isAxiosError };
</file>

<file path="src/lib/supabase/browser-client.ts">
"use client";

import { createBrowserClient } from "@supabase/ssr";
import type { SupabaseClient } from "@supabase/supabase-js";
import { env } from "@/constants/env";
import type { Database } from "./types";

let client: SupabaseClient<Database> | null = null;

export const getSupabaseBrowserClient = () => {
  if (!client) {
    client = createBrowserClient<Database>(
      env.NEXT_PUBLIC_SUPABASE_URL,
      env.NEXT_PUBLIC_SUPABASE_ANON_KEY
    );
  }

  return client;
};
</file>

<file path="src/lib/supabase/client.ts">
import { createBrowserClient } from "@supabase/ssr";

export function createClient() {
  return createBrowserClient(
    process.env.NEXT_PUBLIC_SUPABASE_URL!,
    process.env.NEXT_PUBLIC_SUPABASE_ANON_KEY!
  );
}
</file>

<file path="src/lib/supabase/server-client.ts">
import { cookies } from "next/headers";
import { createServerClient } from "@supabase/ssr";
import type { SupabaseClient } from "@supabase/supabase-js";
import { env } from "@/constants/env";
import type { Database } from "./types";

type WritableCookieStore = Awaited<ReturnType<typeof cookies>> & {
  set?: (options: {
    name: string;
    value: string;
    path?: string;
    expires?: Date;
    maxAge?: number;
    httpOnly?: boolean;
    sameSite?: "lax" | "strict" | "none";
    secure?: boolean;
  }) => void;
};

export const createSupabaseServerClient = async (): Promise<
  SupabaseClient<Database>
> => {
  const cookieStore = (await cookies()) as WritableCookieStore;

  return createServerClient<Database>(
    env.NEXT_PUBLIC_SUPABASE_URL,
    env.NEXT_PUBLIC_SUPABASE_ANON_KEY,
    {
      cookies: {
        getAll() {
          return cookieStore.getAll();
        },
        setAll(cookiesToSet) {
          cookiesToSet.forEach(({ name, value, options }) => {
            if (typeof cookieStore.set === "function") {
              cookieStore.set({ name, value, ...options });
            }
          });
        },
      },
    }
  );
};
</file>

<file path="src/lib/supabase/server.ts">
import "server-only";

import { createServerClient } from "@supabase/ssr";
import { cookies } from "next/headers";

export async function createClient() {
  const cookieStore = await cookies();

  return createServerClient(
    process.env.NEXT_PUBLIC_SUPABASE_URL!,
    process.env.SUPABASE_SERVICE_ROLE_KEY!,
    {
      cookies: {
        getAll() {
          return cookieStore.getAll();
        },
        setAll(cookiesToSet) {
          try {
            cookiesToSet.forEach(({ name, value, options }) =>
              cookieStore.set(name, value, options)
            );
          } catch {
            // The `setAll` method was called from a Server Component.
            // This can be ignored if you have middleware refreshing
            // user sessions.
          }
        },
      },
    }
  );
}

export async function createPureClient() {
  return createServerClient(
    process.env.NEXT_PUBLIC_SUPABASE_URL!,
    process.env.SUPABASE_SERVICE_ROLE_KEY!,
    {
      cookies: {
        getAll() {
          return [];
        },
        setAll() {},
      },
    }
  );
}
</file>

<file path="src/lib/supabase/types.ts">
export type Database = Record<string, never>;

export type SupabaseUserMetadata = Record<string, unknown>;
</file>

<file path="src/lib/clerk-theme.ts">
import type { Appearance } from "@clerk/types";

export const clerkAppearance: Appearance = {
  layout: {
    socialButtonsPlacement: "bottom",
    socialButtonsVariant: "iconButton",
  },
  variables: {
    // Colors from design guide
    colorPrimary: "#3BA2F8", // Accent Blue
    colorBackground: "#FCFCFD", // Off-White
    colorText: "#111827", // Gray 900
    colorTextSecondary: "#374151", // Gray 700
    colorInputBackground: "#FFFFFF",
    colorInputText: "#111827",
    colorDanger: "#EF4444", // Error Red

    // Border radius
    borderRadius: "8px",

    // Typography
    fontFamily: "Pretendard Variable, -apple-system, sans-serif",
    fontWeight: {
      normal: 400,
      medium: 500,
      semibold: 600,
      bold: 700,
    },
  },
  elements: {
    // Root container
    rootBox: {
      width: "100%",
      maxWidth: "420px",
    },

    // Card
    card: {
      backgroundColor: "#FFFFFF",
      border: "1px solid #E1E5EA",
      borderRadius: "12px",
      boxShadow: "0 4px 6px rgba(0, 0, 0, 0.07)",
      padding: "32px 24px",
    },

    // Header
    headerTitle: {
      fontSize: "24px",
      fontWeight: 600,
      color: "#111827",
      letterSpacing: "-0.025em",
    },
    headerSubtitle: {
      fontSize: "14px",
      fontWeight: 400,
      color: "#6B7280",
      marginTop: "8px",
    },

    // Social buttons
    socialButtonsBlockButton: {
      border: "1px solid #E1E5EA",
      borderRadius: "8px",
      "&:hover": {
        backgroundColor: "#F3F4F6",
      },
    },

    // Form elements
    formFieldLabel: {
      fontSize: "14px",
      fontWeight: 500,
      color: "#374151",
      marginBottom: "8px",
    },
    formFieldInput: {
      height: "40px",
      padding: "12px 16px",
      border: "1px solid #D1D5DB",
      borderRadius: "6px",
      fontSize: "16px",
      "&:focus": {
        borderColor: "#3BA2F8",
        boxShadow: "0 0 0 3px rgba(59, 162, 248, 0.1)",
      },
      "&::placeholder": {
        color: "#D1D5DB",
      },
    },
    formFieldInputShowPasswordButton: {
      color: "#6B7280",
    },

    // Buttons
    formButtonPrimary: {
      height: "48px",
      backgroundColor: "#3BA2F8",
      borderRadius: "8px",
      fontSize: "16px",
      fontWeight: 600,
      padding: "0 24px",
      "&:hover": {
        backgroundColor: "#2E91E5",
      },
      "&:active": {
        backgroundColor: "#2680D0",
      },
    },

    // Footer
    footer: {
      marginTop: "24px",
    },
    footerActionLink: {
      color: "#3BA2F8",
      fontWeight: 500,
      "&:hover": {
        color: "#2E91E5",
      },
    },

    // Divider
    dividerLine: {
      backgroundColor: "#E1E5EA",
    },
    dividerText: {
      color: "#6B7280",
      fontSize: "14px",
    },

    // Alert
    alertText: {
      fontSize: "14px",
    },

    // Identifier
    identityPreviewText: {
      fontSize: "14px",
      fontWeight: 500,
    },

    // Links
    formFieldAction: {
      color: "#3BA2F8",
      fontSize: "14px",
      fontWeight: 500,
      "&:hover": {
        color: "#2E91E5",
      },
    },
  },
};
</file>

<file path="src/lib/slug.ts">
/**
 * Generates a URL-friendly slug from a given string
 * Handles both Korean and English text
 */
export const generateSlug = (text: string): string => {
  return text
    .toLowerCase()
    .trim()
    // Replace Korean characters with romanization (basic approach)
    .replace(/[\u3131-\uD79D]/g, '') // Remove Korean characters for now
    // Replace spaces and special characters with hyphens
    .replace(/[^\w\s-]/g, '')
    .replace(/[\s_]+/g, '-')
    .replace(/^-+|-+$/g, '');
};

/**
 * Generates a unique slug by appending a random string
 */
export const generateUniqueSlug = (text: string): string => {
  const baseSlug = generateSlug(text);
  const randomSuffix = Math.random().toString(36).substring(2, 8);
  return `${baseSlug}-${randomSuffix}`;
};
</file>

<file path="src/lib/utils.ts">
import { clsx, type ClassValue } from "clsx";
import { twMerge } from "tailwind-merge";

export function cn(...inputs: ClassValue[]) {
  return twMerge(clsx(inputs));
}
</file>

<file path="src/types/globals.d.ts">
export {}

declare global {
  interface CustomJwtSessionClaims {
    metadata: {
      onboardingCompleted?: boolean
    }
  }
}
</file>

<file path="supabase/migrations/0001_create_example_table.sql">
-- Migration: create example table for backend reference implementation
-- Ensures pgcrypto available for gen_random_uuid
create extension if not exists "pgcrypto";

create table if not exists public.example (
  id uuid primary key default gen_random_uuid(),
  full_name text,
  avatar_url text,
  bio text,
  updated_at timestamptz not null default now()
);

comment on table public.example is 'Example table used by the hono + next.js starter backend layer.';

insert into public.example (full_name, avatar_url, bio)
values
  (
    'Jane Example',
    'https://picsum.photos/seed/jane-example/200/200',
    'Demonstration record generated by the starter migration.'
  )
  on conflict do nothing;

ALTER TABLE IF EXISTS public.example DISABLE ROW LEVEL SECURITY;
</file>

<file path="supabase/migrations/0002_create_style_guides_table.sql">
-- Migration: create style_guides table for storing user onboarding data
-- This table stores the brand voice, style preferences, and content guidelines
-- for each user to personalize their AI-generated content

-- Ensures pgcrypto available for gen_random_uuid
create extension if not exists "pgcrypto";

-- Create enum types for style guide fields
create type formality_level as enum ('casual', 'neutral', 'formal');
create type language_code as enum ('ko', 'en');
create type content_tone as enum ('professional', 'friendly', 'inspirational', 'educational');
create type content_length_preference as enum ('short', 'medium', 'long');
create type reading_level as enum ('beginner', 'intermediate', 'advanced');

-- Create style_guides table
create table if not exists public.style_guides (
  -- Primary key
  id uuid primary key default gen_random_uuid(),

  -- User reference (one style guide per user for MVP)
  clerk_user_id text not null unique,

  -- Brand Voice fields (Step 1)
  brand_name text not null,
  brand_description text not null,
  personality text[] not null check (array_length(personality, 1) between 1 and 3),
  formality formality_level not null default 'neutral',

  -- Target Audience fields (Step 2)
  target_audience text not null,
  pain_points text not null,

  -- Language field (Step 3)
  language language_code not null default 'ko',

  -- Style fields (Step 4)
  tone content_tone not null default 'professional',
  content_length content_length_preference not null default 'medium',
  reading_level reading_level not null default 'intermediate',

  -- Review/Notes field (Step 5)
  notes text,

  -- Metadata
  is_default boolean not null default true,
  created_at timestamptz not null default now(),
  updated_at timestamptz not null default now()
);

-- Add index for faster lookups by user
create index if not exists idx_style_guides_clerk_user_id
  on public.style_guides(clerk_user_id);

-- Add helpful comments
comment on table public.style_guides is
  'Stores user onboarding data including brand voice, target audience, language preferences, and content style settings. Each user has one style guide for MVP.';

comment on column public.style_guides.clerk_user_id is
  'Reference to Clerk user ID. Unique constraint ensures one style guide per user in MVP.';

comment on column public.style_guides.personality is
  'Array of personality traits (1-3 items). Examples: innovative, trustworthy, playful, etc.';

comment on column public.style_guides.is_default is
  'Flag to mark this as the default style guide for the user. Always true for MVP (single guide per user).';

-- Create trigger function to auto-update updated_at timestamp
create or replace function update_style_guides_updated_at()
returns trigger as $$
begin
  new.updated_at = now();
  return new;
end;
$$ language plpgsql;

-- Create trigger
create trigger set_style_guides_updated_at
  before update on public.style_guides
  for each row
  execute function update_style_guides_updated_at();

-- Disable Row Level Security (RLS)
-- Backend API uses service role key which bypasses RLS
alter table public.style_guides disable row level security;
</file>

<file path="supabase/migrations/0003_create_articles_table.sql">
-- Migration: create articles table for storing AI-generated blog posts
-- This table stores article drafts, published posts, metadata, and SEO information
-- with references to the user's style guide

-- Ensures pgcrypto available for gen_random_uuid
create extension if not exists "pgcrypto";

-- Create enum type for article status
create type article_status as enum ('draft', 'published', 'archived');

-- Create articles table
create table if not exists public.articles (
  -- Primary key
  id uuid primary key default gen_random_uuid(),

  -- User reference
  clerk_user_id text not null,

  -- Basic article information
  title text not null,
  slug text not null,
  keywords text[] not null default array[]::text[],
  description text,
  content text not null,

  -- Style guide reference (nullable for flexibility)
  style_guide_id uuid references public.style_guides(id) on delete set null,

  -- Content style overrides (from style_guides enum types)
  tone content_tone,
  content_length content_length_preference,
  reading_level reading_level,

  -- SEO metadata
  meta_title text,
  meta_description text,

  -- Status and publishing
  status article_status not null default 'draft',
  published_at timestamptz,

  -- Timestamps
  created_at timestamptz not null default now(),
  updated_at timestamptz not null default now()
);

-- Add indexes for faster lookups
create index if not exists idx_articles_clerk_user_id
  on public.articles(clerk_user_id);

create index if not exists idx_articles_slug
  on public.articles(slug);

create index if not exists idx_articles_status
  on public.articles(status);

create index if not exists idx_articles_style_guide_id
  on public.articles(style_guide_id);

create index if not exists idx_articles_published_at
  on public.articles(published_at desc);

-- Add composite index for user's published articles
create index if not exists idx_articles_user_published
  on public.articles(clerk_user_id, status, published_at desc)
  where status = 'published';

-- Add helpful comments
comment on table public.articles is
  'Stores AI-generated blog articles including drafts, published posts, and archived content. Each article can reference a style guide and override specific style settings.';

comment on column public.articles.clerk_user_id is
  'Reference to Clerk user ID. Identifies the article owner.';

comment on column public.articles.slug is
  'URL-friendly slug for the article. Should be unique per user.';

comment on column public.articles.keywords is
  'Array of keywords/tags for SEO and categorization.';

comment on column public.articles.style_guide_id is
  'Optional reference to style guide. If null, uses default style guide.';

comment on column public.articles.tone is
  'Content tone override. If null, uses style guide tone.';

comment on column public.articles.content_length is
  'Content length preference override. If null, uses style guide preference.';

comment on column public.articles.reading_level is
  'Reading level override. If null, uses style guide level.';

comment on column public.articles.status is
  'Article lifecycle status: draft (being edited), published (live), archived (removed from public view).';

comment on column public.articles.published_at is
  'Timestamp when the article was first published. Null for drafts.';

-- Create trigger function to auto-update updated_at timestamp
create or replace function update_articles_updated_at()
returns trigger as $$
begin
  new.updated_at = now();
  return new;
end;
$$ language plpgsql;

-- Create trigger
create trigger set_articles_updated_at
  before update on public.articles
  for each row
  execute function update_articles_updated_at();

-- Disable Row Level Security (RLS)
-- Backend API uses service role key which bypasses RLS
alter table public.articles disable row level security;
</file>

<file path="supabase/migrations/0004_create_generation_quota_table.sql">
-- Create generation_quota table for tracking AI article generation usage
-- Migration: 0004_create_generation_quota_table.sql

BEGIN;

-- Create enum for tier types
CREATE TYPE tier_type AS ENUM ('free', 'pro');

-- Create generation_quota table
CREATE TABLE IF NOT EXISTS generation_quota (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    clerk_user_id TEXT NOT NULL UNIQUE,
    tier tier_type NOT NULL DEFAULT 'free',
    generation_count INTEGER NOT NULL DEFAULT 0,
    last_reset_at TIMESTAMPTZ NOT NULL DEFAULT NOW(),
    created_at TIMESTAMPTZ NOT NULL DEFAULT NOW(),
    updated_at TIMESTAMPTZ NOT NULL DEFAULT NOW()
);

-- Create index on clerk_user_id for fast lookups
CREATE INDEX IF NOT EXISTS idx_generation_quota_clerk_user_id
    ON generation_quota(clerk_user_id);

-- Create updated_at trigger function if not exists
CREATE OR REPLACE FUNCTION update_updated_at_column()
RETURNS TRIGGER AS $$
BEGIN
    NEW.updated_at = NOW();
    RETURN NEW;
END;
$$ LANGUAGE plpgsql;

-- Create trigger to automatically update updated_at
DROP TRIGGER IF EXISTS update_generation_quota_updated_at ON generation_quota;
CREATE TRIGGER update_generation_quota_updated_at
    BEFORE UPDATE ON generation_quota
    FOR EACH ROW
    EXECUTE FUNCTION update_updated_at_column();

-- Disable RLS (Row Level Security)
ALTER TABLE generation_quota DISABLE ROW LEVEL SECURITY;

-- Add comments for documentation
COMMENT ON TABLE generation_quota IS 'Tracks AI article generation quota and usage per user';
COMMENT ON COLUMN generation_quota.clerk_user_id IS 'Clerk user ID (unique identifier)';
COMMENT ON COLUMN generation_quota.tier IS 'User subscription tier (free/pro)';
COMMENT ON COLUMN generation_quota.generation_count IS 'Number of articles generated in current period';
COMMENT ON COLUMN generation_quota.last_reset_at IS 'Timestamp of last quota reset (monthly)';

COMMIT;
</file>

<file path=".cursorignore">
pnpm-lock.yaml
yarn.lock
package-lock.json
</file>

<file path=".env.test">
# Test environment variables
NEXT_PUBLIC_SUPABASE_URL=http://localhost:54321
NEXT_PUBLIC_SUPABASE_ANON_KEY=test-anon-key
</file>

<file path="components.json">
{
  "$schema": "https://ui.shadcn.com/schema.json",
  "style": "default",
  "rsc": true,
  "tsx": true,
  "tailwind": {
    "config": "",
    "css": "src/app/globals.css",
    "baseColor": "neutral",
    "cssVariables": true,
    "prefix": ""
  },
  "aliases": {
    "components": "@/components",
    "utils": "@/lib/utils",
    "ui": "@/components/ui",
    "lib": "@/lib",
    "hooks": "@/hooks"
  }
}
</file>

<file path="eslint.config.mjs">
import { dirname } from 'path';
import { fileURLToPath } from 'url';
import { FlatCompat } from '@eslint/eslintrc';

const __filename = fileURLToPath(import.meta.url);
const __dirname = dirname(__filename);

const compat = new FlatCompat({
  baseDirectory: __dirname,
});

const eslintConfig = [
  ...compat.extends('next/core-web-vitals', 'next/typescript'),
  {
    rules: {
      '@typescript-eslint/no-empty-object-type': 'off',
      '@typescript-eslint/no-explicit-any': 'off',
      '@typescript-eslint/no-unused-vars': 'off',
    },
  },
];

export default eslintConfig;
</file>

<file path="next.config.ts">
import type { NextConfig } from 'next';

const nextConfig: NextConfig = {
  /* config options here */
  eslint: {
    ignoreDuringBuilds: true,
  },
  images: {
    remotePatterns: [
      {
        hostname: '**',
      },
    ],
  },
};

export default nextConfig;
</file>

<file path="playwright.config.ts">
import { defineConfig, devices } from '@playwright/test';

/**
 * See https://playwright.dev/docs/test-configuration.
 */
export default defineConfig({
  testDir: './e2e',
  /* Run tests in files in parallel */
  fullyParallel: true,
  /* Fail the build on CI if you accidentally left test.only in the source code. */
  forbidOnly: !!process.env.CI,
  /* Retry on CI only */
  retries: process.env.CI ? 2 : 0,
  /* Opt out of parallel tests on CI. */
  workers: process.env.CI ? 1 : undefined,
  /* Reporter to use. See https://playwright.dev/docs/test-reporters */
  reporter: 'html',
  /* Shared settings for all the projects below. See https://playwright.dev/docs/api/class-testoptions. */
  use: {
    /* Base URL to use in actions like `await page.goto('/')`. */
    baseURL: process.env.PLAYWRIGHT_BASE_URL || 'http://localhost:3000',
    /* Collect trace when retrying the failed test. See https://playwright.dev/docs/trace-viewer */
    trace: 'on-first-retry',
  },

  /* Configure projects for major browsers */
  projects: [
    {
      name: 'chromium',
      use: { ...devices['Desktop Chrome'] },
    },
  ],

  /* Run your local dev server before starting the tests */
  webServer: {
    command: 'npm run dev',
    url: 'http://localhost:3000',
    reuseExistingServer: !process.env.CI,
    env: {
      NEXT_PUBLIC_SUPABASE_URL: process.env.NEXT_PUBLIC_SUPABASE_URL || 'http://localhost:54321',
      NEXT_PUBLIC_SUPABASE_ANON_KEY: process.env.NEXT_PUBLIC_SUPABASE_ANON_KEY || 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InRlc3QiLCJyb2xlIjoiYW5vbiIsImlhdCI6MTYwMzk2ODgzNCwiZXhwIjoxOTYwMzk2ODM0fQ.xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx',
    },
  },
});
</file>

<file path="postcss.config.mjs">
/** @type {import('postcss-load-config').Config} */
const config = {
  plugins: {
    '@tailwindcss/postcss': {},
  },
};

export default config;
</file>

<file path="tsconfig.json">
{
  "compilerOptions": {
    "target": "ES2017",
    "lib": ["dom", "dom.iterable", "esnext"],
    "allowJs": true,
    "skipLibCheck": true,
    "strict": true,
    "noEmit": true,
    "esModuleInterop": true,
    "strictNullChecks": false,
    "module": "esnext",
    "moduleResolution": "bundler",
    "resolveJsonModule": true,
    "isolatedModules": true,
    "noImplicitAny": false,
    "jsx": "preserve",
    "incremental": true,
    "plugins": [
      {
        "name": "next"
      }
    ],
    "paths": {
      "@/*": ["./src/*"]
    }
  },
  "include": ["next-env.d.ts", "**/*.ts", "**/*.tsx", ".next/types/**/*.ts"],
  "exclude": ["node_modules"]
}
</file>

<file path="vitest.config.ts">
import { defineConfig } from 'vitest/config';
import react from '@vitejs/plugin-react';
import path from 'path';
import { fileURLToPath } from 'url';

const __dirname = path.dirname(fileURLToPath(import.meta.url));

export default defineConfig({
  plugins: [react()],
  test: {
    globals: true,
    environment: 'happy-dom',
    setupFiles: ['./vitest.setup.ts'],
    exclude: ['**/node_modules/**', '**/e2e/**'],
    coverage: {
      provider: 'v8',
      reporter: ['text', 'json', 'html'],
      exclude: [
        'node_modules/**',
        'e2e/**',
        '**/*.config.{js,ts}',
        '**/types.ts',
        '**/*.d.ts',
      ],
    },
  },
  resolve: {
    alias: {
      '@': path.resolve(__dirname, './src'),
    },
  },
});
</file>

<file path="vitest.d.ts">
import 'vitest';
import type { TestingLibraryMatchers } from '@testing-library/jest-dom/matchers';

declare module 'vitest' {
  interface Assertion<T = any> extends TestingLibraryMatchers<typeof expect.stringContaining, T> {}
  interface AsymmetricMatchersContaining extends TestingLibraryMatchers {}
}
</file>

<file path="vitest.setup.ts">
import { expect, afterEach } from 'vitest';
import { cleanup } from '@testing-library/react';
import * as matchers from '@testing-library/jest-dom/matchers';

// Extend Vitest matchers with Testing Library
expect.extend(matchers);

// Cleanup after each test
afterEach(() => {
  cleanup();
});
</file>

<file path=".ruler/ruler.toml">
# Ruler Configuration File
# See https://ai.intellectronica.net/ruler for documentation.

# To specify which agents are active by default when --agents is not used,
# uncomment and populate the following line. If omitted, all agents are active.
default_agents = ["cursor", "codex", "claude"]

# Enable nested rule loading from nested .ruler directories
# When enabled, ruler will search for and process .ruler directories throughout the project hierarchy
# nested = false

# --- Agent Specific Configurations ---
# You can enable/disable agents and override their default output paths here.
# Use lowercase agent identifiers: amp, copilot, claude, codex, cursor, windsurf, cline, aider, kilocode

# [agents.copilot]
# enabled = true
# output_path = ".github/copilot-instructions.md"

# [agents.aider]
# enabled = true
# output_path_instructions = "AGENTS.md"
# output_path_config = ".aider.conf.yml"

# [agents.gemini-cli]
# enabled = true

# --- MCP Servers ---
# Define Model Context Protocol servers here. Two examples:
# 1. A stdio server (local executable)
# 2. A remote server (HTTP-based)

# [mcp_servers.example_stdio]
# command = "node"
# args = ["scripts/your-mcp-server.js"]
# env = { API_KEY = "replace_me" }

# [mcp_servers.example_remote]
# url = "https://api.example.com/mcp"
# headers = { Authorization = "Bearer REPLACE_ME" }
</file>

<file path=".vooster/project.json">
{
  "uid": "6G09",
  "name": "IndieBlog",
  "description": "í‚¤ì›Œë“œë§Œ ì…ë ¥í•˜ë©´ 5ë¶„ ë‚´ì— ì˜ì–´ì™€ í•œêµ­ì–´ ë¸”ë¡œê·¸ ê¸€, SEO ë©”íƒ€ë°ì´í„°, ë¸Œëœë“œ í†¤ê¹Œì§€ ìë™ ì™„ì„±í•˜ëŠ” AI ì½˜í…ì¸  ìƒì„± SaaSì…ë‹ˆë‹¤.",
  "connectedAt": "2025-11-08T10:13:51.896Z"
}
</file>

<file path="src/app/(protected)/new-article/page.tsx">
"use client";

import { useState } from "react";
import { useForm } from "react-hook-form";
import { zodResolver } from "@hookform/resolvers/zod";
import { useRouter } from "next/navigation";
import { Form } from "@/components/ui/form";
import { Button } from "@/components/ui/button";
import { Card } from "@/components/ui/card";
import { Tabs, TabsContent, TabsList, TabsTrigger } from "@/components/ui/tabs";
import { useToast } from "@/hooks/use-toast";
import { Save, Eye, Search, ArrowLeft, Sparkles } from "lucide-react";
import { ArticleForm } from "@/features/articles/components/article-form";
import { ArticlePreview } from "@/features/articles/components/article-preview";
import { SeoPanel } from "@/features/articles/components/seo-panel";
import { GenerationProgress } from "@/features/articles/components/generation-progress";
import { useCreateArticle } from "@/features/articles/hooks/useCreateArticle";
import { useGenerateArticle } from "@/features/articles/hooks/useGenerateArticle";
import { useStyleGuide } from "@/features/articles/hooks/useStyleGuide";
import {
  ArticleFormSchema,
  defaultArticleFormValues,
  type ArticleFormData,
} from "@/features/articles/lib/article-form-schema";

type NewArticlePageProps = {
  params: Promise<Record<string, never>>;
};

export default function NewArticlePage({ params }: NewArticlePageProps) {
  void params;

  const router = useRouter();
  const { toast } = useToast();
  const [isSaving, setIsSaving] = useState(false);
  const [isGeneratingAI, setIsGeneratingAI] = useState(false);

  const form = useForm<ArticleFormData>({
    resolver: zodResolver(ArticleFormSchema),
    defaultValues: defaultArticleFormValues,
    mode: "onChange",
  });

  const createArticleMutation = useCreateArticle();
  const generateArticleMutation = useGenerateArticle();
  const { data: styleGuideData, isLoading: isLoadingStyleGuide } =
    useStyleGuide();

  const formValues = form.watch();

  const handleSaveDraft = async (data: ArticleFormData) => {
    setIsSaving(true);
    try {
      const result = await createArticleMutation.mutateAsync(data);

      toast({
        title: "ì €ì¥ ì™„ë£Œ",
        description: "ê¸€ì´ ì„±ê³µì ìœ¼ë¡œ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤.",
      });

      router.push(`/dashboard`);
    } catch (error) {
      console.error("Failed to save draft:", error);
      toast({
        title: "ì €ì¥ ì‹¤íŒ¨",
        description:
          error instanceof Error
            ? error.message
            : "ê¸€ ì €ì¥ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.",
        variant: "destructive",
      });
    } finally {
      setIsSaving(false);
    }
  };

  const handleBack = () => {
    if (form.formState.isDirty) {
      const confirmed = window.confirm(
        "ì‘ì„± ì¤‘ì¸ ë‚´ìš©ì´ ìˆìŠµë‹ˆë‹¤. ì •ë§ ë‚˜ê°€ì‹œê² ìŠµë‹ˆê¹Œ?"
      );
      if (!confirmed) return;
    }
    router.back();
  };

  const handleGenerateAI = async () => {
    // AI ìƒì„±ì„ ìœ„í•œ ìµœì†Œ ìš”êµ¬ì‚¬í•­: ìŠ¤íƒ€ì¼ ê°€ì´ë“œ IDë§Œ í•„ìš”
    const styleGuideId = form.getValues("styleGuideId");

    if (!styleGuideId) {
      toast({
        title: "ìŠ¤íƒ€ì¼ ê°€ì´ë“œ í•„ìš”",
        description: "AI ê¸€ ìƒì„±ì„ ìœ„í•´ì„œëŠ” ìŠ¤íƒ€ì¼ ê°€ì´ë“œë¥¼ ì„ íƒí•´ì£¼ì„¸ìš”.",
        variant: "destructive",
      });
      return;
    }

    // ì£¼ì œ ì…ë ¥ ë°›ê¸°
    const topic = window.prompt(
      "ì–´ë–¤ ì£¼ì œë¡œ ê¸€ì„ ì‘ì„±í• ê¹Œìš”?\n\nì˜ˆì‹œ: Next.jsì—ì„œ Server Actions ì‚¬ìš©í•˜ê¸°, React Queryë¡œ ì„œë²„ ìƒíƒœ ê´€ë¦¬í•˜ê¸°"
    );

    if (!topic || !topic.trim()) {
      return;
    }

    setIsGeneratingAI(true);

    try {
      const result = await generateArticleMutation.mutateAsync({
        topic: topic.trim(),
        styleGuideId,
        keywords: form.getValues("keywords") || [],
        additionalInstructions: undefined,
      });

      // ìƒì„±ëœ ì½˜í…ì¸ ë¡œ í¼ í•„ë“œ ìë™ ì±„ìš°ê¸°
      const generatedContent = result.generatedContent;

      form.setValue("title", generatedContent.title);
      form.setValue("content", generatedContent.content);
      form.setValue("description", generatedContent.metaDescription);
      form.setValue("keywords", generatedContent.keywords);
      form.setValue("metaTitle", generatedContent.title);
      form.setValue("metaDescription", generatedContent.metaDescription);

      toast({
        title: "AI ê¸€ ìƒì„± ì™„ë£Œ",
        description: `ê¸€ì´ ì„±ê³µì ìœ¼ë¡œ ìƒì„±ë˜ì—ˆìŠµë‹ˆë‹¤. ë‚¨ì€ ìƒì„± íšŸìˆ˜: ${result.quotaRemaining}íšŒ`,
      });

      setIsGeneratingAI(false);
    } catch (error) {
      console.error("Failed to generate article:", error);
      // ErrorëŠ” GenerationProgress ì»´í¬ë„ŒíŠ¸ì—ì„œ ì²˜ë¦¬
      setIsGeneratingAI(false);
    }
  };

  const handleCancelGeneration = () => {
    setIsGeneratingAI(false);
    generateArticleMutation.reset();
  };

  const handleRetryGeneration = () => {
    generateArticleMutation.reset();
    handleGenerateAI();
  };

  // Style guide data for dropdown
  const styleGuides = styleGuideData
    ? [
        {
          id: styleGuideData.id,
          name: `My Style Guide`,
        },
      ]
    : [];

  return (
    <div className="min-h-screen" style={{ backgroundColor: "#FCFCFD" }}>
      <div className="container mx-auto max-w-[1400px] px-4 py-8">
        {/* Header */}
        <div className="mb-6">
          <Button
            variant="ghost"
            onClick={handleBack}
            className="mb-4 -ml-2"
            style={{ color: "#6B7280" }}
          >
            <ArrowLeft className="mr-2 h-4 w-4" />
            ë’¤ë¡œ ê°€ê¸°
          </Button>

          <div className="flex items-center justify-between">
            <div>
              <h1 className="text-3xl font-bold" style={{ color: "#1F2937" }}>
                ìƒˆ ê¸€ ì‘ì„±
              </h1>
              <p className="mt-1 text-sm" style={{ color: "#6B7280" }}>
                ë¸”ë¡œê·¸ì— ê²Œì‹œí•  ìƒˆë¡œìš´ ê¸€ì„ ì‘ì„±í•˜ì„¸ìš”
              </p>
            </div>
          </div>
        </div>

        <Form {...form}>
          <form onSubmit={form.handleSubmit(handleSaveDraft)}>
            {/* Desktop: 3-column layout */}
            <div className="hidden lg:grid lg:grid-cols-[1fr,350px,350px] lg:gap-6">
              {/* Left: Form */}
              <Card
                className="p-6"
                style={{
                  borderColor: "#E1E5EA",
                  borderRadius: "12px",
                }}
              >
                <ArticleForm
                  form={form}
                  styleGuides={styleGuides}
                  isLoading={isSaving || isLoadingStyleGuide}
                />

                {/* Save Button */}
                <div className="mt-8 flex justify-end border-t pt-6">
                  <Button
                    type="submit"
                    disabled={isSaving || !form.formState.isValid}
                    className="h-12 px-8"
                    style={{
                      backgroundColor: "#3BA2F8",
                      borderRadius: "8px",
                    }}
                  >
                    <Save className="mr-2 h-4 w-4" />
                    {isSaving ? "ì €ì¥ ì¤‘..." : "ì´ˆì•ˆ ì €ì¥"}
                  </Button>
                </div>
              </Card>

              {/* Middle: Preview */}
              <div>
                <ArticlePreview formData={formValues} />
              </div>

              {/* Right: SEO Panel */}
              <div>
                <SeoPanel formData={formValues} />
              </div>
            </div>

            {/* Tablet: 2-column layout (Form + Tabs) */}
            <div className="hidden md:grid md:grid-cols-[1fr,400px] md:gap-6 lg:hidden">
              {/* Left: Form */}
              <Card
                className="p-6"
                style={{
                  borderColor: "#E1E5EA",
                  borderRadius: "12px",
                }}
              >
                <ArticleForm
                  form={form}
                  styleGuides={styleGuides}
                  isLoading={isSaving || isLoadingStyleGuide}
                />

                {/* Save Button */}
                <div className="mt-8 flex justify-end border-t pt-6">
                  <Button
                    type="submit"
                    disabled={isSaving || !form.formState.isValid}
                    className="h-12 px-8"
                    style={{
                      backgroundColor: "#3BA2F8",
                      borderRadius: "8px",
                    }}
                  >
                    <Save className="mr-2 h-4 w-4" />
                    {isSaving ? "ì €ì¥ ì¤‘..." : "ì´ˆì•ˆ ì €ì¥"}
                  </Button>
                </div>
              </Card>

              {/* Right: Tabs (Preview + SEO) */}
              <div>
                <Tabs defaultValue="preview" className="w-full">
                  <TabsList
                    className="grid w-full grid-cols-2"
                    style={{
                      backgroundColor: "#F9FAFB",
                      borderRadius: "8px",
                    }}
                  >
                    <TabsTrigger value="preview" className="gap-2">
                      <Eye className="h-4 w-4" />
                      ë¯¸ë¦¬ë³´ê¸°
                    </TabsTrigger>
                    <TabsTrigger value="seo" className="gap-2">
                      <Search className="h-4 w-4" />
                      SEO
                    </TabsTrigger>
                  </TabsList>
                  <TabsContent value="preview" className="mt-4">
                    <ArticlePreview formData={formValues} />
                  </TabsContent>
                  <TabsContent value="seo" className="mt-4">
                    <SeoPanel formData={formValues} />
                  </TabsContent>
                </Tabs>
              </div>
            </div>

            {/* Mobile: Single column with Tabs */}
            <div className="md:hidden">
              <Tabs defaultValue="form" className="w-full">
                <TabsList
                  className="grid w-full grid-cols-3"
                  style={{
                    backgroundColor: "#F9FAFB",
                    borderRadius: "8px",
                  }}
                >
                  <TabsTrigger value="form" className="text-xs">
                    ì‘ì„±
                  </TabsTrigger>
                  <TabsTrigger value="preview" className="text-xs">
                    <Eye className="mr-1 h-3 w-3" />
                    ë¯¸ë¦¬ë³´ê¸°
                  </TabsTrigger>
                  <TabsTrigger value="seo" className="text-xs">
                    <Search className="mr-1 h-3 w-3" />
                    SEO
                  </TabsTrigger>
                </TabsList>

                <TabsContent value="form" className="mt-4">
                  <Card
                    className="p-4"
                    style={{
                      borderColor: "#E1E5EA",
                      borderRadius: "12px",
                    }}
                  >
                    <ArticleForm
                      form={form}
                      styleGuides={styleGuides}
                      isLoading={isSaving || isLoadingStyleGuide}
                    />

                    {/* Save Button */}
                    <div className="mt-6 border-t pt-6">
                      <Button
                        type="submit"
                        disabled={isSaving || !form.formState.isValid}
                        className="h-12 w-full"
                        style={{
                          backgroundColor: "#3BA2F8",
                          borderRadius: "8px",
                        }}
                      >
                        <Save className="mr-2 h-4 w-4" />
                        {isSaving ? "ì €ì¥ ì¤‘..." : "ì´ˆì•ˆ ì €ì¥"}
                      </Button>
                    </div>
                  </Card>
                </TabsContent>

                <TabsContent value="preview" className="mt-4">
                  <ArticlePreview formData={formValues} />
                </TabsContent>

                <TabsContent value="seo" className="mt-4">
                  <SeoPanel formData={formValues} />
                </TabsContent>
              </Tabs>
            </div>
          </form>
        </Form>
      </div>
    </div>
  );
}
</file>

<file path="src/app/auth/after/page.tsx">
import { auth } from "@clerk/nextjs/server";
import { redirect } from "next/navigation";

export default async function AfterAuthPage() {
  const { userId, sessionClaims } = await auth();

  // ì¸ì¦ë˜ì§€ ì•Šì€ ê²½ìš° ë¡œê·¸ì¸ í˜ì´ì§€ë¡œ ë¦¬ë””ë ‰íŠ¸
  if (!userId) {
    redirect("/sign-in");
  }

  // ì˜¨ë³´ë”© ì™„ë£Œ ì—¬ë¶€ í™•ì¸
  const onboardingCompleted = sessionClaims?.metadata?.onboardingCompleted === true;

  if (onboardingCompleted) {
    // ì˜¨ë³´ë”© ì™„ë£Œ ì‹œ ëŒ€ì‹œë³´ë“œë¡œ ë¦¬ë””ë ‰íŠ¸
    redirect("/dashboard");
  } else {
    // ì˜¨ë³´ë”© ë¯¸ì™„ë£Œ ì‹œ ì˜¨ë³´ë”© í˜ì´ì§€ë¡œ ë¦¬ë””ë ‰íŠ¸
    redirect("/auth/onboarding");
  }
}
</file>

<file path="src/app/login/page.tsx">
import { redirect } from "next/navigation";

export default function LoginPage() {
  redirect("/sign-in");
}
</file>

<file path="src/app/sign-in/[[...sign-in]]/page.tsx">
import { SignIn } from "@clerk/nextjs";
import { clerkAppearance } from "@/lib/clerk-theme";

export default function Page() {
  return (
    <div className="flex min-h-screen items-center justify-center" style={{ backgroundColor: "#FCFCFD" }}>
      <div className="w-full max-w-md px-4">
        <div className="mb-8 text-center">
          <h1 className="text-2xl font-bold text-gray-900 mb-2">ContentCraft AI</h1>
          <p className="text-sm text-gray-600">AI ê¸°ë°˜ ì½˜í…ì¸  ìƒì„± í”Œë«í¼</p>
        </div>
        <SignIn appearance={clerkAppearance} />
      </div>
    </div>
  );
}
</file>

<file path="src/app/sign-up/[[...sign-up]]/page.tsx">
import { SignUp } from "@clerk/nextjs";
import { clerkAppearance } from "@/lib/clerk-theme";

export default function Page() {
  return (
    <div className="flex min-h-screen items-center justify-center" style={{ backgroundColor: "#FCFCFD" }}>
      <div className="w-full max-w-md px-4">
        <div className="mb-8 text-center">
          <h1 className="text-2xl font-bold text-gray-900 mb-2">ContentCraft AI</h1>
          <p className="text-sm text-gray-600">AI ê¸°ë°˜ ì½˜í…ì¸  ìƒì„± í”Œë«í¼</p>
        </div>
        <SignUp appearance={clerkAppearance} />
      </div>
    </div>
  );
}
</file>

<file path="src/app/signup/page.tsx">
import { redirect } from "next/navigation";

export default function SignupPage() {
  redirect("/sign-up");
}
</file>

<file path="src/app/providers.tsx">
// In Next.js, this file would be called: app/providers.tsx
"use client";

// Since QueryClientProvider relies on useContext under the hood, we have to put 'use client' on top
import {
  isServer,
  QueryClient,
  QueryClientProvider,
} from "@tanstack/react-query";
import { ThemeProvider } from "next-themes";
import { Toaster } from "@/components/ui/sonner";

function makeQueryClient() {
  return new QueryClient({
    defaultOptions: {
      queries: {
        // With SSR, we usually want to set some default staleTime
        // above 0 to avoid refetching immediately on the client
        staleTime: 60 * 1000,
      },
    },
  });
}

let browserQueryClient: QueryClient | undefined = undefined;

function getQueryClient() {
  if (isServer) {
    // Server: always make a new query client
    return makeQueryClient();
  } else {
    // Browser: make a new query client if we don't already have one
    // This is very important, so we don't re-make a new client if React
    // suspends during the initial render. This may not be needed if we
    // have a suspense boundary BELOW the creation of the query client
    if (!browserQueryClient) browserQueryClient = makeQueryClient();
    return browserQueryClient;
  }
}

export default function Providers({ children }: { children: React.ReactNode }) {
  // NOTE: Avoid useState when initializing the query client if you don't
  //       have a suspense boundary between this and the code that may
  //       suspend because React will throw away the client on the initial
  //       render if it suspends and there is no boundary
  const queryClient = getQueryClient();

  return (
    <ThemeProvider
      attribute="class"
      defaultTheme="system"
      enableSystem
      forcedTheme="light"
      disableTransitionOnChange
    >
      <QueryClientProvider client={queryClient}>
        {children}
        <Toaster />
      </QueryClientProvider>
    </ThemeProvider>
  );
}
</file>

<file path="src/backend/config/index.ts">
import { z } from 'zod';
import type { AppConfig } from '@/backend/hono/context';

const envSchema = z.object({
  SUPABASE_URL: z.string().url(),
  SUPABASE_SERVICE_ROLE_KEY: z.string().min(1),
  GOOGLE_GENERATIVE_AI_API_KEY: z.string().min(1),
});

let cachedConfig: AppConfig | null = null;

export const getAppConfig = (): AppConfig => {
  if (cachedConfig) {
    return cachedConfig;
  }

  const parsed = envSchema.safeParse({
    SUPABASE_URL: process.env.SUPABASE_URL,
    SUPABASE_SERVICE_ROLE_KEY: process.env.SUPABASE_SERVICE_ROLE_KEY,
    GOOGLE_GENERATIVE_AI_API_KEY: process.env.GOOGLE_GENERATIVE_AI_API_KEY,
  });

  if (!parsed.success) {
    const messages = parsed.error.issues
      .map((issue) => `${issue.path.join('.') || 'config'}: ${issue.message}`)
      .join('; ');
    throw new Error(`Invalid backend configuration: ${messages}`);
  }

  cachedConfig = {
    supabase: {
      url: parsed.data.SUPABASE_URL,
      serviceRoleKey: parsed.data.SUPABASE_SERVICE_ROLE_KEY,
    },
    google: {
      generativeAiApiKey: parsed.data.GOOGLE_GENERATIVE_AI_API_KEY,
    },
  } satisfies AppConfig;

  return cachedConfig;
};
</file>

<file path="src/backend/hono/context.ts">
import type { Context } from 'hono';
import type { SupabaseClient } from '@supabase/supabase-js';

export type AppLogger = Pick<Console, 'info' | 'error' | 'warn' | 'debug'>;

export type AppConfig = {
  supabase: {
    url: string;
    serviceRoleKey: string;
  };
  google: {
    generativeAiApiKey: string;
  };
};

export type AppVariables = {
  supabase: SupabaseClient;
  logger: AppLogger;
  config: AppConfig;
};

export type AppEnv = {
  Variables: AppVariables;
};

export type AppContext = Context<AppEnv>;

export const contextKeys = {
  supabase: 'supabase',
  logger: 'logger',
  config: 'config',
} as const satisfies Record<keyof AppVariables, keyof AppVariables>;

export const getSupabase = (c: AppContext) =>
  c.get(contextKeys.supabase) as SupabaseClient;

export const getLogger = (c: AppContext) =>
  c.get(contextKeys.logger) as AppLogger;

export const getConfig = (c: AppContext) =>
  c.get(contextKeys.config) as AppConfig;
</file>

<file path="src/components/layout/header.tsx">
"use client";

import { SignedIn, SignedOut, SignInButton, UserButton } from "@clerk/nextjs";
import { Logo } from "@/components/brand/logo";
import { Sidebar } from "./sidebar";
import { Button } from "@/components/ui/button";

export function Header() {
  return (
    <header className="flex h-16 items-center justify-between border-b border-gray-200 bg-white px-6">
      <div className="flex items-center gap-4">
        <div className="md:hidden">
          <Sidebar />
        </div>
        <div className="hidden md:block">
          <Logo />
        </div>
      </div>

      <div className="flex items-center gap-4">
        <SignedIn>
          <UserButton
            appearance={{
              elements: {
                avatarBox: "h-9 w-9",
                userButtonTrigger: "focus:shadow-none",
              },
            }}
            afterSignOutUrl="/sign-in"
          />
        </SignedIn>
        <SignedOut>
          <SignInButton mode="modal">
            <Button
              variant="default"
              className="h-10 bg-[#3BA2F8] hover:bg-[#2E91E5] px-6 font-semibold"
            >
              ë¡œê·¸ì¸
            </Button>
          </SignInButton>
        </SignedOut>
      </div>
    </header>
  );
}
</file>

<file path="src/constants/auth.ts">
import { match } from "ts-pattern";

const PUBLIC_PATHS = ["/", "/sign-in", "/sign-up"] as const;
const PUBLIC_PREFIXES = ["/_next", "/api", "/favicon", "/static", "/docs", "/images"] as const;

export const LOGIN_PATH = "/sign-in";
export const SIGNUP_PATH = "/sign-up";
export const AUTH_ENTRY_PATHS = [LOGIN_PATH, SIGNUP_PATH] as const;
export const isAuthEntryPath = (
  pathname: string
): pathname is (typeof AUTH_ENTRY_PATHS)[number] =>
  AUTH_ENTRY_PATHS.includes(pathname as (typeof AUTH_ENTRY_PATHS)[number]);

export const isAuthPublicPath = (pathname: string) => {
  const normalized = pathname.toLowerCase();

  return match(normalized)
    .when(
      (path) => PUBLIC_PATHS.some((publicPath) => publicPath === path),
      () => true
    )
    .when(
      (path) => PUBLIC_PREFIXES.some((prefix) => path.startsWith(prefix)),
      () => true
    )
    .otherwise(() => false);
};

export const shouldProtectPath = (pathname: string) => !isAuthPublicPath(pathname);
</file>

<file path="src/features/articles/actions/article-actions.ts">
"use server";

import { auth } from "@clerk/nextjs/server";
import type {
  CreateArticleRequest,
  UpdateArticleRequest,
  GenerateArticleRequest,
  GenerateArticleResponse,
} from "../lib/dto";

const API_BASE_URL = process.env.NEXT_PUBLIC_APP_URL || "http://localhost:3000";

/**
 * Create a new article draft
 */
export async function createArticleDraft(data: CreateArticleRequest) {
  try {
    const { userId } = await auth();

    if (!userId) {
      throw new Error("Unauthorized");
    }

    const response = await fetch(`${API_BASE_URL}/api/articles/draft`, {
      method: "POST",
      headers: {
        "Content-Type": "application/json",
        "x-clerk-user-id": userId,
      },
      body: JSON.stringify(data),
    });

    if (!response.ok) {
      const errorData = await response.json().catch(() => ({}));
      console.error("Failed to create article draft:", errorData);
      throw new Error(
        errorData.error?.message || "ê¸€ ì‘ì„±ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤"
      );
    }

    const result = await response.json();
    return result.data;
  } catch (error) {
    console.error("Error creating article draft:", error);
    throw new Error(
      error instanceof Error ? error.message : "ê¸€ ì‘ì„± ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤"
    );
  }
}

/**
 * Update an existing article draft
 */
export async function updateArticleDraft(
  articleId: string,
  data: UpdateArticleRequest
) {
  try {
    const { userId } = await auth();

    if (!userId) {
      throw new Error("Unauthorized");
    }

    const response = await fetch(`${API_BASE_URL}/api/articles/${articleId}`, {
      method: "PATCH",
      headers: {
        "Content-Type": "application/json",
        "x-clerk-user-id": userId,
      },
      body: JSON.stringify(data),
    });

    if (!response.ok) {
      const errorData = await response.json().catch(() => ({}));
      console.error("Failed to update article draft:", errorData);
      throw new Error(
        errorData.error?.message || "ê¸€ ìˆ˜ì •ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤"
      );
    }

    const result = await response.json();
    return result.data;
  } catch (error) {
    console.error("Error updating article draft:", error);
    throw new Error(
      error instanceof Error ? error.message : "ê¸€ ìˆ˜ì • ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤"
    );
  }
}

/**
 * Get an article by ID
 */
export async function getArticle(articleId: string) {
  try {
    const { userId } = await auth();

    if (!userId) {
      throw new Error("Unauthorized");
    }

    const response = await fetch(`${API_BASE_URL}/api/articles/${articleId}`, {
      method: "GET",
      headers: {
        "x-clerk-user-id": userId,
      },
      cache: "no-store",
    });

    if (!response.ok) {
      const errorData = await response.json().catch(() => ({}));
      console.error("Failed to get article:", errorData);
      throw new Error(
        errorData.error?.message || "ê¸€ì„ ë¶ˆëŸ¬ì˜¤ëŠ”ë° ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤"
      );
    }

    const result = await response.json();
    return result.data;
  } catch (error) {
    console.error("Error getting article:", error);
    throw new Error(
      error instanceof Error
        ? error.message
        : "ê¸€ì„ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤"
    );
  }
}

/**
 * Get user's style guide
 */
export async function getUserStyleGuide() {
  try {
    const { userId } = await auth();

    if (!userId) {
      throw new Error("Unauthorized");
    }

    const response = await fetch(
      `${API_BASE_URL}/api/style-guides/${userId}`,
      {
        method: "GET",
        headers: {
          "x-clerk-user-id": userId,
        },
        cache: "no-store",
      }
    );

    if (!response.ok) {
      const errorData = await response.json().catch(() => ({}));
      console.error("Failed to get style guide:", errorData);
      throw new Error(
        errorData.error?.message || "ìŠ¤íƒ€ì¼ ê°€ì´ë“œë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ”ë° ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤"
      );
    }

    const result = await response.json();
    return result.data;
  } catch (error) {
    console.error("Error getting style guide:", error);
    throw new Error(
      error instanceof Error
        ? error.message
        : "ìŠ¤íƒ€ì¼ ê°€ì´ë“œë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤"
    );
  }
}

/**
 * Generate article using AI
 */
export async function generateArticleAction(
  data: GenerateArticleRequest
): Promise<GenerateArticleResponse> {
  try {
    const { userId } = await auth();

    if (!userId) {
      throw new Error("Unauthorized");
    }

    const response = await fetch(`${API_BASE_URL}/api/articles/generate`, {
      method: "POST",
      headers: {
        "Content-Type": "application/json",
        "x-clerk-user-id": userId,
      },
      body: JSON.stringify(data),
    });

    if (!response.ok) {
      const errorData = await response.json().catch(() => ({}));
      console.error("Failed to generate article:", errorData);

      // Handle specific error codes
      if (errorData.error?.code === "QUOTA_EXCEEDED") {
        throw new Error(
          `ìƒì„± íšŸìˆ˜ ì œí•œì— ë„ë‹¬í–ˆìŠµë‹ˆë‹¤. (${errorData.error.details?.currentCount}/${errorData.error.details?.limit})`
        );
      }

      throw new Error(
        errorData.error?.message || "AI ê¸€ ìƒì„±ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤"
      );
    }

    const result = await response.json();
    return result.data;
  } catch (error) {
    console.error("Error generating article:", error);
    throw new Error(
      error instanceof Error
        ? error.message
        : "AI ê¸€ ìƒì„± ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤"
    );
  }
}
</file>

<file path="src/features/articles/backend/error.ts">
export const articleErrorCodes = {
  unauthorized: 'ARTICLE_UNAUTHORIZED',
  notFound: 'ARTICLE_NOT_FOUND',
  validationError: 'ARTICLE_VALIDATION_ERROR',
  createError: 'ARTICLE_CREATE_ERROR',
  updateError: 'ARTICLE_UPDATE_ERROR',
  deleteError: 'ARTICLE_DELETE_ERROR',
  fetchError: 'ARTICLE_FETCH_ERROR',
  quotaExceeded: 'QUOTA_EXCEEDED',
  aiGenerationFailed: 'AI_GENERATION_FAILED',
  styleGuideNotFound: 'STYLE_GUIDE_NOT_FOUND',
  quotaCheckFailed: 'QUOTA_CHECK_FAILED',
  quotaIncrementFailed: 'QUOTA_INCREMENT_FAILED',
} as const;

type ArticleErrorValue =
  (typeof articleErrorCodes)[keyof typeof articleErrorCodes];

export type ArticleServiceError = ArticleErrorValue;
</file>

<file path="src/features/articles/backend/route.ts">
import type { Hono } from 'hono';
import {
  failure,
  success,
  respond,
  type ErrorResult,
} from '@/backend/http/response';
import {
  getLogger,
  getSupabase,
  getConfig,
  type AppEnv,
} from '@/backend/hono/context';
import {
  CreateArticleRequestSchema,
  UpdateArticleRequestSchema,
  GenerateArticleRequestSchema,
} from '@/features/articles/backend/schema';
import {
  createArticle,
  getArticleById,
  updateArticle,
  deleteArticle,
} from './service';
import {
  articleErrorCodes,
  type ArticleServiceError,
} from './error';
import { generateArticleContent } from './ai-service';
import { checkQuota, incrementQuota } from './quota-service';
import { generateUniqueSlug } from '@/lib/slug';

export const registerArticlesRoutes = (app: Hono<AppEnv>) => {
  /**
   * POST /api/articles/draft
   * Creates a new article draft
   *
   * Request body: CreateArticleRequest
   * Headers: x-clerk-user-id (required)
   */
  app.post('/api/articles/draft', async (c) => {
    // Get userId from header (passed from server action)
    const userId = c.req.header('x-clerk-user-id');

    if (!userId) {
      return respond(
        c,
        failure(
          401,
          articleErrorCodes.unauthorized,
          'User ID is required. Please provide x-clerk-user-id header.',
        ),
      );
    }

    // Parse and validate request body
    const body = await c.req.json();
    const parsedBody = CreateArticleRequestSchema.safeParse(body);

    if (!parsedBody.success) {
      return respond(
        c,
        failure(
          400,
          articleErrorCodes.validationError,
          'Invalid request body. Please check your input.',
          parsedBody.error.format(),
        ),
      );
    }

    const supabase = getSupabase(c);
    const logger = getLogger(c);

    // Create article draft
    const result = await createArticle(supabase, userId, parsedBody.data);

    if (!result.ok) {
      const errorResult = result as ErrorResult<ArticleServiceError, unknown>;
      logger.error('Failed to create article draft', errorResult.error.message);
      return respond(c, result);
    }

    logger.info('Article draft created successfully', { userId, articleId: result.data.id });
    return respond(c, result);
  });

  /**
   * GET /api/articles/:id
   * Gets an article by ID
   *
   * URL params: id (article UUID)
   * Headers: x-clerk-user-id (required)
   */
  app.get('/api/articles/:id', async (c) => {
    // Get userId from header
    const userId = c.req.header('x-clerk-user-id');

    if (!userId) {
      return respond(
        c,
        failure(
          401,
          articleErrorCodes.unauthorized,
          'User ID is required. Please provide x-clerk-user-id header.',
        ),
      );
    }

    const articleId = c.req.param('id');

    if (!articleId) {
      return respond(
        c,
        failure(
          400,
          articleErrorCodes.validationError,
          'Article ID is required.',
        ),
      );
    }

    const supabase = getSupabase(c);
    const logger = getLogger(c);

    // Get article
    const result = await getArticleById(supabase, userId, articleId);

    if (!result.ok) {
      const errorResult = result as ErrorResult<ArticleServiceError, unknown>;
      logger.error('Failed to get article', errorResult.error.message);
      return respond(c, result);
    }

    logger.info('Article retrieved successfully', { userId, articleId });
    return respond(c, result);
  });

  /**
   * PATCH /api/articles/:id
   * Updates an article
   *
   * URL params: id (article UUID)
   * Request body: UpdateArticleRequest
   * Headers: x-clerk-user-id (required)
   */
  app.patch('/api/articles/:id', async (c) => {
    // Get userId from header
    const userId = c.req.header('x-clerk-user-id');

    if (!userId) {
      return respond(
        c,
        failure(
          401,
          articleErrorCodes.unauthorized,
          'User ID is required. Please provide x-clerk-user-id header.',
        ),
      );
    }

    const articleId = c.req.param('id');

    if (!articleId) {
      return respond(
        c,
        failure(
          400,
          articleErrorCodes.validationError,
          'Article ID is required.',
        ),
      );
    }

    // Parse and validate request body
    const body = await c.req.json();
    const parsedBody = UpdateArticleRequestSchema.safeParse(body);

    if (!parsedBody.success) {
      return respond(
        c,
        failure(
          400,
          articleErrorCodes.validationError,
          'Invalid request body. Please check your input.',
          parsedBody.error.format(),
        ),
      );
    }

    const supabase = getSupabase(c);
    const logger = getLogger(c);

    // Update article
    const result = await updateArticle(
      supabase,
      userId,
      articleId,
      parsedBody.data,
    );

    if (!result.ok) {
      const errorResult = result as ErrorResult<ArticleServiceError, unknown>;
      logger.error('Failed to update article', errorResult.error.message);
      return respond(c, result);
    }

    logger.info('Article updated successfully', { userId, articleId });
    return respond(c, result);
  });

  /**
   * DELETE /api/articles/:id
   * Deletes an article
   *
   * URL params: id (article UUID)
   * Headers: x-clerk-user-id (required)
   */
  app.delete('/api/articles/:id', async (c) => {
    // Get userId from header
    const userId = c.req.header('x-clerk-user-id');

    if (!userId) {
      return respond(
        c,
        failure(
          401,
          articleErrorCodes.unauthorized,
          'User ID is required. Please provide x-clerk-user-id header.',
        ),
      );
    }

    const articleId = c.req.param('id');

    if (!articleId) {
      return respond(
        c,
        failure(
          400,
          articleErrorCodes.validationError,
          'Article ID is required.',
        ),
      );
    }

    const supabase = getSupabase(c);
    const logger = getLogger(c);

    // Delete article
    const result = await deleteArticle(supabase, userId, articleId);

    if (!result.ok) {
      const errorResult = result as ErrorResult<ArticleServiceError, unknown>;
      logger.error('Failed to delete article', errorResult.error.message);
      return respond(c, result);
    }

    logger.info('Article deleted successfully', { userId, articleId });
    return respond(c, result);
  });

  /**
   * POST /api/articles/generate
   * Generates a new article using AI (Google Gemini)
   *
   * Request body: GenerateArticleRequest
   * Headers: x-clerk-user-id (required)
   */
  app.post('/api/articles/generate', async (c) => {
    // Get userId from header
    const userId = c.req.header('x-clerk-user-id');

    if (!userId) {
      return respond(
        c,
        failure(
          401,
          articleErrorCodes.unauthorized,
          'User ID is required. Please provide x-clerk-user-id header.',
        ),
      );
    }

    // Parse and validate request body
    const body = await c.req.json();
    const parsedBody = GenerateArticleRequestSchema.safeParse(body);

    if (!parsedBody.success) {
      return respond(
        c,
        failure(
          400,
          articleErrorCodes.validationError,
          'Invalid request body. Please check your input.',
          parsedBody.error.format(),
        ),
      );
    }

    const supabase = getSupabase(c);
    const logger = getLogger(c);
    const config = getConfig(c);

    // Step 1: Check quota
    const quotaCheckResult = await checkQuota(supabase, userId);

    if (!quotaCheckResult.ok) {
      const errorResult = quotaCheckResult as ErrorResult<ArticleServiceError, unknown>;
      logger.error('Quota check failed', errorResult.error.message);
      return respond(c, quotaCheckResult);
    }

    if (!quotaCheckResult.data.allowed) {
      return respond(
        c,
        failure(
          429,
          articleErrorCodes.quotaExceeded,
          `Generation quota exceeded. You have used ${quotaCheckResult.data.currentCount}/${quotaCheckResult.data.limit} generations.`,
          {
            tier: quotaCheckResult.data.tier,
            currentCount: quotaCheckResult.data.currentCount,
            limit: quotaCheckResult.data.limit,
          },
        ),
      );
    }

    // Step 2: Generate article content using AI
    const generationResult = await generateArticleContent(
      supabase,
      userId,
      config.google.generativeAiApiKey,
      parsedBody.data,
    );

    if (!generationResult.ok) {
      const errorResult = generationResult as ErrorResult<ArticleServiceError, unknown>;
      logger.error('AI generation failed', errorResult.error.message);
      return respond(c, generationResult);
    }

    const generatedContent = generationResult.data;

    // Step 3: Create article in database
    const slug = generateUniqueSlug(generatedContent.title);

    const createArticleData = {
      title: generatedContent.title,
      slug,
      keywords: generatedContent.keywords,
      description: generatedContent.metaDescription,
      content: generatedContent.content,
      styleGuideId: parsedBody.data.styleGuideId,
      metaTitle: generatedContent.title,
      metaDescription: generatedContent.metaDescription,
    };

    const articleResult = await createArticle(supabase, userId, createArticleData);

    if (!articleResult.ok) {
      const errorResult = articleResult as ErrorResult<ArticleServiceError, unknown>;
      logger.error('Failed to save generated article', errorResult.error.message);
      return respond(c, articleResult);
    }

    // Step 4: Increment quota
    const incrementResult = await incrementQuota(supabase, userId);

    if (!incrementResult.ok) {
      const errorResult = incrementResult as ErrorResult<ArticleServiceError, unknown>;
      logger.warn('Failed to increment quota after article creation', errorResult.error.message);
      // Continue anyway since article was created successfully
    }

    const quotaRemaining = incrementResult.ok
      ? incrementResult.data.remaining
      : quotaCheckResult.data.remaining - 1;

    logger.info('Article generated successfully', {
      userId,
      articleId: articleResult.data.id,
      quotaRemaining,
    });

    // Return response
    return respond(
      c,
      success(
        {
          article: articleResult.data,
          generatedContent,
          quotaRemaining,
        },
        201,
      ),
    );
  });
};
</file>

<file path="src/features/articles/backend/schema.ts">
import { z } from 'zod';

// Article status enum
export const ArticleStatusSchema = z.enum(['draft', 'published', 'archived']);

// Reuse enums from style_guides (defined in onboarding schema)
export const ContentToneSchema = z.enum([
  'professional',
  'friendly',
  'inspirational',
  'educational',
]);

export const ContentLengthSchema = z.enum(['short', 'medium', 'long']);

export const ReadingLevelSchema = z.enum([
  'beginner',
  'intermediate',
  'advanced',
]);

// Create Article Request Schema
export const CreateArticleRequestSchema = z.object({
  title: z
    .string()
    .min(1, 'ì œëª©ì„ ì…ë ¥í•´ì£¼ì„¸ìš”')
    .max(200, 'ì œëª©ì€ 200ì ì´ë‚´ë¡œ ì…ë ¥í•´ì£¼ì„¸ìš”'),
  slug: z
    .string()
    .min(1, 'URL ìŠ¬ëŸ¬ê·¸ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”')
    .max(200, 'ìŠ¬ëŸ¬ê·¸ëŠ” 200ì ì´ë‚´ë¡œ ì…ë ¥í•´ì£¼ì„¸ìš”')
    .regex(
      /^[a-z0-9]+(?:-[a-z0-9]+)*$/,
      'ìŠ¬ëŸ¬ê·¸ëŠ” ì†Œë¬¸ì, ìˆ«ì, í•˜ì´í”ˆ(-)ë§Œ ì‚¬ìš© ê°€ëŠ¥í•©ë‹ˆë‹¤',
    ),
  keywords: z.array(z.string()).default([]),
  description: z.string().max(500, 'ì„¤ëª…ì€ 500ì ì´ë‚´ë¡œ ì…ë ¥í•´ì£¼ì„¸ìš”').optional(),
  content: z.string().min(1, 'ë‚´ìš©ì„ ì…ë ¥í•´ì£¼ì„¸ìš”'),
  styleGuideId: z.string().uuid('ìœ íš¨í•˜ì§€ ì•Šì€ ìŠ¤íƒ€ì¼ ê°€ì´ë“œ IDì…ë‹ˆë‹¤').optional(),
  tone: ContentToneSchema.optional(),
  contentLength: ContentLengthSchema.optional(),
  readingLevel: ReadingLevelSchema.optional(),
  metaTitle: z.string().max(60, 'Meta ì œëª©ì€ 60ì ì´ë‚´ë¡œ ì…ë ¥í•´ì£¼ì„¸ìš”').optional(),
  metaDescription: z
    .string()
    .max(160, 'Meta ì„¤ëª…ì€ 160ì ì´ë‚´ë¡œ ì…ë ¥í•´ì£¼ì„¸ìš”')
    .optional(),
});

export type CreateArticleRequest = z.infer<typeof CreateArticleRequestSchema>;

// Update Article Request Schema
export const UpdateArticleRequestSchema = z.object({
  title: z
    .string()
    .min(1, 'ì œëª©ì„ ì…ë ¥í•´ì£¼ì„¸ìš”')
    .max(200, 'ì œëª©ì€ 200ì ì´ë‚´ë¡œ ì…ë ¥í•´ì£¼ì„¸ìš”')
    .optional(),
  slug: z
    .string()
    .min(1, 'URL ìŠ¬ëŸ¬ê·¸ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”')
    .max(200, 'ìŠ¬ëŸ¬ê·¸ëŠ” 200ì ì´ë‚´ë¡œ ì…ë ¥í•´ì£¼ì„¸ìš”')
    .regex(
      /^[a-z0-9]+(?:-[a-z0-9]+)*$/,
      'ìŠ¬ëŸ¬ê·¸ëŠ” ì†Œë¬¸ì, ìˆ«ì, í•˜ì´í”ˆ(-)ë§Œ ì‚¬ìš© ê°€ëŠ¥í•©ë‹ˆë‹¤',
    )
    .optional(),
  keywords: z.array(z.string()).optional(),
  description: z.string().max(500, 'ì„¤ëª…ì€ 500ì ì´ë‚´ë¡œ ì…ë ¥í•´ì£¼ì„¸ìš”').optional(),
  content: z.string().min(1, 'ë‚´ìš©ì„ ì…ë ¥í•´ì£¼ì„¸ìš”').optional(),
  styleGuideId: z.string().uuid('ìœ íš¨í•˜ì§€ ì•Šì€ ìŠ¤íƒ€ì¼ ê°€ì´ë“œ IDì…ë‹ˆë‹¤').optional(),
  tone: ContentToneSchema.optional(),
  contentLength: ContentLengthSchema.optional(),
  readingLevel: ReadingLevelSchema.optional(),
  metaTitle: z.string().max(60, 'Meta ì œëª©ì€ 60ì ì´ë‚´ë¡œ ì…ë ¥í•´ì£¼ì„¸ìš”').optional(),
  metaDescription: z
    .string()
    .max(160, 'Meta ì„¤ëª…ì€ 160ì ì´ë‚´ë¡œ ì…ë ¥í•´ì£¼ì„¸ìš”')
    .optional(),
  status: ArticleStatusSchema.optional(),
});

export type UpdateArticleRequest = z.infer<typeof UpdateArticleRequestSchema>;

// Database row schema (snake_case to match database columns)
export const ArticleTableRowSchema = z.object({
  id: z.string().uuid(),
  clerk_user_id: z.string(),
  title: z.string(),
  slug: z.string(),
  keywords: z.array(z.string()),
  description: z.string().nullable(),
  content: z.string(),
  style_guide_id: z.string().uuid().nullable(),
  tone: ContentToneSchema.nullable(),
  content_length: ContentLengthSchema.nullable(),
  reading_level: ReadingLevelSchema.nullable(),
  meta_title: z.string().nullable(),
  meta_description: z.string().nullable(),
  status: ArticleStatusSchema,
  published_at: z.string().nullable(),
  created_at: z.string(),
  updated_at: z.string(),
});

export type ArticleRow = z.infer<typeof ArticleTableRowSchema>;

// Response schema (camelCase for API responses)
export const ArticleResponseSchema = z.object({
  id: z.string().uuid(),
  clerkUserId: z.string(),
  title: z.string(),
  slug: z.string(),
  keywords: z.array(z.string()),
  description: z.string().nullable(),
  content: z.string(),
  styleGuideId: z.string().uuid().nullable(),
  tone: ContentToneSchema.nullable(),
  contentLength: ContentLengthSchema.nullable(),
  readingLevel: ReadingLevelSchema.nullable(),
  metaTitle: z.string().nullable(),
  metaDescription: z.string().nullable(),
  status: ArticleStatusSchema,
  publishedAt: z.string().nullable(),
  createdAt: z.string(),
  updatedAt: z.string(),
});

export type ArticleResponse = z.infer<typeof ArticleResponseSchema>;

// Generate Article Request Schema
export const GenerateArticleRequestSchema = z.object({
  topic: z
    .string()
    .min(1, 'ì£¼ì œë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”')
    .max(200, 'ì£¼ì œëŠ” 200ì ì´ë‚´ë¡œ ì…ë ¥í•´ì£¼ì„¸ìš”'),
  styleGuideId: z
    .string()
    .uuid('ìœ íš¨í•˜ì§€ ì•Šì€ ìŠ¤íƒ€ì¼ ê°€ì´ë“œ IDì…ë‹ˆë‹¤')
    .optional(),
  keywords: z.array(z.string()).optional().default([]),
  additionalInstructions: z
    .string()
    .max(1000, 'ì¶”ê°€ ì§€ì‹œì‚¬í•­ì€ 1000ì ì´ë‚´ë¡œ ì…ë ¥í•´ì£¼ì„¸ìš”')
    .optional(),
});

export type GenerateArticleRequest = z.infer<typeof GenerateArticleRequestSchema>;

// AI Generated Content Schema (from Gemini)
export const AIGeneratedContentSchema = z.object({
  title: z.string(),
  content: z.string(),
  metaDescription: z.string(),
  keywords: z.array(z.string()),
  headings: z.array(z.string()),
});

export type AIGeneratedContent = z.infer<typeof AIGeneratedContentSchema>;

// Generate Article Response Schema
export const GenerateArticleResponseSchema = z.object({
  article: ArticleResponseSchema,
  generatedContent: AIGeneratedContentSchema,
  quotaRemaining: z.number(),
});

export type GenerateArticleResponse = z.infer<typeof GenerateArticleResponseSchema>;
</file>

<file path="src/features/articles/lib/dto.ts">
// Re-export backend schemas for use in frontend (React Query hooks, etc.)
export {
  CreateArticleRequestSchema,
  UpdateArticleRequestSchema,
  ArticleResponseSchema,
  ArticleStatusSchema,
  ContentToneSchema,
  ContentLengthSchema,
  ReadingLevelSchema,
  GenerateArticleRequestSchema,
  GenerateArticleResponseSchema,
  AIGeneratedContentSchema,
  type CreateArticleRequest,
  type UpdateArticleRequest,
  type ArticleResponse,
  type GenerateArticleRequest,
  type GenerateArticleResponse,
  type AIGeneratedContent,
} from '@/features/articles/backend/schema';
</file>

<file path="src/features/auth/context/current-user-context.tsx">
"use client";

import {
  createContext,
  useCallback,
  useContext,
  useMemo,
  useState,
  type ReactNode,
} from "react";
import { useQueryClient } from "@tanstack/react-query";
import { useUser } from "@clerk/nextjs";
import type {
  CurrentUserContextValue,
  CurrentUserSnapshot,
} from "../types";

const CurrentUserContext = createContext<CurrentUserContextValue | null>(null);

type CurrentUserProviderProps = {
  children: ReactNode;
  initialState: CurrentUserSnapshot;
};

export const CurrentUserProvider = ({
  children,
  initialState,
}: CurrentUserProviderProps) => {
  const queryClient = useQueryClient();
  const { user: clerkUser, isLoaded } = useUser();
  const [snapshot, setSnapshot] = useState<CurrentUserSnapshot>(initialState);

  const refresh = useCallback(async () => {
    if (!isLoaded) return;

    const nextSnapshot: CurrentUserSnapshot = clerkUser
      ? {
          status: "authenticated",
          user: {
            id: clerkUser.id,
            email: clerkUser.emailAddresses[0]?.emailAddress ?? null,
            appMetadata: {},
            userMetadata: {},
          },
        }
      : { status: "unauthenticated", user: null };

    setSnapshot(nextSnapshot);
    queryClient.setQueryData(["currentUser"], nextSnapshot);
  }, [clerkUser, isLoaded, queryClient]);

  const value = useMemo<CurrentUserContextValue>(() => {
    const currentSnapshot: CurrentUserSnapshot = clerkUser
      ? {
          status: "authenticated",
          user: {
            id: clerkUser.id,
            email: clerkUser.emailAddresses[0]?.emailAddress ?? null,
            appMetadata: {},
            userMetadata: {},
          },
        }
      : isLoaded
        ? { status: "unauthenticated", user: null }
        : snapshot;

    return {
      ...currentSnapshot,
      refresh,
      isAuthenticated: currentSnapshot.status === "authenticated",
      isLoading: !isLoaded,
    };
  }, [clerkUser, isLoaded, refresh, snapshot]);

  return (
    <CurrentUserContext.Provider value={value}>
      {children}
    </CurrentUserContext.Provider>
  );
};

export const useCurrentUserContext = () => {
  const value = useContext(CurrentUserContext);

  if (!value) {
    throw new Error("CurrentUserProviderê°€ íŠ¸ë¦¬ ìƒë‹¨ì— í•„ìš”í•©ë‹ˆë‹¤.");
  }

  return value;
};
</file>

<file path="src/features/auth/server/load-current-user.ts">
import "server-only";

import { currentUser } from "@clerk/nextjs/server";
import type { CurrentUserSnapshot } from "../types";

export const loadCurrentUser = async (): Promise<CurrentUserSnapshot> => {
  try {
    const user = await currentUser();

    if (user) {
      return {
        status: "authenticated",
        user: {
          id: user.id,
          email: user.emailAddresses[0]?.emailAddress ?? null,
          appMetadata: {},
          userMetadata: {},
        },
      };
    }

    return { status: "unauthenticated", user: null };
  } catch (error) {
    // If currentUser() fails (e.g., called outside clerkMiddleware scope),
    // treat as unauthenticated
    console.warn("Failed to load current user:", error);
    return { status: "unauthenticated", user: null };
  }
};
</file>

<file path="src/features/onboarding/backend/error.ts">
export const styleGuideErrorCodes = {
  unauthorized: 'STYLE_GUIDE_UNAUTHORIZED',
  notFound: 'STYLE_GUIDE_NOT_FOUND',
  createError: 'STYLE_GUIDE_CREATE_ERROR',
  validationError: 'STYLE_GUIDE_VALIDATION_ERROR',
  upsertError: 'STYLE_GUIDE_UPSERT_ERROR',
  fetchError: 'STYLE_GUIDE_FETCH_ERROR',
} as const;

type StyleGuideErrorValue = (typeof styleGuideErrorCodes)[keyof typeof styleGuideErrorCodes];

export type StyleGuideServiceError = StyleGuideErrorValue;
</file>

<file path="src/features/onboarding/backend/route.ts">
import type { Hono } from 'hono';
import {
  failure,
  respond,
  type ErrorResult,
} from '@/backend/http/response';
import {
  getLogger,
  getSupabase,
  type AppEnv,
} from '@/backend/hono/context';
import { CreateStyleGuideRequestSchema } from '@/features/onboarding/backend/schema';
import { upsertStyleGuide, getStyleGuide } from './service';
import {
  styleGuideErrorCodes,
  type StyleGuideServiceError,
} from './error';

export const registerOnboardingRoutes = (app: Hono<AppEnv>) => {
  /**
   * POST /api/style-guides
   * Creates or updates a style guide for a user
   *
   * Request body: OnboardingFormData
   * Headers: x-clerk-user-id (required)
   */
  app.post('/api/style-guides', async (c) => {
    // Get userId from header (passed from server action)
    const userId = c.req.header('x-clerk-user-id');

    if (!userId) {
      return respond(
        c,
        failure(
          401,
          styleGuideErrorCodes.unauthorized,
          'User ID is required. Please provide x-clerk-user-id header.',
        ),
      );
    }

    // Parse and validate request body
    const body = await c.req.json();
    const parsedBody = CreateStyleGuideRequestSchema.safeParse(body);

    if (!parsedBody.success) {
      return respond(
        c,
        failure(
          400,
          styleGuideErrorCodes.validationError,
          'Invalid request body. Please check your input.',
          parsedBody.error.format(),
        ),
      );
    }

    const supabase = getSupabase(c);
    const logger = getLogger(c);

    // Save to database
    const result = await upsertStyleGuide(supabase, userId, parsedBody.data);

    if (!result.ok) {
      const errorResult = result as ErrorResult<StyleGuideServiceError, unknown>;
      logger.error('Failed to save style guide', errorResult.error.message);
      return respond(c, result);
    }

    logger.info('Style guide saved successfully', { userId });
    return respond(c, result);
  });

  /**
   * GET /api/style-guides/:userId
   * Gets the style guide for a user
   *
   * URL params: userId (Clerk user ID)
   * Headers: x-clerk-user-id (required for authorization)
   */
  app.get('/api/style-guides/:userId', async (c) => {
    // Get requesting user ID from header
    const requestingUserId = c.req.header('x-clerk-user-id');

    if (!requestingUserId) {
      return respond(
        c,
        failure(
          401,
          styleGuideErrorCodes.unauthorized,
          'User ID is required. Please provide x-clerk-user-id header.',
        ),
      );
    }

    // Get target user ID from URL param
    const targetUserId = c.req.param('userId');

    if (!targetUserId) {
      return respond(
        c,
        failure(
          400,
          styleGuideErrorCodes.validationError,
          'User ID parameter is required.',
        ),
      );
    }

    // Verify that requesting user can only access their own style guide
    if (requestingUserId !== targetUserId) {
      return respond(
        c,
        failure(
          403,
          styleGuideErrorCodes.unauthorized,
          'You can only access your own style guide.',
        ),
      );
    }

    const supabase = getSupabase(c);
    const logger = getLogger(c);

    // Get style guide
    const result = await getStyleGuide(supabase, targetUserId);

    if (!result.ok) {
      const errorResult = result as ErrorResult<StyleGuideServiceError, unknown>;
      logger.error('Failed to get style guide', errorResult.error.message);
      return respond(c, result);
    }

    logger.info('Style guide retrieved successfully', { userId: targetUserId });
    return respond(c, result);
  });
};
</file>

<file path="src/features/onboarding/backend/service.ts">
import type { SupabaseClient } from '@supabase/supabase-js';
import {
  failure,
  success,
  type HandlerResult,
} from '@/backend/http/response';
import {
  StyleGuideTableRowSchema,
  StyleGuideResponseSchema,
  type StyleGuideResponse,
  type CreateStyleGuideRequest,
} from '@/features/onboarding/backend/schema';
import {
  styleGuideErrorCodes,
  type StyleGuideServiceError,
} from '@/features/onboarding/backend/error';

const STYLE_GUIDES_TABLE = 'style_guides';

/**
 * Creates or updates a style guide for a user
 * Uses UPSERT to handle repeat onboarding flows
 */
export const upsertStyleGuide = async (
  client: SupabaseClient,
  clerkUserId: string,
  data: CreateStyleGuideRequest,
): Promise<HandlerResult<StyleGuideResponse, StyleGuideServiceError, unknown>> => {
  // Map camelCase TypeScript to snake_case database columns
  const dbRecord = {
    clerk_user_id: clerkUserId,
    brand_name: data.brandName,
    brand_description: data.brandDescription,
    personality: data.personality,
    formality: data.formality,
    target_audience: data.targetAudience,
    pain_points: data.painPoints,
    language: data.language,
    tone: data.tone,
    content_length: data.contentLength,
    reading_level: data.readingLevel,
    notes: data.notes || null,
    is_default: true, // Always true for MVP (one guide per user)
  };

  // Use UPSERT to handle users going through onboarding multiple times
  const { data: savedData, error } = await client
    .from(STYLE_GUIDES_TABLE)
    .upsert(dbRecord, {
      onConflict: 'clerk_user_id', // Update if user already exists
      ignoreDuplicates: false,
    })
    .select('*')
    .single();

  if (error) {
    return failure(
      500,
      styleGuideErrorCodes.upsertError,
      `Failed to save style guide: ${error.message}`,
    );
  }

  if (!savedData) {
    return failure(
      500,
      styleGuideErrorCodes.upsertError,
      'Style guide was saved but no data was returned',
    );
  }

  // Validate the database row
  const rowParse = StyleGuideTableRowSchema.safeParse(savedData);

  if (!rowParse.success) {
    return failure(
      500,
      styleGuideErrorCodes.validationError,
      'Style guide row failed validation.',
      rowParse.error.format(),
    );
  }

  // Map snake_case database columns to camelCase response
  const mapped = {
    id: rowParse.data.id,
    clerkUserId: rowParse.data.clerk_user_id,
    brandName: rowParse.data.brand_name,
    brandDescription: rowParse.data.brand_description,
    personality: rowParse.data.personality,
    formality: rowParse.data.formality,
    targetAudience: rowParse.data.target_audience,
    painPoints: rowParse.data.pain_points,
    language: rowParse.data.language,
    tone: rowParse.data.tone,
    contentLength: rowParse.data.content_length,
    readingLevel: rowParse.data.reading_level,
    notes: rowParse.data.notes,
    isDefault: rowParse.data.is_default,
    createdAt: rowParse.data.created_at,
    updatedAt: rowParse.data.updated_at,
  } satisfies StyleGuideResponse;

  // Validate the response
  const parsed = StyleGuideResponseSchema.safeParse(mapped);

  if (!parsed.success) {
    return failure(
      500,
      styleGuideErrorCodes.validationError,
      'Style guide response failed validation.',
      parsed.error.format(),
    );
  }

  return success(parsed.data, 201);
};

/**
 * Gets the style guide for a user
 * Returns the user's default style guide (one guide per user in MVP)
 */
export const getStyleGuide = async (
  client: SupabaseClient,
  clerkUserId: string,
): Promise<HandlerResult<StyleGuideResponse, StyleGuideServiceError, unknown>> => {
  const { data, error } = await client
    .from(STYLE_GUIDES_TABLE)
    .select('*')
    .eq('clerk_user_id', clerkUserId)
    .single();

  if (error) {
    if (error.code === 'PGRST116') {
      return failure(404, styleGuideErrorCodes.notFound, 'Style guide not found');
    }
    return failure(
      500,
      styleGuideErrorCodes.fetchError,
      `Failed to fetch style guide: ${error.message}`,
    );
  }

  if (!data) {
    return failure(404, styleGuideErrorCodes.notFound, 'Style guide not found');
  }

  // Validate the database row
  const rowParse = StyleGuideTableRowSchema.safeParse(data);

  if (!rowParse.success) {
    return failure(
      500,
      styleGuideErrorCodes.validationError,
      'Style guide row failed validation.',
      rowParse.error.format(),
    );
  }

  // Map snake_case database columns to camelCase response
  const mapped = {
    id: rowParse.data.id,
    clerkUserId: rowParse.data.clerk_user_id,
    brandName: rowParse.data.brand_name,
    brandDescription: rowParse.data.brand_description,
    personality: rowParse.data.personality,
    formality: rowParse.data.formality,
    targetAudience: rowParse.data.target_audience,
    painPoints: rowParse.data.pain_points,
    language: rowParse.data.language,
    tone: rowParse.data.tone,
    contentLength: rowParse.data.content_length,
    readingLevel: rowParse.data.reading_level,
    notes: rowParse.data.notes,
    isDefault: rowParse.data.is_default,
    createdAt: rowParse.data.created_at,
    updatedAt: rowParse.data.updated_at,
  } satisfies StyleGuideResponse;

  // Validate the response
  const parsed = StyleGuideResponseSchema.safeParse(mapped);

  if (!parsed.success) {
    return failure(
      500,
      styleGuideErrorCodes.validationError,
      'Style guide response failed validation.',
      parsed.error.format(),
    );
  }

  return success(parsed.data, 200);
};
</file>

<file path=".env.example">
# Supabase Configuration
NEXT_PUBLIC_SUPABASE_URL=your-supabase-url
NEXT_PUBLIC_SUPABASE_ANON_KEY=your-supabase-anon-key
SUPABASE_URL=your-supabase-url
SUPABASE_SERVICE_ROLE_KEY=your-supabase-service-role-key

# Google Generative AI Configuration
GOOGLE_GENERATIVE_AI_API_KEY=your-google-api-key
</file>

<file path=".gitignore">
# See https://help.github.com/articles/ignoring-files/ for more about ignoring files.

# dependencies
/node_modules
/.pnp
.pnp.*
.yarn/*
!.yarn/patches
!.yarn/plugins
!.yarn/releases
!.yarn/versions

# testing
/coverage
playwright-report
test-results

# next.js
/.next/
/out/

# production
/build

# misc
.DS_Store
*.pem

# debug
npm-debug.log*
yarn-debug.log*
yarn-error.log*
.pnpm-debug.log*

# env files (can opt-in for committing if needed)
.env*
!.env.example
!.env.test

# vercel
.vercel

# EasyNext
.easynext

# typescript
*.tsbuildinfo
next-env.d.ts


# START Ruler Generated Files
/.codex/config.toml
/.codex/config.toml.bak
/.cursor/rules/ruler_cursor_instructions.mdc
/.cursor/rules/ruler_cursor_instructions.mdc.bak
/AGENTS.md
/AGENTS.md.bak
/CLAUDE.md
/CLAUDE.md.bak
# END Ruler Generated Files
</file>

<file path="tailwind.config.ts">
import type { Config } from "tailwindcss";

const config: Config = {
  darkMode: "class",
  content: [
    "./src/pages/**/*.{js,ts,jsx,tsx,mdx}",
    "./src/components/**/*.{js,ts,jsx,tsx,mdx}",
    "./src/app/**/*.{js,ts,jsx,tsx,mdx}",
  ],
  theme: {
    extend: {
      colors: {
        primary: {
          DEFAULT: "hsl(var(--primary))",
          foreground: "hsl(var(--primary-foreground))",
        },
        secondary: {
          DEFAULT: "hsl(var(--secondary))",
          foreground: "hsl(var(--secondary-foreground))",
        },
        accent: {
          DEFAULT: "hsl(var(--accent))",
          foreground: "hsl(var(--accent-foreground))",
        },
        background: "hsl(var(--background))",
        foreground: "hsl(var(--foreground))",
        card: {
          DEFAULT: "hsl(var(--card))",
          foreground: "hsl(var(--card-foreground))",
        },
        muted: {
          DEFAULT: "hsl(var(--muted))",
          foreground: "hsl(var(--muted-foreground))",
        },
        border: "hsl(var(--border))",
        input: "hsl(var(--input))",
        ring: "hsl(var(--ring))",
        destructive: {
          DEFAULT: "hsl(var(--destructive))",
          foreground: "hsl(var(--destructive-foreground))",
        },
      },
      fontFamily: {
        sans: ["Pretendard Variable", "sans-serif"],
      },
      fontSize: {
        sm: "14px",
        base: "16px",
        lg: "18px",
        xl: "20px",
        "2xl": "24px",
        "3xl": "30px",
        "4xl": "36px",
      },
      borderRadius: {
        lg: "var(--radius)",
        md: "calc(var(--radius) - 2px)",
        sm: "calc(var(--radius) - 4px)",
      },
      keyframes: {
        "accordion-down": {
          from: { height: "0" },
          to: { height: "var(--radix-accordion-content-height)" },
        },
        "accordion-up": {
          from: { height: "var(--radix-accordion-content-height)" },
          to: { height: "0" },
        },
      },
      animation: {
        "accordion-down": "accordion-down 0.2s ease-out",
        "accordion-up": "accordion-up 0.2s ease-out",
      },
    },
  },
  plugins: [require("tailwindcss-animate")],
};

export default config;
</file>

<file path="src/app/(protected)/dashboard/page.tsx">
"use client";

import { Suspense, useState, useEffect } from "react";
import { useSearchParams, useRouter } from "next/navigation";
import { useCurrentUser } from "@/features/auth/hooks/useCurrentUser";
import { WelcomeHeader } from "@/components/dashboard/welcome-header";
import { StatsCards } from "@/components/dashboard/stats-cards";
import { ActivityChart } from "@/components/dashboard/activity-chart";
import { RecentArticlesList } from "@/components/dashboard/recent-articles-list";
import { WelcomeBanner } from "@/components/dashboard/welcome-banner";

type DashboardPageProps = {
  params: Promise<Record<string, never>>;
};

const WELCOME_SHOWN_KEY = "onboarding_welcome_shown";

function DashboardContent() {
  const { user } = useCurrentUser();
  const searchParams = useSearchParams();
  const router = useRouter();
  const [showWelcomeBanner, setShowWelcomeBanner] = useState(false);

  useEffect(() => {
    // Check if welcome parameter is present
    const welcomeParam = searchParams.get("welcome");

    if (welcomeParam === "true") {
      // Check if banner has already been shown in this session
      const hasShownWelcome = sessionStorage.getItem(WELCOME_SHOWN_KEY);

      if (!hasShownWelcome) {
        // Show banner and mark as shown
        setShowWelcomeBanner(true);
        sessionStorage.setItem(WELCOME_SHOWN_KEY, "true");
      }

      // Clean URL by removing welcome parameter
      const newUrl = window.location.pathname;
      router.replace(newUrl);
    }
  }, [searchParams, router]);

  const getUserName = (email?: string) => {
    if (!email) return "Sam";
    return email.split("@")[0];
  };

  const handleDismissBanner = () => {
    setShowWelcomeBanner(false);
  };

  return (
    <div className="flex flex-col gap-8">
      {showWelcomeBanner && (
        <WelcomeBanner onDismiss={handleDismissBanner} />
      )}
      <WelcomeHeader userName={getUserName(user?.email)} />
      <StatsCards monthlyArticles={4} monthlyGoal={10} savedHours={8} />
      <ActivityChart />
      <RecentArticlesList />
    </div>
  );
}

export default function DashboardPage({ params }: DashboardPageProps) {
  void params;

  return (
    <Suspense fallback={<div className="flex flex-col gap-8">Loading...</div>}>
      <DashboardContent />
    </Suspense>
  );
}
</file>

<file path="src/app/(protected)/layout.tsx">
import { type ReactNode } from "react";
import { ClerkProvider } from "@clerk/nextjs";
import { Sidebar } from "@/components/layout/sidebar";
import { Header } from "@/components/layout/header";
import { loadCurrentUser } from "@/features/auth/server/load-current-user";
import { CurrentUserProvider } from "@/features/auth/context/current-user-context";

type ProtectedLayoutProps = {
  children: ReactNode;
};

/**
 * Protected Layout
 *
 * This layout wraps all authenticated routes with ClerkProvider and user context.
 *
 * Authentication and onboarding guards are handled by middleware.ts
 * This layout provides:
 * - ClerkProvider for authentication context
 * - CurrentUserProvider for user data
 * - UI structure for authenticated, onboarded users
 *
 * Middleware ensures:
 * - User is authenticated
 * - User has completed onboarding
 * - Unauthenticated users are redirected to /sign-in
 * - Users without onboarding are redirected to /auth/onboarding
 *
 * By placing ClerkProvider here instead of root layout:
 * - 404 pages and error routes work without Clerk context
 * - Static asset requests don't trigger Clerk middleware errors
 * - Clerk only runs on routes matched by clerkMiddleware()
 */
export default async function ProtectedLayout({
  children,
}: ProtectedLayoutProps) {
  const currentUser = await loadCurrentUser();

  return (
    <ClerkProvider>
      <CurrentUserProvider initialState={currentUser}>
        <div className="flex h-screen overflow-hidden">
          <Sidebar />
          <div className="flex flex-1 flex-col overflow-hidden">
            <Header />
            <main className="flex-1 overflow-y-auto bg-background p-8">
              {children}
            </main>
          </div>
        </div>
      </CurrentUserProvider>
    </ClerkProvider>
  );
}
</file>

<file path="src/app/globals.css">
@import "tailwindcss";

@plugin "@tailwindcss/typography";
@plugin "tailwindcss-animate";

@custom-variant dark (&:where(.dark, .dark *));

@utility container {
  margin-inline: auto;
  width: 100%;
  padding-inline: 2rem;
  @media (width >= 1400px) {
    max-width: 1400px;
  }
}

@theme {
  --color-border: hsl(var(--border));
  --color-input: hsl(var(--input));
  --color-ring: hsl(var(--ring));
  --color-background: hsl(var(--background));
  --color-foreground: hsl(var(--foreground));

  --color-primary: hsl(var(--primary));
  --color-primary-foreground: hsl(var(--primary-foreground));

  --color-secondary: hsl(var(--secondary));
  --color-secondary-foreground: hsl(var(--secondary-foreground));

  --color-destructive: hsl(var(--destructive));
  --color-destructive-foreground: hsl(var(--destructive-foreground));

  --color-muted: hsl(var(--muted));
  --color-muted-foreground: hsl(var(--muted-foreground));

  --color-accent: hsl(var(--accent));
  --color-accent-foreground: hsl(var(--accent-foreground));

  --color-popover: hsl(var(--popover));
  --color-popover-foreground: hsl(var(--popover-foreground));

  --color-card: hsl(var(--card));
  --color-card-foreground: hsl(var(--card-foreground));

  --radius-lg: var(--radius);
  --radius-md: calc(var(--radius) - 2px);
  --radius-sm: calc(var(--radius) - 4px);

  --animate-accordion-down: accordion-down 0.2s ease-out;
  --animate-accordion-up: accordion-up 0.2s ease-out;

  @keyframes accordion-down {
    from {
      height: 0;
    }
    to {
      height: var(--radix-accordion-content-height);
    }
  }
  @keyframes accordion-up {
    from {
      height: var(--radix-accordion-content-height);
    }
    to {
      height: 0;
    }
  }
}

/*
  The default border color has changed to `currentcolor` in Tailwind CSS v4,
  so we've added these compatibility styles to make sure everything still
  looks the same as it did with Tailwind CSS v3.

  If we ever want to remove these styles, we need to add an explicit border
  color utility to any element that depends on these defaults.
*/
@layer base {
  *,
  ::after,
  ::before,
  ::backdrop,
  ::file-selector-button {
    border-color: var(--color-gray-200, currentcolor);
  }
}

@layer base {
  :root {
    --background: 0 0% 100%;
    --foreground: 240 10% 3.9%;
    --card: 0 0% 100%;
    --card-foreground: 240 10% 3.9%;
    --popover: 0 0% 100%;
    --popover-foreground: 240 10% 3.9%;
    --primary: 240 5.9% 10%;
    --primary-foreground: 60 9.1% 97.8%;
    --secondary: 240 4.8% 95.9%;
    --secondary-foreground: 240 5.9% 10%;
    --muted: 240 4.8% 95.9%;
    --muted-foreground: 240 3.8% 46.1%;
    --accent: 240 4.8% 95.9%;
    --accent-foreground: 240 5.9% 10%;
    --destructive: 0 84.2% 60.2%;
    --destructive-foreground: 60 9.1% 97.8%;
    --border: 240 5.9% 90%;
    --input: 240 5.9% 90%;
    --ring: 240 10% 3.9%;
    --radius: 0.5rem;
    --chart-1: 12 76% 61%;
    --chart-2: 173 58% 39%;
    --chart-3: 197 37% 24%;
    --chart-4: 43 74% 66%;
    --chart-5: 27 87% 67%;
  }

  .dark {
    --background: 0 0% 3.9%;
    --foreground: 0 0% 98%;
    --card: 0 0% 3.9%;
    --card-foreground: 0 0% 98%;
    --popover: 0 0% 3.9%;
    --popover-foreground: 0 0% 98%;
    --primary: 0 0% 98%;
    --primary-foreground: 0 0% 9%;
    --secondary: 0 0% 14.9%;
    --secondary-foreground: 0 0% 98%;
    --muted: 0 0% 14.9%;
    --muted-foreground: 0 0% 63.9%;
    --accent: 0 0% 14.9%;
    --accent-foreground: 0 0% 98%;
    --destructive: 0 62.8% 30.6%;
    --destructive-foreground: 0 0% 98%;
    --border: 0 0% 14.9%;
    --input: 0 0% 14.9%;
    --ring: 0 0% 83.1%;
    --chart-1: 220 70% 50%;
    --chart-2: 160 60% 45%;
    --chart-3: 30 80% 55%;
    --chart-4: 280 65% 60%;
    --chart-5: 340 75% 55%;
  }
}

@layer base {
  * {
    @apply border-border;
  }
  body {
    @apply bg-background text-foreground;
  }
}

/* Screen reader only utility */
.sr-only {
  position: absolute;
  width: 1px;
  height: 1px;
  padding: 0;
  margin: -1px;
  overflow: hidden;
  clip: rect(0, 0, 0, 0);
  white-space: nowrap;
  border-width: 0;
}
</file>

<file path="src/app/layout.tsx">
import type { Metadata } from "next";
import "./globals.css";
import Providers from "./providers";

export const metadata: Metadata = {
  title: "ì½˜í…ì¸ ë©”ì´ì»¤",
  description: "AI ê¸°ë°˜ ì½˜í…ì¸  ìƒì„± SaaS",
};

/**
 * Root Layout
 *
 * This layout provides the base HTML structure and global styles.
 * It does NOT include ClerkProvider or authentication logic.
 *
 * Authentication is handled in the (protected) sub-layout to ensure:
 * - 404 pages and error routes work without Clerk context
 * - Static asset requests don't trigger Clerk middleware errors
 * - Clerk only runs on authenticated routes matched by middleware
 */
export default function RootLayout({
  children,
}: Readonly<{
  children: React.ReactNode;
}>) {
  return (
    <html lang="ko" suppressHydrationWarning>
      <head>
        <link
          rel="stylesheet"
          as="style"
          crossOrigin="anonymous"
          href="https://cdn.jsdelivr.net/gh/orioncactus/pretendard@v1.3.9/dist/web/variable/pretendardvariable.min.css"
        />
      </head>
      <body className="antialiased font-sans">
        <Providers>{children}</Providers>
      </body>
    </html>
  );
}
</file>

<file path="src/backend/hono/app.ts">
import { Hono } from 'hono';
import { errorBoundary } from '@/backend/middleware/error';
import { withAppContext } from '@/backend/middleware/context';
import { withSupabase } from '@/backend/middleware/supabase';
import { registerExampleRoutes } from '@/features/example/backend/route';
import { registerOnboardingRoutes } from '@/features/onboarding/backend/route';
import { registerArticlesRoutes } from '@/features/articles/backend/route';
import type { AppEnv } from '@/backend/hono/context';

let singletonApp: Hono<AppEnv> | null = null;

export const createHonoApp = () => {
  // In development, always recreate the app to support HMR
  // In production, use singleton pattern for performance
  const isDevelopment = process.env.NODE_ENV === 'development';

  if (!isDevelopment && singletonApp) {
    return singletonApp;
  }

  const app = new Hono<AppEnv>();

  app.use('*', errorBoundary());
  app.use('*', withAppContext());
  app.use('*', withSupabase());

  registerExampleRoutes(app);
  registerOnboardingRoutes(app);
  registerArticlesRoutes(app);

  // Only cache in production
  if (!isDevelopment) {
    singletonApp = app;
  }

  return app;
};
</file>

<file path="src/middleware.ts">
import { clerkMiddleware, createRouteMatcher } from "@clerk/nextjs/server";
import { NextResponse } from "next/server";

/**
 * Authentication and Onboarding Guard Middleware
 *
 * This middleware implements a three-stage routing guard system:
 *
 * STAGE 1: Onboarding Route Guard
 * - Route: /auth/onboarding
 * - Requires: User authentication
 * - Redirect: Unauthenticated users â†’ /sign-in
 * - Reverse: Completed onboarding â†’ /dashboard (prevents re-access)
 *
 * STAGE 2: Protected Routes Guard
 * - Routes: /dashboard, /new-article, /style-guide, /account, /editor, /settings
 * - Requires: User authentication + completed onboarding
 * - Redirect: Unauthenticated users â†’ /sign-in (via auth.protect())
 * - Redirect: Authenticated users without onboarding â†’ /auth/onboarding
 *
 * STAGE 3: Public Routes
 * - All other routes pass through without checks
 * - Includes: /sign-in, /sign-up, /auth/after, static assets
 *
 * ONBOARDING STATUS CHECK:
 * - Uses sessionClaims.publicMetadata.onboardingCompleted (boolean)
 * - No database calls (metadata-based for performance)
 * - Set during onboarding completion via updateUser()
 */

const isProtectedRoute = createRouteMatcher([
  "/dashboard(.*)",
  "/new-article(.*)",
  "/style-guide(.*)",
  "/account(.*)",
  "/editor(.*)",
  "/settings(.*)",
]);

const isOnboardingRoute = createRouteMatcher(["/auth/onboarding(.*)"]);

export default clerkMiddleware(async (auth, req) => {
  const { userId, sessionClaims } = await auth();

  // STAGE 1: Onboarding Route Guard
  if (isOnboardingRoute(req)) {
    // Require authentication for onboarding page
    if (!userId) {
      const signInUrl = new URL("/sign-in", req.url);
      return NextResponse.redirect(signInUrl);
    }

    // Reverse redirect: If onboarding already completed, redirect to dashboard
    const metadata = sessionClaims?.publicMetadata as { onboardingCompleted?: boolean } | undefined;
    const onboardingCompleted = metadata?.onboardingCompleted === true;

    if (onboardingCompleted) {
      const dashboardUrl = new URL("/dashboard", req.url);
      return NextResponse.redirect(dashboardUrl);
    }

    return NextResponse.next();
  }

  // STAGE 2: Protected Routes Guard
  if (isProtectedRoute(req)) {
    // STAGE 2a: Require authentication
    if (!userId) {
      await auth.protect(); // Redirects to sign-in
      return;
    }

    // STAGE 2b: Require completed onboarding
    const metadata = sessionClaims?.publicMetadata as { onboardingCompleted?: boolean } | undefined;
    const onboardingCompleted = metadata?.onboardingCompleted === true;

    // BYPASS: If onboarding was just completed (indicated by query param), skip the check
    // This allows the user to navigate to dashboard immediately after completing onboarding
    // The session will be refreshed on the next request
    const url = new URL(req.url);
    const justCompletedOnboarding = url.searchParams.get("onboarding_completed") === "true";

    if (!onboardingCompleted && !justCompletedOnboarding) {
      const onboardingUrl = new URL("/auth/onboarding", req.url);
      return NextResponse.redirect(onboardingUrl);
    }

    // If bypassed, clean up the query param by redirecting without it
    if (justCompletedOnboarding && !onboardingCompleted) {
      url.searchParams.delete("onboarding_completed");
      return NextResponse.redirect(url);
    }
  }

  // STAGE 3: Public routes pass through
});

export const config = {
  matcher: [
    // Skip Next.js internals and all static files, unless found in search params
    "/((?!_next|[^?]*\\.(?:html?|css|js(?!on)|jpe?g|webp|png|gif|svg|ttf|woff2?|ico|csv|docx?|xlsx?|zip|webmanifest)).*)",
    // Always run for API routes
    "/(api|trpc)(.*)",
  ],
};
</file>

<file path="package.json">
{
  "name": "template",
  "version": "0.1.3",
  "private": true,
  "type": "module",
  "scripts": {
    "dev": "next dev --turbopack",
    "build": "next build",
    "start": "next start",
    "lint": "next lint",
    "test": "vitest run",
    "test:watch": "vitest",
    "test:ui": "vitest --ui",
    "test:coverage": "vitest run --coverage",
    "test:e2e": "playwright test",
    "test:e2e:watch": "playwright test --ui",
    "test:e2e:headed": "playwright test --headed",
    "test:all": "run-p test test:e2e",
    "typecheck": "tsc --noEmit",
    "env:check": "dotenv -e .env.local -- tsx scripts/check-env.ts"
  },
  "dependencies": {
    "@ai-sdk/google": "^2.0.29",
    "@clerk/nextjs": "^6.34.5",
    "@hookform/resolvers": "^4",
    "@radix-ui/react-accordion": "^1.2.3",
    "@radix-ui/react-avatar": "^1.1.2",
    "@radix-ui/react-checkbox": "^1.1.1",
    "@radix-ui/react-dialog": "^1.1.4",
    "@radix-ui/react-dropdown-menu": "^2.1.1",
    "@radix-ui/react-label": "^2.1.0",
    "@radix-ui/react-progress": "^1.1.8",
    "@radix-ui/react-select": "^2.1.4",
    "@radix-ui/react-separator": "^1.1.1",
    "@radix-ui/react-slot": "^1.1.0",
    "@radix-ui/react-tabs": "^1.1.13",
    "@radix-ui/react-toast": "^1.2.6",
    "@supabase/ssr": "^0.5.2",
    "@supabase/supabase-js": "^2.58.0",
    "@tanstack/react-query": "^5",
    "ai": "^5.0.89",
    "axios": "^1.7.9",
    "class-variance-authority": "^0.7.0",
    "clsx": "^2.1.1",
    "date-fns": "^4",
    "es-toolkit": "^1",
    "framer-motion": "^11",
    "hono": "^4.9.9",
    "lucide-react": "^0.469.0",
    "next": "15.1.0",
    "next-themes": "^0.4.3",
    "react": "^19.0.0",
    "react-dom": "^19.0.0",
    "react-hook-form": "^7",
    "react-use": "^17",
    "server-only": "0.0.1",
    "sonner": "^2.0.7",
    "ts-pattern": "^5",
    "zod": "^3",
    "zustand": "^4"
  },
  "devDependencies": {
    "@eslint/eslintrc": "^3",
    "@playwright/test": "^1.56.0",
    "@tailwindcss/postcss": "^4.1.13",
    "@tailwindcss/typography": "^0.5.10",
    "@testing-library/dom": "^10.4.1",
    "@testing-library/jest-dom": "^6.9.1",
    "@testing-library/react": "^16.3.0",
    "@testing-library/user-event": "^14.6.1",
    "@types/node": "^20",
    "@types/react": "^19",
    "@types/react-dom": "^19",
    "@vitejs/plugin-react": "^5.0.4",
    "@vitest/coverage-v8": "^3.2.4",
    "@vitest/ui": "^3.2.4",
    "dotenv-cli": "^10.0.0",
    "eslint": "^9",
    "eslint-config-next": "15.1.0",
    "happy-dom": "^19.0.2",
    "npm-run-all": "^4.1.5",
    "postcss": "^8",
    "tailwind-merge": "^2.5.2",
    "tailwindcss": "^4.1.13",
    "tailwindcss-animate": "^1.0.7",
    "tsx": "^4.20.6",
    "typescript": "^5",
    "vitest": "^3.2.4"
  }
}
</file>

</files>
